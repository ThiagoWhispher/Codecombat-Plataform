{"version":3,"sources":["app/models/Achievement.coffee"],"names":[],"mappings":";AAAA;EAAA;;;AAAA,YAAY,QAAQ,aAAR;;AACZ,QAAQ,QAAQ,eAAR;;AAER,MAAM,CAAC,OAAP,GAAuB;;;;;;;EACrB,WAAC,UAAD,GAAY;;EACZ,WAAC,OAAD,GAAS,QAAQ,4BAAR;;wBACT,UAAS;;wBACT,qBAAoB;;wBAEpB,eAAc;WACZ;EADY;;wBAGd,iBAAgB;AACd;IAAA,OAAO,IAAC,IAAD,CAAK,UAAL,EAAiB,IAAjB;IACP,IAA6D,IAAI,CAAC,IAAL,IAAa,KAAK,CAAC,gBAAhF;AAAA,aAAO,KAAK,CAAC,gBAAiB,KAAI,CAAC,IAAL,CAAvB,CAAkC,IAAI,CAAC,UAAvC,EAAP;;EAFc;;wBAIhB,OAAM;IACJ,IAAC,aAAD;WACA,uCAAM,SAAN;EAFI;;EAIN,WAAC,aAAD,GACE;IAAA,GAAG,kBAAH;IACA,GAAG,mBADH;IAEA,GAAG,oBAFH;IAGA,GAAG,kBAHH;IAIA,GAAG,qBAJH;;;wBAMF,WAAU;WAAG,WAAW,CAAC,YAAa,KAAC,IAAD,CAAK,YAAL,EAAmB,IAAnB;EAA5B;;EAEV,WAAC,gBAAD,GAAkB;;wBAElB,cAAa;IACX,IAAG,IAAC,IAAD,CAAK,MAAL,CAAH;aAAoB,WAAW,IAAC,IAAD,CAAK,MAAL,EAA/B;KAAA;aAAiD,WAAW,CAAC,gBAA7D;;EADW;;wBAGb,WAAU;WAAG;EAAH;;wBAGV,mBAAkB;AAChB;IAAA,IAA0B,IAAC,eAA3B;AAAA,aAAO,IAAC,gBAAR;;IACA,SAAS,QAAQ,CAAC,aAAT,CAAuB,QAAvB;IACT,QAAQ,IAAI;IACZ,KAAK,CAAC,GAAN,GAAY,IAAC,YAAD;IACZ,QAAQ,CAAC,CAAC,QAAF;IACR,KAAK,CAAC,MAAN,GAAe;aAAA;AACb;QAAA,MAAM,CAAC,KAAP,GAAe,KAAK,CAAC;QACrB,MAAM,CAAC,MAAP,GAAgB,KAAK,CAAC;QACtB,UAAU,MAAM,CAAC,UAAP,CAAkB,IAAlB;QACV,OAAO,CAAC,SAAR,CAAkB,KAAlB,EAAyB,CAAzB,EAA4B,CAA5B;QACA,UAAU,OAAO,CAAC,YAAR,CAAqB,CAArB,EAAwB,CAAxB,EAA2B,MAAM,CAAC,KAAlC,EAAyC,MAAM,CAAC,MAAhD;QACV,UAAU,KAAK,CAAC,SAAN,CAAgB,OAAhB;QACV,OAAO,CAAC,YAAR,CAAqB,OAArB,EAA8B,CAA9B,EAAiC,CAAjC;QACA,KAAC,eAAD,GAAkB,MAAM,CAAC,SAAP;eAClB,KAAK,CAAC,OAAN,CAAc,KAAC,eAAf;MATa;IAAA;WAUf;EAhBgB;;wBAkBlB,oBAAmB;WAAG,IAAC;EAAJ;;wBAEnB,WAAU;WAAG,KAAK,CAAC,IAAN,CAAW,IAAC,WAAZ,EAAwB,MAAxB;EAAH;;wBAEV,kBAAiB;WAAG,KAAK,CAAC,IAAN,CAAW,IAAC,WAAZ,EAAwB,aAAxB;EAAH;;;;GAxDwB","file":"public/javascripts/app/models/Achievement.js","sourcesContent":["CocoModel = require './CocoModel'\r\nutils = require '../core/utils'\r\n\r\nmodule.exports = class Achievement extends CocoModel\r\n  @className: 'Achievement'\r\n  @schema: require 'schemas/models/achievement'\r\n  urlRoot: '/db/achievement'\r\n  editableByArtisans: true\r\n\r\n  isRepeatable: ->\r\n    @get('proportionalTo')?\r\n\r\n  getExpFunction: ->\r\n    func = @get('function', true)\r\n    return utils.functionCreators[func.kind](func.parameters) if func.kind of utils.functionCreators\r\n\r\n  save: ->\r\n    @populateI18N()\r\n    super(arguments...)\r\n\r\n  @styleMapping:\r\n    1: 'achievement-wood'\r\n    2: 'achievement-stone'\r\n    3: 'achievement-silver'\r\n    4: 'achievement-gold'\r\n    5: 'achievement-diamond'\r\n\r\n  getStyle: -> Achievement.styleMapping[@get 'difficulty', true]\r\n\r\n  @defaultImageURL: '/images/achievements/default.png'\r\n\r\n  getImageURL: ->\r\n    if @get 'icon' then '/file/' + @get('icon') else Achievement.defaultImageURL\r\n\r\n  hasImage: -> @get('icon')?\r\n\r\n  # TODO Could cache the default icon separately\r\n  cacheLockedImage: ->\r\n    return @lockedImageURL if @lockedImageURL\r\n    canvas = document.createElement 'canvas'\r\n    image = new Image\r\n    image.src = @getImageURL()\r\n    defer = $.Deferred()\r\n    image.onload = =>\r\n      canvas.width = image.width\r\n      canvas.height = image.height\r\n      context = canvas.getContext '2d'\r\n      context.drawImage image, 0, 0\r\n      imgData = context.getImageData 0, 0, canvas.width, canvas.height\r\n      imgData = utils.grayscale imgData\r\n      context.putImageData imgData, 0, 0\r\n      @lockedImageURL = canvas.toDataURL()\r\n      defer.resolve @lockedImageURL\r\n    defer\r\n\r\n  getLockedImageURL: -> @lockedImageURL\r\n\r\n  i18nName: -> utils.i18n @attributes, 'name'\r\n\r\n  i18nDescription: -> utils.i18n @attributes, 'description'\r\n"]}