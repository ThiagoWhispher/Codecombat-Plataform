{"version":3,"sources":["app/templates/editor/component/thang-component-config-view.jade","app/views/editor/component/ThangComponentConfigView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/editor/component/ThangComponentConfigView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),view = locals_.view;buf.push(\"<div class=\\\"panel panel-default\\\"><div\" + (jade.attrs({ \"class\": [('panel-heading'),(view.isDefaultComponent ? \"is-default-component\" : \"\")] }, {\"class\":true})) + \"><em>\" + (jade.escape((jade.interp = view.component.attributes.system) == null ? '' : jade.interp)) + \".</em><strong class=\\\"panel-title spr\\\">\" + (jade.escape(null == (jade.interp = view.component.attributes.name) ? \"\" : jade.interp)) + \"</strong><span id=\\\"description\\\" class=\\\"text-muted\\\">\" + (jade.escape(null == (jade.interp = view.component.attributes.description) ? \"\" : jade.interp)) + \"</span></div><div class=\\\"panel-body\\\"><div class=\\\"treema\\\"></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","CocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/editor/component/thang-component-config-view'\r\n\r\nLevel = require 'models/Level'\r\nLevelComponent = require 'models/LevelComponent'\r\nnodes = require '../level/treema_nodes'\r\nrequire 'vendor/treema'\r\n\r\nmodule.exports = class ThangComponentConfigView extends CocoView\r\n  className: 'thang-component-config-view'\r\n  template: template\r\n  changed: false\r\n\r\n  constructor: (options) ->\r\n    super options\r\n    @component = options.component\r\n    @config = options.config or {}\r\n    @additionalDefaults = options.additionalDefaults\r\n    @isDefaultComponent = false\r\n    @world = options.world\r\n    @level = options.level\r\n    @callback = options.callback\r\n\r\n  afterRender: ->\r\n    super()\r\n    @buildTreema()\r\n\r\n  setConfig: (config) ->\r\n    @handlingChange = true\r\n    @editThangTreema.set('/', config)\r\n    @handlingChange = false\r\n\r\n  setIsDefaultComponent: (isDefaultComponent) ->\r\n    changed = @isDefaultComponent isnt isDefaultComponent\r\n    if isDefaultComponent then @config = undefined\r\n    @isDefaultComponent = isDefaultComponent\r\n    @render() if changed\r\n\r\n  buildTreema: ->\r\n    thangs = if @level? then @level.get('thangs') else []\r\n    thangIDs = _.filter(_.pluck(thangs, 'id'))\r\n    teams = _.filter(_.pluck(thangs, 'team'))\r\n    superteams = _.filter(_.pluck(thangs, 'superteam'))\r\n    superteams = _.union(teams, superteams)\r\n    schema = $.extend true, {}, @component.get('configSchema')\r\n    schema.default ?= {}\r\n    _.merge schema.default, @additionalDefaults if @additionalDefaults\r\n\r\n    if @level?.isType('hero', 'hero-ladder', 'hero-coop', 'course', 'course-ladder', 'game-dev', 'web-dev')\r\n      schema.required = []\r\n    treemaOptions =\r\n      supermodel: @supermodel\r\n      schema: schema\r\n      data: @config\r\n      callbacks: {change: @onConfigEdited}\r\n      world: @world\r\n      view: @\r\n      thangIDs: thangIDs\r\n      teams: teams\r\n      superteams: superteams\r\n      nodeClasses:\r\n        object: ComponentConfigNode\r\n        'point2d': nodes.WorldPointNode\r\n        'viewport': nodes.WorldViewportNode\r\n        'bounds': nodes.WorldBoundsNode\r\n        'radians': nodes.RadiansNode\r\n        'team': nodes.TeamNode\r\n        'superteam': nodes.SuperteamNode\r\n        'meters': nodes.MetersNode\r\n        'kilograms': nodes.KilogramsNode\r\n        'seconds': nodes.SecondsNode\r\n        'speed': nodes.SpeedNode\r\n        'acceleration': nodes.AccelerationNode\r\n        'thang-type': nodes.ThangTypeNode\r\n        'item-thang-type': nodes.ItemThangTypeNode\r\n        'solutions': SolutionsNode\r\n\r\n    @editThangTreema = @$el.find('.treema').treema treemaOptions\r\n    @editThangTreema.build()\r\n    @editThangTreema.open(2)\r\n    if _.isEqual(@editThangTreema.data, {}) and not @editThangTreema.canAddChild()\r\n      @$el.find('.panel-body').hide()\r\n\r\n  onConfigEdited: =>\r\n    return if @destroyed or @handlingChange\r\n    @config = @data()\r\n    @changed = true\r\n    @trigger 'changed', { component: @component, config: @config }\r\n\r\n  data: -> @editThangTreema.data\r\n\r\n  destroy: ->\r\n    @editThangTreema?.destroy()\r\n    super()\r\n\r\nclass ComponentConfigNode extends TreemaObjectNode\r\n  nodeDescription: 'Component Property'\r\n\r\nclass SolutionsNode extends TreemaArrayNode\r\n  buildValueForDisplay: (valEl, data) ->\r\n    btn = $('<button class=\"btn btn-default btn-xs\">Fill defaults</button>')\r\n    btn.on('click', @onClickFillDefaults)\r\n    valEl.append(btn)\r\n\r\n  onClickFillDefaults: (e) =>\r\n    e.preventDefault()\r\n\r\n    sources = { javascript: @parent.data.source }\r\n    _.extend sources, @parent.data.languages or {}\r\n    solutions = _.clone(@data)\r\n    solutions = _.filter(solutions, (solution) -> not _.isEmpty(solution) )\r\n    for language in _.keys(sources)\r\n      source = sources[language]\r\n      solution = _.findWhere(solutions, {language: language})\r\n      continue if solution\r\n      solutions.push({\r\n        source: source\r\n        language: language\r\n        succeeds: true\r\n      })\r\n\r\n    @set('/', solutions)\r\n"]}