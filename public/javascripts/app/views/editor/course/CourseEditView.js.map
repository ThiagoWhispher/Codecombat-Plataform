{"version":3,"sources":["app/views/editor/course/CourseEditView.coffee"],"names":[],"mappings":";AAAA;EAAA;;;AAAA,WAAW,QAAQ,qBAAR;;AACX,WAAW,QAAQ,8BAAR;;AACX,SAAS,QAAQ,eAAR;;AACT,eAAe,QAAQ,yBAAR;;AACf,cAAc,QAAQ,0BAAR;;AACd,SAAS,QAAQ,aAAR;;AACT,MAAM,QAAQ,kBAAR;;AAEN,QAAQ,gBAAR;;AAEA,MAAM,CAAC,OAAP,GAAuB;;;2BACrB,KAAI;;2BACJ,WAAU;;2BAEV,SACE;IAAA,sBAAsB,mBAAtB;;;EAEW,wBAAC,OAAD,EAAU,QAAV;IAAU,IAAC,YAAD;IACrB,gDAAM,OAAN;IACA,IAAC,OAAD,GAAc,WAAO;MAAA,KAAK,IAAC,SAAN;KAAP;IACd,IAAC,OAAM,CAAC,WAAR,GAAsB;IACtB,IAAC,WAAU,CAAC,SAAZ,CAAsB,IAAC,OAAvB;EAJW;;2BAMb,WAAU;IACR;IACA,IAAC,YAAD;WACA,IAAC,SAAD,CAAU,IAAC,OAAX,EAAmB,QAAnB,EAA6B;aAAA;QAC3B,KAAC,OAAM,CAAC,kBAAR;eACA,KAAC,OAAM,CAAC,GAAR,CAAY,GAAZ,EAAiB,KAAC,OAAM,CAAC,UAAzB;MAF2B;IAAA,QAA7B;EAHQ;;2BAOV,cAAa;AACX;IAAA,IAAU,yBAAY,CAAC,CAAI,IAAC,OAAM,CAAC,MAAb,CAAtB;AAAA;;IACA,OAAO,CAAC,CAAC,MAAF,CAAS,IAAT,EAAe,EAAf,EAAmB,IAAC,OAAM,CAAC,UAA3B;IACP,UACE;MAAA,MAAM,IAAN;MACA,UAAU,eAAY,CAAC,IAAC,OAAM,CAAC,GAAR,CAAY,KAAZ,CAAD,CADtB;MAEA,QAAQ,MAAM,CAAC,MAFf;MAGA,UAAU,EAAE,CAAC,GAAH,CAAO,WAAP,CAHV;MAIA,YAAY,IAAC,WAJb;;IAKF,IAAC,OAAD,GAAU,IAAC,IAAG,CAAC,IAAL,CAAU,gBAAV,CAA2B,CAAC,MAA5B,CAAmC,OAAnC;IACV,IAAC,OAAM,CAAC,KAAR;oEAC+B,CAAE,IAAjC,CAAsC,CAAtC;EAXW;;2BAab,cAAa;IACX;IACA,KAAc,IAAC,WAAU,CAAC,QAAZ,EAAd;AAAA;;IACA,IAAmB,EAAE,CAAC,GAAH,CAAO,WAAP,CAAnB;MAAA,IAAC,aAAD;;IACA,IAAC,YAAD,GAAe,IAAC,cAAD,CAAmB,gBAAY,IAAC,OAAb,CAAnB,EAAyC,IAAC,IAAG,CAAC,IAAL,CAAU,eAAV,CAAzC;WACf,IAAC,YAAW,CAAC,IAAb;EALW;;2BAOb,oBAAmB,SAAC,CAAD;AACjB;IAAA,IAAC,OAAM,CAAC,gBAAR;AACA;AAAA;;MACE,IAAC,OAAM,CAAC,GAAR,CAAY,GAAZ,EAAiB,KAAjB;AADF;IAEA,IAAC,OAAM,CAAC,kBAAR;IAEA,MAAM,IAAC,OAAM,CAAC,IAAR;IAEN,GAAG,CAAC,KAAJ,CAAU;aAAA,SAAC,UAAD,EAAa,QAAb,EAAuB,OAAvB;eACR,OAAO,CAAC,KAAR,CAAc,QAAd;MADQ;IAAA,QAAV;WAGA,GAAG,CAAC,OAAJ,CAAY;aAAA;AACV;QAAA,MAAM,oBAAiB,CAAC,KAAC,OAAM,CAAC,GAAR,CAAY,MAAZ,KAAuB,KAAC,OAAM,CAAC,EAAhC;eACvB,QAAQ,CAAC,QAAQ,CAAC,IAAlB,GAAyB;MAFf;IAAA,QAAZ;EAXiB;;;;GAxCyB","file":"public/javascripts/app/views/editor/course/CourseEditView.js","sourcesContent":["RootView = require 'views/core/RootView'\r\ntemplate = require 'templates/editor/course/edit'\r\nCourse = require 'models/Course'\r\nConfirmModal = require 'views/core/ConfirmModal'\r\nPatchesView = require 'views/editor/PatchesView'\r\nerrors = require 'core/errors'\r\napp = require 'core/application'\r\n\r\nrequire 'game-libraries'\r\n\r\nmodule.exports = class CourseEditView extends RootView\r\n  id: 'editor-course-edit-view'\r\n  template: template\r\n\r\n  events:\r\n    'click #save-button': 'onClickSaveButton'\r\n\r\n  constructor: (options, @courseID) ->\r\n    super options\r\n    @course = new Course(_id: @courseID)\r\n    @course.saveBackups = true\r\n    @supermodel.loadModel @course\r\n\r\n  onLoaded: ->\r\n    super()\r\n    @buildTreema()\r\n    @listenTo @course, 'change', =>\r\n      @course.updateI18NCoverage()\r\n      @treema.set('/', @course.attributes)\r\n\r\n  buildTreema: ->\r\n    return if @treema? or (not @course.loaded)\r\n    data = $.extend(true, {}, @course.attributes)\r\n    options =\r\n      data: data\r\n      filePath: \"db/course/#{@course.get('_id')}\"\r\n      schema: Course.schema\r\n      readOnly: me.get('anonymous')\r\n      supermodel: @supermodel\r\n    @treema = @$el.find('#course-treema').treema(options)\r\n    @treema.build()\r\n    @treema.childrenTreemas.rewards?.open(3)\r\n\r\n  afterRender: ->\r\n    super()\r\n    return unless @supermodel.finished()\r\n    @showReadOnly() if me.get('anonymous')\r\n    @patchesView = @insertSubView(new PatchesView(@course), @$el.find('.patches-view'))\r\n    @patchesView.load()\r\n\r\n  onClickSaveButton: (e) ->\r\n    @treema.endExistingEdits()\r\n    for key, value of @treema.data\r\n      @course.set(key, value)\r\n    @course.updateI18NCoverage()\r\n\r\n    res = @course.save()\r\n\r\n    res.error (collection, response, options) =>\r\n      console.error response\r\n\r\n    res.success =>\r\n      url = \"/editor/course/#{@course.get('slug') or @course.id}\"\r\n      document.location.href = url\r\n"]}