{"version":3,"sources":["app/views/editor/PatchesView.coffee"],"names":[],"mappings":";AAAA;EAAA;;;AAAA,WAAW,QAAQ,qBAAR;;AACX,WAAW,QAAQ,0BAAR;;AACX,oBAAoB,QAAQ,+BAAR;;AACpB,aAAa,QAAQ,iBAAR;;AACb,aAAa,QAAQ,cAAR;;AAEb,MAAM,CAAC,OAAP,GAAuB;;;wBACrB,WAAU;;wBACV,YAAW;;wBACX,SAAQ;;wBAER,SACE;IAAA,0BAA0B,wBAA1B;IACA,oBAAoB,gBADpB;;;EAGW,qBAAC,KAAD,EAAS,OAAT;IAAC,IAAC,SAAD;IACZ,6CAAM,OAAN;IACA,IAAC,YAAD;EAFW;;wBAIb,cAAa;IACX,IAAC,eAAD,GAAkB;WAClB,IAAC,QAAD,GAAW,IAAC,MAAK,CAAC,sBAAP;EAFA;;wBAIb,OAAM;IACJ,IAAC,YAAD;IACA,IAAC,QAAD,GAAW,IAAC,MAAK,CAAC,sBAAP,CAA8B,IAAC,OAA/B,EAAuC;MAAC,OAAO,KAAR;KAAvC;IACX,IAAC,WAAU,CAAC,eAAZ,CAA4B,IAAC,QAA7B;WACA,IAAC,SAAD,CAAU,IAAC,QAAX,EAAoB,MAApB,EAA4B,IAAC,gBAA7B;EAJI;;wBAMN,kBAAiB;AACf;IAAA;;AAAO;AAAA;WAAA;;qBAAA,CAAC,CAAC,GAAF,CAAM,SAAN;AAAA;;;IACP,eAAe,UAAU,CAAC,SAAX,CAAqB,GAArB;IACf,IAAqE,YAArE;aAAA,IAAC,WAAU,CAAC,kBAAZ,CAA+B,YAA/B,EAA6C,YAA7C,CAA0D,CAAC,IAA3D;;EAHe;;wBAKjB,gBAAe;AACb;IAAA,IAAI;AACJ;AAAA;;MAAA,KAAK,CAAC,QAAN,GAAiB,UAAU,CAAC,OAAX,CAAmB,KAAK,CAAC,GAAN,CAAU,SAAV,CAAnB;AAAjB;IACA,CAAC,CAAC,OAAF,GAAY,IAAC,QAAO,CAAC;IACrB,CAAC,CAAC;WACF;EALa;;wBAOf,cAAa;IACX,IAAC,IAAG,CAAC,IAAL,CAAU,MAAI,IAAC,OAAf,CAAwB,CAAC,QAAzB,CAAkC,QAAlC;WACA;EAFW;;wBAIb,yBAAwB,SAAC,CAAD;IACtB,IAAC,OAAD,GAAU,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,GAAZ;WACV,IAAC,cAAD;EAFsB;;wBAIxB,gBAAe;IACb,IAAC,WAAU,CAAC,aAAZ;IACA,IAAC,KAAD;WACA,IAAC,OAAD;EAHa;;wBAKf,iBAAgB,SAAC,CAAD;AACd;IAAA,MAAM,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,OAAZ,CAAoB,YAApB;IACN,QAAQ,CAAC,CAAC,IAAF,CAAO,IAAC,QAAO,CAAC,MAAhB,EAAwB;MAAC,IAAI,GAAG,CAAC,IAAJ,CAAS,UAAT,CAAL;KAAxB;IACR,QAAY,eAAW,KAAX,EAAkB,IAAC,MAAnB;IACZ,IAAC,cAAD,CAAe,KAAf;IACA,IAAC,SAAD,CAAU,KAAV,EAAiB,gBAAjB,EAAmC;aAAG,IAAC,QAAD,CAAS,gBAAT;IAAH,CAAnC;WACA,IAAC,SAAD,CAAU,KAAV,EAAiB,MAAjB,EAAyB;AACvB;MAAA,IAAI;eAAA;iBAAG,KAAC,cAAD;QAAH;MAAA;MACJ,WAAW,CAAX,EAAc,GAAd;aACA,IAAC,cAAD,CAAe,KAAf;IAHuB,CAAzB;EANc;;;;GAhDyB","file":"public/javascripts/app/views/editor/PatchesView.js","sourcesContent":["CocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/editor/patches'\r\nPatchesCollection = require 'collections/PatchesCollection'\r\nnameLoader = require 'core/NameLoader'\r\nPatchModal = require './PatchModal'\r\n\r\nmodule.exports = class PatchesView extends CocoView\r\n  template: template\r\n  className: 'patches-view'\r\n  status: 'pending'\r\n\r\n  events:\r\n    'change .status-buttons': 'onStatusButtonsChanged'\r\n    'click .patch-row': 'openPatchModal'\r\n\r\n  constructor: (@model, options) ->\r\n    super(options)\r\n    @initPatches()\r\n\r\n  initPatches: ->\r\n    @startedLoading = false\r\n    @patches = @model.fetchPatchesWithStatus()\r\n\r\n  load: ->\r\n    @initPatches()\r\n    @patches = @model.fetchPatchesWithStatus(@status, {cache: false})\r\n    @supermodel.trackCollection(@patches)\r\n    @listenTo @patches, 'sync', @onPatchesLoaded\r\n\r\n  onPatchesLoaded: ->\r\n    ids = (p.get('creator') for p in @patches.models)\r\n    jqxhrOptions = nameLoader.loadNames ids\r\n    @supermodel.addRequestResource('user_names', jqxhrOptions).load() if jqxhrOptions\r\n\r\n  getRenderData: ->\r\n    c = super()\r\n    patch.userName = nameLoader.getName(patch.get('creator')) for patch in @patches.models\r\n    c.patches = @patches.models\r\n    c.status\r\n    c\r\n\r\n  afterRender: ->\r\n    @$el.find(\".#{@status}\").addClass 'active'\r\n    super()\r\n\r\n  onStatusButtonsChanged: (e) ->\r\n    @status = $(e.target).val()\r\n    @reloadPatches()\r\n\r\n  reloadPatches: ->\r\n    @supermodel.resetProgress()\r\n    @load()\r\n    @render()\r\n\r\n  openPatchModal: (e) ->\r\n    row = $(e.target).closest '.patch-row'\r\n    patch = _.find @patches.models, {id: row.data('patch-id')}\r\n    modal = new PatchModal(patch, @model)\r\n    @openModalView(modal)\r\n    @listenTo modal, 'accepted-patch', -> @trigger 'accepted-patch'\r\n    @listenTo modal, 'hide', ->\r\n      f = => @reloadPatches()\r\n      setTimeout(f, 400)\r\n      @stopListening modal\r\n"]}