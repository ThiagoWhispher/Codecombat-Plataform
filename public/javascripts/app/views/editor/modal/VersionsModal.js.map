{"version":3,"sources":["app/templates/editor/modal/versions-modal.jade","app/views/editor/modal/VersionsModal.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/editor/modal/VersionsModal.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),view = locals_.view,dataList = locals_.dataList,page = locals_.page,moment = locals_.moment;buf.push(\"<div class=\\\"modal-dialog game\\\"><div class=\\\"background-wrapper\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\">\");\nif ( view.closeButton)\n{\nbuf.push(\"<div type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-hidden=\\\"true\\\" class=\\\"button close\\\">&times;</div>\");\n}\nif ( dataList)\n{\nbuf.push(\"<h3><span data-i18n=\\\"general.version_history_for\\\">Version History for:</span>\\\"\" + (jade.escape((jade.interp = dataList[0].name) == null ? '' : jade.interp)) + \"\\\"</h3><p data-i18n=\\\"general.select_changes\\\">Select two changes below to see the difference.</p>\");\n}\nbuf.push(\"<div class=\\\"delta-container\\\"><div class=\\\"delta-view\\\"></div></div></div><div class=\\\"modal-body\\\">\");\nif ( dataList)\n{\nbuf.push(\"<table class=\\\"table table-condensed\\\"><tr><th></th><th></th><th></th><th></th><th data-i18n=\\\"general.commit_msg\\\">Commit Message</th></tr>\");\n// iterate dataList\n;(function(){\n  var $$obj = dataList;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var data = $$obj[$index];\n\nbuf.push(\"<tr><td><input\" + (jade.attrs({ 'type':(\"checkbox\"), 'value':(data._id), \"class\": [('select')] }, {\"type\":true,\"value\":true})) + \"/></td><td><a\" + (jade.attrs({ 'href':(\"/editor/\" + (page) + \"/\" + (data._id) + \"\") }, {\"href\":true})) + \">\" + (jade.escape((jade.interp = data.version.major) == null ? '' : jade.interp)) + \".\" + (jade.escape((jade.interp = data.version.minor) == null ? '' : jade.interp)) + \"</a></td><td>\" + (jade.escape(null == (jade.interp = moment(data.created).format('l')) ? \"\" : jade.interp)) + \"</td><td>\" + (jade.escape(null == (jade.interp = data.creator) ? \"\" : jade.interp)) + \"</td><td>\" + (jade.escape((jade.interp = data.commitMessage) == null ? '' : jade.interp)) + \"</td></tr>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var data = $$obj[$index];\n\nbuf.push(\"<tr><td><input\" + (jade.attrs({ 'type':(\"checkbox\"), 'value':(data._id), \"class\": [('select')] }, {\"type\":true,\"value\":true})) + \"/></td><td><a\" + (jade.attrs({ 'href':(\"/editor/\" + (page) + \"/\" + (data._id) + \"\") }, {\"href\":true})) + \">\" + (jade.escape((jade.interp = data.version.major) == null ? '' : jade.interp)) + \".\" + (jade.escape((jade.interp = data.version.minor) == null ? '' : jade.interp)) + \"</a></td><td>\" + (jade.escape(null == (jade.interp = moment(data.created).format('l')) ? \"\" : jade.interp)) + \"</td><td>\" + (jade.escape(null == (jade.interp = data.creator) ? \"\" : jade.interp)) + \"</td><td>\" + (jade.escape((jade.interp = data.commitMessage) == null ? '' : jade.interp)) + \"</td></tr>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</table>\");\n}\nbuf.push(\"</div><div class=\\\"modal-body wait secret\\\"><h3>Reticulating Splines...</h3><div class=\\\"progress progress-striped active\\\"><div class=\\\"progress-bar\\\"></div></div></div><div class=\\\"modal-footer\\\"></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","ModalView = require 'views/core/ModalView'\r\ntemplate = require 'templates/editor/modal/versions-modal'\r\nDeltaView = require 'views/editor/DeltaView'\r\nPatchModal = require 'views/editor/PatchModal'\r\nnameLoader = require 'core/NameLoader'\r\nCocoCollection = require 'collections/CocoCollection'\r\ndeltasLib = require 'core/deltas'\r\n\r\nclass VersionsViewCollection extends CocoCollection\r\n  url: ''\r\n  model: null\r\n\r\n  initialize: (@url, @levelID, @model) ->\r\n    super()\r\n    @url = @url + @levelID + '/versions'\r\n\r\nmodule.exports = class VersionsModal extends ModalView\r\n  template: template\r\n  plain: true\r\n  modalWidthPercent: 80\r\n\r\n  # needs to be overwritten by child\r\n  id: ''\r\n  url: ''\r\n  page: ''\r\n\r\n  events:\r\n    'change input.select': 'onSelectionChanged'\r\n\r\n  constructor: (options, @ID, @model) ->\r\n    super options\r\n    @original = new @model(_id: @ID)\r\n    @original = @supermodel.loadModel(@original).model\r\n    @listenToOnce(@original, 'sync', @onViewSync)\r\n\r\n  onViewSync: ->\r\n    @versions = new VersionsViewCollection(@url, @original.attributes.original, @model)\r\n    @versions = @supermodel.loadCollection(@versions, 'versions').model\r\n    @listenTo(@versions, 'sync', @onVersionsFetched)\r\n\r\n  onVersionsFetched: ->\r\n    ids = (p.get('creator') for p in @versions.models)\r\n    jqxhrOptions = nameLoader.loadNames ids\r\n    @supermodel.addRequestResource('user_names', jqxhrOptions).load() if jqxhrOptions\r\n\r\n  onSelectionChanged: ->\r\n    rows = @$el.find 'input.select:checked'\r\n    deltaEl = @$el.find '.delta-view'\r\n    @removeSubView(@deltaView) if @deltaView\r\n    @deltaView = null\r\n    if rows.length isnt 2 then return\r\n\r\n    laterVersion = new @model(_id: $(rows[0]).val())\r\n    earlierVersion = new @model(_id: $(rows[1]).val())\r\n    @deltaView = new DeltaView({\r\n      model: earlierVersion\r\n      comparisonModel: laterVersion\r\n      skipPaths: deltasLib.DOC_SKIP_PATHS\r\n      loadModels: true\r\n    })\r\n    @insertSubView(@deltaView, deltaEl)\r\n\r\n  getRenderData: (context={}) ->\r\n    context = super(context)\r\n    context.page = @page\r\n    if @versions\r\n      context.dataList = (m.attributes for m in @versions.models)\r\n      for version in context.dataList\r\n        version.creator = nameLoader.getName(version.creator)\r\n    context\r\n"]}