{"version":3,"sources":["app/templates/editor/thang/vector-icon-setup-modal.jade","app/views/editor/thang/VectorIconSetupModal.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/editor/thang/VectorIconSetupModal.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),view = locals_.view;buf.push(\"<div class=\\\"modal-dialog game\\\"><div class=\\\"background-wrapper\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\">\");\nif ( view.closeButton)\n{\nbuf.push(\"<div type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-hidden=\\\"true\\\" class=\\\"button close\\\">&times;</div>\");\n}\nbuf.push(\"<h3>Choose Container for Vector Icon</h3></div><div class=\\\"modal-body\\\">\");\nif ( view.container)\n{\nbuf.push(\"<form class=\\\"form\\\"><div class=\\\"form-group\\\"><select id=\\\"container-select\\\" class=\\\"form-control\\\">\");\n// iterate view.containers\n;(function(){\n  var $$obj = view.containers;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var container = $$obj[$index];\n\nbuf.push(\"<option\" + (jade.attrs({ 'value':(container), 'selected':(container === view.container) }, {\"value\":true,\"selected\":true})) + \">\" + (jade.escape(null == (jade.interp = container) ? \"\" : jade.interp)) + \"</option>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var container = $$obj[$index];\n\nbuf.push(\"<option\" + (jade.attrs({ 'value':(container), 'selected':(container === view.container) }, {\"value\":true,\"selected\":true})) + \">\" + (jade.escape(null == (jade.interp = container) ? \"\" : jade.interp)) + \"</option>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</select></div></form><canvas\" + (jade.attrs({ 'width':(view.demoSize), 'height':(view.demoSize), 'id':('resulting-icon') }, {\"width\":true,\"height\":true})) + \"></canvas><div class=\\\"alert alert-info\\\">Arrow keys to move, Shift-Plus/Minus to scale.</div>\");\n}\nelse\n{\nbuf.push(\"<div>forgetting something?</div>\");\n}\nbuf.push(\"</div><div class=\\\"modal-body wait secret\\\"><h3>Reticulating Splines...</h3><div class=\\\"progress progress-striped active\\\"><div class=\\\"progress-bar\\\"></div></div></div><div class=\\\"modal-footer\\\"><button id=\\\"center\\\" class=\\\"btn pull-left btn-info\\\"><span class=\\\"glyphicon glyphicon-cutlery\\\"></span><span class=\\\"spl\\\">Center</span></button><button id=\\\"done-button\\\" class=\\\"btn btn-primary\\\">Done</button></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","ModalView = require 'views/core/ModalView'\r\ntemplate = require 'templates/editor/thang/vector-icon-setup-modal'\r\n\r\nmodule.exports = class VectorIconSetupModal extends ModalView\r\n  id: \"vector-icon-setup-modal\"\r\n  template: template\r\n  demoSize: 400\r\n  plain: true\r\n\r\n  events:\r\n    'change #container-select': 'onChangeContainer'\r\n    'click #center': 'onClickCenter'\r\n    'click #zero-bounds': 'onClickZeroBounds'\r\n    'click #done-button': 'onClickDone'\r\n\r\n  shortcuts:\r\n    'shift+-': -> @incrScale(-0.02)\r\n    'shift+=': -> @incrScale(0.02)\r\n    'up': -> @incrRegY(1)\r\n    'down': -> @incrRegY(-1)\r\n    'left': -> @incrRegX(1)\r\n    'right': -> @incrRegX(-1)\r\n\r\n  constructor: (options, @thangType) ->\r\n    portrait = @thangType.get('actions')?.portrait\r\n    @containers = _.keys(@thangType.get('raw')?.containers or {})\r\n    @container = portrait?.container or _.last @containers\r\n    @scale = portrait?.scale or 1\r\n    @regX = portrait?.positions?.registration?.x or 0\r\n    @regY = portrait?.positions?.registration?.y or 0\r\n    @saveChanges()\r\n    super(options)\r\n\r\n  saveChanges: ->\r\n    actions = _.cloneDeep (@thangType.get('actions') ? {})\r\n    actions.portrait ?= {}\r\n    actions.portrait.scale = @scale\r\n    actions.portrait.positions ?= {}\r\n    actions.portrait.positions.registration = { x: @regX, y: @regY }\r\n    actions.portrait.container = @container\r\n    @thangType.set('actions', actions)\r\n    @thangType.buildActions()\r\n\r\n  afterRender: ->\r\n    @initStage()\r\n    super()\r\n\r\n  initStage: ->\r\n    return unless @containers and @container\r\n    @stage = @thangType.getVectorPortraitStage(@demoSize)\r\n    @sprite = @stage.children[0]\r\n    canvas = $(@stage.canvas)\r\n    canvas.attr('id', 'resulting-icon')\r\n    @$el.find('#resulting-icon').replaceWith(canvas)\r\n    @updateSpriteProperties()\r\n\r\n  onChangeContainer: (e) ->\r\n    @container = $(e.target).val()\r\n    @saveChanges()\r\n    @initStage()\r\n\r\n  refreshSprite: ->\r\n    return unless @stage\r\n    stage = @thangType.getVectorPortraitStage(@demoSize)\r\n    @stage.removeAllChildren()\r\n    @stage.addChild(@sprite = stage.children[0])\r\n    @updateSpriteProperties()\r\n    @stage.update()\r\n\r\n  updateSpriteProperties: ->\r\n    @sprite.scaleX = @sprite.scaleY = @scale * @demoSize / 100\r\n    @sprite.regX = @regX / @scale\r\n    @sprite.regY = @regY / @scale\r\n    console.log 'set to', @scale, @regX, @regY\r\n\r\n  onClickCenter: ->\r\n    containerInfo = @thangType.get('raw').containers[@container]\r\n    b = containerInfo.b\r\n    @regX = b[0]\r\n    @regY = b[1]\r\n    maxDimension = Math.max(b[2], b[3])\r\n    @scale = 100 / maxDimension\r\n    if b[2] > b[3]\r\n      @regY += (b[3] - b[2]) / 2\r\n    else\r\n      @regX += (b[2] - b[3]) / 2\r\n    @regX *= @scale\r\n    @regY *= @scale\r\n    @updateSpriteProperties()\r\n    @stage.update()\r\n\r\n  incrScale: (amount) ->\r\n    @scale += amount\r\n    @updateSpriteProperties()\r\n    @stage.update()\r\n\r\n  incrRegX: (amount) ->\r\n    @regX += amount\r\n    @updateSpriteProperties()\r\n    @stage.update()\r\n\r\n  incrRegY: (amount) ->\r\n    @regY += amount\r\n    @updateSpriteProperties()\r\n    @stage.update()\r\n\r\n  onClickDone: ->\r\n    @saveChanges()\r\n    @trigger 'done'\r\n    @hide()"]}