{"version":3,"sources":["app/views/editor/level/components/NewLevelComponentModal.coffee"],"names":[],"mappings":";AAAA;EAAA;;;AAAA,YAAY,QAAQ,sBAAR;;AACZ,WAAW,QAAQ,sCAAR;;AACX,iBAAiB,QAAQ,uBAAR;;AACjB,QAAQ,QAAQ,YAAR;;AACP,KAAM,QAAQ,WAAR,EAAN;;AAED,MAAM,CAAC,OAAP,GAAuB;;;mCACrB,KAAI;;mCACJ,WAAU;;mCACV,UAAS;;mCACT,oBAAmB;;mCAEnB,SACE;IAAA,qCAAqC,uBAArC;IACA,eAAe,uBADf;;;EAGW,gCAAC,OAAD;IACX,wDAAM,OAAN;IACA,IAAC,QAAD,GAAW,cAAc,CAAC,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,MAAD;EAFvC;;mCAIb,wBAAuB,SAAC,CAAD;AACrB;IAAA,CAAC,CAAC,cAAF;IACA,SAAS,IAAC,IAAG,CAAC,IAAL,CAAU,yBAAV,CAAoC,CAAC,GAArC;IACT,OAAO,IAAC,IAAG,CAAC,IAAL,CAAU,uBAAV,CAAkC,CAAC,GAAnC;IACP,YAAgB;IAChB,SAAS,CAAC,GAAV,CAAc,QAAd,EAAwB,MAAxB;IACA,SAAS,CAAC,GAAV,CAAc,MAAd,EAAsB,IAAtB;IACA,SAAS,CAAC,GAAV,CAAc,MAAd,EAAsB,SAAS,CAAC,GAAV,CAAc,MAAd,EAAsB,IAAtB,CAA2B,CAAC,OAA5B,CAAoC,cAApC,EAAoD,IAApD,CAAtB;IACA,SAAS,CAAC,GAAV,CAAc,aAAd,EAA6B;MAAC;QAAC,QAAQ,OAAT;QAAkB,QAAQ,EAAE,CAAC,EAA7B;OAAD;KAA7B;IACA,MAAM,SAAS,CAAC,IAAV,CAAe,IAAf,EAAqB;MAAC,MAAM,MAAP;KAArB;IACN,KAAc,GAAd;AAAA;;IAEA,IAAC,YAAD;IACA,GAAG,CAAC,KAAJ,CAAU;aAAA;QACR,KAAC,YAAD;QACA,OAAO,CAAC,GAAR,CAAY,aAAZ,EAA2B,IAAI,CAAC,KAAL,CAAW,GAAG,CAAC,YAAf,CAA3B;eACA,KAAK,CAAC,iBAAN,CAAwB,KAAC,IAAzB,EAA8B,IAAI,CAAC,KAAL,CAAW,GAAG,CAAC,YAAf,CAA9B;MAHQ;IAAA,QAAV;WAIA,GAAG,CAAC,OAAJ,CAAY;aAAA;QACV,KAAC,WAAU,CAAC,aAAZ,CAA0B,SAA1B;eACA,KAAC,KAAD;MAFU;IAAA,QAAZ;EAjBqB;;;;GAd6B","file":"public/javascripts/app/views/editor/level/components/NewLevelComponentModal.js","sourcesContent":["ModalView = require 'views/core/ModalView'\r\ntemplate = require 'templates/editor/level/component/new'\r\nLevelComponent = require 'models/LevelComponent'\r\nforms = require 'core/forms'\r\n{me} = require 'core/auth'\r\n\r\nmodule.exports = class NewLevelComponentModal extends ModalView\r\n  id: 'editor-level-component-new-modal'\r\n  template: template\r\n  instant: false\r\n  modalWidthPercent: 60\r\n\r\n  events:\r\n    'click #new-level-component-submit': 'makeNewLevelComponent'\r\n    'submit form': 'makeNewLevelComponent'\r\n\r\n  constructor: (options) ->\r\n    super options\r\n    @systems = LevelComponent.schema.properties.system.enum\r\n\r\n  makeNewLevelComponent: (e) ->\r\n    e.preventDefault()\r\n    system = @$el.find('#level-component-system').val()\r\n    name = @$el.find('#level-component-name').val()\r\n    component = new LevelComponent()\r\n    component.set 'system', system\r\n    component.set 'name', name\r\n    component.set 'code', component.get('code', true).replace(/AttacksSelf/g, name)\r\n    component.set 'permissions', [{access: 'owner', target: me.id}]  # Private until saved in a published Level\r\n    res = component.save(null, {type: 'POST'})  # Override PUT so we can trigger postFirstVersion logic\r\n    return unless res\r\n\r\n    @showLoading()\r\n    res.error =>\r\n      @hideLoading()\r\n      console.log 'Got errors:', JSON.parse(res.responseText)\r\n      forms.applyErrorsToForm(@$el, JSON.parse(res.responseText))\r\n    res.success =>\r\n      @supermodel.registerModel component\r\n      @hide()\r\n"]}