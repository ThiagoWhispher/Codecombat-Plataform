{"version":3,"sources":["app/views/editor/level/thangs/AddThangsView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/editor/level/thangs/AddThangsView.js","sourcesContent":["CocoView = require 'views/core/CocoView'\r\nadd_thangs_template = require 'templates/editor/level/add-thangs-view'\r\nThangType = require 'models/ThangType'\r\nCocoCollection = require 'collections/CocoCollection'\r\n\r\nclass ThangTypeSearchCollection extends CocoCollection\r\n  url: '/db/thang.type?project=original,name,version,description,slug,kind,rasterIcon'\r\n  model: ThangType\r\n\r\n  addTerm: (term) ->\r\n    @url += \"&term=#{term}\" if term\r\n\r\nmodule.exports = class AddThangsView extends CocoView\r\n  id: 'add-thangs-view'\r\n  className: 'add-thangs-palette'\r\n  template: add_thangs_template\r\n\r\n  events:\r\n    'keyup input#thang-search': 'runSearch'\r\n\r\n  constructor: (options) ->\r\n    super options\r\n    @world = options.world\r\n\r\n    # should load depended-on Components, too\r\n    @thangTypes = @supermodel.loadCollection(new ThangTypeSearchCollection(), 'thangs').model\r\n\r\n  getRenderData: (context={}) ->\r\n    context = super(context)\r\n    if @searchModels\r\n      models = @searchModels\r\n    else\r\n      models = @supermodel.getModels(ThangType)\r\n\r\n    thangTypes = _.uniq models, false, (thangType) -> thangType.get('original')\r\n    thangTypes = _.reject thangTypes, (thangType) -> thangType.get('kind') in ['Mark', 'Item', undefined]\r\n    groupMap = {}\r\n    for thangType in thangTypes\r\n      kind = thangType.get('kind')\r\n      groupMap[kind] ?= []\r\n      groupMap[kind].push thangType\r\n\r\n    groups = []\r\n    for groupName in Object.keys(groupMap).sort()\r\n      someThangTypes = groupMap[groupName]\r\n      someThangTypes = _.sortBy someThangTypes, (thangType) -> thangType.get('name')\r\n      group =\r\n        name: groupName\r\n        thangs: someThangTypes\r\n      groups.push group\r\n\r\n    groups = _.sortBy groups, (group) ->\r\n      index = ['Wall', 'Floor', 'Unit', 'Doodad', 'Misc'].indexOf group.name\r\n      if index is -1 then 9001 else index\r\n\r\n    context.thangTypes = thangTypes\r\n    context.groups = groups\r\n    context\r\n\r\n  afterRender: ->\r\n    super()\r\n    @buildAddThangPopovers()\r\n\r\n  buildAddThangPopovers: ->\r\n    @$el.find('#thangs-list .add-thang-palette-icon').addClass('has-tooltip').tooltip(container: 'body', animation: false)\r\n\r\n  runSearch: (e) =>\r\n    if e?.which is 27\r\n      @onEscapePressed()\r\n    term = @$el.find('input#thang-search').val()\r\n    return unless term isnt @lastSearch\r\n\r\n    @searchModels = @thangTypes.filter (model) ->\r\n      return true unless term\r\n      regExp = new RegExp term, 'i'\r\n      return model.get('name').match regExp\r\n    @render()\r\n    @$el.find('input#thang-search').focus().val(term)\r\n    @lastSearch = term\r\n\r\n  onEscapePressed: ->\r\n    @$el.find('input#thang-search').val('')\r\n    @runSearch\r\n"]}