{"version":3,"sources":["app/templates/editor/level/level-feedback-view.jade","app/views/editor/level/LevelFeedbackView.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9IA;AAAA;;ACAA;EAAA;;;AAAA,WAAW,QAAQ,qBAAR;;AACX,iBAAiB,QAAQ,4BAAR;;AACjB,WAAW,QAAQ,4CAAR;;AACX,QAAQ,QAAQ,cAAR;;AACR,gBAAgB,QAAQ,sBAAR;;AAEV;;;;;;;oCACJ,QAAO;;oCACP,aAAY,SAAC,MAAD,EAAS,OAAT;IACV,wDAAM,MAAN,EAAc,OAAd;WACA,IAAC,IAAD,GAAO,eAAY,CAAC,OAAO,CAAC,KAAK,CAAC,GAAd,CAAkB,MAAlB,CAAD,CAAZ,GAAuC;EAFpC;;oCAIZ,aAAY,SAAC,CAAD,EAAI,CAAJ;AACV;IAAA,QAAQ;IACR,IAA6B,CAAC,CAAC,GAAF,CAAM,SAAN,MAAoB,EAAE,CAAC,EAApD;MAAA,SAAS,iBAAT;;IACA,IAA6B,CAAC,CAAC,GAAF,CAAM,SAAN,MAAoB,EAAE,CAAC,EAApD;MAAA,SAAS,iBAAT;;IACA,SAAa,SAAK,CAAC,CAAC,GAAF,CAAM,SAAN,CAAL;IACb,SAAS,CAAC,CAAK,SAAK,CAAC,CAAC,GAAF,CAAM,SAAN,CAAL,CAAL;IACV,IAAyB,CAAC,CAAC,GAAF,CAAM,QAAN,CAAzB;MAAA,SAAS,aAAT;;IACA,IAAyB,CAAC,CAAC,GAAF,CAAM,QAAN,CAAzB;MAAA,SAAS,aAAT;;IACA,IAAG,QAAQ,CAAX;aAAkB,CAAC,EAAnB;KAAA;MAA2B,IAAG,QAAQ,CAAX;eAAkB,EAAlB;OAAA;eAAyB,EAAzB;OAA3B;;EARU;;;;GANwB;;AAgBtC,MAAM,CAAC,OAAP,GAAuB;;;8BACrB,KAAI;;8BACJ,WAAU;;8BACV,YAAW;;8BAEX,gBACE;IAAA,wBAAwB,gBAAxB;;;EAEW,2BAAC,OAAD;IACX,mDAAM,OAAN;EADW;;8BAGb,gBAAe,SAAC,OAAD;AACb;;MADc,UAAQ;;IACtB,UAAU,qDAAM,OAAN;IACV,OAAO,CAAC,MAAR,GAAiB;IACjB,OAAO,CAAC,WAAR,GAAsB;IACtB,OAAO,CAAC,aAAR,GAAwB;IACxB,OAAO,CAAC,YAAR,GAAuB;IACvB,0CAAe,CAAE,MAAM,CAAC,eAAxB;MACE,OAAO,CAAC,WAAR;;AAAuB;AAAA;aAAA;;cAA+C,IAAC,YAAW,CAAC,MAAM,CAAC,MAApB,GAA6B,EAA7B,IAAmC,CAAC,CAAC,GAAF,CAAM,QAAN;yBAAlF,CAAC,CAAC;;AAAF;;;MACvB,OAAO,CAAC,aAAR,GAAwB,CAAC,CAAC,MAAF;;AAAU;AAAA;aAAA;;uBAAA,CAAC,CAAC,GAAF,CAAM,QAAN;AAAA;;mBAAV,EAAyD,SAAC,GAAD,EAAM,CAAN;eAAY,MAAM,aAAC,IAAI,CAAL;MAAlB,CAAzD,IAAuF,IAAC,YAAW,CAAC,MAAM,CAAC;MACnI,OAAO,CAAC,YAAR,GAAuB,IAAC,YAAW,CAAC,MAAM,CAAC,OAH7C;KAAA;MAKE,OAAO,CAAC,OAAR,GAAkB,KALpB;;WAMA;EAZa;;8BAcf,iBAAgB,SAAC,CAAD;IAEd,IAAc,CAAC,CAAC,SAAF,KAAe,sBAA7B;AAAA;;IACA,KAAO,IAAC,YAAR;MACE,IAAC,YAAD,GAAe,IAAC,WAAU,CAAC,cAAZ,CAA+B,4BAAwB,IAAxB,EAA8B;QAAA,OAAO,IAAC,QAAO,CAAC,KAAhB;OAA9B,CAA/B,EAAqF,UAArF,CAAgG,CAAC;aAChH,IAAC,OAAD,GAFF;;EAHc;;;;GAzB+B","file":"public/javascripts/app/views/editor/level/LevelFeedbackView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),averageRating = locals_.averageRating,totalRatings = locals_.totalRatings,allFeedback = locals_.allFeedback,moment = locals_.moment;buf.push(\"<h2>Average Rating: \" + (jade.escape((jade.interp = averageRating.toFixed(2)) == null ? '' : jade.interp)) + \", \" + (jade.escape((jade.interp = totalRatings) == null ? '' : jade.interp)) + \" ratings</h2><ul class=\\\"user-feedback-list list-group\\\">\");\n// iterate allFeedback\n;(function(){\n  var $$obj = allFeedback;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var feedback = $$obj[$index];\n\nbuf.push(\"<li class=\\\"list-group-item\\\">\");\n// iterate Array(feedback.rating)\n;(function(){\n  var $$obj = Array(feedback.rating);\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var i = $$obj[$index];\n\nbuf.push(\"<div class=\\\"glyphicon glyphicon-star\\\"></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var i = $$obj[$index];\n\nbuf.push(\"<div class=\\\"glyphicon glyphicon-star\\\"></div>\");\n    }\n\n  }\n}).call(this);\n\nif ( feedback.rating < 5)\n{\n// iterate Array(5 - feedback.rating)\n;(function(){\n  var $$obj = Array(5 - feedback.rating);\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var i = $$obj[$index];\n\nbuf.push(\"<div class=\\\"glyphicon glyphicon-star-empty\\\"></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var i = $$obj[$index];\n\nbuf.push(\"<div class=\\\"glyphicon glyphicon-star-empty\\\"></div>\");\n    }\n\n  }\n}).call(this);\n\n}\nbuf.push(\"<span class=\\\"spl spr\\\">-</span><em>\" + (jade.escape(null == (jade.interp = moment(new Date(feedback.created)).fromNow()) ? \"\" : jade.interp)) + \"</em><span class=\\\"spl spr\\\">-</span><a\" + (jade.attrs({ 'href':(\"/user/\" + (feedback.creator) + \"\") }, {\"href\":true})) + \"><strong>\" + (jade.escape(null == (jade.interp = feedback.creatorName || 'Anonymous') ? \"\" : jade.interp)) + \"</strong></a>\");\nif ( feedback.review)\n{\nbuf.push(\"<span class=\\\"spr\\\">:</span><span>\" + (jade.escape(null == (jade.interp = feedback.review) ? \"\" : jade.interp)) + \"</span>\");\n}\nbuf.push(\"</li>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var feedback = $$obj[$index];\n\nbuf.push(\"<li class=\\\"list-group-item\\\">\");\n// iterate Array(feedback.rating)\n;(function(){\n  var $$obj = Array(feedback.rating);\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var i = $$obj[$index];\n\nbuf.push(\"<div class=\\\"glyphicon glyphicon-star\\\"></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var i = $$obj[$index];\n\nbuf.push(\"<div class=\\\"glyphicon glyphicon-star\\\"></div>\");\n    }\n\n  }\n}).call(this);\n\nif ( feedback.rating < 5)\n{\n// iterate Array(5 - feedback.rating)\n;(function(){\n  var $$obj = Array(5 - feedback.rating);\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var i = $$obj[$index];\n\nbuf.push(\"<div class=\\\"glyphicon glyphicon-star-empty\\\"></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var i = $$obj[$index];\n\nbuf.push(\"<div class=\\\"glyphicon glyphicon-star-empty\\\"></div>\");\n    }\n\n  }\n}).call(this);\n\n}\nbuf.push(\"<span class=\\\"spl spr\\\">-</span><em>\" + (jade.escape(null == (jade.interp = moment(new Date(feedback.created)).fromNow()) ? \"\" : jade.interp)) + \"</em><span class=\\\"spl spr\\\">-</span><a\" + (jade.attrs({ 'href':(\"/user/\" + (feedback.creator) + \"\") }, {\"href\":true})) + \"><strong>\" + (jade.escape(null == (jade.interp = feedback.creatorName || 'Anonymous') ? \"\" : jade.interp)) + \"</strong></a>\");\nif ( feedback.review)\n{\nbuf.push(\"<span class=\\\"spr\\\">:</span><span>\" + (jade.escape(null == (jade.interp = feedback.review) ? \"\" : jade.interp)) + \"</span>\");\n}\nbuf.push(\"</li>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</ul>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","CocoView = require 'views/core/CocoView'\r\nCocoCollection = require 'collections/CocoCollection'\r\ntemplate = require 'templates/editor/level/level-feedback-view'\r\nLevel = require 'models/Level'\r\nLevelFeedback = require 'models/LevelFeedback'\r\n\r\nclass LevelFeedbackCollection extends CocoCollection\r\n  model: LevelFeedback\r\n  initialize: (models, options) ->\r\n    super models, options\r\n    @url = \"/db/level/#{options.level.get('slug')}/all_feedback\"\r\n\r\n  comparator: (a, b) ->\r\n    score = 0\r\n    score -= 9001900190019001 if a.get('creator') is me.id\r\n    score += 9001900190019001 if b.get('creator') is me.id\r\n    score -= new Date(a.get 'created')\r\n    score -= -(new Date(b.get 'created'))\r\n    score -= 900190019001 if a.get('review')\r\n    score += 900190019001 if b.get('review')\r\n    if score < 0 then -1 else (if score > 0 then 1 else 0)\r\n\r\nmodule.exports = class LevelFeedbackView extends CocoView\r\n  id: 'level-feedback-view'\r\n  template: template\r\n  className: 'tab-pane'\r\n\r\n  subscriptions:\r\n    'editor:view-switched': 'onViewSwitched'\r\n\r\n  constructor: (options) ->\r\n    super options\r\n\r\n  getRenderData: (context={}) ->\r\n    context = super(context)\r\n    context.moment = moment\r\n    context.allFeedback = []\r\n    context.averageRating = 0\r\n    context.totalRatings = 0\r\n    if @allFeedback?.models.length\r\n      context.allFeedback = (m.attributes for m in @allFeedback.models when @allFeedback.models.length < 20 or m.get('review'))\r\n      context.averageRating = _.reduce((m.get('rating') for m in @allFeedback.models), (acc, x) -> acc + (x ? 5)) / (@allFeedback.models.length)\r\n      context.totalRatings = @allFeedback.models.length\r\n    else\r\n      context.loading = true\r\n    context\r\n\r\n  onViewSwitched: (e) ->\r\n    # Lazily load.\r\n    return unless e.targetURL is '#level-feedback-view'\r\n    unless @allFeedback\r\n      @allFeedback = @supermodel.loadCollection(new LevelFeedbackCollection(null, level: @options.level), 'feedback').model\r\n      @render()\r\n"]}