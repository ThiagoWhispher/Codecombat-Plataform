{"version":3,"sources":["app/templates/editor/level/level-edit-view.jade","app/views/editor/level/LevelEditView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/editor/level/LevelEditView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),level = locals_.level,view = locals_.view,authorized = locals_.authorized,recentlyPlayedOpponents = locals_.recentlyPlayedOpponents,anonymous = locals_.anonymous,me = locals_.me;if ( level.loading)\n{\nbuf.push(\"<nav role=\\\"navigation\\\" id=\\\"level-editor-top-nav\\\" class=\\\"navbar navbar-default\\\"><div class=\\\"container-fluid\\\"><ul class=\\\"nav navbar-nav\\\"><li><a href=\\\"/editor/level\\\"><span class=\\\"glyphicon-home glyphicon\\\"></span></a></li></ul></div></nav>\");\n}\nelse\n{\nbuf.push(\"<nav role=\\\"navigation\\\" id=\\\"level-editor-top-nav\\\" class=\\\"navbar navbar-default\\\"><ul class=\\\"nav navbar-nav\\\"><li><a href=\\\"/editor/level\\\"><span class=\\\"glyphicon-home glyphicon\\\"></span></a></li></ul><ul class=\\\"nav navbar-nav nav-tabs\\\"><li class=\\\"active\\\"><a href=\\\"#thangs-tab-view\\\" data-toggle=\\\"tab\\\" data-i18n=\\\"editor.level_tab_thangs\\\">Thangs</a></li><li><a href=\\\"#editor-level-scripts-tab-view\\\" data-toggle=\\\"tab\\\" data-i18n=\\\"editor.level_tab_scripts\\\">Scripts</a></li><li><a href=\\\"#editor-level-settings-tab-view\\\" data-toggle=\\\"tab\\\" data-i18n=\\\"play.settings\\\">Settings</a></li><li><a href=\\\"#editor-level-components-tab-view\\\" data-toggle=\\\"tab\\\" data-i18n=\\\"editor.level_tab_components\\\" id=\\\"components-tab\\\">Components</a></li><li><a href=\\\"#systems-tab-view\\\" data-toggle=\\\"tab\\\" data-i18n=\\\"editor.level_tab_systems\\\">Systems</a></li><li><a href=\\\"#editor-level-tasks-tab-view\\\" data-toggle=\\\"tab\\\" data-i18n=\\\"editor.level_tab_tasks\\\" id=\\\"tasks-tab\\\">\" + (jade.escape(null == (jade.interp = \"Tasks\" + \" \" + view.getTaskCompletionRatio()) ? \"\" : jade.interp)) + \"</a></li><li><a href=\\\"#editor-level-patches\\\" data-toggle=\\\"tab\\\" id=\\\"patches-tab\\\"><span data-i18n=\\\"resources.patches\\\" class=\\\"spr\\\">Patches</span>\");\nvar patches = level.get('patches')\nif ( patches && patches.length)\n{\nbuf.push(\"<span class=\\\"badge\\\">\" + (jade.escape(null == (jade.interp = patches.length) ? \"\" : jade.interp)) + \"</span>\");\n}\nbuf.push(\"</a></li><li><a href=\\\"#related-achievements-view\\\" data-toggle=\\\"tab\\\" data-i18n=\\\"user.achievements_title\\\">Achievements</a></li><li><a href=\\\"#editor-level-documentation\\\" data-toggle=\\\"tab\\\" data-i18n=\\\"editor.level_tab_docs\\\">Documentation</a></li><li><a href=\\\"#level-feedback-view\\\" data-toggle=\\\"tab\\\"><div class=\\\"glyphicon glyphicon-star\\\"></div></a></li></ul><div class=\\\"navbar-header\\\"><span class=\\\"navbar-brand\\\">\" + (jade.escape((jade.interp = level.attributes.name) == null ? '' : jade.interp)) + \"<span id=\\\"completion-rate\\\" class=\\\"spl\\\"></span></span></div><ul class=\\\"nav navbar-nav navbar-right\\\"><li id=\\\"undo-button\\\"><a><span class=\\\"glyphicon-arrow-left glyphicon\\\"></span></a></li><li id=\\\"redo-button\\\"><a><span class=\\\"glyphicon-arrow-right glyphicon\\\"></span></a></li><li id=\\\"artisan-guide-button\\\"><a><span class=\\\"glyphicon-book glyphicon\\\"></span></a></li>\");\nif ( authorized)\n{\nbuf.push(\"<li id=\\\"commit-level-start-button\\\"><a><span class=\\\"glyphicon-floppy-disk glyphicon\\\"></span></a></li>\");\n}\nelse\n{\nbuf.push(\"<li id=\\\"level-patch-button\\\"><a><span class=\\\"glyphicon-floppy-disk glyphicon\\\"></span></a></li>\");\n}\nif ( level.isType('ladder'))\n{\nbuf.push(\"<li class=\\\"dropdown\\\"><a data-toggle=\\\"dropdown\\\" class=\\\"play-with-team-parent\\\"><span class=\\\"glyphicon-play glyphicon\\\"></span></a><ul class=\\\"dropdown-menu\\\"><li class=\\\"dropdown-header\\\">Play As Which Team?</li><li>\");\n// iterate ['humans', 'ogres']\n;(function(){\n  var $$obj = ['humans', 'ogres'];\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var team = $$obj[$index];\n\nbuf.push(\"<a\" + (jade.attrs({ 'data-team':(team), \"class\": [('play-with-team-button')] }, {\"data-team\":true})) + \">\" + (jade.escape(null == (jade.interp = team + ' vs. AI') ? \"\" : jade.interp)) + \"</a>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var team = $$obj[$index];\n\nbuf.push(\"<a\" + (jade.attrs({ 'data-team':(team), \"class\": [('play-with-team-button')] }, {\"data-team\":true})) + \">\" + (jade.escape(null == (jade.interp = team + ' vs. AI') ? \"\" : jade.interp)) + \"</a>\");\n    }\n\n  }\n}).call(this);\n\n// iterate recentlyPlayedOpponents\n;(function(){\n  var $$obj = recentlyPlayedOpponents;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var match = $$obj[$index];\n\nbuf.push(\"<a\" + (jade.attrs({ 'data-team':(match.yourTeam), 'data-opponent':(match.opponentSessionID), \"class\": [('play-with-team-button')] }, {\"data-team\":true,\"data-opponent\":true})) + \">\" + (jade.escape(null == (jade.interp = match.yourTeam + ' vs. ' + match.opponentName) ? \"\" : jade.interp)) + \"</a>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var match = $$obj[$index];\n\nbuf.push(\"<a\" + (jade.attrs({ 'data-team':(match.yourTeam), 'data-opponent':(match.opponentSessionID), \"class\": [('play-with-team-button')] }, {\"data-team\":true,\"data-opponent\":true})) + \">\" + (jade.escape(null == (jade.interp = match.yourTeam + ' vs. ' + match.opponentName) ? \"\" : jade.interp)) + \"</a>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</li></ul></li>\");\n}\nelse\n{\nbuf.push(\"<li data-i18n=\\\"[title]general.play_preview\\\" title=\\\"Play preview of current level\\\" id=\\\"play-button\\\"><a><span class=\\\"glyphicon-play glyphicon\\\"></span></a></li>\");\n}\nbuf.push(\"<li class=\\\"dropdown\\\"><a data-toggle=\\\"dropdown\\\"><span class=\\\"glyphicon-chevron-down glyphicon\\\"></span></a><ul class=\\\"dropdown-menu\\\"><li data-i18n=\\\"common.actions\\\" class=\\\"dropdown-header\\\">Actions</li><li><a id=\\\"level-watch-button\\\"><span class=\\\"watch\\\"><span class=\\\"glyphicon glyphicon-eye-open\\\"></span><span data-i18n=\\\"common.watch\\\" class=\\\"spl\\\">Watch</span></span><span class=\\\"unwatch secret\\\"><span class=\\\"glyphicon glyphicon-eye-close\\\"></span><span data-i18n=\\\"common.unwatch\\\" class=\\\"spl\\\">Unwatch</span></span></a></li><li\" + (jade.attrs({ \"class\": [(anonymous ? \"disabled\": \"\")] }, {\"class\":true})) + \"><a data-i18n=\\\"common.fork\\\" id=\\\"fork-start-button\\\">Fork</a></li>\");\nif ( me.isAdmin() || me.isArtisan())\n{\nbuf.push(\"<!-- DNT--><li><a id=\\\"save-branch\\\">Save/Stash Branch</a></li><li><a id=\\\"load-branch\\\">Load/Unstash Branch</a></li>\");\n}\nbuf.push(\"<li\" + (jade.attrs({ \"class\": [(anonymous ? \"disabled\": \"\")] }, {\"class\":true})) + \"><a\" + (jade.attrs({ 'data-toggle':(\"coco-modal\"), 'data-target':(\"modal/RevertModal\"), 'data-i18n':(\"editor.revert\"), 'disabled':(anonymous), 'id':('revert-button') }, {\"data-toggle\":true,\"data-target\":true,\"data-i18n\":true,\"disabled\":true})) + \">Revert</a></li><li\" + (jade.attrs({ \"class\": [(anonymous ? \"disabled\": \"\")] }, {\"class\":true})) + \"><a\" + (jade.attrs({ 'data-toggle':(\"coco-modal\"), 'data-target':(\"editor/level/modals/GenerateTerrainModal\"), 'data-i18n':(\"editor.generate_terrain\"), 'disabled':(anonymous), \"class\": [('generate-terrain-button')] }, {\"data-toggle\":true,\"data-target\":true,\"data-i18n\":true,\"disabled\":true})) + \">Generate Terrain</a></li><li\" + (jade.attrs({ \"class\": [(anonymous ? \"disabled\": \"\")] }, {\"class\":true})) + \"><a data-i18n=\\\"editor.pop_i18n\\\" id=\\\"pop-level-i18n-button\\\">Populate i18n</a></li>\");\nif ( view.courseID)\n{\nbuf.push(\"<li\" + (jade.attrs({ \"class\": [(anonymous ? \"disabled\": \"\")] }, {\"class\":true})) + \"><a data-classroom=\\\"classroom\\\" data-code-language=\\\"javascript\\\" class=\\\"play-classroom-level\\\">Play Classroom JavaScript</a></li><li\" + (jade.attrs({ \"class\": [(anonymous ? \"disabled\": \"\")] }, {\"class\":true})) + \"><a data-classroom=\\\"classroom\\\" data-code-language=\\\"python\\\" class=\\\"play-classroom-level\\\">Play Classroom Python</a></li><li\" + (jade.attrs({ \"class\": [(anonymous ? \"disabled\": \"\")] }, {\"class\":true})) + \"><a data-classroom=\\\"home\\\" data-code-language=\\\"\\\" class=\\\"play-classroom-level\\\">Play Home</a></li>\");\n}\nif ( me.isAdmin())\n{\nbuf.push(\"<li><a\" + (jade.attrs({ 'href':(\"/editor/verifier/\" + (level.get('slug')) + \"?dev=true\") }, {\"href\":true})) + \">Verifier</a></li>\");\n}\nbuf.push(\"<li class=\\\"divider\\\"></li><li data-i18n=\\\"common.info\\\" class=\\\"dropdown-header\\\">Info</li><li id=\\\"level-history-button\\\"><a href=\\\"#\\\" data-i18n=\\\"general.version_history\\\">Version History</a></li><li class=\\\"divider\\\"></li><li data-i18n=\\\"common.help\\\" class=\\\"dropdown-header\\\">Help</li><li><a href=\\\"https://github.com/codecombat/codecombat/wiki/Artisan-Home\\\" data-i18n=\\\"editor.wiki\\\" target=\\\"_blank\\\">Wiki</a></li><li><a href=\\\"https://coco-slack-invite.herokuapp.com/\\\" data-i18n=\\\"editor.live_chat\\\" target=\\\"_blank\\\">Live Chat</a></li><li><a href=\\\"http://discourse.codecombat.com/category/artisan\\\" data-i18n=\\\"nav.forum\\\" target=\\\"_blank\\\">Forum</a></li>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<li><a data-i18n=\\\"nav.contact\\\" class=\\\"contact-modal\\\"></a></li>\");\n}\nbuf.push(\"</ul></li></ul></nav>\");\n}\nbuf.push(\"<div class=\\\"outer-content\\\"><div id=\\\"level-editor-tabs\\\" class=\\\"tab-content\\\"><div id=\\\"thangs-tab-view\\\" class=\\\"tab-pane active\\\"></div><div id=\\\"editor-level-scripts-tab-view\\\" class=\\\"tab-pane\\\"></div><div id=\\\"editor-level-settings-tab-view\\\" class=\\\"tab-pane\\\"></div><div id=\\\"editor-level-components-tab-view\\\" class=\\\"tab-pane\\\"></div><div id=\\\"systems-tab-view\\\" class=\\\"tab-pane\\\"></div><div id=\\\"editor-level-tasks-tab-view\\\" class=\\\"tab-pane\\\"></div><div id=\\\"editor-level-patches\\\" class=\\\"tab-pane nano\\\"><div class=\\\"nano-content\\\"><div class=\\\"patches-view\\\"></div></div></div><div id=\\\"related-achievements-view\\\" class=\\\"tab-pane\\\"></div><div id=\\\"editor-level-documentation\\\" class=\\\"tab-pane\\\"><div class=\\\"tab-content\\\"><ul class=\\\"nav nav-pills nav-justified\\\"><li><a href=\\\"#components-documentation-view\\\" data-toggle=\\\"pill\\\" data-i18n=\\\"resources.components\\\">Components</a></li><li><a href=\\\"#systems-documentation-view\\\" data-toggle=\\\"pill\\\" data-i18n=\\\"resources.systems\\\">Systems</a></li></ul><div id=\\\"components-documentation-view\\\" class=\\\"tab-pane\\\"></div><div id=\\\"systems-documentation-view\\\" class=\\\"tab-pane\\\"></div></div></div><div id=\\\"level-feedback-view\\\" class=\\\"tab-pane\\\"></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","RootView = require 'views/core/RootView'\r\ntemplate = require 'templates/editor/level/level-edit-view'\r\nLevel = require 'models/Level'\r\nLevelSystem = require 'models/LevelSystem'\r\nLevelComponent = require 'models/LevelComponent'\r\nLevelSystems = require 'collections/LevelSystems'\r\nLevelComponents = require 'collections/LevelComponents'\r\nWorld = require 'lib/world/world'\r\nDocumentFiles = require 'collections/DocumentFiles'\r\nLevelLoader = require 'lib/LevelLoader'\r\n\r\nCampaigns = require 'collections/Campaigns'\r\nCocoCollection = require 'collections/CocoCollection'\r\nCourse = require 'models/Course'\r\n\r\n# in the template, but need to require them to load them\r\nrequire 'views/modal/RevertModal'\r\nrequire 'views/editor/level/modals/GenerateTerrainModal'\r\n\r\nThangsTabView = require './thangs/ThangsTabView'\r\nSettingsTabView = require './settings/SettingsTabView'\r\nScriptsTabView = require './scripts/ScriptsTabView'\r\nComponentsTabView = require './components/ComponentsTabView'\r\nSystemsTabView = require './systems/SystemsTabView'\r\nTasksTabView = require './tasks/TasksTabView'\r\nSaveLevelModal = require './modals/SaveLevelModal'\r\nArtisanGuideModal = require './modals/ArtisanGuideModal'\r\nForkModal = require 'views/editor/ForkModal'\r\nSaveVersionModal = require 'views/editor/modal/SaveVersionModal'\r\nSaveBranchModal = require 'views/editor/level/modals/SaveBranchModal'\r\nLoadBranchModal = require 'views/editor/level/modals/LoadBranchModal'\r\nPatchesView = require 'views/editor/PatchesView'\r\nRelatedAchievementsView = require 'views/editor/level/RelatedAchievementsView'\r\nVersionHistoryView = require './modals/LevelVersionsModal'\r\nComponentsDocumentationView = require 'views/editor/docs/ComponentsDocumentationView'\r\nSystemsDocumentationView = require 'views/editor/docs/SystemsDocumentationView'\r\nLevelFeedbackView = require 'views/editor/level/LevelFeedbackView'\r\nstorage = require 'core/storage'\r\nutils = require 'core/utils'\r\n\r\nrequire 'vendor/coffeescript' # this is tenuous, since the LevelSession and LevelComponent models are what compile the code\r\nrequire 'vendor/treema'\r\n\r\n# Make sure that all of our Aethers are loaded, so that if we try to preview the level, it will work.\r\nrequire 'vendor/aether-javascript'\r\nrequire 'vendor/aether-python'\r\nrequire 'vendor/aether-coffeescript'\r\nrequire 'vendor/aether-lua'\r\nrequire 'vendor/aether-java'\r\nrequire 'vendor/aether-html'\r\n\r\nrequire 'game-libraries'\r\n\r\nmodule.exports = class LevelEditView extends RootView\r\n  id: 'editor-level-view'\r\n  className: 'editor'\r\n  template: template\r\n  cache: false\r\n\r\n  events:\r\n    'click #play-button': 'onPlayLevel'\r\n    'click .play-with-team-button': 'onPlayLevel'\r\n    'click .play-with-team-parent': 'onPlayLevelTeamSelect'\r\n    'click .play-classroom-level': 'onPlayLevel'\r\n    'click #commit-level-start-button': 'startCommittingLevel'\r\n    'click li:not(.disabled) > #fork-start-button': 'startForking'\r\n    'click #level-history-button': 'showVersionHistory'\r\n    'click #undo-button': 'onUndo'\r\n    'mouseenter #undo-button': 'showUndoDescription'\r\n    'click #redo-button': 'onRedo'\r\n    'mouseenter #redo-button': 'showRedoDescription'\r\n    'click #patches-tab': -> @patchesView.load()\r\n    'click #components-tab': -> @subviews.editor_level_components_tab_view.refreshLevelThangsTreema @level.get('thangs')\r\n    'click #artisan-guide-button': 'showArtisanGuide'\r\n    'click #level-patch-button': 'startPatchingLevel'\r\n    'click #level-watch-button': 'toggleWatchLevel'\r\n    'click li:not(.disabled) > #pop-level-i18n-button': 'onPopulateI18N'\r\n    'click a[href=\"#editor-level-documentation\"]': 'onClickDocumentationTab'\r\n    'click #save-branch': 'onClickSaveBranch'\r\n    'click #load-branch': 'onClickLoadBranch'\r\n    'mouseup .nav-tabs > li a': 'toggleTab'\r\n\r\n  constructor: (options, @levelID) ->\r\n    super options\r\n    @supermodel.shouldSaveBackups = (model) ->\r\n      model.constructor.className in ['Level', 'LevelComponent', 'LevelSystem', 'ThangType']\r\n    @levelLoader = new LevelLoader supermodel: @supermodel, levelID: @levelID, headless: true, sessionless: true, loadArticles: true\r\n    @level = @levelLoader.level\r\n    @files = new DocumentFiles(@levelLoader.level)\r\n    @supermodel.loadCollection(@files, 'file_names')\r\n    @campaigns = new Campaigns()\r\n    @supermodel.trackRequest @campaigns.fetchByType('course', { data: { project: 'levels' } })\r\n    @courses = new CocoCollection([], { url: \"/db/course\", model: Course})\r\n    @supermodel.loadCollection(@courses, 'courses')\r\n\r\n  destroy: ->\r\n    clearInterval @timerIntervalID\r\n    super()\r\n\r\n  showLoading: ($el) ->\r\n    $el ?= @$el.find('.outer-content')\r\n    super($el)\r\n\r\n  getTitle: -> \"LevelEditor - \" + (@level.get('name') or '...')\r\n\r\n  onLoaded: ->\r\n    _.defer =>\r\n      @world = @levelLoader.world\r\n      @render()\r\n      @timerIntervalID = setInterval @incrementBuildTime, 1000\r\n    campaignCourseMap = {}\r\n    campaignCourseMap[course.get('campaignID')] = course.id for course in @courses.models\r\n    for campaign in @campaigns.models\r\n      for levelID, level of campaign.get('levels') when levelID is @level.get('original')\r\n        @courseID = campaignCourseMap[campaign.id]\r\n      break if @courseID\r\n    if not @courseID and me.isAdmin()\r\n      # Give it a fake course ID so we can test it in course mode before it's in a course.\r\n      @courseID = '560f1a9f22961295f9427742'\r\n    @getLevelCompletionRate()\r\n\r\n  getRenderData: (context={}) ->\r\n    context = super(context)\r\n    context.level = @level\r\n    context.authorized = me.isAdmin() or @level.hasWriteAccess(me)\r\n    context.anonymous = me.get('anonymous')\r\n    context.recentlyPlayedOpponents = storage.load('recently-played-matches')?[@levelID] ? []\r\n    context\r\n\r\n  afterRender: ->\r\n    super()\r\n    return unless @supermodel.finished()\r\n    @$el.find('a[data-toggle=\"tab\"]').on 'shown.bs.tab', (e) =>\r\n      Backbone.Mediator.publish 'editor:view-switched', {targetURL: $(e.target).attr('href')}\r\n    @listenTo @level, 'change:tasks', => @renderSelectors '#tasks-tab'\r\n    @insertSubView new ThangsTabView world: @world, supermodel: @supermodel, level: @level\r\n    @insertSubView new SettingsTabView supermodel: @supermodel\r\n    @insertSubView new ScriptsTabView world: @world, supermodel: @supermodel, files: @files\r\n    @insertSubView new ComponentsTabView supermodel: @supermodel\r\n    @insertSubView new SystemsTabView supermodel: @supermodel, world: @world\r\n    @insertSubView new TasksTabView world: @world, supermodel: @supermodel, level: @level\r\n    @insertSubView new RelatedAchievementsView supermodel: @supermodel, level: @level\r\n    @insertSubView new ComponentsDocumentationView lazy: true  # Don't give it the supermodel, it'll pollute it!\r\n    @insertSubView new SystemsDocumentationView lazy: true  # Don't give it the supermodel, it'll pollute it!\r\n    @insertSubView new LevelFeedbackView level: @level\r\n\r\n    Backbone.Mediator.publish 'editor:level-loaded', level: @level\r\n    @showReadOnly() if me.get('anonymous')\r\n    @patchesView = @insertSubView(new PatchesView(@level), @$el.find('.patches-view'))\r\n    @listenTo @patchesView, 'accepted-patch', -> location.reload() unless key.shift  # Reload to make sure changes propagate, unless secret shift shortcut\r\n    @$el.find('#level-watch-button').find('> span').toggleClass('secret') if @level.watching()\r\n\r\n  onPlayLevelTeamSelect: (e) ->\r\n    if @childWindow and not @childWindow.closed\r\n      # We already have a child window open, so we don't need to ask for a team; we'll use its existing team.\r\n      e.stopImmediatePropagation()\r\n      @onPlayLevel e\r\n\r\n  onPlayLevel: (e) ->\r\n    team = $(e.target).data('team')\r\n    opponentSessionID = $(e.target).data('opponent')\r\n    if $(e.target).data('classroom') is 'home'\r\n      newClassMode = @lastNewClassMode = undefined\r\n    else if $(e.target).data('classroom')\r\n      newClassMode = @lastNewClassMode = true\r\n    else\r\n      newClassMode = @lastNewClassMode\r\n    newClassLanguage = @lastNewClassLanguage = ($(e.target).data('code-language') ? @lastNewClassLanguage) or undefined\r\n    sendLevel = =>\r\n      @childWindow.Backbone.Mediator.publish 'level:reload-from-data', level: @level, supermodel: @supermodel\r\n    if @childWindow and not @childWindow.closed and @playClassMode is newClassMode and @playClassLanguage is newClassLanguage\r\n      # Reset the LevelView's world, but leave the rest of the state alone\r\n      sendLevel()\r\n    else\r\n      # Create a new Window with a blank LevelView\r\n      scratchLevelID = @level.get('slug') + '?dev=true'\r\n      scratchLevelID += \"&team=#{team}\" if team\r\n      scratchLevelID += \"&opponent=#{opponentSessionID}\" if opponentSessionID\r\n      @playClassMode = newClassMode\r\n      @playClassLanguage = newClassLanguage\r\n      if @playClassMode\r\n        scratchLevelID += \"&course=#{@courseID}\"\r\n        scratchLevelID += \"&codeLanguage=#{@playClassLanguage}\"\r\n      if me.get('name') is 'Nick'\r\n        @childWindow = window.open(\"/play/level/#{scratchLevelID}\", 'child_window', 'width=2560,height=1080,left=0,top=-1600,location=1,menubar=1,scrollbars=1,status=0,titlebar=1,toolbar=1', true)\r\n      else\r\n        @childWindow = window.open(\"/play/level/#{scratchLevelID}\", 'child_window', 'width=1280,height=640,left=10,top=10,location=0,menubar=0,scrollbars=0,status=0,titlebar=0,toolbar=0', true)\r\n      @childWindow.onPlayLevelViewLoaded = (e) => sendLevel()  # still a hack\r\n    @childWindow.focus()\r\n\r\n  onUndo: ->\r\n    TreemaNode.getLastTreemaWithFocus()?.undo()\r\n\r\n  onRedo: ->\r\n    TreemaNode.getLastTreemaWithFocus()?.redo()\r\n\r\n  showUndoDescription: ->\r\n    undoDescription = TreemaNode.getLastTreemaWithFocus().getUndoDescription()\r\n    @$el.find('#undo-button').attr('title', $.i18n.t(\"general.undo_prefix\") + \" \" + undoDescription + \" \" + $.i18n.t(\"general.undo_shortcut\"))\r\n\r\n  showRedoDescription: ->\r\n    redoDescription = TreemaNode.getLastTreemaWithFocus().getRedoDescription()\r\n    @$el.find('#redo-button').attr('title', $.i18n.t(\"general.redo_prefix\") + \" \" + redoDescription + \" \" + $.i18n.t(\"general.redo_shortcut\"))\r\n\r\n  getCurrentView: ->\r\n    currentViewID = @$el.find('.tab-pane.active').attr('id')\r\n    return @patchesView if currentViewID is 'editor-level-patches'\r\n    currentViewID = 'components-documentation-view' if currentViewID is 'editor-level-documentation'\r\n    return @subviews[_.string.underscored(currentViewID)]\r\n\r\n  startPatchingLevel: (e) ->\r\n    @openModalView new SaveVersionModal({model: @level})\r\n    Backbone.Mediator.publish 'editor:view-switched', {}\r\n\r\n  startCommittingLevel: (e) ->\r\n    @openModalView new SaveLevelModal level: @level, supermodel: @supermodel, buildTime: @levelBuildTime\r\n    Backbone.Mediator.publish 'editor:view-switched', {}\r\n\r\n  showArtisanGuide: (e) ->\r\n    @openModalView new ArtisanGuideModal level: @level\r\n    Backbone.Mediator.publish 'editor:view-switched', {}\r\n\r\n  startForking: (e) ->\r\n    @openModalView new ForkModal model: @level, editorPath: 'level'\r\n    Backbone.Mediator.publish 'editor:view-switched', {}\r\n\r\n  showVersionHistory: (e) ->\r\n    versionHistoryView = new VersionHistoryView level: @level, @levelID\r\n    @openModalView versionHistoryView\r\n    Backbone.Mediator.publish 'editor:view-switched', {}\r\n\r\n  toggleWatchLevel: ->\r\n    button = @$el.find('#level-watch-button')\r\n    @level.watch(button.find('.watch').is(':visible'))\r\n    button.find('> span').toggleClass('secret')\r\n\r\n  onPopulateI18N: ->\r\n    totalChanges = @level.populateI18N()\r\n\r\n    levelComponentMap = _(currentView.supermodel.getModels(LevelComponent))\r\n      .map((c) -> [c.get('original'), c])\r\n      .object()\r\n      .value()\r\n\r\n    for thang, thangIndex in @level.get('thangs')\r\n      for thangComponent, thangComponentIndex in thang.components\r\n        component = levelComponentMap[thangComponent.original]\r\n        configSchema = component.get('configSchema')\r\n        path = \"/thangs/#{thangIndex}/components/#{thangComponentIndex}/config\"\r\n        totalChanges += @level.populateI18N(thangComponent.config, configSchema, path)\r\n\r\n    if totalChanges\r\n      f = -> document.location.reload()\r\n      setTimeout(f, 500)\r\n    else\r\n      noty timeout: 2000, text: 'No changes.', type: 'information', layout: 'topRight'\r\n\r\n  onClickSaveBranch: ->\r\n    components = new LevelComponents(@supermodel.getModels(LevelComponent))\r\n    systems = new LevelSystems(@supermodel.getModels(LevelSystem))\r\n    @openModalView new SaveBranchModal({components, systems})\r\n    Backbone.Mediator.publish 'editor:view-switched', {}\r\n\r\n  onClickLoadBranch: ->\r\n    components = new LevelComponents(@supermodel.getModels(LevelComponent))\r\n    systems = new LevelSystems(@supermodel.getModels(LevelSystem))\r\n    @openModalView new LoadBranchModal({components, systems})\r\n    Backbone.Mediator.publish 'editor:view-switched', {}\r\n\r\n  toggleTab: (e) ->\r\n    @renderScrollbar()\r\n    return unless $(document).width() <= 800\r\n    li = $(e.target).closest('li')\r\n    if li.hasClass('active')\r\n      li.parent().find('li').show()\r\n    else\r\n      li.parent().find('li').hide()\r\n      li.show()\r\n    console.log li.hasClass('active')\r\n\r\n  onClickDocumentationTab: (e) ->\r\n    # It's either too late at night or something is going on with Bootstrap nested tabs, so we do the click instead of using .active.\r\n    return if @initializedDocs\r\n    @initializedDocs = true\r\n    @$el.find('a[href=\"#components-documentation-view\"]').click()\r\n\r\n  incrementBuildTime: =>\r\n    return if application.userIsIdle\r\n    @levelBuildTime ?= @level.get('buildTime') ? 0\r\n    ++@levelBuildTime\r\n\r\n  getTaskCompletionRatio: ->\r\n    if not @level.get('tasks')?\r\n      return '0/0'\r\n    else\r\n      return _.filter(@level.get('tasks'), (_elem) -> return _elem.complete).length + '/' + @level.get('tasks').length\r\n\r\n  getLevelCompletionRate: ->\r\n    return unless me.isAdmin()\r\n    startDay = utils.getUTCDay -14\r\n    startDayDashed = \"#{startDay[0..3]}-#{startDay[4..5]}-#{startDay[6..7]}\"\r\n    endDay = utils.getUTCDay -1\r\n    endDayDashed = \"#{endDay[0..3]}-#{endDay[4..5]}-#{endDay[6..7]}\"\r\n    success = (data) =>\r\n      return if @destroyed\r\n      started = 0\r\n      finished = 0\r\n      for day in data\r\n        started += day.started ? 0\r\n        finished += day.finished ? 0\r\n      rate = finished / started\r\n      rateDisplay = (rate * 100).toFixed(1) + '%'\r\n      @$('#completion-rate').text rateDisplay\r\n    request = @supermodel.addRequestResource 'level_completions', {\r\n      url: '/db/analytics_perday/-/level_completions'\r\n      data: {startDay: startDay, endDay: endDay, slug: @level.get('slug')}\r\n      method: 'POST'\r\n      success: success\r\n    }, 0\r\n    request.load()\r\n"]}