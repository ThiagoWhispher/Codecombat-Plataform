{"version":3,"sources":["app/views/editor/level/modals/NewAchievementModal.coffee"],"names":[],"mappings":";AAAA;EAAA;;;AAAA,gBAAgB,QAAQ,kCAAR;;AAChB,WAAW,QAAQ,8CAAR;;AACX,QAAQ,QAAQ,YAAR;;AACR,cAAc,QAAQ,oBAAR;;AAEd,MAAM,CAAC,OAAP,GAAuB;;;gCACrB,KAAI;;gCACJ,WAAU;;gCACV,QAAO;;gCAEP,SACE;IAAA,oCAAoC,wBAApC;;;EAEW,6BAAC,OAAD;IACX,qDAAM,OAAN;IACA,IAAC,MAAD,GAAS,OAAO,CAAC;EAFN;;gCAIb,yBAAwB,SAAC,CAAD;AACtB;IAAA,OAAO,CAAC,CAAC,MAAM,CAAC,OAAT,CAAiB,IAAC,IAAG,CAAC,IAAL,CAAU,OAAV,CAAkB,CAAC,GAAnB,EAAjB;IACP,MAAM,yBAAuB;WAC7B,MAAM,CAAC,IAAP,CAAY,GAAZ,EAAiB,QAAjB;EAHsB;;gCAKxB,cAAa;AACX;IAAA,UAAU,IAAC,IAAG,CAAC,IAAL,CAAU,6BAAV;IACV;;AAAiB;WAAA;;qBAAA,EAAE,KAAF,CAAQ,CAAC,GAAT;AAAA;;;IACjB,QAAQ;AACR;;AACE,cAAO,EAAP;AAAA,aACO,uBADP;UAEI,KAAM,kBAAN,GAA0B;AADvB;AADP;UAII,KAAM,uBAAoB,EAApB,GAAuB,SAAvB,CAAN,GAAyC;AAJ7C;AADF;IAMA,KAAM,kBAAN,GAA0B,IAAC,MAAK,CAAC,GAAP,CAAW,UAAX;WAC1B;EAXW;;gCAab,eAAc;AACZ;IAAA,cAAc,IAAI;IAClB,OAAO,IAAC,IAAG,CAAC,IAAL,CAAU,OAAV,CAAkB,CAAC,GAAnB;IACP,cAAc,IAAC,IAAG,CAAC,IAAL,CAAU,cAAV,CAAyB,CAAC,GAA1B;IACd,QAAQ,IAAC,YAAD;IAER,WAAW,CAAC,GAAZ,CAAgB,MAAhB,EAAwB,IAAxB;IACA,WAAW,CAAC,GAAZ,CAAgB,aAAhB,EAA+B,WAA/B;IACA,WAAW,CAAC,GAAZ,CAAgB,OAAhB,EAAyB,KAAzB;IACA,WAAW,CAAC,GAAZ,CAAgB,YAAhB,EAA8B,gBAA9B;IACA,WAAW,CAAC,GAAZ,CAAgB,WAAhB,EAA6B,SAA7B;IACA,WAAW,CAAC,GAAZ,CAAgB,SAAhB,EAA2B,IAAC,MAAK,CAAC,GAAP,CAAW,UAAX,CAA3B;WAEA;EAbY;;;;GA9BmC","file":"public/javascripts/app/views/editor/level/modals/NewAchievementModal.js","sourcesContent":["NewModelModal = require 'views/editor/modal/NewModelModal'\r\ntemplate = require 'templates/editor/level/modal/new-achievement'\r\nforms = require 'core/forms'\r\nAchievement = require 'models/Achievement'\r\n\r\nmodule.exports = class NewAchievementModal extends NewModelModal\r\n  id: 'new-achievement-modal'\r\n  template: template\r\n  plain: false\r\n\r\n  events:\r\n    'click #save-new-achievement-link': 'onAchievementSubmitted'\r\n\r\n  constructor: (options) ->\r\n    super options\r\n    @level = options.level\r\n\r\n  onAchievementSubmitted: (e) ->\r\n    slug = _.string.slugify @$el.find('#name').val()\r\n    url = \"/editor/achievement/#{slug}\"\r\n    window.open url, '_blank'\r\n\r\n  createQuery: ->\r\n    checked = @$el.find('[name=queryOptions]:checked')\r\n    checkedValues = ($(check).val() for check in checked)\r\n    query = {}\r\n    for id in checkedValues\r\n      switch id\r\n        when 'misc-level-completion'\r\n          query['state.complete'] = true\r\n        else\r\n          query[\"state.goalStates.#{id}.status\"] = 'success'\r\n    query['level.original'] = @level.get 'original'\r\n    query\r\n\r\n  makeNewModel: ->\r\n    achievement = new Achievement\r\n    name = @$el.find('#name').val()\r\n    description = @$el.find('#description').val()\r\n    query = @createQuery()\r\n\r\n    achievement.set 'name', name\r\n    achievement.set 'description', description\r\n    achievement.set 'query', query\r\n    achievement.set 'collection', 'level.sessions'\r\n    achievement.set 'userField', 'creator'\r\n    achievement.set 'related', @level.get('original')\r\n\r\n    achievement\r\n"]}