{"version":3,"sources":["app/templates/courses/courses-view.jade","app/views/courses/CoursesView.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApQA;AAAA;;ACAA;EAAA;;;AAAA,MAAM,QAAQ,kBAAR;;AACN,WAAW,QAAQ,qBAAR;;AACX,WAAW,QAAQ,gCAAR;;AACX,YAAY,QAAQ,sBAAR;;AACZ,qBAAqB,QAAQ,+BAAR;;AACrB,4BAA4B,QAAQ,yCAAR;;AAC5B,kBAAkB,QAAQ,+BAAR;;AAClB,sBAAsB,QAAQ,mCAAR;;AACtB,iBAAiB,QAAQ,8BAAR;;AACjB,iBAAiB,QAAQ,uBAAR;;AACjB,iBAAiB,QAAQ,4BAAR;;AACjB,SAAS,QAAQ,eAAR;;AACT,YAAY,QAAQ,kBAAR;;AACZ,aAAa,QAAQ,wBAAR;;AACb,eAAe,QAAQ,qBAAR;;AACf,SAAS,QAAQ,oBAAR;;AACT,aAAa,QAAQ,iBAAR;;AACb,WAAW,QAAQ,iBAAR;;AACX,YAAY,QAAQ,kBAAR;;AACZ,QAAQ,QAAQ,YAAR;;AAIR,MAAM,CAAC,OAAP,GAAuB;;;;;;;wBACrB,KAAI;;wBACJ,WAAU;;wBAEV,SACE;IAAA,qBAAqB,oBAArB;IACA,6BAA6B,iBAD7B;IAEA,0BAA0B,yBAF1B;IAGA,yBAAyB,wBAHzB;IAIA,2BAA2B,uBAJ3B;IAKA,mBAAmB,aALnB;IAMA,yBAAyB,kBANzB;IAOA,0BAA0B,mBAP1B;;;wBASF,WAAU;AAAG,WAAO,CAAC,CAAC,IAAI,CAAC,CAAP,CAAS,kBAAT;EAAV;;wBAEV,aAAY;AACV;IAAA,IAAC,kBAAD,GAAqB,KAAK,CAAC,gBAAN,CAAuB,KAAvB,EAA8B,KAA9B;IACrB,IAAC,gBAAD,GAAuB,mBAAe,EAAf,EAAmB;MAAE,KAAK,cAAY,EAAE,CAAC,EAAf,GAAkB,mBAAzB;MAA6C,OAAO,cAApD;KAAnB;IACvB,IAAC,gBAAe,CAAC,UAAjB,GAA8B,SAAC,EAAD;AAAQ,aAAO,EAAE,CAAC,GAAH,CAAO,aAAP,IAAwB,EAAE,CAAC,GAAH,CAAO,UAAP;IAAvC;IAC9B,IAAC,aAAD,CAAc,IAAC,gBAAf,EAAgC,MAAhC,EAAwC,IAAC,wBAAzC;IACA,IAAC,WAAU,CAAC,cAAZ,CAA2B,IAAC,gBAA5B,EAA6C;MAAE,OAAO,KAAT;KAA7C;IACA,IAAC,WAAD,GAAkB,mBAAe,EAAf,EAAmB;MAAE,KAAK,eAAP;MAAwB,OAAO,SAA/B;KAAnB;IAClB,IAAC,WAAU,CAAC,UAAZ,GAAyB,SAAC,CAAD,EAAI,CAAJ;aAAU,CAAC,CAAC,EAAE,CAAC,aAAL,CAAmB,CAAC,CAAC,EAArB;IAAV;IACzB,IAAC,WAAU,CAAC,cAAZ,CAA2B,IAAC,WAA5B,EAAwC;MAAE,MAAM;QAAC,UAAU,EAAE,CAAC,EAAd;OAAR;MAA2B,OAAO,KAAlC;KAAxC;IACA,IAAC,gBAAD,GAAuB;IACvB,IAAC,gBAAe,CAAC,SAAjB,CAA2B;MAAC,MAAM;QAAC,SAAS,KAAV;OAAP;KAA3B;IACA,IAAC,WAAU,CAAC,eAAZ,CAA4B,IAAC,gBAA7B;IACA,IAAC,QAAD,GAAe,mBAAe,EAAf,EAAmB;MAAE,KAAK,YAAP;MAAqB,OAAO,MAA5B;KAAnB;IACf,IAAC,WAAU,CAAC,cAAZ,CAA2B,IAAC,QAA5B;IACA,IAAC,iBAAD,GAAoB;IACpB,IAAC,KAAD,GAAQ,QAAQ,WAAR;IAGR,IAAC,KAAD,GAAQ,IAAI;IACZ,sBAAsB,SAAS,CAAC,MAAM,CAAC;IACvC,0DAAmC,CAAE,mBAAtB,IAAmC;IAClD,IAAC,KAAI,CAAC,GAAN,GAAY,oBAAkB,YAAlB,GAA+B;IAE3C,IAAC,WAAU,CAAC,SAAZ,CAAsB,IAAC,KAAvB,EAA6B,MAA7B;WACA,IAAC,SAAD,CAAU,IAAC,KAAX,EAAiB,KAAjB,EAAwB;aACtB,IAAC,OAAD;IADsB,CAAxB;EAxBU;;wBA2BZ,cAAa;IACX;IACA,MAAO,EAAE,CAAC,SAAH,MAAkB,CAAC,IAAC,kBAAD,IAAuB,CAAI,EAAE,CAAC,SAAH,EAA5B,CAAzB;aACE,IAAC,iBAAD,GADF;;EAFW;;wBAKb,0BAAyB;AAEvB;IAAA,IAAC,gBAAe,CAAC,MAAjB,CAAwB,IAAC,gBAAe,CAAC,KAAjB,CAAuB;MAAC,YAAY,IAAb;KAAvB,CAAxB;AAEA;AAAA;SAAA;;MACE,IAAY,CAAI,cAAc,CAAC,GAAf,CAAmB,aAAnB,CAAhB;AAAA;;MACA,WAAW,cAAc,CAAC,GAAf,CAAmB,UAAnB;MACX,cAAc,CAAC,QAAf,GAA8B,mBAAe,EAAf,EAAmB;QAC/C,KAAK,cAAc,CAAC,GAAf,KAAuB,2BADmB;QAE/C,OAAO,YAFwC;OAAnB;MAI9B,cAAc,CAAC,QAAQ,CAAC,UAAxB,GAAqC;mBACrC,IAAC,WAAU,CAAC,cAAZ,CAA2B,cAAc,CAAC,QAA1C,EAAoD;QAAE,MAAM;UAAE,SAAS,gDAAX;SAAR;OAApD;AARF;;EAJuB;;wBAczB,WAAU;AACR;IAAA;IACA,IAAG,IAAC,kBAAD,IAAuB,CAAI,EAAE,CAAC,WAAH,EAA9B;;WACgB,CAAE,UAAhB,CAA2B,0BAA3B,EAAuD;UAAA,UAAU,UAAV;UAAsB,WAAW,IAAC,kBAAlC;SAAvD,EAA4G,CAAC,UAAD,CAA5G;;MACA,IAAC,UAAD,GAFF;KAAA,MAGK,IAAG,IAAC,kBAAD,IAAuB,EAAE,CAAC,WAAH,EAA1B;MACH,IAAC,cAAD,CAAmB,wBAAnB,EADG;;IAEL;;yBAAgE;IAChE,OAAO,CAAC,OAAR,CAAgB,CAAC,CAAC,IAAF,CAAO,UAAU,CAAC,SAAX,CAAqB,QAArB,CAAP,CAAhB,CACA,CAAC,IADD,CACM;aAAA;AACJ;QAAA,KAAC,aAAD,GAAgB;AAChB;;UAAA,KAAC,aAAa,SAAd,GAAyB,UAAU,CAAC,OAAX,CAAmB,OAAnB;AAAzB;oDACA,KAAC;MAHG;IAAA,QADN;WAMA,CAAC,CAAC,OAAF,CAAU,CAAC,CAAC,MAAF,CAAS,CAAC,CAAC,KAAF,CAAQ,IAAC,WAAU,CAAC,MAApB,EAA4B,IAA5B,CAAT,CAAV,EAAuD;aAAA,SAAC,WAAD;AACrD;QAAA,SAAa;QACb,KAAC,SAAD,CAAU,MAAV,EAAkB,MAAlB,EAA0B;AACxB;UAAA,IAAU,KAAC,UAAX;AAAA;;AACA;AAAA;;YAAA,KAAC,iBAAiB,MAAK,CAAC,GAAN,CAAU,UAAV,EAAlB,GAA2C;AAA3C;iBACA,KAAC,OAAD;QAHwB,CAA1B;eAIA,KAAC,WAAU,CAAC,YAAZ,CAAyB,MAAM,CAAC,iBAAP,CAAyB,WAAzB,EAAsC;UAAE,MAAM;YAAE,SAAS,8BAAX;WAAR;SAAtC,CAAzB;MANqD;IAAA,QAAvD;EAdQ;;wBAsBV,qBAAoB;AAClB;IAAA,QAAY;IACZ,IAAC,cAAD,CAAe,KAAf;+CACc,CAAE,UAAhB,CAA2B,wBAA3B,EAAqD;MAAA,UAAU,UAAV;KAArD,EAA2E,CAAC,UAAD,CAA3E;EAHkB;;wBAKpB,kBAAiB;AACf;;SAAc,CAAE,UAAhB,CAA2B,yBAA3B,EAAsD;QAAA,UAAU,UAAV;OAAtD,EAA4E,CAAC,UAAD,CAA5E;;IACA,QAAY,uBAAmB;MAAE,eAAe;QAAE,WAAW,KAAK,CAAC,gBAAN,CAAuB,KAAvB,EAA8B,EAA9B,CAAb;OAAjB;KAAnB;WACZ,IAAC,cAAD,CAAe,KAAf;EAHe;;wBAKjB,0BAAyB;AACvB;;SAAc,CAAE,UAAhB,CAA2B,8BAA3B,EAA2D;QAAA,UAAU,UAAV;OAA3D,EAAiF,CAAC,UAAD,CAAjF;;IACA,QAAY,oBAAgB;MAAE,eAAe,IAAC,KAAI,CAAC,EAAvB;KAAhB;IACZ,IAAC,cAAD,CAAe,KAAf;IACA,IAAC,SAAD,CAAU,KAAV,EAAiB,qBAAjB,EAAwC;aAAA,SAAC,OAAD;eAGtC,KAAC,KAAI,CAAC,GAAN,CAAU,OAAO,CAAC,UAAlB;MAHsC;IAAA,QAAxC;WAIA,IAAC,SAAD,CAAU,KAAV,EAAiB,MAAjB,EAAyB;aACvB,IAAC,cAAD,CAAe,KAAf;IADuB,CAAzB;EARuB;;wBAWzB,wBAAuB,SAAC,CAAD;AACrB;IAAA,CAAC,CAAC,cAAF;IACA,YAAY,IAAC,EAAD,CAAG,mBAAH,CAAuB,CAAC,GAAxB,MAAiC,IAAC;;SAChC,CAAE,UAAhB,CAA2B,+BAA3B,EAA4D;QAAA,UAAU,UAAV;QAAsB,WAAW,SAAjC;OAA5D,EAAwG,CAAC,UAAD,CAAxG;;WACA,IAAC,UAAD;EAJqB;;wBAMvB,yBAAwB,SAAC,CAAD;AACtB;IAAA,YAAY,IAAC,EAAD,CAAG,mBAAH,CAAuB,CAAC,GAAxB,MAAiC,IAAC;;SAChC,CAAE,UAAhB,CAA2B,+BAA3B,EAA4D;QAAA,UAAU,UAAV;QAAsB,WAAW,SAAjC;OAA5D,EAAwG,CAAC,UAAD,CAAxG;;WACA,IAAC,UAAD;EAHsB;;wBAKxB,YAAW;AACT;IAAA,IAAU,IAAC,MAAX;AAAA;;IACA,IAAC,MAAD,GAAS;IACT,IAAC,aAAD,GAAgB;IAChB,IAAC,UAAD,GAAa,IAAC,EAAD,CAAG,mBAAH,CAAuB,CAAC,GAAxB,MAAiC,IAAC;IAC/C,IAAG,CAAI,IAAC,UAAR;MACE,IAAC,MAAD,GAAS;MACT,IAAC,aAAD,GAAgB;MAChB,IAAC,gBAAD,CAAiB,kBAAjB;AACA,aAJF;;IAKA,IAAC,gBAAD,CAAiB,kBAAjB;IACA,IAAG,EAAE,CAAC,GAAH,CAAO,eAAP,KAA2B,EAAE,CAAC,SAAH,EAA9B;MACE,eAAmB;MACnB,QAAQ,YAAY,CAAC,YAAb,CAA0B,IAAC,UAA3B;MACR,IAAC,SAAD,CAAU,YAAV,EAAwB,cAAxB,EAAwC;eAAG,IAAC,uBAAD,CAAwB,YAAxB;MAAH,CAAxC;aACA,IAAC,SAAD,CAAU,YAAV,EAAwB,YAAxB,EAAsC;eAAG,IAAC,qBAAD,CAAsB,YAAtB,EAAoC,KAApC;MAAH,CAAtC,EAJF;KAAA;MAME,QAAY,mBAAe;QAAG,WAAD,IAAC,UAAH;OAAf;MACZ,IAAC,cAAD,CAAe,KAAf;MACA,IAAC,SAAD,CAAU,KAAV,EAAiB,OAAjB,EAA0B,IAAC,iBAA3B;MACA,IAAC,SAAD,CAAU,KAAV,EAAiB,cAAjB,EAAiC,IAAC,uBAAlC;MACA,IAAC,SAAD,CAAU,KAAV,EAAiB,YAAjB,EAA+B,IAAC,qBAAhC;MACA,IAAC,aAAD,CAAc,KAAd,EAAqB,QAArB,EAA+B;QAC7B,KAAO,EAAE,CAAC,SAAH,EAAP;iBACE,IAAC,iBAAD,GADF;;MAD6B,CAA/B;aAGA,IAAC,SAAD,CAAU,KAAV,EAAiB,QAAjB,EAA2B;QACzB,IAAC,MAAD,GAAS;eACT,IAAC,gBAAD,CAAiB,kBAAjB;MAFyB,CAA3B,EAdF;;EAXS;;wBA8BX,mBAAkB;WAChB,CAAC,CAAC,KAAF,CAAQ;aACN,WAAW,CAAC,MAAM,CAAC,aAAnB,CAAiC,kCAAjC;IADM,CAAR;EADgB;;wBAIlB,uBAAsB,SAAC,SAAD,EAAY,KAAZ,EAAmB,OAAnB;IACpB,IAAC,MAAD,GAAS;IACT,IAAG,KAAK,CAAC,MAAN,KAAgB,GAAnB;MACE,IAAC,aAAD,GAAgB,uBADlB;KAAA,MAEK,IAAG,KAAK,CAAC,MAAN,KAAgB,GAAnB;MACH,IAAC,aAAD,GAAgB,CAAC,CAAC,CAAF,CAAI,4BAAJ,EADb;KAAA;MAGH,IAAC,aAAD,GAAgB,KAAG,KAAK,CAAC,aAHtB;;WAIL,IAAC,gBAAD,CAAiB,kBAAjB;EARoB;;wBAUtB,yBAAwB,SAAC,YAAD,EAAe,IAAf,EAAqB,OAArB;AACtB;IAAA,IAAC,MAAD,GAAS;;SACU,CAAE,UAArB,CAAgC,kBAAhC,EAAoD;QAClD,UAAU,SADwC;QAElD,WAAW,IAAC,UAFsC;QAGlD,aAAa,YAAY,CAAC,EAHwB;QAIlD,eAAe,YAAY,CAAC,GAAb,CAAiB,MAAjB,CAJmC;QAKlD,SAAS,YAAY,CAAC,GAAb,CAAiB,SAAjB,CALyC;OAApD;;IAOA,IAAC,WAAU,CAAC,GAAZ,CAAgB,YAAhB;IACA,IAAC,OAAD;IACA,IAAC,mBAAD,GAAsB,YAAY,CAAC;IAEnC,2BAA+B,mBAAe,EAAf,EAAmB;MAAE,KAAK,qBAAP;MAA8B,OAAO,cAArC;KAAnB;IAC/B,wBAAwB,CAAC,KAAzB,CAA+B;MAAE,MAAM;QAAC,aAAa,YAAY,CAAC,EAA3B;OAAR;KAA/B;WACA,IAAC,aAAD,CAAc,wBAAd,EAAwC,MAAxC,EAAgD;aAG9C,QAAQ,CAAC,QAAQ,CAAC,MAAlB,GAA2B;IAHmB,CAAhD;EAfsB;;wBAoBxB,cAAa,SAAC,CAAD;AACX;IAAA,YAAY,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,IAAnB,CAAwB,YAAxB;;SACE,CAAE,UAAhB,CAA2B,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,IAAnB,CAAwB,cAAxB,CAA3B,EAAoE;QAAA,UAAU,UAAV;QAAsB,WAAW,SAAjC;OAApE,EAAgH,CAAC,UAAD,CAAhH;;WACA,WAAW,CAAC,MAAM,CAAC,QAAnB,CAA4B,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,IAAnB,CAAwB,MAAxB,CAA5B,EAA6D;MAAE,SAAS,IAAX;KAA7D;EAHW;;wBAKb,mBAAkB,SAAC,CAAD;AAChB;IAAA,cAAc,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,IAAZ,CAAiB,cAAjB;;SACA,CAAE,UAAhB,CAA2B,qBAA3B,EAAkD;QAAA,UAAU,UAAV;QAAsB,aAAa,WAAnC;OAAlD,EAAkG,CAAC,UAAD,CAAlG;;WACA,WAAW,CAAC,MAAM,CAAC,QAAnB,CAA4B,eAAa,WAAzC,EAAwD;MAAE,SAAS,IAAX;KAAxD;EAHgB;;wBAKlB,oBAAmB,SAAC,CAAD;AACjB;IAAA,WAAW,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,IAAZ,CAAiB,WAAjB;IACX,mBAAmB,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,IAAZ,CAAiB,mBAAjB;;SACL,CAAE,UAAhB,CAA2B,sBAA3B,EAAmD;QAAA,UAAU,UAAV;QAAsB,UAAU,QAAhC;QAA0C,kBAAkB,gBAA5D;OAAnD,EAAiI,CAAC,UAAD,CAAjI;;WACA,WAAW,CAAC,MAAM,CAAC,QAAnB,CAA4B,eAAa,QAAb,GAAsB,GAAtB,GAAyB,gBAArD,EAAyE;MAAE,SAAS,IAAX;KAAzE;EAJiB;;;;GA9LsB","file":"public/javascripts/app/views/courses/CoursesView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),view = locals_.view,me = locals_.me,serverConfig = locals_.serverConfig,i18n = locals_.i18n;var course_instance_body_mixin = function(courseInstance, classroom){\nvar block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};\nvar course = view.courses.get(courseInstance.get('courseID'));\nvar stats = classroom.statsForSessions(courseInstance.sessions, course.id);\nif ( stats.levels.done)\n{\nbuf.push(\"<div class=\\\"text-success\\\"><span class=\\\"glyphicon glyphicon-ok\\\"></span><span data-i18n=\\\"courses.course_complete\\\" class=\\\"spl\\\"></span><span>!</span></div>\");\n}\nbuf.push(\"<div class=\\\"pull-right\\\">\");\nif ( stats.levels.done)\n{\nvar arenaLevel = stats.levels.arena;\nvar projectLevel = stats.levels.project;\nif ( arenaLevel)\n{\nvar url = view.urls.courseArenaLadder({level: view.originalLevelMap[arenaLevel.get('original')] || arenaLevel, courseInstance: courseInstance});\nbuf.push(\"<a\" + (jade.attrs({ 'data-href':(url), 'data-level-slug':(arenaLevel.get('slug')), 'data-event-action':(\"Students Play Arena\"), \"class\": [('play-btn'),('btn'),('btn-forest-alt'),('btn-lg'),('m-b-1')] }, {\"data-href\":true,\"data-level-slug\":true,\"data-event-action\":true})) + \"><span data-i18n=\\\"courses.play_arena\\\"></span></a>\");\n}\nelse if ( projectLevel)\n{\nvar url = view.urls.courseLevel({level: view.originalLevelMap[projectLevel.get('original')] || projectLevel, courseInstance: courseInstance});\nbuf.push(\"<a\" + (jade.attrs({ 'data-href':(url), 'data-level-slug':(projectLevel.get('slug')), 'data-event-action':(\"Students Play Project\"), \"class\": [('play-btn'),('btn'),('btn-forest-alt'),('btn-lg'),('m-b-1')] }, {\"data-href\":true,\"data-level-slug\":true,\"data-event-action\":true})) + \"><span data-i18n=\\\"courses.view_project\\\"></span></a>\");\n}\nelse\n{\nbuf.push(\"<a disabled=\\\"disabled\\\" data-i18n=\\\"courses.course_complete\\\" class=\\\"btn btn-default btn-lg m-b-1\\\"></a>\");\n}\n}\nelse if ( stats.levels.next != stats.levels.first)\n{\nvar next = stats.levels.next;\nvar url = view.urls.courseLevel({level: view.originalLevelMap[next.get('original')] || next, courseInstance: courseInstance});\nbuf.push(\"<a\" + (jade.attrs({ 'data-href':(url), 'data-level-slug':(next.get('slug')), 'data-event-action':(\"Students Continue Course\"), \"class\": [('play-btn'),('btn'),('btn-forest'),('btn-lg'),('m-b-1')] }, {\"data-href\":true,\"data-level-slug\":true,\"data-event-action\":true})) + \"><span data-i18n=\\\"common.continue\\\"></span></a>\");\n}\nelse\n{\nvar firstLevel = stats.levels.first;\nvar url = view.urls.courseLevel({level: view.originalLevelMap[firstLevel.get('original')] || firstLevel, courseInstance: courseInstance});\nbuf.push(\"<a\" + (jade.attrs({ 'data-href':(url), 'data-level-slug':(firstLevel.get('slug')), 'data-event-action':(\"Students Start Course\"), \"class\": [('play-btn'),('btn'),('btn-navy'),('btn-lg'),('m-b-1')] }, {\"data-href\":true,\"data-level-slug\":true,\"data-event-action\":true})) + \"><span data-i18n=\\\"courses.start\\\"></span></a>\");\n}\nbuf.push(\"</div>\");\nif ( stats.levels.lastPlayed)\n{\nbuf.push(\"<div><span data-i18n=\\\"courses.last_level\\\"></span><span>: \" + (jade.escape((jade.interp = stats.levels.lastPlayedNumber) == null ? '' : jade.interp)) + \".</span><span class=\\\"spl\\\">\" + (jade.escape(null == (jade.interp = stats.levels.lastPlayed.get('name')) ? \"\" : jade.interp)) + \"</span></div>\");\n}\nbuf.push(\"<div class=\\\"clearfix\\\"></div><div class=\\\"progress\\\"><div\" + (jade.attrs({ 'style':(\"width:\"+stats.levels.pctDone), \"class\": [('progress-bar')] }, {\"style\":true})) + \">\" + (jade.escape(null == (jade.interp = stats.levels.pctDone) ? \"\" : jade.interp)) + \"</div></div>\");\n};\nvar accountLinks_mixin = function(){\nvar block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};\nbuf.push(\"<li><a\" + (jade.attrs({ 'href':(\"/user/\" + (me.getSlugOrID()) + \"\"), 'data-i18n':(\"nav.profile\") }, {\"href\":true,\"data-i18n\":true})) + \"></a></li><li><a href=\\\"/account/settings\\\" data-i18n=\\\"play.settings\\\"></a></li><li><a id=\\\"logout-button\\\" data-i18n=\\\"login.log_out\\\"></a></li>\");\n};\nbuf.push(\"<div class=\\\"style-flat\\\"><nav id=\\\"main-nav\\\" class=\\\"navbar navbar-default\\\"><div class=\\\"container-fluid container\\\"><div class=\\\"row\\\"><div class=\\\"col-md-12\\\"><div class=\\\"navbar-header\\\"><button data-toggle=\\\"collapse\\\" data-target=\\\"#navbar-collapse\\\" aria-expanded=\\\"false\\\" class=\\\"navbar-toggle collapsed\\\"><span data-i18n=\\\"nav.toggle_nav\\\" class=\\\"sr-only\\\"></span><span class=\\\"icon-bar\\\"></span><span class=\\\"icon-bar\\\"></span><span class=\\\"icon-bar\\\"></span></button><a href=\\\"/\\\" class=\\\"navbar-brand\\\">\");\nif ( serverConfig.codeNinjas)\n{\nbuf.push(\"<img id=\\\"logo-img\\\" src=\\\"/images/pages/base/logo.png\\\" class=\\\"code-ninjas-powered-by\\\"/><img src=\\\"/images/pages/base/code-ninjas-logo-right.png\\\" class=\\\"code-ninjas-logo\\\"/>\");\n}\nelse\n{\nbuf.push(\"<img id=\\\"logo-img\\\" src=\\\"/images/pages/base/logo.png\\\"/>\");\n}\nbuf.push(\"<span class=\\\"glyphicon glyphicon-home\\\"></span></a></div><div id=\\\"navbar-collapse\\\" class=\\\"collapse navbar-collapse\\\"><ul class=\\\"nav navbar-nav\\\">\");\nif ( (!me.isStudent() && !me.isTeacher()))\n{\nbuf.push(\"<li><a href=\\\"/play\\\" data-i18n=\\\"common.play\\\"></a></li>\");\n}\nbuf.push(\"<li><a href=\\\"play/ladder\\\" data-i18n=\\\"game_menu.multiplayer_tab\\\"></a></li>\");\nif ( me.isStudent())\n{\nbuf.push(\"<li><a href=\\\"/students\\\" data-i18n=\\\"nav.my_courses\\\"></a></li>\");\n}\nif ( !me.isAnonymous() && me.isTeacher())\n{\nbuf.push(\"<li><a href=\\\"/teachers/classes\\\" data-i18n=\\\"nav.my_classrooms\\\"></a></li>\");\n}\nbuf.push(\"<li><a href=\\\"/about\\\" data-i18n=\\\"nav.about\\\"></a></li><li><a\" + (jade.attrs({ 'href':(view.forumLink()), 'data-i18n':(\"nav.forum\") }, {\"href\":true,\"data-i18n\":true})) + \"></a></li></ul>\");\nif ( me.isAnonymous())\n{\nbuf.push(\"<ul class=\\\"nav navbar-nav\\\"><li><a id=\\\"create-account-link\\\" data-i18n=\\\"login.sign_up\\\" class=\\\"signup-button\\\"></a></li><li><a id=\\\"login-link\\\" data-i18n=\\\"login.log_in\\\" class=\\\"login-button\\\"></a></li></ul>\");\n}\nelse\n{\nbuf.push(\"<ul class=\\\"nav navbar-nav hidden-md hidden-lg\\\"><li class=\\\"disabled\\\"><a><img\" + (jade.attrs({ 'src':(me.getPhotoURL()), \"class\": [('img-circle'),('img-circle-small'),('m-r-1'),((me.isTeacher() ? 'border-navy' : ''))] }, {\"class\":true,\"src\":true})) + \"/><span>\" + (jade.escape(null == (jade.interp = me.displayName()) ? \"\" : jade.interp)) + \"</span></a></li>\");\naccountLinks_mixin();\nbuf.push(\"</ul><ul class=\\\"nav navbar-nav\\\"><li class=\\\"dropdown hidden-xs hidden-sm\\\"><a href=\\\"#\\\" data-toggle=\\\"dropdown\\\" role=\\\"button\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"false\\\" class=\\\"dropdown-toggle\\\"><img\" + (jade.attrs({ 'src':(me.getPhotoURL()), \"class\": [('img-circle'),('img-circle-small'),('m-r-1'),((me.isTeacher() ? 'border-navy' : ''))] }, {\"class\":true,\"src\":true})) + \"/><span data-i18n=\\\"nav.my_account\\\"></span></a><ul class=\\\"dropdown-menu\\\"><li class=\\\"user-dropdown-header text-center\\\"><span class=\\\"user-level\\\">\" + (jade.escape(null == (jade.interp = me.level()) ? \"\" : jade.interp)) + \"</span><a\" + (jade.attrs({ 'href':(\"/user/\" + (me.getSlugOrID()) + \"\") }, {\"href\":true})) + \"><img\" + (jade.attrs({ 'src':(me.getPhotoURL()), \"class\": [('img-circle'),((me.isTeacher() ? 'border-navy' : ''))] }, {\"class\":true,\"src\":true})) + \"/></a><h5>\" + (jade.escape(null == (jade.interp = me.broadName()) ? \"\" : jade.interp)) + \"</h5></li>\");\naccountLinks_mixin();\nbuf.push(\"</ul></li></ul>\");\n}\nbuf.push(\"<ul class=\\\"nav navbar-nav\\\"><li><div id=\\\"language-dropdown-wrapper\\\"><select class=\\\"language-dropdown form-control\\\"></select></div></li></ul></div></div></div></div></nav><div id=\\\"site-content-area\\\"><div class=\\\"container\\\"><div class=\\\"row m-y-3\\\"><div class=\\\"col-xs-12\\\">\");\nif ( me.isTeacher())\n{\nbuf.push(\"<div class=\\\"alert alert-danger text-center\\\"><!-- DNT: Temporary--><h3>ATTENTION TEACHERS:</h3><p>We are transitioning to a new classroom management system; this page will soon be student-only.</p><a href=\\\"/teachers/classes\\\">Go to teachers area.</a></div>\");\n}\nbuf.push(\"<div id=\\\"main-content\\\">\");\nif ( me.isAnonymous())\n{\nbuf.push(\"<h1 data-i18n=\\\"courses.welcome_to_courses\\\" class=\\\"text-center\\\"></h1><div class=\\\"text-center\\\"><p><h2 data-i18n=\\\"courses.ready_to_play\\\"></h2></p><p><button id=\\\"start-new-game-btn\\\" data-i18n=\\\"courses.start_new_game\\\" class=\\\"btn btn-navy\\\"></button></p><p><span class=\\\"spr\\\">-</span><span data-i18n=\\\"general.or\\\" class=\\\"text-uppercase\\\"></span><span class=\\\"spl\\\">-</span></p><p><button id=\\\"log-in-btn\\\" data-i18n=\\\"login.log_in\\\" class=\\\"btn btn-forest\\\"></button></p></div><h2 id=\\\"play-now-to-learn-header\\\" data-i18n=\\\"courses.play_now_learn_header\\\" class=\\\"text-center text-uppercase\\\"></h2><ul id=\\\"benefits-ul\\\"><li data-i18n=\\\"courses.play_now_learn_1\\\"></li><li data-i18n=\\\"courses.play_now_learn_2\\\"></li><li data-i18n=\\\"courses.play_now_learn_3\\\"></li><li data-i18n=\\\"courses.play_now_learn_4\\\"></li></ul>\");\n}\nelse\n{\nbuf.push(\"<div class=\\\"text-center\\\"><h1 data-i18n=\\\"courses.welcome_to_page\\\"></h1></div><div class=\\\"current-hero-container text-center row\\\"><div class=\\\"hero-avatar\\\"><img\" + (jade.attrs({ 'src':(view.hero.getPortraitURL()) }, {\"src\":true})) + \"/></div><div class=\\\"current-hero-right-col\\\"><div class=\\\"semibold current-hero-text\\\"><span data-i18n=\\\"courses.current_hero\\\" class=\\\"spr\\\"></span><span class=\\\"current-hero-name\\\">\" + (jade.escape(null == (jade.interp = view.hero.getHeroShortName()) ? \"\" : jade.interp)) + \"</span></div><button class=\\\"change-hero-btn btn btn-lg btn-forest\\\"><span data-i18n=\\\"courses.change_hero\\\"></span></button></div></div>\");\nif ( view.classrooms.size())\n{\nbuf.push(\"<br/><h3 data-i18n=\\\"courses.my_classes\\\"></h3>\");\n// iterate view.classrooms.models\n;(function(){\n  var $$obj = view.classrooms.models;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var classroom = $$obj[$index];\n\nbuf.push(\"<hr class=\\\"class-break\\\"/>\");\nvar justAdded = classroom.id === view.classroomJustAdded;\nvar classroomClass = justAdded ? 'just-added' : '';\nif ( justAdded)\n{\nbuf.push(\"<div id=\\\"just-added-text\\\" data-i18n=\\\"courses.class_added\\\" class=\\\"text-center\\\"></div>\");\n}\nbuf.push(\"<div\" + (jade.attrs({ \"class\": [(classroomClass)] }, {\"class\":true})) + \"><h5><span class=\\\"spr\\\">\" + (jade.escape(null == (jade.interp = classroom.get('name')) ? \"\" : jade.interp)) + \"</span><span class=\\\"spr\\\">(\" + (jade.escape((jade.interp = (classroom.get('aceConfig') || {}).language === 'javascript' ? 'JavaScript' : 'Python') == null ? '' : jade.interp)) + \")</span></h5><p><span data-i18n=\\\"courses.teacher\\\"></span><span>:</span>\");\nif ( view.ownerNameMap && view.ownerNameMap[classroom.get('ownerID')])\n{\nbuf.push(\"<span class=\\\"spl\\\">\" + (jade.escape(null == (jade.interp = view.ownerNameMap[classroom.get('ownerID')]) ? \"\" : jade.interp)) + \"</span>\");\n}\nbuf.push(\"</p>\");\nvar courseInstances = view.courseInstances.where({classroomID: classroom.id});\n// iterate courseInstances\n;(function(){\n  var $$obj = courseInstances;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var courseInstance = $$obj[$index];\n\nbuf.push(\"<div class=\\\"course-instance-entry\\\">\");\nvar course = view.courses.get(courseInstance.get('courseID'));\nbuf.push(\"<h6><span class=\\\"spr\\\">\" + (jade.escape(null == (jade.interp = i18n(course.attributes, 'name')) ? \"\" : jade.interp)) + \"</span><small><a\" + (jade.attrs({ 'data-course-id':(courseInstance.get('courseID')), 'data-courseinstance-id':(courseInstance.id), 'data-i18n':(\"courses.view_levels\"), \"class\": [('view-levels-btn')] }, {\"data-course-id\":true,\"data-courseinstance-id\":true,\"data-i18n\":true})) + \"></a></small></h6>\");\ncourse_instance_body_mixin(courseInstance, classroom);\nbuf.push(\"<div class=\\\"clearfix\\\"></div></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var courseInstance = $$obj[$index];\n\nbuf.push(\"<div class=\\\"course-instance-entry\\\">\");\nvar course = view.courses.get(courseInstance.get('courseID'));\nbuf.push(\"<h6><span class=\\\"spr\\\">\" + (jade.escape(null == (jade.interp = i18n(course.attributes, 'name')) ? \"\" : jade.interp)) + \"</span><small><a\" + (jade.attrs({ 'data-course-id':(courseInstance.get('courseID')), 'data-courseinstance-id':(courseInstance.id), 'data-i18n':(\"courses.view_levels\"), \"class\": [('view-levels-btn')] }, {\"data-course-id\":true,\"data-courseinstance-id\":true,\"data-i18n\":true})) + \"></a></small></h6>\");\ncourse_instance_body_mixin(courseInstance, classroom);\nbuf.push(\"<div class=\\\"clearfix\\\"></div></div>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var classroom = $$obj[$index];\n\nbuf.push(\"<hr class=\\\"class-break\\\"/>\");\nvar justAdded = classroom.id === view.classroomJustAdded;\nvar classroomClass = justAdded ? 'just-added' : '';\nif ( justAdded)\n{\nbuf.push(\"<div id=\\\"just-added-text\\\" data-i18n=\\\"courses.class_added\\\" class=\\\"text-center\\\"></div>\");\n}\nbuf.push(\"<div\" + (jade.attrs({ \"class\": [(classroomClass)] }, {\"class\":true})) + \"><h5><span class=\\\"spr\\\">\" + (jade.escape(null == (jade.interp = classroom.get('name')) ? \"\" : jade.interp)) + \"</span><span class=\\\"spr\\\">(\" + (jade.escape((jade.interp = (classroom.get('aceConfig') || {}).language === 'javascript' ? 'JavaScript' : 'Python') == null ? '' : jade.interp)) + \")</span></h5><p><span data-i18n=\\\"courses.teacher\\\"></span><span>:</span>\");\nif ( view.ownerNameMap && view.ownerNameMap[classroom.get('ownerID')])\n{\nbuf.push(\"<span class=\\\"spl\\\">\" + (jade.escape(null == (jade.interp = view.ownerNameMap[classroom.get('ownerID')]) ? \"\" : jade.interp)) + \"</span>\");\n}\nbuf.push(\"</p>\");\nvar courseInstances = view.courseInstances.where({classroomID: classroom.id});\n// iterate courseInstances\n;(function(){\n  var $$obj = courseInstances;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var courseInstance = $$obj[$index];\n\nbuf.push(\"<div class=\\\"course-instance-entry\\\">\");\nvar course = view.courses.get(courseInstance.get('courseID'));\nbuf.push(\"<h6><span class=\\\"spr\\\">\" + (jade.escape(null == (jade.interp = i18n(course.attributes, 'name')) ? \"\" : jade.interp)) + \"</span><small><a\" + (jade.attrs({ 'data-course-id':(courseInstance.get('courseID')), 'data-courseinstance-id':(courseInstance.id), 'data-i18n':(\"courses.view_levels\"), \"class\": [('view-levels-btn')] }, {\"data-course-id\":true,\"data-courseinstance-id\":true,\"data-i18n\":true})) + \"></a></small></h6>\");\ncourse_instance_body_mixin(courseInstance, classroom);\nbuf.push(\"<div class=\\\"clearfix\\\"></div></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var courseInstance = $$obj[$index];\n\nbuf.push(\"<div class=\\\"course-instance-entry\\\">\");\nvar course = view.courses.get(courseInstance.get('courseID'));\nbuf.push(\"<h6><span class=\\\"spr\\\">\" + (jade.escape(null == (jade.interp = i18n(course.attributes, 'name')) ? \"\" : jade.interp)) + \"</span><small><a\" + (jade.attrs({ 'data-course-id':(courseInstance.get('courseID')), 'data-courseinstance-id':(courseInstance.id), 'data-i18n':(\"courses.view_levels\"), \"class\": [('view-levels-btn')] }, {\"data-course-id\":true,\"data-courseinstance-id\":true,\"data-i18n\":true})) + \"></a></small></h6>\");\ncourse_instance_body_mixin(courseInstance, classroom);\nbuf.push(\"<div class=\\\"clearfix\\\"></div></div>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div>\");\n    }\n\n  }\n}).call(this);\n\n}\nbuf.push(\"<h3 data-i18n=\\\"courses.join_class\\\" class=\\\"text-uppercase\\\"></h3><hr/><form id=\\\"join-class-form\\\" class=\\\"form-inline\\\"><div class=\\\"help-block\\\"><em data-i18n=\\\"courses.ask_teacher_for_code\\\"></em></div><div class=\\\"form-group\\\"><input\" + (jade.attrs({ 'id':('class-code-input'), 'data-i18n':(\"[placeholder]courses.enter_c_code\"), 'placeholder':(\"<Enter Class Code>\"), 'value':(view.classCode), \"class\": [('form-control')] }, {\"data-i18n\":true,\"placeholder\":true,\"value\":true})) + \"/></div><input id=\\\"join-class-button\\\" type=\\\"submit\\\" data-i18n=\\\"[value]courses.join\\\" value=\\\"Join\\\" class=\\\"btn btn-navy\\\"/>\");\nif ( view.state === 'enrolling')\n{\nbuf.push(\"<div class=\\\"progress progress-striped active\\\"><div style=\\\"width: 100%\\\" data-i18n=\\\"courses.joining\\\" class=\\\"progress-bar\\\">Joining class</div></div>\");\n}\nif ( view.errorMessage)\n{\nbuf.push(\"<div class=\\\"alert alert-danger\\\">\" + (jade.escape(null == (jade.interp = view.errorMessage) ? \"\" : jade.interp)) + \"</div>\");\n}\nbuf.push(\"</form>\");\n}\nbuf.push(\"</div></div></div></div></div><div class=\\\"container-fluid\\\"><div id=\\\"footer\\\" class=\\\"small\\\"><div class=\\\"container\\\"><div class=\\\"row\\\"><div class=\\\"col-sm-3\\\"><ul class=\\\"list-unstyled\\\"><li><strong>CodeCombat</strong></li><li><a href=\\\"/about\\\" data-i18n=\\\"nav.about\\\"></a></li><li><a href=\\\"/about#jobs\\\" data-i18n=\\\"nav.jobs\\\"></a></li><li><a href=\\\"http://blog.codecombat.com/\\\" data-i18n=\\\"nav.blog\\\"></a></li><li><a href=\\\"/legal\\\" data-i18n=\\\"nav.legal\\\"></a></li><li><a href=\\\"/privacy\\\" data-i18n=\\\"nav.privacy\\\"></a></li></ul></div>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<div class=\\\"col-sm-3\\\"><ul class=\\\"list-unstyled\\\"><li><strong data-i18n=\\\"nav.schools\\\"></strong></li><li><a href=\\\"/teachers/resources/faq\\\" data-i18n=\\\"teacher.educator_faq\\\"></a></li><li><a href=\\\"/teachers/classes\\\" data-i18n=\\\"nav.my_classrooms\\\"></a></li><li><a href=\\\"/teachers/resources\\\" data-i18n=\\\"nav.resource_hub\\\"></a></li><li><a href=\\\"/teachers/demo\\\" data-i18n=\\\"new_home.request_demo\\\"></a></li></ul></div>\");\n}\nbuf.push(\"<div class=\\\"col-sm-3\\\"><ul class=\\\"list-unstyled\\\"><li><strong data-i18n=\\\"nav.get_involved\\\"></strong></li><li><a href=\\\"/community\\\" data-i18n=\\\"nav.community\\\"></a></li><li><a href=\\\"/contribute\\\" data-i18n=\\\"nav.contribute\\\"></a></li>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<li><a\" + (jade.attrs({ 'href':(view.forumLink()), 'data-i18n':(\"nav.forum\") }, {\"href\":true,\"data-i18n\":true})) + \"></a></li>\");\n}\nbuf.push(\"<li><a href=\\\"/play/ladder\\\" data-i18n=\\\"game_menu.multiplayer_tab\\\"></a></li><li><a href=\\\"https://github.com/codecombat/codecombat\\\" data-i18n=\\\"nav.open_source\\\"></a></li></ul></div><div class=\\\"col-sm-3\\\"><ul class=\\\"list-unstyled\\\"><li><strong data-i18n=\\\"nav.support\\\"></strong></li>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<li><a tabindex=\\\"-1\\\" data-i18n=\\\"nav.contact\\\" class=\\\"contact-modal\\\"></a></li>\");\n}\nbuf.push(\"<li><a href=\\\"https://www.facebook.com/codecombat\\\" data-i18n=\\\"nav.facebook\\\"></a></li><li><a href=\\\"https://twitter.com/codecombat\\\" data-i18n=\\\"nav.twitter\\\"></a></li></ul></div></div></div></div><div id=\\\"final-footer\\\" class=\\\"small text-center\\\">Copyright ©2016 CodeCombat. All Rights Reserved.<br class=\\\"hidden-lg hidden-md\\\"/><img src=\\\"/images/pages/base/logo.png\\\" alt=\\\"CodeCombat\\\"/><br class=\\\"hidden-lg hidden-md\\\"/>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<span data-i18n=\\\"nav.help_pref\\\" class=\\\"spr\\\"></span>\");\nvar supportEmail = (me.get('preferredLanguage', true) || 'en-US').split('-')[0] == 'nl' ? 'klantenservice@codecombat.nl' : 'team@codecombat.com';\nbuf.push(\"<a\" + (jade.attrs({ 'href':(\"mailto:\" + supportEmail) }, {\"href\":true})) + \">\" + (jade.escape(null == (jade.interp = supportEmail) ? \"\" : jade.interp)) + \"</a><span data-i18n=\\\"nav.help_suff\\\" class=\\\"spl\\\"></span>\");\n}\nbuf.push(\"</div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","app = require 'core/application'\r\nRootView = require 'views/core/RootView'\r\ntemplate = require 'templates/courses/courses-view'\r\nAuthModal = require 'views/core/AuthModal'\r\nCreateAccountModal = require 'views/core/CreateAccountModal'\r\nChangeCourseLanguageModal = require 'views/courses/ChangeCourseLanguageModal'\r\nHeroSelectModal = require 'views/courses/HeroSelectModal'\r\nChooseLanguageModal = require 'views/courses/ChooseLanguageModal'\r\nJoinClassModal = require 'views/courses/JoinClassModal'\r\nCourseInstance = require 'models/CourseInstance'\r\nCocoCollection = require 'collections/CocoCollection'\r\nCourse = require 'models/Course'\r\nClassroom = require 'models/Classroom'\r\nClassrooms = require 'collections/Classrooms'\r\nLevelSession = require 'models/LevelSession'\r\nLevels = require 'collections/Levels'\r\nNameLoader = require 'core/NameLoader'\r\nCampaign = require 'models/Campaign'\r\nThangType = require 'models/ThangType'\r\nutils = require 'core/utils'\r\n\r\n# TODO: Test everything\r\n\r\nmodule.exports = class CoursesView extends RootView\r\n  id: 'courses-view'\r\n  template: template\r\n\r\n  events:\r\n    'click #log-in-btn': 'onClickLogInButton'\r\n    'click #start-new-game-btn': 'openSignUpModal'\r\n    'click .change-hero-btn': 'onClickChangeHeroButton'\r\n    'click #join-class-btn': 'onClickJoinClassButton'\r\n    'submit #join-class-form': 'onSubmitJoinClassForm'\r\n    'click .play-btn': 'onClickPlay'\r\n    'click .view-class-btn': 'onClickViewClass'\r\n    'click .view-levels-btn': 'onClickViewLevels'\r\n\r\n  getTitle: -> return $.i18n.t('courses.students')\r\n\r\n  initialize: ->\r\n    @classCodeQueryVar = utils.getQueryVariable('_cc', false)\r\n    @courseInstances = new CocoCollection([], { url: \"/db/user/#{me.id}/course_instances\", model: CourseInstance})\r\n    @courseInstances.comparator = (ci) -> return ci.get('classroomID') + ci.get('courseID')\r\n    @listenToOnce @courseInstances, 'sync', @onCourseInstancesLoaded\r\n    @supermodel.loadCollection(@courseInstances, { cache: false })\r\n    @classrooms = new CocoCollection([], { url: \"/db/classroom\", model: Classroom})\r\n    @classrooms.comparator = (a, b) -> b.id.localeCompare(a.id)\r\n    @supermodel.loadCollection(@classrooms, { data: {memberID: me.id}, cache: false })\r\n    @ownedClassrooms = new Classrooms()\r\n    @ownedClassrooms.fetchMine({data: {project: '_id'}})\r\n    @supermodel.trackCollection(@ownedClassrooms)\r\n    @courses = new CocoCollection([], { url: \"/db/course\", model: Course})\r\n    @supermodel.loadCollection(@courses)\r\n    @originalLevelMap = {}\r\n    @urls = require('core/urls')\r\n\r\n    # TODO: Trim this section for only what's necessary\r\n    @hero = new ThangType\r\n    defaultHeroOriginal = ThangType.heroes.captain\r\n    heroOriginal = me.get('heroConfig')?.thangType or defaultHeroOriginal\r\n    @hero.url = \"/db/thang.type/#{heroOriginal}/version\"\r\n    # @hero.setProjection ['name','slug','soundTriggers','featureImages','gems','heroClass','description','components','extendedName','unlockLevelName','i18n']\r\n    @supermodel.loadModel(@hero, 'hero')\r\n    @listenTo @hero, 'all', ->\r\n      @render()\r\n\r\n  afterInsert: ->\r\n    super()\r\n    unless me.isStudent() or (@classCodeQueryVar and not me.isTeacher())\r\n      @onClassLoadError()\r\n\r\n  onCourseInstancesLoaded: ->\r\n    # HoC 2015 used special single player course instances\r\n    @courseInstances.remove(@courseInstances.where({hourOfCode: true}))\r\n\r\n    for courseInstance in @courseInstances.models\r\n      continue if not courseInstance.get('classroomID')\r\n      courseID = courseInstance.get('courseID')\r\n      courseInstance.sessions = new CocoCollection([], {\r\n        url: courseInstance.url() + '/my-course-level-sessions',\r\n        model: LevelSession\r\n      })\r\n      courseInstance.sessions.comparator = 'changed'\r\n      @supermodel.loadCollection(courseInstance.sessions, { data: { project: 'state.complete,level.original,playtime,changed' }})\r\n\r\n  onLoaded: ->\r\n    super()\r\n    if @classCodeQueryVar and not me.isAnonymous()\r\n      window.tracker?.trackEvent 'Students Join Class Link', category: 'Students', classCode: @classCodeQueryVar, ['Mixpanel']\r\n      @joinClass()\r\n    else if @classCodeQueryVar and me.isAnonymous()\r\n      @openModalView(new CreateAccountModal())\r\n    ownerIDs = _.map(@classrooms.models, (c) -> c.get('ownerID')) ? []\r\n    Promise.resolve($.ajax(NameLoader.loadNames(ownerIDs)))\r\n    .then(=>\r\n      @ownerNameMap = {}\r\n      @ownerNameMap[ownerID] = NameLoader.getName(ownerID) for ownerID in ownerIDs\r\n      @render?()\r\n    )\r\n    _.forEach _.unique(_.pluck(@classrooms.models, 'id')), (classroomID) =>\r\n      levels = new Levels()\r\n      @listenTo levels, 'sync', =>\r\n        return if @destroyed\r\n        @originalLevelMap[level.get('original')] = level for level in levels.models\r\n        @render()\r\n      @supermodel.trackRequest(levels.fetchForClassroom(classroomID, { data: { project: 'original,primerLanguage,slug' }}))\r\n\r\n  onClickLogInButton: ->\r\n    modal = new AuthModal()\r\n    @openModalView(modal)\r\n    window.tracker?.trackEvent 'Students Login Started', category: 'Students', ['Mixpanel']\r\n\r\n  openSignUpModal: ->\r\n    window.tracker?.trackEvent 'Students Signup Started', category: 'Students', ['Mixpanel']\r\n    modal = new CreateAccountModal({ initialValues: { classCode: utils.getQueryVariable('_cc', \"\") } })\r\n    @openModalView(modal)\r\n\r\n  onClickChangeHeroButton: ->\r\n    window.tracker?.trackEvent 'Students Change Hero Started', category: 'Students', ['Mixpanel']\r\n    modal = new HeroSelectModal({ currentHeroID: @hero.id })\r\n    @openModalView(modal)\r\n    @listenTo modal, 'hero-select:success', (newHero) =>\r\n      # @hero.url = \"/db/thang.type/#{me.get('heroConfig').thangType}/version\"\r\n      # @hero.fetch()\r\n      @hero.set(newHero.attributes)\r\n    @listenTo modal, 'hide', ->\r\n      @stopListening modal\r\n\r\n  onSubmitJoinClassForm: (e) ->\r\n    e.preventDefault()\r\n    classCode = @$('#class-code-input').val() or @classCodeQueryVar\r\n    window.tracker?.trackEvent 'Students Join Class With Code', category: 'Students', classCode: classCode, ['Mixpanel']\r\n    @joinClass()\r\n\r\n  onClickJoinClassButton: (e) ->\r\n    classCode = @$('#class-code-input').val() or @classCodeQueryVar\r\n    window.tracker?.trackEvent 'Students Join Class With Code', category: 'Students', classCode: classCode, ['Mixpanel']\r\n    @joinClass()\r\n\r\n  joinClass: ->\r\n    return if @state\r\n    @state = 'enrolling'\r\n    @errorMessage = null\r\n    @classCode = @$('#class-code-input').val() or @classCodeQueryVar\r\n    if not @classCode\r\n      @state = null\r\n      @errorMessage = 'Please enter a code.'\r\n      @renderSelectors '#join-class-form'\r\n      return\r\n    @renderSelectors '#join-class-form'\r\n    if me.get('emailVerified') or me.isStudent()\r\n      newClassroom = new Classroom()\r\n      jqxhr = newClassroom.joinWithCode(@classCode)\r\n      @listenTo newClassroom, 'join:success', -> @onJoinClassroomSuccess(newClassroom)\r\n      @listenTo newClassroom, 'join:error', -> @onJoinClassroomError(newClassroom, jqxhr)\r\n    else\r\n      modal = new JoinClassModal({ @classCode })\r\n      @openModalView modal\r\n      @listenTo modal, 'error', @onClassLoadError\r\n      @listenTo modal, 'join:success', @onJoinClassroomSuccess\r\n      @listenTo modal, 'join:error', @onJoinClassroomError\r\n      @listenToOnce modal, 'hidden', ->\r\n        unless me.isStudent()\r\n          @onClassLoadError()\r\n      @listenTo modal, 'hidden', ->\r\n        @state = null\r\n        @renderSelectors '#join-class-form'\r\n\r\n  # Super hacky way to patch users being able to join class while hiding /students from others\r\n  onClassLoadError: ->\r\n    _.defer ->\r\n      application.router.routeDirectly('courses/RestrictedToStudentsView')\r\n\r\n  onJoinClassroomError: (classroom, jqxhr, options) ->\r\n    @state = null\r\n    if jqxhr.status is 422\r\n      @errorMessage = 'Please enter a code.'\r\n    else if jqxhr.status is 404\r\n      @errorMessage = $.t('signup.classroom_not_found')\r\n    else\r\n      @errorMessage = \"#{jqxhr.responseText}\"\r\n    @renderSelectors '#join-class-form'\r\n\r\n  onJoinClassroomSuccess: (newClassroom, data, options) ->\r\n    @state = null\r\n    application.tracker?.trackEvent 'Joined classroom', {\r\n      category: 'Courses'\r\n      classCode: @classCode\r\n      classroomID: newClassroom.id\r\n      classroomName: newClassroom.get('name')\r\n      ownerID: newClassroom.get('ownerID')\r\n    }\r\n    @classrooms.add(newClassroom)\r\n    @render()\r\n    @classroomJustAdded = newClassroom.id\r\n\r\n    classroomCourseInstances = new CocoCollection([], { url: \"/db/course_instance\", model: CourseInstance })\r\n    classroomCourseInstances.fetch({ data: {classroomID: newClassroom.id} })\r\n    @listenToOnce classroomCourseInstances, 'sync', ->\r\n      # TODO: Smoother system for joining a classroom and course instances, without requiring page reload,\r\n      # and showing which class was just joined.\r\n      document.location.search = '' # Using document.location.reload() causes an infinite loop of reloading\r\n\r\n  onClickPlay: (e) ->\r\n    levelSlug = $(e.currentTarget).data('level-slug')\r\n    window.tracker?.trackEvent $(e.currentTarget).data('event-action'), category: 'Students', levelSlug: levelSlug, ['Mixpanel']\r\n    application.router.navigate($(e.currentTarget).data('href'), { trigger: true })\r\n\r\n  onClickViewClass: (e) ->\r\n    classroomID = $(e.target).data('classroom-id')\r\n    window.tracker?.trackEvent 'Students View Class', category: 'Students', classroomID: classroomID, ['Mixpanel']\r\n    application.router.navigate(\"/students/#{classroomID}\", { trigger: true })\r\n\r\n  onClickViewLevels: (e) ->\r\n    courseID = $(e.target).data('course-id')\r\n    courseInstanceID = $(e.target).data('courseinstance-id')\r\n    window.tracker?.trackEvent 'Students View Levels', category: 'Students', courseID: courseID, courseInstanceID: courseInstanceID, ['Mixpanel']\r\n    application.router.navigate(\"/students/#{courseID}/#{courseInstanceID}\", { trigger: true })\r\n"]}