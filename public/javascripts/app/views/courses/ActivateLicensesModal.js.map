{"version":3,"sources":["app/templates/courses/activate-licenses-modal.jade","app/views/courses/ActivateLicensesModal.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9GA;AAAA;;ACAA;EAAA;;;AAAA,YAAY,QAAQ,sBAAR;;AACZ,QAAQ,QAAQ,cAAR;;AACR,WAAW,QAAQ,2CAAR;;AACX,iBAAiB,QAAQ,4BAAR;;AACjB,WAAW,QAAQ,sBAAR;;AACX,YAAY,QAAQ,kBAAR;;AACZ,aAAa,QAAQ,wBAAR;;AACb,OAAO,QAAQ,aAAR;;AACP,QAAQ,QAAQ,mBAAR;;AAER,MAAM,CAAC,OAAP,GAAuB;;;;;;;kCACrB,KAAI;;kCACJ,WAAU;;kCAEV,SACE;IAAA,8CAA8C,wBAA9C;IACA,kCAAkC,oBADlC;IAEA,eAAe,cAFf;IAGA,gCAAgC,8BAHhC;;;kCAKF,kBAAiB,SAAC,OAAD;AACf;IAAA,gBAAgB,OAAO,CAAC,aAAR,IAAyB,OAAO,CAAC;IACjD,qBAAqB,CAAC,CAAC,MAAF,CAAS,aAAa,CAAC,MAAvB,EAA+B,SAAC,IAAD;aAAU,CAAI,IAAI,CAAC,UAAL;IAAd,CAA/B;WACrB;MACE,eAAmB,UAAM,kBAAN,CADrB;MAEE,sBAA0B,UAAM,kBAAN,CAF5B;MAGE,OAAO,IAHT;;EAHe;;kCASjB,aAAY,SAAC,O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","file":"public/javascripts/app/views/courses/ActivateLicensesModal.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),view = locals_.view,state = locals_.state,paid = locals_.paid;buf.push(\"<div class=\\\"modal-dialog\\\"><div class=\\\"modal-content style-flat\\\"><div class=\\\"modal-header\\\">\");\nif ( view.closeButton)\n{\nbuf.push(\"<div type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-hidden=\\\"true\\\" class=\\\"button close\\\">&times;</div>\");\n}\nbuf.push(\"<div class=\\\"clearfix\\\"></div><div class=\\\"text-center\\\"><h1 data-i18n=\\\"teacher.apply_licenses\\\"></h1><h2 data-i18n=\\\"courses.grants_lifetime_access\\\"></h2></div></div><div class=\\\"modal-body\\\">\");\nvar numToEnroll = state.get('visibleSelectedUsers').length\nvar unusedEnrollments = view.prepaids.totalMaxRedeemers() - view.prepaids.totalRedeemers()\nvar tooManySelected = numToEnroll > unusedEnrollments\nvar noneSelected = numToEnroll == 0\nif ( view.classrooms.length > 1)\n{\nbuf.push(\"<div class=\\\"row\\\"><div class=\\\"col-sm-10 col-sm-offset-1\\\"><div class=\\\"text-center m-b-3\\\"><div class=\\\"small color-navy\\\"><span data-i18n=\\\"teacher.show_students_from\\\"></span><span class=\\\"spr\\\">:</span></div><select class=\\\"classroom-select\\\">\");\n// iterate view.classrooms.models\n;(function(){\n  var $$obj = view.classrooms.models;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var classroom = $$obj[$index];\n\nbuf.push(\"<option\" + (jade.attrs({ 'selected':((view.classroom ? classroom.id === view.classroom.id : false)), 'value':(classroom.id) }, {\"selected\":true,\"value\":true})) + \">\" + (jade.escape(null == (jade.interp = classroom.get('name')) ? \"\" : jade.interp)) + \"</option>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var classroom = $$obj[$index];\n\nbuf.push(\"<option\" + (jade.attrs({ 'selected':((view.classroom ? classroom.id === view.classroom.id : false)), 'value':(classroom.id) }, {\"selected\":true,\"value\":true})) + \">\" + (jade.escape(null == (jade.interp = classroom.get('name')) ? \"\" : jade.interp)) + \"</option>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"<option\" + (jade.attrs({ 'selected':((!view.classroom)), 'value':(''), 'data-i18n':('teacher.all_students') }, {\"selected\":true,\"value\":true,\"data-i18n\":true})) + \"></option></select></div></div></div>\");\n}\nbuf.push(\"<form class=\\\"form m-t-3\\\"><span data-i18n=\\\"teacher.apply_licenses_to_the_following_students\\\"></span><span>:</span><div class=\\\"well form-group\\\">\");\nvar enrolledUsers = view.users.filter(function(user){ return user.isEnrolled() })\nvar unenrolledUsers = view.users.filter(function(user){ return !user.isEnrolled() })\n// iterate unenrolledUsers\n;(function(){\n  var $$obj = unenrolledUsers;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var user = $$obj[$index];\n\nvar selected = Boolean(paid || state.get('selectedUsers').get(user.id))\nbuf.push(\"<div class=\\\"checkbox\\\"><label><input\" + (jade.attrs({ 'type':(\"checkbox\"), 'disabled':(false), 'checked':(selected), 'data-user-id':(user.id), 'name':('user'), \"class\": [('user-checkbox')] }, {\"type\":true,\"disabled\":true,\"checked\":true,\"data-user-id\":true,\"name\":true})) + \"/><span class=\\\"spr\\\">\" + (jade.escape(null == (jade.interp = user.broadName()) ? \"\" : jade.interp)) + \"</span></label></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var user = $$obj[$index];\n\nvar selected = Boolean(paid || state.get('selectedUsers').get(user.id))\nbuf.push(\"<div class=\\\"checkbox\\\"><label><input\" + (jade.attrs({ 'type':(\"checkbox\"), 'disabled':(false), 'checked':(selected), 'data-user-id':(user.id), 'name':('user'), \"class\": [('user-checkbox')] }, {\"type\":true,\"disabled\":true,\"checked\":true,\"data-user-id\":true,\"name\":true})) + \"/><span class=\\\"spr\\\">\" + (jade.escape(null == (jade.interp = user.broadName()) ? \"\" : jade.interp)) + \"</span></label></div>\");\n    }\n\n  }\n}).call(this);\n\nif ( enrolledUsers.length > 0)\n{\nbuf.push(\"<div class=\\\"small-details m-t-3\\\"><span data-i18n=\\\"teacher.students_have_licenses\\\"></span></div>\");\n}\n// iterate enrolledUsers\n;(function(){\n  var $$obj = enrolledUsers;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var user = $$obj[$index];\n\nvar selected = Boolean(paid || state.get('selectedUsers').get(user.id))\nbuf.push(\"<div class=\\\"checkbox\\\"><label><input\" + (jade.attrs({ 'type':(\"checkbox\"), 'disabled':(true), 'checked':(true), 'data-user-id':(user.id), 'name':('user'), \"class\": [('user-checkbox')] }, {\"type\":true,\"disabled\":true,\"checked\":true,\"data-user-id\":true,\"name\":true})) + \"/><span class=\\\"spr\\\">\" + (jade.escape(null == (jade.interp = user.broadName()) ? \"\" : jade.interp)) + \"</span></label></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var user = $$obj[$index];\n\nvar selected = Boolean(paid || state.get('selectedUsers').get(user.id))\nbuf.push(\"<div class=\\\"checkbox\\\"><label><input\" + (jade.attrs({ 'type':(\"checkbox\"), 'disabled':(true), 'checked':(true), 'data-user-id':(user.id), 'name':('user'), \"class\": [('user-checkbox')] }, {\"type\":true,\"disabled\":true,\"checked\":true,\"data-user-id\":true,\"name\":true})) + \"/><span class=\\\"spr\\\">\" + (jade.escape(null == (jade.interp = user.broadName()) ? \"\" : jade.interp)) + \"</span></label></div>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div>\");\nif ( state.get('error'))\n{\nbuf.push(\"<div class=\\\"alert alert-danger\\\">\" + (jade.escape(null == (jade.interp = state.get('error')) ? \"\" : jade.interp)) + \"</div>\");\n}\nbuf.push(\"<div id=\\\"submit-form-area\\\" class=\\\"text-center\\\"><p\" + (jade.attrs({ \"class\": [('small-details'),('not-enough-enrollments'),((tooManySelected ? 'visible' : ''))] }, {\"class\":true})) + \"><span data-i18n=\\\"teacher.not_enough_enrollments\\\"></span></p><p class=\\\"small-details\\\"><span data-i18n=\\\"courses.enrollment_credits_available\\\" class=\\\"spr\\\"></span><span id=\\\"total-available\\\">\" + (jade.escape(null == (jade.interp = view.prepaids.totalAvailable()) ? \"\" : jade.interp)) + \"</span></p><p><button\" + (jade.attrs({ 'id':('activate-licenses-btn'), 'type':(\"submit\"), \"class\": [('btn'),('btn-lg'),('btn-primary'),((tooManySelected || noneSelected ? 'disabled' : ''))] }, {\"class\":true,\"type\":true})) + \"><span data-i18n=\\\"teacher.apply_licenses\\\"></span> (<span id=\\\"total-selected-span\\\">\" + (jade.escape(null == (jade.interp = numToEnroll) ? \"\" : jade.interp)) + \"</span>)</button></p><p><a id=\\\"get-more-licenses-btn\\\" href=\\\"/teachers/licenses\\\" data-i18n=\\\"courses.get_enrollments\\\" class=\\\"btn btn-lg btn-primary-alt\\\"></a></p></div></form></div><div class=\\\"modal-body wait secret\\\"><h3>Reticulating Splines...</h3><div class=\\\"progress progress-striped active\\\"><div class=\\\"progress-bar\\\"></div></div></div><div class=\\\"modal-footer\\\"></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","ModalView = require 'views/core/ModalView'\r\nState = require 'models/State'\r\ntemplate = require 'templates/courses/activate-licenses-modal'\r\nCocoCollection = require 'collections/CocoCollection'\r\nPrepaids = require 'collections/Prepaids'\r\nClassroom = require 'models/Classroom'\r\nClassrooms = require 'collections/Classrooms'\r\nUser = require 'models/User'\r\nUsers = require 'collections/Users'\r\n\r\nmodule.exports = class ActivateLicensesModal extends ModalView\r\n  id: 'activate-licenses-modal'\r\n  template: template\r\n\r\n  events:\r\n    'change input[type=\"checkbox\"][name=\"user\"]': 'updateSelectedStudents'\r\n    'change select.classroom-select': 'replaceStudentList'\r\n    'submit form': 'onSubmitForm'\r\n    'click #get-more-licenses-btn': 'onClickGetMoreLicensesButton'\r\n\r\n  getInitialState: (options) ->\r\n    selectedUsers = options.selectedUsers or options.users\r\n    selectedUserModels = _.filter(selectedUsers.models, (user) -> not user.isEnrolled())\r\n    {\r\n      selectedUsers: new Users(selectedUserModels)\r\n      visibleSelectedUsers: new Users(selectedUserModels)\r\n      error: null\r\n    }\r\n  \r\n  initialize: (options) ->\r\n    @state = new State(@getInitialState(options))\r\n    @classroom = options.classroom\r\n    @users = options.users.clone()\r\n    @users.comparator = (user) -> user.broadName().toLowerCase()\r\n    @prepaids = new Prepaids()\r\n    @prepaids.comparator = 'endDate' # use prepaids in order of expiration\r\n    @supermodel.trackRequest @prepaids.fetchByCreator(me.id)\r\n    @classrooms = new Classrooms()\r\n    @supermodel.trackRequest @classrooms.fetchMine({\r\n      data: {archived: false}\r\n      success: =>\r\n        @classrooms.each (classroom) =>\r\n          classroom.users = new Users()\r\n          jqxhrs = classroom.users.fetchForClassroom(classroom, { removeDeleted: true })\r\n          @supermodel.trackRequests(jqxhrs)\r\n      })\r\n    \r\n    @listenTo @state, 'change', @render\r\n    @listenTo @state.get('selectedUsers'), 'change add remove reset', ->\r\n      @state.set { visibleSelectedUsers: new Users(@state.get('selectedUsers').filter (u) => @users.get(u)) }\r\n      @render()\r\n    @listenTo @users, 'change add remove reset', ->\r\n      @state.set { visibleSelectedUsers: new Users(@state.get('selectedUsers').filter (u) => @users.get(u)) }\r\n      @render()\r\n    @listenTo @prepaids, 'sync add remove', ->\r\n      @state.set {\r\n        unusedEnrollments: @prepaids.totalMaxRedeemers() - @prepaids.totalRedeemers()\r\n      }\r\n      \r\n  onLoaded: ->\r\n    @prepaids.reset(@prepaids.filter((prepaid) -> prepaid.status() is 'available'))\r\n    super()\r\n  \r\n  afterRender: ->\r\n    super()\r\n    # @updateSelectedStudents() # TODO: refactor to event/state style\r\n\r\n  updateSelectedStudents: (e) ->\r\n    userID = $(e.currentTarget).data('user-id')\r\n    user = @users.get(userID)\r\n    if @state.get('selectedUsers').contains(user)\r\n      @state.get('selectedUsers').remove(user)\r\n    else\r\n      @state.get('selectedUsers').add(user)\r\n    # @render() # TODO: Have @state automatically listen to children's change events?\r\n  \r\n  replaceStudentList: (e) ->\r\n    selectedClassroomID = $(e.currentTarget).val()\r\n    @classroom = @classrooms.get(selectedClassroomID)\r\n    if not @classroom\r\n      users = _.uniq _.flatten @classrooms.map (classroom) -> classroom.users.models\r\n      @users.reset(users)\r\n      @users.sort()\r\n    else\r\n      @users.reset(@classrooms.get(selectedClassroomID).users.models)\r\n    @render()\r\n    null\r\n\r\n  onSubmitForm: (e) ->\r\n    e.preventDefault()\r\n    @state.set error: null\r\n    usersToRedeem = @state.get('visibleSelectedUsers')\r\n    @redeemUsers(usersToRedeem)\r\n\r\n  redeemUsers: (usersToRedeem) ->\r\n    if not usersToRedeem.size()\r\n      @finishRedeemUsers()\r\n      @hide()\r\n      return\r\n\r\n    user = usersToRedeem.first()\r\n    prepaid = @prepaids.find((prepaid) -> prepaid.status() is 'available')\r\n    prepaid.redeem(user, {\r\n      success: (prepaid) =>\r\n        user.set('coursePrepaid', prepaid.pick('_id', 'startDate', 'endDate', 'type', 'includedCourseIDs'))\r\n        usersToRedeem.remove(user)\r\n        # pct = 100 * (usersToRedeem.originalSize - usersToRedeem.size() / usersToRedeem.originalSize)\r\n        # @$('#progress-area .progress-bar').css('width', \"#{pct.toFixed(1)}%\")\r\n        application.tracker?.trackEvent 'Enroll modal finished enroll student', category: 'Courses', userID: user.id\r\n        @redeemUsers(usersToRedeem)\r\n      error: (prepaid, jqxhr) =>\r\n        @state.set { error: jqxhr.responseJSON.message }\r\n    })\r\n\r\n  finishRedeemUsers: ->\r\n    @trigger 'redeem-users', @state.get('selectedUsers')\r\n\r\n  onClickGetMoreLicensesButton: ->\r\n    @hide?() # In case this is opened in /teachers/licenses itself, otherwise the button does nothing\r\n"]}