{"version":3,"sources":["app/templates/play/menu/game-menu-modal.jade","app/views/play/menu/GameMenuModal.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvEA;AAAA;;ACAA;EAAA;;;;AAAA,YAAY,QAAQ,sBAAR;;AACZ,qBAAqB,QAAQ,+BAAR;;AACrB,WAAW,QAAQ,qCAAR;;AACX,eAAe,CACb,QAAQ,8BAAR,CADa,EAEb,QAAQ,6BAAR,CAFa,EAGb,QAAQ,2BAAR,CAHa;;AAMf,MAAM,CAAC,OAAP,GAAuB;;;0BACrB,YAAW;;0BACX,WAAU;;0BACV,KAAI;;0BACJ,UAAS;;0BAET,SACE;IAAA,uBAAuB,oBAAvB;IACA,iCAAiC,YADjC;IAEA,0BAA0B;aAAG,IAAC,QAAD,CAAS,aAAT;IAAH,CAF1B;IAGA,sBAAsB,MAHtB;IAIA,mBAAmB,qBAJnB;;;EAMW,uBAAC,OAAD;AACX;IAAA,+CAAM,OAAN;IACA,IAAC,MAAD,GAAS,IAAC,QAAO,CAAC;IAClB,IAAC,QAAO,CAAC,OAAT,GAAmB,IAAC,QAAO,CAAC,KAAK,CAAC,GAAf,CAAmB,MAAnB;IACnB,IAAC,QAAO,CAAC,yBAAT,GAAqC,CAAC,CAAC,MAAF,CAAS,EAAT,EAAa,IAAb,iEAAyD,EAAzD;IACrC,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,yBAA1B,EAAqD;MAAA,2EAA+C,SAA/C;KAArD;EALW;;0BAOb,gBAAe,SAAC,OAAD;AACb;;MADc,UAAQ;;IACtB,UAAU,iDAAM,OAAN;IACV,uEAA6C;IAC7C,WAAW,CAAC,OAAD,EAAU,SAAV,EAAqB,WAArB;IACX,IAA4C,MAAM,CAAC,YAAY,CAAC,OAAhE;MAAA,WAAW,CAAC,CAAC,OAAF,CAAU,QAAV,EAAoB,SAApB,EAAX;;IACA,KAAO,MAAM,CAAC,YAAY,CAAC,OAA3B;MACE,IAAG,IAAC,MAAK,CAAC,MAAP,CAAc,QAAd,EAAwB,eAAxB,KAA4C,8DAAoC,CAAE,gBAAtC,GAA+C,CAA9F;QACE,WAAW,CAAC,CAAC,OAAF,CAAU,QAAV,EAAoB,OAApB,EADb;OADF;;IAGA,MAAkD,EAAE,CAAC,OAAH,MAAgB,sBAAsB,CAAC,IAAvB,CAA4B,MAAM,CAAC,QAAQ,CAAC,IAA5C,CAAlE;MAAA,WAAW,CAAC,CAAC,OAAF,CAAU,QAAV,EAAoB,WAApB,EAAX;;IACA,IAAC,iBAAD,GAAoB;IACpB,OAAO,CAAC,OAAR,kDAAqC,QAAS;IAC9C,OAAO,CAAC,QAAR,GAAmB;IACnB,OAAO,CAAC,OAAR,GACE;MAAA,WAAW,KAAX;MACA,SAAS,MADT;MAEA,aAAa,aAFb;;WAGF;EAhBa;;0BAkBf,kBAAiB;AACf;IAAA,oCAAsB,CAAE,MAAR,CAAe,QAAf,EAAyB,eAAzB,UAAhB;AAAA,aAAO,MAAP;;IACA,YAAgB,IAAC,QAAO,CAAC,QAAT,KAAqB,UAArB,aAAiC,eAAjC,aAAkD,gBAAlD,aAAoE,wBAApF;AAAA,aAAO,MAAP;;AACA,WAAO;EAHQ;;0BAKjB,cAAa;AACX;IAAA;AACA;;MAAA,IAAC,cAAD,CAAmB,gBAAY,IAAC,QAAb,CAAnB;AAAA;IACA;AAAY,cAAO,IAAC,QAAO,CAAC,OAAhB;AAAA,aACL,OADK;iBACQ,IAAC,SAAQ,CAAC;AADlB;UAGR,IAAG,aAAW,IAAC,iBAAZ,eAAH;mBAAqC,IAAC,SAAQ,CAAC,WAA/C;WAAA;mBAA+D,IAAC,SAAQ,CAAC,aAAzE;;AAHQ;;IAIZ,SAAS,CAAC,GAAG,CAAC,QAAd,CAAuB,QAAvB;;MACA,SAAS,CAAC;;IACV,IAAC,UAAD,CAAW,gBAAX;WACA,IAAC,IAAG,CAAC,IAAL,CAAU,eAAV,CAA0B,CAAC,YAA3B;EAVW;;0BAYb,aAAY,SAAC,CAAD;AACV;IAAA,IAAC,UAAD,CAAW,sBAAX;IACA,kBAAkB,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,SAAd,CAAwB,CAAxB,CAA0B,CAAC,OAA3B,CAAmC,IAAnC,EAAyC,GAAzC;;UACQ,CAAC;;AAC3B;AAAA;SAAA;;UAA8D,eAAgB;8DAA9E,OAAO,CAAC;;AAAR;;EAJU;;0BAMZ,WAAU;AACR;IAAA;AACA;AAAA;;;QAAA,OAAO,CAAC;;AAAR;IACA,IAAC,UAAD,CAAW,iBAAX;WACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,wBAA1B,EAAoD,EAApD;EAJQ;;0BAMV,sBAAqB,SAAC,CAAD;AACnB;;SAAc,CAAE,UAAhB,CAA2B,gBAA3B,EAA6C;QAAA,UAAU,YAAV;QAAwB,OAAO,WAA/B;QAA4C,OAAO,IAAC,QAAO,CAAC,OAA5D;OAA7C;;IAEA,CAAC,CAAC,cAAF;WACA,IAAC,cAAD,CAAmB,wBAAnB;EAJmB;;;;GAnEsB","file":"public/javascripts/app/views/play/menu/GameMenuModal.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),view = locals_.view,submenus = locals_.submenus,showTab = locals_.showTab,iconMap = locals_.iconMap,me = locals_.me;buf.push(\"<div class=\\\"modal-dialog\\\"><div class=\\\"modal-content\\\"><img src=\\\"/images/pages/play/modal/game-menu-background.png\\\" draggable=\\\"false\\\" id=\\\"game-menu-background\\\"/><div id=\\\"close-modal\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span></div><ul id=\\\"game-menu-nav\\\" class=\\\"nav nav-pills nav-stacked\\\">\");\nif ( view.showsChooseHero())\n{\nbuf.push(\"<li><a id=\\\"change-hero-tab\\\"><span class=\\\"glyphicon glyphicon-user\\\"></span><span data-i18n=\\\"[title]game_menu.choose_hero_caption;play.change_hero\\\"></span></a></li>\");\n}\n// iterate submenus\n;(function(){\n  var $$obj = submenus;\n  if ('number' == typeof $$obj.length) {\n\n    for (var index = 0, $$l = $$obj.length; index < $$l; index++) {\n      var submenu = $$obj[index];\n\nbuf.push(\"<li\" + (jade.attrs({ \"class\": [(submenu === showTab ? \"active\" : \"\")] }, {\"class\":true})) + \"><a\" + (jade.attrs({ 'href':('#' + submenu + '-view'), 'data-toggle':('tab') }, {\"href\":true,\"data-toggle\":true})) + \"><span\" + (jade.attrs({ \"class\": [('glyphicon'),(\"glyphicon-\"+iconMap[submenu])] }, {\"class\":true})) + \"></span>\");\nvar i18nKey = 'game_menu.' + submenu.replace('-', '_');\nbuf.push(\"<span\" + (jade.attrs({ 'data-i18n':('[title]' + i18nKey + '_caption;' + i18nKey + '_tab') }, {\"data-i18n\":true})) + \"></span></a></li>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var index in $$obj) {\n      $$l++;      var submenu = $$obj[index];\n\nbuf.push(\"<li\" + (jade.attrs({ \"class\": [(submenu === showTab ? \"active\" : \"\")] }, {\"class\":true})) + \"><a\" + (jade.attrs({ 'href':('#' + submenu + '-view'), 'data-toggle':('tab') }, {\"href\":true,\"data-toggle\":true})) + \"><span\" + (jade.attrs({ \"class\": [('glyphicon'),(\"glyphicon-\"+iconMap[submenu])] }, {\"class\":true})) + \"></span>\");\nvar i18nKey = 'game_menu.' + submenu.replace('-', '_');\nbuf.push(\"<span\" + (jade.attrs({ 'data-i18n':('[title]' + i18nKey + '_caption;' + i18nKey + '_tab') }, {\"data-i18n\":true})) + \"></span></a></li>\");\n    }\n\n  }\n}).call(this);\n\nif ( me.get('anonymous'))\n{\nbuf.push(\"<li data-toggle=\\\"coco-modal\\\" data-target=\\\"core/CreateAccountModal\\\" class=\\\"auth-tab\\\"><a data-toggle=\\\"coco-modal\\\" data-target=\\\"core/CreateAccountModal\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span><span data-i18n=\\\"[title]game_menu.auth_caption;game_menu.auth_tab\\\"></span></a></li>\");\n}\nbuf.push(\"</ul><div class=\\\"tab-content game-menu-tab-content\\\">\");\n// iterate submenus\n;(function(){\n  var $$obj = submenus;\n  if ('number' == typeof $$obj.length) {\n\n    for (var index = 0, $$l = $$obj.length; index < $$l; index++) {\n      var submenu = $$obj[index];\n\nbuf.push(\"<div\" + (jade.attrs({ 'id':(submenu + '-view'), \"class\": [('tab-pane')] }, {\"id\":true})) + \"></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var index in $$obj) {\n      $$l++;      var submenu = $$obj[index];\n\nbuf.push(\"<div\" + (jade.attrs({ 'id':(submenu + '-view'), \"class\": [('tab-pane')] }, {\"id\":true})) + \"></div>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","ModalView = require 'views/core/ModalView'\r\nCreateAccountModal = require 'views/core/CreateAccountModal'\r\ntemplate = require 'templates/play/menu/game-menu-modal'\r\nsubmenuViews = [\r\n  require 'views/play/menu/SaveLoadView'\r\n  require 'views/play/menu/OptionsView'\r\n  require 'views/play/menu/GuideView'\r\n]\r\n\r\nmodule.exports = class GameMenuModal extends ModalView\r\n  className: 'modal fade play-modal'\r\n  template: template\r\n  id: 'game-menu-modal'\r\n  instant: true\r\n\r\n  events:\r\n    'change input.select': 'onSelectionChanged'\r\n    'shown.bs.tab #game-menu-nav a': 'onTabShown'\r\n    'click #change-hero-tab': -> @trigger 'change-hero'\r\n    'click #close-modal': 'hide'\r\n    'click .auth-tab': 'onClickSignupButton'\r\n\r\n  constructor: (options) ->\r\n    super options\r\n    @level = @options.level\r\n    @options.levelID = @options.level.get('slug')\r\n    @options.startingSessionHeroConfig = $.extend {}, true, (@options.session.get('heroConfig') ? {})\r\n    Backbone.Mediator.publish 'music-player:enter-menu', terrain: @options.level.get('terrain', true) ? 'Dungeon'\r\n\r\n  getRenderData: (context={}) ->\r\n    context = super(context)\r\n    docs = @options.level.get('documentation') ? {}\r\n    submenus = ['guide', 'options', 'save-load']\r\n    submenus = _.without submenus, 'options' if window.serverConfig.picoCTF\r\n    unless window.serverConfig.picoCTF\r\n      if @level.isType('course', 'course-ladder') or not @options.level.get('helpVideos')?.length > 0\r\n        submenus = _.without submenus, 'guide'\r\n    submenus = _.without submenus, 'save-load' unless me.isAdmin() or /https?:\\/\\/localhost/.test(window.location.href)\r\n    @includedSubmenus = submenus\r\n    context.showTab = @options.showTab ? submenus[0]\r\n    context.submenus = submenus\r\n    context.iconMap =\r\n      'options': 'cog'\r\n      'guide': 'list'\r\n      'save-load': 'floppy-disk'\r\n    context\r\n\r\n  showsChooseHero: ->\r\n    return false if @level?.isType('course', 'course-ladder')\r\n    return false if @options.levelID in ['zero-sum', 'ace-of-coders', 'elemental-wars', 'the-battle-of-sky-span']\r\n    return true\r\n\r\n  afterRender: ->\r\n    super()\r\n    @insertSubView new submenuView @options for submenuView in submenuViews\r\n    firstView = switch @options.showTab\r\n      when 'guide' then @subviews.guide_view\r\n      else\r\n        if 'guide' in @includedSubmenus then @subviews.guide_view else @subviews.options_view\r\n    firstView.$el.addClass 'active'\r\n    firstView.onShown?()\r\n    @playSound 'game-menu-open'\r\n    @$el.find('.nano:visible').nanoScroller()\r\n\r\n  onTabShown: (e) ->\r\n    @playSound 'game-menu-tab-switch'\r\n    shownSubviewKey = e.target.hash.substring(1).replace(/-/g, '_')\r\n    @subviews[shownSubviewKey].onShown?()\r\n    subview.onHidden?() for subviewKey, subview of @subviews when subviewKey isnt shownSubviewKey\r\n\r\n  onHidden: ->\r\n    super()\r\n    subview.onHidden?() for subviewKey, subview of @subviews\r\n    @playSound 'game-menu-close'\r\n    Backbone.Mediator.publish 'music-player:exit-menu', {}\r\n\r\n  onClickSignupButton: (e) ->\r\n    window.tracker?.trackEvent 'Started Signup', category: 'Play Level', label: 'Game Menu', level: @options.levelID\r\n    # TODO: Default already seems to be prevented.  Need to be explicit?\r\n    e.preventDefault()\r\n    @openModalView new CreateAccountModal()\r\n"]}