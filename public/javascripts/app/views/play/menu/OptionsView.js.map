{"version":3,"sources":["app/templates/play/menu/options-view.jade","app/views/play/menu/OptionsView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/menu/OptionsView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),me = locals_.me,music = locals_.music,aceConfig = locals_.aceConfig;buf.push(\"<div id=\\\"player-avatar-container\\\" title=\\\"Click to change your avatar\\\">\");\nif ( !me.get('photoURL'))\n{\nbuf.push(\"<div class=\\\"editable-icon glyphicon glyphicon-pencil\\\"></div>\");\n}\nbuf.push(\"<img\" + (jade.attrs({ 'src':(me.getPhotoURL(230)), 'draggable':(\"false\"), \"class\": [('profile-photo')] }, {\"src\":true,\"draggable\":true})) + \"/><div class=\\\"form-group\\\"><input\" + (jade.attrs({ 'id':('player-name'), 'name':(\"playerName\"), 'type':(\"text\"), 'value':(me.get('name', true)), \"class\": [('profile-caption')] }, {\"name\":true,\"type\":true,\"value\":true})) + \"/></div></div><div class=\\\"form\\\"><h3 data-i18n=\\\"options.general_options\\\">General Options</h3><div id=\\\"volume-group\\\" class=\\\"form-group slider-group\\\"><span class=\\\"glyphicon glyphicon-volume-down\\\"></span><div id=\\\"option-volume\\\" class=\\\"slider spr spl\\\"></div><span class=\\\"glyphicon glyphicon-volume-up\\\"></span></div><div class=\\\"form-group checkbox\\\"><label for=\\\"option-music\\\" class=\\\"control-label\\\"><input\" + (jade.attrs({ 'id':('option-music'), 'name':(\"option-music\"), 'type':(\"checkbox\"), 'checked':(music) }, {\"name\":true,\"type\":true,\"checked\":true})) + \"/><span class=\\\"custom-checkbox\\\"><div class=\\\"glyphicon glyphicon-ok\\\"></div></span><span data-i18n=\\\"options.music_label\\\">Music</span></label><span data-i18n=\\\"options.music_description\\\" class=\\\"help-block\\\">Turn background music on/off.</span></div><img src=\\\"/images/pages/play/modal/hr.png\\\" draggable=\\\"false\\\" class=\\\"hr\\\"/><h3 data-i18n=\\\"options.editor_config_title\\\">Editor Configuration</h3><div class=\\\"form-group checkbox\\\"><label for=\\\"option-live-completion\\\"><input\" + (jade.attrs({ 'id':('option-live-completion'), 'name':(\"liveCompletion\"), 'type':(\"checkbox\"), 'checked':(aceConfig.liveCompletion) }, {\"name\":true,\"type\":true,\"checked\":true})) + \"/><span class=\\\"custom-checkbox\\\"><div class=\\\"glyphicon glyphicon-ok\\\"></div></span><span data-i18n=\\\"options.editor_config_livecompletion_label\\\">Live Autocompletion</span></label><span data-i18n=\\\"options.editor_config_livecompletion_description\\\" class=\\\"help-block\\\">Displays autocomplete suggestions while typing.</span></div><div class=\\\"form-group checkbox\\\"><label for=\\\"option-invisibles\\\"><input\" + (jade.attrs({ 'id':('option-invisibles'), 'name':(\"invisibles\"), 'type':(\"checkbox\"), 'checked':(aceConfig.invisibles) }, {\"name\":true,\"type\":true,\"checked\":true})) + \"/><span class=\\\"custom-checkbox\\\"><div class=\\\"glyphicon glyphicon-ok\\\"></div></span><span data-i18n=\\\"options.editor_config_invisibles_label\\\">Show Invisibles</span></label><span data-i18n=\\\"options.editor_config_invisibles_description\\\" class=\\\"help-block\\\">Displays invisibles such as spaces or tabs.</span></div><div class=\\\"form-group checkbox\\\"><label for=\\\"option-indent-guides\\\"><input\" + (jade.attrs({ 'id':('option-indent-guides'), 'name':(\"indentGuides\"), 'type':(\"checkbox\"), 'checked':(aceConfig.indentGuides) }, {\"name\":true,\"type\":true,\"checked\":true})) + \"/><span class=\\\"custom-checkbox\\\"><div class=\\\"glyphicon glyphicon-ok\\\"></div></span><span data-i18n=\\\"options.editor_config_indentguides_label\\\">Show Indent Guides</span></label><span data-i18n=\\\"options.editor_config_indentguides_description\\\" class=\\\"help-block\\\">Displays vertical lines to see indentation better.</span></div><div class=\\\"form-group checkbox\\\"><label for=\\\"option-behaviors\\\"><input\" + (jade.attrs({ 'id':('option-behaviors'), 'name':(\"behaviors\"), 'type':(\"checkbox\"), 'checked':(aceConfig.behaviors) }, {\"name\":true,\"type\":true,\"checked\":true})) + \"/><span class=\\\"custom-checkbox\\\"><div class=\\\"glyphicon glyphicon-ok\\\"></div></span><span data-i18n=\\\"options.editor_config_behaviors_label\\\">Smart Behaviors</span></label><span data-i18n=\\\"options.editor_config_behaviors_description\\\" class=\\\"help-block\\\">Autocompletes brackets, braces, and quotes.</span></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","CocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/play/menu/options-view'\r\n{me} = require 'core/auth'\r\nThangType = require 'models/ThangType'\r\nUser = require 'models/User'\r\nforms = require 'core/forms'\r\n\r\nmodule.exports = class OptionsView extends CocoView\r\n  id: 'options-view'\r\n  className: 'tab-pane'\r\n  template: template\r\n  aceConfig: {}\r\n  defaultConfig:\r\n    language: 'python'\r\n    keyBindings: 'default'\r\n    invisibles: false\r\n    indentGuides: false\r\n    behaviors: false\r\n    liveCompletion: true\r\n\r\n  events:\r\n    'change #option-music': 'updateMusic'\r\n    'change #option-invisibles': 'updateInvisibles'\r\n    'change #option-indent-guides': 'updateIndentGuides'\r\n    'change #option-behaviors': 'updateBehaviors'\r\n    'change #option-live-completion': 'updateLiveCompletion'\r\n    'click .profile-photo': 'onEditProfilePhoto'\r\n    'click .editable-icon': 'onEditProfilePhoto'\r\n    'keyup #player-name': -> @trigger 'nameChanged'\r\n\r\n  constructor: (options) ->\r\n    @uploadFilePath = \"db/user/#{me.id}\"\r\n    @onNameChange = _.debounce(@checkNameExists, 500)\r\n    @on 'nameChanged', @onNameChange\r\n    @playerName = me.get 'name'\r\n    require('core/services/filepicker')() unless window.application.isIPadApp  # Initialize if needed\r\n    super options\r\n\r\n  getRenderData: (c={}) ->\r\n    c = super(c)\r\n    @aceConfig = _.cloneDeep me.get('aceConfig') ? {}\r\n    @aceConfig = _.defaults @aceConfig, @defaultConfig\r\n    c.aceConfig = @aceConfig\r\n    c.music = me.get('music', true)\r\n    c\r\n\r\n  afterRender: ->\r\n    super()\r\n    @volumeSlider = @$el.find('#option-volume').slider(animate: 'fast', min: 0, max: 1, step: 0.05)\r\n    @volumeSlider.slider('value', me.get('volume'))\r\n    @volumeSlider.on('slide', @onVolumeSliderChange)\r\n    @volumeSlider.on('slidechange', @onVolumeSliderChange)\r\n\r\n  destroy: ->\r\n    @volumeSlider?.slider?('destroy')\r\n    super()\r\n\r\n  onVolumeSliderChange: (e) =>\r\n    volume = @volumeSlider.slider('value')\r\n    me.set 'volume', volume\r\n    @$el.find('#option-volume-value').text (volume * 100).toFixed(0) + '%'\r\n    Backbone.Mediator.publish 'level:set-volume', volume: volume\r\n    @playSound 'menu-button-click'  # Could have another volume-indicating noise\r\n\r\n  onHidden: ->\r\n    if @playerName and @playerName isnt me.get('name')\r\n      me.set 'name', @playerName\r\n    @aceConfig.invisibles = @$el.find('#option-invisibles').prop('checked')\r\n    @aceConfig.keyBindings = 'default'  # We used to give them the option, but we took it away.\r\n    @aceConfig.indentGuides = @$el.find('#option-indent-guides').prop('checked')\r\n    @aceConfig.behaviors = @$el.find('#option-behaviors').prop('checked')\r\n    @aceConfig.liveCompletion = @$el.find('#option-live-completion').prop('checked')\r\n    me.set 'aceConfig', @aceConfig\r\n    me.patch()\r\n    Backbone.Mediator.publish 'tome:change-config', {}\r\n\r\n  updateMusic: ->\r\n    me.set 'music', @$el.find('#option-music').prop('checked')\r\n\r\n  updateInvisibles: ->\r\n    @aceConfig.invisibles = @$el.find('#option-invisibles').prop('checked')\r\n\r\n  updateKeyBindings: ->\r\n    @aceConfig.keyBindings = @$el.find('#option-key-bindings').val()\r\n\r\n  updateIndentGuides: ->\r\n    @aceConfig.indentGuides = @$el.find('#option-indent-guides').prop('checked')\r\n\r\n  updateBehaviors: ->\r\n    @aceConfig.behaviors = @$el.find('#option-behaviors').prop('checked')\r\n\r\n  updateLiveCompletion: ->\r\n    @aceConfig.liveCompletion = @$el.find('#option-live-completion').prop('checked')\r\n\r\n  checkNameExists: =>\r\n    forms.clearFormAlerts(@$el)\r\n    name = $('#player-name').val()\r\n    User.getUnconflictedName name, (newName) =>\r\n      forms.clearFormAlerts(@$el)\r\n      if name isnt newName\r\n        forms.setErrorToProperty @$el, 'playerName', 'This name is already taken so you won\\'t be able to keep it.', true\r\n      else\r\n        @playerName = newName\r\n\r\n  onEditProfilePhoto: (e) ->\r\n    return if window.application.isIPadApp  # TODO: have an iPad-native way of uploading a photo, since we don't want to load FilePicker on iPad (memory)\r\n    @playSound 'menu-button-click'\r\n    photoContainer = @$el.find('.profile-photo')\r\n    onSaving = =>\r\n      photoContainer.addClass('saving')\r\n    onSaved = (uploadingPath) =>\r\n      me.set('photoURL', uploadingPath)\r\n      photoContainer.removeClass('saving').attr('src', me.getPhotoURL(photoContainer.width()))\r\n    filepicker.pick {mimetypes: 'image/*'}, @onImageChosen(onSaving, onSaved)\r\n\r\n  formatImagePostData: (inkBlob) ->\r\n    url: inkBlob.url, filename: inkBlob.filename, mimetype: inkBlob.mimetype, path: @uploadFilePath, force: true\r\n\r\n  onImageChosen: (onSaving, onSaved) ->\r\n    (inkBlob) =>\r\n      onSaving()\r\n      uploadingPath = [@uploadFilePath, inkBlob.filename].join('/')\r\n      $.ajax '/file', type: 'POST', data: @formatImagePostData(inkBlob), success: @onImageUploaded(onSaved, uploadingPath)\r\n\r\n  onImageUploaded: (onSaved, uploadingPath) ->\r\n    (e) =>\r\n      onSaved uploadingPath\r\n"]}