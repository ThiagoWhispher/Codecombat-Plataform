{"version":3,"sources":["app/templates/play/menu/inventory-modal.jade","app/views/play/menu/InventoryModal.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5LA;AAAA;;ACAA;EAAA;;;;;AAAA,YAAY,QAAQ,sBAAR;;AACZ,WAAW,QAAQ,qCAAR;;AACX,wBAAwB,QAAQ,sCAAR;;AACvB,KAAM,QAAQ,WAAR,EAAN;;AACD,YAAY,QAAQ,kBAAR;;AACZ,iBAAiB,QAAQ,4BAAR;;AACjB,WAAW,QAAQ,YAAR;;AACX,gBAAgB,QAAQ,2BAAR;;AAChB,kBAAkB,QAAQ,kCAAR;;AAClB,WAAW,Q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","file":"public/javascripts/app/views/play/menu/InventoryModal.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),gems = locals_.gems,selectedHero = locals_.selectedHero,equipment = locals_.equipment,itemGroups = locals_.itemGroups,selectedHeroClass = locals_.selectedHeroClass;buf.push(\"<div class=\\\"modal-dialog\\\"><div class=\\\"modal-content\\\"><img src=\\\"/images/pages/play/modal/inventory-background.png\\\" draggable=\\\"false\\\" id=\\\"play-items-modal-narrow-bg\\\"/><h1 data-i18n=\\\"game_menu.inventory_tab\\\"></h1><div id=\\\"gems-count-container\\\"><span id=\\\"gems-count\\\" class=\\\"big-font\\\">\" + (jade.escape(null == (jade.interp = gems) ? \"\" : jade.interp)) + \"</span></div><div id=\\\"close-modal\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span></div><div id=\\\"equipped\\\">\");\nif ( selectedHero && selectedHero.get('featureImages'))\n{\nvar featureImages = selectedHero.get('featureImages');\nbuf.push(\"<img\" + (jade.attrs({ 'src':(\"/file/\"+featureImages.body), 'draggable':(\"false\"), 'id':('hero-image') }, {\"src\":true,\"draggable\":true})) + \"/><img\" + (jade.attrs({ 'src':(\"/file/\"+featureImages.head), 'draggable':(\"false\"), 'id':('hero-image-head') }, {\"src\":true,\"draggable\":true})) + \"/><img\" + (jade.attrs({ 'src':(\"/file/\"+featureImages.hair), 'draggable':(\"false\"), 'id':('hero-image-hair') }, {\"src\":true,\"draggable\":true})) + \"/><img\" + (jade.attrs({ 'src':(\"/file/\"+featureImages.thumb), 'draggable':(\"false\"), 'id':('hero-image-thumb') }, {\"src\":true,\"draggable\":true})) + \"/>\");\n}\n// iterate ['head', 'eyes', 'neck', 'torso', 'gloves', 'wrists', 'left-hand', 'right-hand', 'waist', 'feet', 'left-ring', 'right-ring', 'minion', 'flag', 'pet', 'programming-book', 'misc-0', 'misc-1']\n;(function(){\n  var $$obj = ['head', 'eyes', 'neck', 'torso', 'gloves', 'wrists', 'left-hand', 'right-hand', 'waist', 'feet', 'left-ring', 'right-ring', 'minion', 'flag', 'pet', 'programming-book', 'misc-0', 'misc-1'];\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var slot = $$obj[$index];\n\nbuf.push(\"<div\" + (jade.attrs({ 'data-slot':(slot), \"class\": [('item-slot')] }, {\"data-slot\":true})) + \"><div class=\\\"placeholder\\\"></div>\");\nif ( equipment[slot])\n{\nbuf.push(\"<img\" + (jade.attrs({ 'src':(equipment[slot].getPortraitURL()), 'data-item-id':(equipment[slot].id), \"class\": [('item')] }, {\"src\":true,\"data-item-id\":true})) + \"/>\");\n}\nbuf.push(\"</div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var slot = $$obj[$index];\n\nbuf.push(\"<div\" + (jade.attrs({ 'data-slot':(slot), \"class\": [('item-slot')] }, {\"data-slot\":true})) + \"><div class=\\\"placeholder\\\"></div>\");\nif ( equipment[slot])\n{\nbuf.push(\"<img\" + (jade.attrs({ 'src':(equipment[slot].getPortraitURL()), 'data-item-id':(equipment[slot].id), \"class\": [('item')] }, {\"src\":true,\"data-item-id\":true})) + \"/>\");\n}\nbuf.push(\"</div>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div><div id=\\\"unequipped\\\"><div class=\\\"nano\\\"><div class=\\\"nano-content\\\">\");\nif ( itemGroups)\n{\nif ( itemGroups.requiredPurchaseItems.models.length)\n{\nbuf.push(\"<h4 id=\\\"required-purchase-description\\\" data-i18n=\\\"inventory.required_purchase_title\\\"></h4>\");\n// iterate itemGroups.requiredPurchaseItems.models\n;(function(){\n  var $$obj = itemGroups.requiredPurchaseItems.models;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var item = $$obj[$index];\n\nif ( selectedHeroClass && item.classes.indexOf(selectedHeroClass) > -1)\n{\nbuf.push(\"<div\" + (jade.attrs({ 'data-item-id':(item.id), \"class\": [('item'),(item.classes)] }, {\"class\":true,\"data-item-id\":true})) + \"><img draggable=\\\"false\\\"/></div>\");\n}\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var item = $$obj[$index];\n\nif ( selectedHeroClass && item.classes.indexOf(selectedHeroClass) > -1)\n{\nbuf.push(\"<div\" + (jade.attrs({ 'data-item-id':(item.id), \"class\": [('item'),(item.classes)] }, {\"class\":true,\"data-item-id\":true})) + \"><img draggable=\\\"false\\\"/></div>\");\n}\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"<div class=\\\"clearfix\\\"></div>\");\n}\nif ( itemGroups.availableItems.models.length)\n{\nbuf.push(\"<h4 id=\\\"available-description\\\" data-i18n=\\\"inventory.available_item\\\"></h4>\");\n// iterate itemGroups.availableItems.models\n;(function(){\n  var $$obj = itemGroups.availableItems.models;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var item = $$obj[$index];\n\nif ( selectedHeroClass && item.classes.indexOf(selectedHeroClass) > -1)\n{\nbuf.push(\"<div\" + (jade.attrs({ 'data-item-id':(item.id), \"class\": [('item'),('available'),(item.classes)] }, {\"class\":true,\"data-item-id\":true})) + \"><img/><button data-i18n=\\\"inventory.equip\\\" class=\\\"btn equip-item\\\"></button></div>\");\n}\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var item = $$obj[$index];\n\nif ( selectedHeroClass && item.classes.indexOf(selectedHeroClass) > -1)\n{\nbuf.push(\"<div\" + (jade.attrs({ 'data-item-id':(item.id), \"class\": [('item'),('available'),(item.classes)] }, {\"class\":true,\"data-item-id\":true})) + \"><img/><button data-i18n=\\\"inventory.equip\\\" class=\\\"btn equip-item\\\"></button></div>\");\n}\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"<div class=\\\"clearfix\\\"></div>\");\n}\nbuf.push(\"<div id=\\\"double-click-hint\\\" class=\\\"alert alert-info\\\"><span class=\\\"glyphicon glyphicon-info-sign spr\\\"></span><span data-i18n=\\\"inventory.should_equip\\\"></span></div>\");\nif ( itemGroups.restrictedItems.models.length)\n{\nbuf.push(\"<h4 id=\\\"restricted-description\\\" data-i18n=\\\"inventory.restricted_title\\\"></h4>\");\n// iterate itemGroups.restrictedItems.models\n;(function(){\n  var $$obj = itemGroups.restrictedItems.models;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var item = $$obj[$index];\n\nif ( selectedHeroClass && item.classes.indexOf(selectedHeroClass) > -1)\n{\nbuf.push(\"<div\" + (jade.attrs({ 'data-item-id':(item.id), \"class\": [('item'),(item.classes)] }, {\"class\":true,\"data-item-id\":true})) + \"><img draggable=\\\"false\\\"/></div>\");\n}\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var item = $$obj[$index];\n\nif ( selectedHeroClass && item.classes.indexOf(selectedHeroClass) > -1)\n{\nbuf.push(\"<div\" + (jade.attrs({ 'data-item-id':(item.id), \"class\": [('item'),(item.classes)] }, {\"class\":true,\"data-item-id\":true})) + \"><img draggable=\\\"false\\\"/></div>\");\n}\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"<div class=\\\"clearfix\\\"></div>\");\n}\nif ( itemGroups.lockedItems.models.length)\n{\nbuf.push(\"<h4 id=\\\"locked-description\\\" data-i18n=\\\"play.locked\\\"></h4>\");\n// iterate itemGroups.lockedItems.models\n;(function(){\n  var $$obj = itemGroups.lockedItems.models;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var item = $$obj[$index];\n\nif ( selectedHeroClass && item.classes.indexOf(selectedHeroClass) > -1)\n{\nbuf.push(\"<div\" + (jade.attrs({ 'data-item-id':(item.id), \"class\": [('item'),(item.classes)] }, {\"class\":true,\"data-item-id\":true})) + \"><img draggable=\\\"false\\\"/></div>\");\n}\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var item = $$obj[$index];\n\nif ( selectedHeroClass && item.classes.indexOf(selectedHeroClass) > -1)\n{\nbuf.push(\"<div\" + (jade.attrs({ 'data-item-id':(item.id), \"class\": [('item'),(item.classes)] }, {\"class\":true,\"data-item-id\":true})) + \"><img draggable=\\\"false\\\"/></div>\");\n}\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"<div class=\\\"clearfix\\\"></div>\");\n}\n}\nbuf.push(\"</div></div></div><div id=\\\"item-details-view\\\"></div><div id=\\\"item-details-extra\\\"><button id=\\\"equip-item-viewed\\\" data-i18n=\\\"inventory.equip\\\" class=\\\"btn secret\\\"></button><button id=\\\"unequip-item-viewed\\\" data-i18n=\\\"inventory.unequip\\\" class=\\\"btn secret\\\"></button><div id=\\\"restricted-item-viewed\\\" data-i18n=\\\"inventory.restricted\\\" class=\\\"alert alert-danger secret\\\"></div></div><button id=\\\"choose-hero-button\\\" data-i18n=\\\"play.change_hero\\\" class=\\\"btn btn-lg btn-primary choose-inventory-active\\\">Change Hero</button><button id=\\\"play-level-button\\\" data-i18n=\\\"common.play\\\" class=\\\"btn btn-lg btn-success choose-inventory-active\\\">Play</button></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","ModalView = require 'views/core/ModalView'\r\ntemplate = require 'templates/play/menu/inventory-modal'\r\nbuyGemsPromptTemplate = require 'templates/play/modal/buy-gems-prompt'\r\n{me} = require 'core/auth'\r\nThangType = require 'models/ThangType'\r\nCocoCollection = require 'collections/CocoCollection'\r\nItemView = require './ItemView'\r\nSpriteBuilder = require 'lib/sprites/SpriteBuilder'\r\nItemDetailsView = require 'views/play/modal/ItemDetailsView'\r\nPurchase = require 'models/Purchase'\r\nBuyGemsModal = require 'views/play/modal/BuyGemsModal'\r\nCreateAccountModal = require 'views/core/CreateAccountModal'\r\n\r\nhasGoneFullScreenOnce = false\r\n\r\nmodule.exports = class InventoryModal extends ModalView\r\n  id: 'inventory-modal'\r\n  className: 'modal fade play-modal'\r\n  template: template\r\n  slots: ['head', 'eyes', 'neck', 'torso', 'wrists', 'gloves', 'left-ring', 'right-ring', 'right-hand', 'left-hand', 'waist', 'feet', 'programming-book', 'pet', 'minion', 'flag']  #, 'misc-0', 'misc-1']  # TODO: bring in misc slot(s) again when we have space\r\n  ringSlots: ['left-ring', 'right-ring']\r\n  closesOnClickOutside: false # because draggable somehow triggers hide when you don't drag onto a draggable\r\n\r\n  events:\r\n    'click .item-slot': 'onItemSlotClick'\r\n    'click #unequipped .item': 'onUnequippedItemClick'\r\n    'doubletap #unequipped .item': 'onUnequippedItemDoubleClick'\r\n    'doubletap .item-slot .item': 'onEquippedItemDoubleClick'\r\n    'click button.equip-item': 'onClickEquipItemButton'\r\n    'shown.bs.modal': 'onShown'\r\n    'click #choose-hero-button': 'onClickChooseHero'\r\n    'click #play-level-button': 'onClickPlayLevel'\r\n    'click .unlock-button': 'onUnlockButtonClicked'\r\n    'click #equip-item-viewed': 'onClickEquipItemViewed'\r\n    'click #unequip-item-viewed': 'onClickUnequipItemViewed'\r\n    'click #close-modal': 'hide'\r\n    'click .buy-gems-prompt-button': 'onBuyGemsPromptButtonClicked'\r\n    'click': 'onClickedSomewhere'\r\n    'update #unequipped .nano': 'onScrollUnequipped'\r\n\r\n  shortcuts:\r\n    'esc': 'clearSelection'\r\n    'enter': 'onClickPlayLevel'\r\n\r\n\r\n  #- Setup\r\n\r\n  initialize: (options) ->\r\n    @onScrollUnequipped = _.throttle(_.bind(@onScrollUnequipped, @), 200)\r\n    super(arguments...)\r\n    @items = new CocoCollection([], {model: ThangType})\r\n    # TODO: switch to item store loading system?\r\n    @items.url = '/db/thang.type?view=items'\r\n    @items.setProjection [\r\n      'name'\r\n      'slug'\r\n      'components'\r\n      'original'\r\n      'rasterIcon'\r\n      'dollImages'\r\n      'gems'\r\n      'tier'\r\n      'description'\r\n      'heroClass'\r\n      'i18n'\r\n    ]\r\n    @supermodel.loadCollection(@items, 'items')\r\n    @equipment = {}  # Assign for real when we have loaded the session and items.\r\n\r\n  onItemsLoaded: ->\r\n    for item in @items.models\r\n      item.notInLevel = true\r\n      programmableConfig = _.find(item.get('components'), (c) -> c.config?.programmableProperties)?.config\r\n      item.programmableProperties = (programmableConfig?.programmableProperties or []).concat programmableConfig?.moreProgrammableProperties or []\r\n    @itemsProgrammablePropertiesConfigured = true\r\n    @equipment = @options.equipment or @options.session?.get('heroConfig')?.inventory or me.get('heroConfig')?.inventory or {}\r\n    @equipment = $.extend true, {}, @equipment\r\n    @requireLevelEquipment()\r\n    @itemGroups = {}\r\n    @itemGroups.requiredPurchaseItems = new Backbone.Collection()\r\n    @itemGroups.availableItems = new Backbone.Collection()\r\n    @itemGroups.restrictedItems = new Backbone.Collection()\r\n    @itemGroups.lockedItems = new Backbone.Collection()\r\n    itemGroup.comparator = ((m) -> m.get('tier') ? m.get('gems')) for itemGroup in _.values @itemGroups\r\n\r\n    equipped = _.values(@equipment)\r\n    @sortItem(item, equipped) for item in @items.models\r\n\r\n  sortItem: (item, equipped) ->\r\n    equipped ?= _.values(@equipment)\r\n\r\n    # general starting classes\r\n    item.classes = _.clone(item.getAllowedSlots())\r\n    for heroClass in item.getAllowedHeroClasses()\r\n      item.classes.push heroClass\r\n    item.classes.push 'equipped' if item.get('original') in equipped\r\n\r\n    # sort into one of the four groups\r\n    locked = not me.ownsItem item.get('original')\r\n\r\n    restrictedGear = @calculateRestrictedGearPerSlot()\r\n    allRestrictedGear = _.flatten(_.values(restrictedGear))\r\n    restricted = item.get('original') in allRestrictedGear\r\n\r\n    # TODO: make this re-use result of computation of updateLevelRequiredItems, which we can only do after heroClass is ready...\r\n    requiredToPurchase = false\r\n    inCampaignView = $('#campaign-view').length\r\n    unless gearSlugs[item.get('original')] is 'tarnished-bronze-breastplate' and inCampaignView and @options.level.get('slug') is 'the-raised-sword'\r\n      requiredGear = @calculateRequiredGearPerSlot()\r\n      for slot in item.getAllowedSlots()\r\n        continue unless requiredItems = requiredGear[slot]\r\n        continue if @equipment[slot] and @equipment[slot] not in allRestrictedGear and slot not in @ringSlots\r\n        # Point out that they must buy it if they haven't bought any of the required items for that slot, and it's the first one.\r\n        if item.get('original') is requiredItems[0] and not _.find(requiredItems, (requiredItem) -> me.ownsItem requiredItem)\r\n          requiredToPurchase = true\r\n          break\r\n\r\n    if requiredToPurchase and locked and not item.get('gems')\r\n      # Either one of two things has happened:\r\n      # 1. There's a bug and the player doesn't have a required item they should have.\r\n      # 2. The player is trying to play a level they haven't unlocked.\r\n      # We'll just pretend they own it so that they don't get stuck.\r\n      application.tracker?.trackEvent 'Required Item Locked', level: @options.level.get('slug'), label: @options.level.get('slug'), item: item.get('name'), playerLevel: me.level(), levelUnlocked: me.ownsLevel @options.level.get('original')\r\n      locked = false\r\n\r\n    placeholder = not item.getFrontFacingStats().props.length and not _.size(item.getFrontFacingStats().stats)\r\n\r\n    if placeholder and locked  # The item is not complete, so don't put it into a collection.\r\n      null\r\n    else if locked and requiredToPurchase\r\n      item.classes.push 'locked'\r\n      @itemGroups.requiredPurchaseItems.add item\r\n    else if locked\r\n      item.classes.push 'locked'\r\n      if item.isSilhouettedItem() or not item.get('gems')\r\n        # Don't even load/show these--don't add to a collection. (Bandwidth optimization.)\r\n        null\r\n      else\r\n        @itemGroups.lockedItems.add(item)\r\n    else if restricted\r\n      @itemGroups.restrictedItems.add(item)\r\n      item.classes.push 'restricted'\r\n    else\r\n      @itemGroups.availableItems.add(item)\r\n\r\n    # level to unlock\r\n    item.level = item.levelRequiredForItem() if item.get('tier')?\r\n\r\n  onLoaded: ->\r\n    # Both items and session have been loaded.\r\n    @onItemsLoaded()\r\n    super()\r\n\r\n  getRenderData: (context={}) ->\r\n    context = super(context)\r\n    context.equipped = _.values(@equipment)\r\n    context.items = @items.models\r\n    context.itemGroups = @itemGroups\r\n    context.slots = @slots\r\n    context.selectedHero = @selectedHero\r\n    context.selectedHeroClass = @selectedHero?.get('heroClass')\r\n    context.equipment = _.clone @equipment\r\n    context.equipment[slot] = @items.findWhere {original: itemOriginal} for slot, itemOriginal of context.equipment\r\n    context.gems = me.gems()\r\n    context\r\n\r\n  afterRender: ->\r\n    super()\r\n    @$el.find('#play-level-button').css('visibility', 'hidden')\r\n    return unless @supermodel.finished()\r\n    @$el.find('#play-level-button').css('visibility', 'visible')\r\n\r\n    @setUpDraggableEventsForAvailableEquipment()\r\n    @setUpDraggableEventsForEquippedArea()\r\n    @delegateEvents()\r\n    @itemDetailsView = new ItemDetailsView()\r\n    @insertSubView(@itemDetailsView)\r\n    @requireLevelEquipment()\r\n    @$el.find('.nano').nanoScroller({alwaysVisible: true})\r\n    @onSelectionChanged()\r\n    @onEquipmentChanged()\r\n\r\n  afterInsert: ->\r\n    super()\r\n    @canvasWidth = @$el.find('canvas').innerWidth()\r\n    @canvasHeight = @$el.find('canvas').innerHeight()\r\n    @inserted = true\r\n    @requireLevelEquipment()\r\n\r\n  #- Draggable logic\r\n\r\n  setUpDraggableEventsForAvailableEquipment: ->\r\n    for availableItemEl in @$el.find('#unequipped .item')\r\n      availableItemEl = $(availableItemEl)\r\n      continue if availableItemEl.hasClass('locked') or availableItemEl.hasClass('restricted')\r\n      dragHelper = availableItemEl.clone().addClass('draggable-item')\r\n      do (dragHelper, availableItemEl) =>\r\n        availableItemEl.draggable\r\n          revert: 'invalid'\r\n          appendTo: @$el\r\n          cursorAt: {left: 35.5, top: 35.5}\r\n          helper: -> dragHelper\r\n          revertDuration: 200\r\n          distance: 10\r\n          scroll: false\r\n          zIndex: 1100\r\n        availableItemEl.on 'dragstart', => @selectUnequippedItem(availableItemEl)\r\n\r\n  setUpDraggableEventsForEquippedArea: ->\r\n    for itemSlot in @$el.find '.item-slot'\r\n      slot = $(itemSlot).data 'slot'\r\n      do (slot, itemSlot) =>\r\n        $(itemSlot).droppable\r\n          drop: (e, ui) => @equipSelectedItem()\r\n          accept: (el) -> $(el).parent().hasClass slot\r\n          activeClass: 'droppable'\r\n          hoverClass: 'droppable-hover'\r\n          tolerance: 'touch'\r\n        @makeEquippedSlotDraggable $(itemSlot)\r\n\r\n    @$el.find('#equipped').droppable\r\n      drop: (e, ui) => @equipSelectedItem()\r\n      accept: (el) -> true\r\n      activeClass: 'droppable'\r\n      hoverClass: 'droppable-hover'\r\n      tolerance: 'pointer'\r\n\r\n  makeEquippedSlotDraggable: (slot) ->\r\n    unequip = =>\r\n      itemEl = @unequipItemFromSlot slot\r\n      selectedSlotItemID = itemEl.data('item-id')\r\n      item = @items.get(selectedSlotItemID)\r\n      @requireLevelEquipment()\r\n      @showItemDetails(item, 'equip')\r\n      @onSelectionChanged()\r\n      @onEquipmentChanged()\r\n    shouldStayEquippedWhenDropped = (isValidDrop) ->\r\n      pos = $(@).position()\r\n      revert = Math.abs(pos.left) < $(@).outerWidth() and Math.abs(pos.top) < $(@).outerHeight()\r\n      unequip() if not revert\r\n      revert\r\n    # TODO: figure out how to make this actually above the available items list (the .ui-draggable-helper img is still inside .item-view and so underlaps...)\r\n    $(slot).find('img').draggable\r\n      revert: shouldStayEquippedWhenDropped\r\n      appendTo: @$el\r\n      cursorAt: {left: 35.5, top: 35.5}\r\n      revertDuration: 200\r\n      distance: 10\r\n      scroll: false\r\n      zIndex: 100\r\n    slot.on 'dragstart', => @selectItemSlot(slot)\r\n\r\n\r\n  #- Select/equip event handlers\r\n\r\n  onItemSlotClick: (e) ->\r\n    return if @remainingRequiredEquipment?.length  # Don't let them select a slot if we need them to first equip some require gear.\r\n    #@playSound 'menu-button-click'\r\n    @selectItemSlot($(e.target).closest('.item-slot'))\r\n\r\n  onUnequippedItemClick: (e) ->\r\n    return if @justDoubleClicked\r\n    return if @justClickedEquipItemButton\r\n    itemEl = $(e.target).closest('.item')\r\n    #@playSound 'menu-button-click'\r\n    @selectUnequippedItem(itemEl)\r\n\r\n  onUnequippedItemDoubleClick: (e) ->\r\n    itemEl = $(e.target).closest('.item')\r\n    return if itemEl.hasClass('locked') or itemEl.hasClass('restricted')\r\n    @equipSelectedItem()\r\n    @justDoubleClicked = true\r\n    _.defer => @justDoubleClicked = false\r\n\r\n  onEquippedItemDoubleClick: -> @unequipSelectedItem()\r\n  onClickEquipItemViewed: -> @equipSelectedItem()\r\n  onClickUnequipItemViewed: -> @unequipSelectedItem()\r\n\r\n  onClickEquipItemButton: (e) ->\r\n    @playSound 'menu-button-click'\r\n    itemEl = $(e.target).closest('.item')\r\n    @selectUnequippedItem(itemEl)\r\n    @equipSelectedItem()\r\n    @justClickedEquipItemButton = true\r\n    _.defer => @justClickedEquipItemButton = false\r\n\r\n  #- Select/equip higher-level, all encompassing methods the callbacks all use\r\n\r\n  selectItemSlot: (slotEl) ->\r\n    @clearSelection()\r\n    slotEl.addClass('selected')\r\n    selectedSlotItemID = slotEl.find('.item').data('item-id')\r\n    item = @items.get(selectedSlotItemID)\r\n    if item then @showItemDetails(item, 'unequip')\r\n    @onSelectionChanged()\r\n\r\n  selectUnequippedItem: (itemEl) ->\r\n    @clearSelection()\r\n    itemEl.addClass('active')\r\n    showExtra = if itemEl.hasClass('restricted') then 'restricted' else if not itemEl.hasClass('locked') then 'equip' else ''\r\n    @showItemDetails(@items.get(itemEl.data('item-id')), showExtra)\r\n    @onSelectionChanged()\r\n\r\n  equipSelectedItem: ->\r\n    selectedItemEl = @getSelectedUnequippedItem()\r\n    selectedItem = @items.get(selectedItemEl.data('item-id'))\r\n    return unless selectedItem\r\n    allowedSlots = selectedItem.getAllowedSlots()\r\n    firstSlot = unequippedSlot = null\r\n    for allowedSlot in allowedSlots\r\n      slotEl = @$el.find(\".item-slot[data-slot='#{allowedSlot}']\")\r\n      firstSlot ?= slotEl\r\n      unequippedSlot ?= slotEl unless slotEl.find('img').length\r\n    slotEl = unequippedSlot ? firstSlot\r\n    selectedItemEl.effect('transfer', to: slotEl, duration: 500, easing: 'easeOutCubic')\r\n    unequipped = @unequipItemFromSlot(slotEl)\r\n    selectedItemEl.addClass('equipped')\r\n    slotEl.append(selectedItemEl.find('img').clone().addClass('item').data('item-id', selectedItem.id))\r\n    @clearSelection()\r\n    @showItemDetails(selectedItem, 'unequip')\r\n    slotEl.addClass('selected')\r\n    selectedItem.classes.push 'equipped'\r\n    @makeEquippedSlotDraggable slotEl\r\n    @requireLevelEquipment()\r\n    @onSelectionChanged()\r\n    @onEquipmentChanged()\r\n\r\n  unequipSelectedItem: ->\r\n    slotEl = @getSelectedSlot()\r\n    @clearSelection()\r\n    itemEl = @unequipItemFromSlot(slotEl)\r\n    return unless itemEl?.length\r\n    itemEl.addClass('active')\r\n    slotEl.effect('transfer', to: itemEl, duration: 500, easing: 'easeOutCubic')\r\n    selectedSlotItemID = itemEl.data('item-id')\r\n    item = @items.get(selectedSlotItemID)\r\n    item.classes = _.without item.classes, 'equipped'\r\n    @showItemDetails(item, 'equip')\r\n    @requireLevelEquipment()\r\n    @onSelectionChanged()\r\n    @onEquipmentChanged()\r\n\r\n  #- Select/equip helpers\r\n\r\n  clearSelection: ->\r\n    @deselectAllSlots()\r\n    @deselectAllUnequippedItems()\r\n    @hideItemDetails()\r\n\r\n  unequipItemFromSlot: (slotEl) ->\r\n    itemEl = slotEl.find('.item')\r\n    itemIDToUnequip = itemEl.data('item-id')\r\n    return unless itemIDToUnequip\r\n    itemEl.remove()\r\n    item = @items.get itemIDToUnequip\r\n    item.classes = _.without item.classes, 'equipped'\r\n    @$el.find(\"#unequipped .item[data-item-id=#{itemIDToUnequip}]\").removeClass('equipped')\r\n\r\n  deselectAllSlots: ->\r\n    @$el.find('#equipped .item-slot.selected').removeClass('selected')\r\n\r\n  deselectAllUnequippedItems: ->\r\n    @$el.find('#unequipped .item').removeClass('active')\r\n\r\n  getSlot: (name) ->\r\n    @$el.find(\".item-slot[data-slot=#{name}]\")\r\n\r\n  getSelectedSlot: ->\r\n    @$el.find('#equipped .item-slot.selected')\r\n\r\n  getSelectedUnequippedItem: ->\r\n    @$el.find('#unequipped .item.active')\r\n\r\n  onSelectionChanged: ->\r\n    heroClass = @selectedHero?.get('heroClass')\r\n    itemsCanBeEquipped = @$el.find('#unequipped .item.available:not(.equipped)').filter('.'+heroClass).length\r\n    toShow = @$el.find('#double-click-hint, #available-description')\r\n    if itemsCanBeEquipped then toShow.removeClass('secret') else toShow.addClass('secret')\r\n    @delegateEvents()\r\n\r\n\r\n  showItemDetails: (item, showExtra) ->\r\n    @itemDetailsView.setItem(item)\r\n    @$el.find('#item-details-extra > *').addClass('secret')\r\n    @$el.find(\"##{showExtra}-item-viewed\").removeClass('secret')\r\n\r\n  hideItemDetails: ->\r\n    @itemDetailsView?.setItem(null)\r\n    @$el.find('#item-details-extra > *').addClass('secret')\r\n\r\n  getCurrentEquipmentConfig: ->\r\n    config = {}\r\n    for slot in @$el.find('.item-slot')\r\n      slotName = $(slot).data('slot')\r\n      slotItemID = $(slot).find('.item').data('item-id')\r\n      continue unless slotItemID\r\n      item = _.find @items.models, {id:slotItemID}\r\n      config[slotName] = item.get('original')\r\n    config\r\n\r\n  requireLevelEquipment: ->\r\n    # This is called frequently to make sure the player isn't using any restricted items and knows she must equip any required items.\r\n    return unless @inserted and @itemsProgrammablePropertiesConfigured\r\n    equipment = if @supermodel.finished() then @getCurrentEquipmentConfig() else @equipment  # Make sure we're using latest equipment.\r\n    hadRequired = @remainingRequiredEquipment?.length\r\n    @remainingRequiredEquipment = []\r\n    @$el.find('.should-equip').removeClass('should-equip')\r\n    @unequipClassRestrictedItems equipment\r\n    @unequipLevelRestrictedItems equipment\r\n    @updateLevelRequiredItems equipment\r\n    if hadRequired and not @remainingRequiredEquipment.length\r\n      @endHighlight()\r\n      @highlightElement '#play-level-button', duration: 5000\r\n    $('#play-level-button').prop('disabled', @remainingRequiredEquipment.length > 0)\r\n\r\n  unequipClassRestrictedItems: (equipment) ->\r\n    return unless @supermodel.finished() and heroClass = @selectedHero?.get 'heroClass'\r\n    for slot, item of _.clone equipment\r\n      itemModel = @items.findWhere original: item\r\n      unless itemModel and heroClass in itemModel.classes\r\n        console.log 'Unequipping', itemModel.get('heroClass'), 'item', itemModel.get('name'), 'from slot due to class restrictions.'\r\n        @unequipItemFromSlot @$el.find(\".item-slot[data-slot='#{slot}']\")\r\n        delete equipment[slot]\r\n\r\n  calculateRequiredGearPerSlot: ->\r\n    return @requiredGearPerSlot if @requiredGearPerSlot\r\n    requiredGear = _.clone(@options.level.get('requiredGear')) ? {}\r\n    requiredProperties = @options.level.get('requiredProperties') ? []\r\n    restrictedProperties = @options.level.get('restrictedProperties') ? []\r\n    requiredPropertiesPerSlot = {}\r\n    for item in @items.models\r\n      requiredPropertiesOnThisItem = _.intersection(item.programmableProperties, requiredProperties)\r\n      restrictedPropertiesOnThisItem = _.intersection(item.programmableProperties, restrictedProperties)\r\n      continue unless requiredPropertiesOnThisItem.length and not restrictedPropertiesOnThisItem.length\r\n      for slot in item.getAllowedSlots()\r\n        continue if slot isnt 'right-hand' and _.isEqual requiredPropertiesOnThisItem, ['buildXY']  # Don't require things like caltrops belt\r\n        requiredGear[slot] ?= []\r\n        requiredGear[slot].push(item.get('original')) unless item.get('original') in requiredGear[slot]\r\n        requiredPropertiesPerSlot[slot] ?= []\r\n        requiredPropertiesPerSlot[slot].push(prop) for prop in requiredPropertiesOnThisItem when prop not in requiredPropertiesPerSlot[slot]\r\n    @requiredPropertiesPerSlot = requiredPropertiesPerSlot\r\n    @requiredGearPerSlot = requiredGear\r\n    @requiredGearPerSlot\r\n\r\n  calculateRestrictedGearPerSlot: ->\r\n    return @restrictedGearPerSlot if @restrictedGearPerSlot\r\n    @calculateRequiredGearPerSlot() unless @requiredGearPerSlot\r\n    restrictedGear = _.clone(@options.level.get('restrictedGear')) ? {}\r\n    restrictedProperties = @options.level.get('restrictedProperties') ? []\r\n    for item in @items.models\r\n      restrictedPropertiesOnThisItem = _.intersection(item.programmableProperties, restrictedProperties)\r\n      for slot in item.getAllowedSlots()\r\n        requiredPropertiesNotOnThisItem = _.without(@requiredPropertiesPerSlot[slot], item.programmableProperties...)\r\n        if restrictedPropertiesOnThisItem.length or requiredPropertiesNotOnThisItem.length\r\n          restrictedGear[slot] ?= []\r\n          restrictedGear[slot].push(item.get('original')) unless item.get('original') in restrictedGear[slot]\r\n    @restrictedGearPerSlot = restrictedGear\r\n    @restrictedGearPerSlot\r\n\r\n  unequipLevelRestrictedItems: (equipment) ->\r\n    restrictedGear = @calculateRestrictedGearPerSlot()\r\n    for slot, items of restrictedGear\r\n      for item in items\r\n        equipped = equipment[slot]\r\n        if equipped and equipped is item\r\n          console.log 'Unequipping restricted item', equipped, 'for', slot, 'before level', @options.level.get('slug')\r\n          @unequipItemFromSlot @$el.find(\".item-slot[data-slot='#{slot}']\")\r\n          delete equipment[slot]\r\n    null\r\n\r\n  updateLevelRequiredItems: (equipment) ->\r\n    return unless heroClass = @selectedHero?.get 'heroClass'\r\n    requiredGear = @calculateRequiredGearPerSlot()\r\n    for slot, items of requiredGear when items.length\r\n      if slot in @ringSlots\r\n        validSlots = @ringSlots\r\n      else\r\n        validSlots = [slot]\r\n\r\n      continue if validSlots.some (slot) ->\r\n        equipped = equipment[slot]\r\n        equipped in items\r\n\r\n      # Actually, just let them play if they have equipped anything in that slot (and we haven't unequipped it due to restrictions).\r\n      # Rings often have unique effects, so this rule does not apply to them (they are still required even if there is a non-restricted ring equipped in the slot).\r\n      continue if equipment[slot] and slot not in @ringSlots\r\n\r\n      items = (item for item in items when heroClass in (@items.findWhere(original: item)?.classes ? []))\r\n      continue unless items.length  # If the required items are for another class, then let's not be finicky.\r\n\r\n      # We will point out the last (best) element that they own and can use, otherwise the first (cheapest).\r\n      items = _.sortBy items, (item) => @items.findWhere(original: item).get('tier') ? 9001\r\n      bestOwnedItem = _.findLast items, (item) -> me.ownsItem item\r\n      item = bestOwnedItem ? items[0]\r\n\r\n      # For the Tarnished Bronze Breastplate only, don't tell them they need it until they need it in the level, so we can show how to buy it.\r\n      slug = gearSlugs[item]\r\n      inCampaignView = $('#campaign-view').length\r\n      continue if slug is 'tarnished-bronze-breastplate' and inCampaignView and @options.level.get('slug') is 'the-raised-sword'\r\n\r\n      # Now we're definitely requiring and pointing out an item.\r\n      itemModel = @items.findWhere {original: item}\r\n      availableSlotSelector = \"#unequipped .item[data-item-id='#{itemModel.id}']\"\r\n      @highlightElement availableSlotSelector, delay: 500, sides: ['right'], rotation: Math.PI / 2\r\n      $itemEl = @$el.find(availableSlotSelector).addClass 'should-equip'\r\n      @$el.find(\"#equipped div[data-slot='#{slot}']\").addClass 'should-equip'\r\n      if itemOffsetTop = $itemEl[0]?.offsetTop\r\n        itemOffsetBottom = itemOffsetTop + $itemEl.outerHeight(true)\r\n        parentHeight = $itemEl.parent().height()\r\n        if itemOffsetBottom > $itemEl.parent().scrollTop() + parentHeight\r\n          $itemEl.parent().scrollTop itemOffsetBottom - parentHeight\r\n        else if itemOffsetTop < $itemEl.parent().scrollTop()\r\n          $itemEl.parent().scrollTop itemOffsetTop\r\n      @remainingRequiredEquipment.push slot: slot, item: item\r\n    null\r\n\r\n  setHero: (@selectedHero) ->\r\n    if @selectedHero.loading\r\n      @listenToOnce @selectedHero, 'sync', => @setHero? @selectedHero\r\n      return\r\n    @$el.removeClass('Warrior Ranger Wizard').addClass(@selectedHero.get('heroClass'))\r\n    @requireLevelEquipment()\r\n    @render()\r\n    @onEquipmentChanged()\r\n\r\n  onShown: ->\r\n    # Called when we switch tabs to this within the modal\r\n    @requireLevelEquipment()\r\n\r\n  onHidden: ->\r\n    # Called when the modal itself is dismissed\r\n    @endHighlight()\r\n    super()\r\n    @playSound 'game-menu-close'\r\n\r\n  onClickChooseHero: ->\r\n    @playSound 'menu-button-click'\r\n    @hide()\r\n    @trigger 'choose-hero-click'\r\n\r\n  onClickPlayLevel: (e) ->\r\n    return if @$el.find('#play-level-button').prop 'disabled'\r\n    levelSlug = @options.level.get('slug')\r\n    @playSound 'menu-button-click'\r\n    @showLoading()\r\n    ua = navigator.userAgent.toLowerCase()\r\n    isSafari = /safari/.test(ua) and not /chrome/.test(ua)\r\n    isTooShort = $(window).height() < 658  # Min vertical resolution needed at 1366px wide\r\n    if isTooShort and not me.isAdmin() and not hasGoneFullScreenOnce and not isSafari\r\n      @toggleFullscreen()\r\n      hasGoneFullScreenOnce = true\r\n    @updateConfig =>\r\n      @trigger? 'play-click'\r\n    window.tracker?.trackEvent 'Inventory Play', category: 'Play Level', level: levelSlug\r\n\r\n  updateConfig: (callback, skipSessionSave) ->\r\n    sessionHeroConfig = @options.session.get('heroConfig') ? {}\r\n    lastHeroConfig = me.get('heroConfig') ? {}\r\n    inventory = @getCurrentEquipmentConfig()\r\n    patchSession = patchMe = false\r\n    patchSession ||= not _.isEqual inventory, sessionHeroConfig.inventory\r\n    sessionHeroConfig.inventory = inventory\r\n    if hero = @selectedHero?.get('original')\r\n      patchSession ||= not _.isEqual hero, sessionHeroConfig.thangType\r\n      sessionHeroConfig.thangType = hero\r\n    patchMe ||= not _.isEqual inventory, lastHeroConfig.inventory\r\n    lastHeroConfig.inventory = inventory\r\n    if patchMe\r\n      console.log 'setting me.heroConfig to', JSON.stringify(lastHeroConfig)\r\n      me.set 'heroConfig', lastHeroConfig\r\n      me.patch()\r\n    if patchSession\r\n      console.log 'setting session.heroConfig to', JSON.stringify(sessionHeroConfig)\r\n      @options.session.set 'heroConfig', sessionHeroConfig\r\n      @options.session.patch success: callback unless skipSessionSave\r\n    else\r\n      callback?()\r\n\r\n  #- TODO: DRY this between PlayItemsModal and InventoryModal and PlayHeroesModal\r\n\r\n  onUnlockButtonClicked: (e) ->\r\n    e.stopPropagation()\r\n    button = $(e.target).closest('button')\r\n    item = @items.get(button.data('item-id'))\r\n    affordable = item.affordable\r\n    if not affordable\r\n      @playSound 'menu-button-click'\r\n      @askToBuyGems button unless features.freeOnly\r\n    else if button.hasClass('confirm')\r\n      @playSound 'menu-button-unlock-end'\r\n      purchase = Purchase.makeFor(item)\r\n      purchase.save()\r\n\r\n      #- set local changes to mimic what should happen on the server...\r\n      purchased = me.get('purchased') ? {}\r\n      purchased.items ?= []\r\n      purchased.items.push(item.get('original'))\r\n\r\n      me.set('purchased', purchased)\r\n      me.set('spent', (me.get('spent') ? 0) + item.get('gems'))\r\n\r\n      #- ...then rerender key bits\r\n      @itemGroups.lockedItems.remove(item)\r\n      @itemGroups.requiredPurchaseItems.remove(item)\r\n      # Redo all item sorting to make sure that we don't clobber state changes since last render.\r\n      equipped = _.values @getCurrentEquipmentConfig()\r\n      @sortItem(otherItem, equipped) for otherItem in @items.models\r\n      @renderSelectors('#unequipped', '#gems-count')\r\n\r\n      @requireLevelEquipment()\r\n      @delegateEvents()\r\n      @setUpDraggableEventsForAvailableEquipment()\r\n      @itemDetailsView.setItem(item)\r\n      @onScrollUnequipped true\r\n\r\n      Backbone.Mediator.publish 'store:item-purchased', item: item, itemSlug: item.get('slug')\r\n    else\r\n      @playSound 'menu-button-unlock-start'\r\n      button.addClass('confirm').text($.i18n.t('play.confirm'))\r\n      @$el.one 'click', (e) ->\r\n        button.removeClass('confirm').text($.i18n.t('play.unlock')) if e.target isnt button[0]\r\n\r\n  askToSignUp: ->\r\n    createAccountModal = new CreateAccountModal supermodel: @supermodel\r\n    return @openModalView createAccountModal\r\n\r\n  askToBuyGems: (unlockButton) ->\r\n    @$el.find('.unlock-button').popover 'destroy'\r\n    popoverTemplate = buyGemsPromptTemplate {}\r\n    unlockButton.popover(\r\n      animation: true\r\n      trigger: 'manual'\r\n      placement: 'top'\r\n      content: ' '  # template has it\r\n      container: @$el\r\n      template: popoverTemplate\r\n    ).popover 'show'\r\n    popover = unlockButton.data('bs.popover')\r\n    popover?.$tip?.i18n()\r\n\r\n  onBuyGemsPromptButtonClicked: (e) ->\r\n    @playSound 'menu-button-click'\r\n    return @askToSignUp() if me.get('anonymous')\r\n    @openModalView new BuyGemsModal()\r\n\r\n  onClickedSomewhere: (e) ->\r\n    return if @destroyed\r\n    @$el.find('.unlock-button').popover 'destroy'\r\n\r\n\r\n  #- Dynamic portrait loading\r\n\r\n  onScrollUnequipped: (forceLoadAll=false) ->\r\n    # dynamically load visible items when the user scrolls enough to see them\r\n    return if @destroyed\r\n    nanoContent = @$el.find('#unequipped .nano-content')\r\n    items = nanoContent.find('.item:visible:not(.loaded)')\r\n    threshold = nanoContent.height() + 100\r\n    for itemEl in items\r\n      itemEl = $(itemEl)\r\n      if itemEl.position().top < threshold or forceLoadAll\r\n        itemEl.addClass('loaded')\r\n        item = @items.get(itemEl.data('item-id'))\r\n        itemEl.find('img').attr('src', item.getPortraitURL())\r\n\r\n\r\n  #- Paper doll equipment updating\r\n  onEquipmentChanged: ->\r\n    heroClass = @selectedHero?.get('heroClass') ? 'Warrior'\r\n    gender = if @selectedHero?.get('slug') in heroGenders.male then 'male' else 'female'\r\n    @$el.find('#hero-image, #hero-image-hair, #hero-image-head, #hero-image-thumb').removeClass().addClass \"#{gender} #{heroClass}\"\r\n    equipment = @getCurrentEquipmentConfig()\r\n    @onScrollUnequipped()\r\n    return unless _.size(equipment) and @supermodel.finished()\r\n    @removeDollImages()\r\n    slotsWithImages = []\r\n    for slot, original of equipment\r\n      item = _.find @items.models, (item) -> item.get('original') is original\r\n      continue unless dollImages = item?.get('dollImages')\r\n      didAdd = @addDollImage slot, dollImages, heroClass, gender, item\r\n      slotsWithImages.push slot if didAdd if item.get('original') isnt '54ea39342b7506e891ca70f2'  # Circlet of the Magi needs hair under it\r\n    @$el.find('#hero-image-hair').toggle not ('head' in slotsWithImages)\r\n    @$el.find('#hero-image-thumb').toggle not ('gloves' in slotsWithImages)\r\n\r\n    @equipment = @options.equipment = equipment\r\n\r\n  removeDollImages: ->\r\n    @$el.find('.doll-image').remove()\r\n\r\n  addDollImage: (slot, dollImages, heroClass, gender, item) ->\r\n    heroClass = @selectedHero?.get('heroClass') ? 'Warrior'\r\n    gender = if @selectedHero?.get('slug') in heroGenders.male then 'male' else 'female'\r\n    didAdd = false\r\n    if slot is 'gloves'\r\n      if heroClass is 'Ranger'\r\n        imageKeys = [\"#{gender}#{heroClass}\", \"#{gender}#{heroClass}Thumb\"]\r\n      else\r\n        imageKeys = [\"#{gender}\", \"#{gender}Thumb\"]\r\n    else if heroClass is 'Wizard' and slot is 'torso'\r\n      imageKeys = [gender, \"#{gender}Back\"]\r\n    else if heroClass is 'Ranger' and slot is 'head' and item.get('original') in ['5441c2be4e9aeb727cc97105', '5441c3144e9aeb727cc97111']\r\n      # All-class headgear like faux fur hat, viking helmet is abusing ranger glove slot\r\n      imageKeys = [\"#{gender}Ranger\"]\r\n    else\r\n      imageKeys = [gender]\r\n    for imageKey in imageKeys\r\n      imageURL = dollImages[imageKey]\r\n      if not imageURL\r\n        console.log \"Hmm, should have #{slot} #{imageKey} paper doll image, but don't have it.\"\r\n      else\r\n        imageEl = $('<img>').attr('src', \"/file/#{imageURL}\").addClass(\"doll-image #{slot} #{heroClass} #{gender} #{_.string.underscored(imageKey).replace(/_/g, '-')}\").attr('draggable', false)\r\n        @$el.find('#equipped').append imageEl\r\n        didAdd = true\r\n    didAdd\r\n\r\n  destroy: ->\r\n    @$el.find('.unlock-button').popover 'destroy'\r\n    @$el.find('.ui-droppable').droppable 'destroy'\r\n    @$el.find('.ui-draggable').draggable('destroy').off 'dragstart'\r\n    @$el.find('.item-slot').off 'dragstart'\r\n    @stage?.removeAllChildren()\r\n    super()\r\n\r\n\r\nheroGenders =\r\n  male: ['knight', 'samurai', 'trapper', 'potion-master', 'goliath', 'assassin', 'necromancer', 'duelist', 'code-ninja']\r\n  female: ['captain', 'ninja', 'forest-archer', 'librarian', 'sorcerer', 'raider', 'guardian', 'pixie', 'master-wizard', 'champion']\r\n\r\ngear =\r\n  'simple-boots': '53e237bf53457600003e3f05'\r\n  'simple-sword': '53e218d853457600003e3ebe'\r\n  'tarnished-bronze-breastplate': '53e22eac53457600003e3efc'\r\n  'leather-boots': '53e2384453457600003e3f07'\r\n  'leather-belt': '5437002a7beba4a82024a97d'\r\n  'programmaticon-i': '53e4108204c00d4607a89f78'\r\n  'programmaticon-ii': '546e25d99df4a17d0d449be1'\r\n  'crude-glasses': '53e238df53457600003e3f0b'\r\n  'crude-builders-hammer': '53f4e6e3d822c23505b74f42'\r\n  'long-sword': '544d7d1f8494308424f564a3'\r\n  'sundial-wristwatch': '53e2396a53457600003e3f0f'\r\n  'bronze-shield': '544c310ae0017993fce214bf'\r\n  'wooden-glasses': '53e2167653457600003e3eb3'\r\n  'basic-flags': '545bacb41e649a4495f887da'\r\n  'roughedge': '544d7d918494308424f564a7'\r\n  'sharpened-sword': '544d7deb8494308424f564ab'\r\n  'crude-crossbow': '544d7ffd8494308424f564c3'\r\n  'crude-dagger': '544d952b8494308424f56517'\r\n  'weak-charge': '544d957d8494308424f5651f'\r\n  'enchanted-stick': '544d87188494308424f564f1'\r\n  'unholy-tome-i': '546374bc3839c6e02811d308'\r\n  'book-of-life-i': '546375653839c6e02811d30b'\r\n  'rough-sense-stone': '54693140a2b1f53ce79443bc'\r\n  'polished-sense-stone': '53e215a253457600003e3eaf'\r\n  'quartz-sense-stone': '54693240a2b1f53ce79443c5'\r\n  'wooden-builders-hammer': '54694ba3a2b1f53ce794444d'\r\n  'simple-wristwatch': '54693797a2b1f53ce79443e9'\r\n\r\ngearSlugs = _.invert gear\r\n"]}