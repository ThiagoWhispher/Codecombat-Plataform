{"version":3,"sources":["app/templates/play/modal/item-details-view.jade","app/views/play/modal/ItemDetailsView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/modal/ItemDetailsView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),item = locals_.item,stats = locals_.stats,me = locals_.me,props = locals_.props;buf.push(\"<div id=\\\"item-title\\\"><h2 class=\\\"one-line big-font\\\">\" + (jade.escape(null == (jade.interp = item ? item.name : '') ? \"\" : jade.interp)) + \"</h2></div><div id=\\\"item-details-body\\\">\");\nif ( item)\n{\nbuf.push(\"<div class=\\\"nano\\\"><div class=\\\"nano-content\\\"><div id=\\\"item-container\\\"><img\" + (jade.attrs({ 'src':(item.getPortraitURL()), 'draggable':(\"false\"), \"class\": [('item-img')] }, {\"src\":true,\"draggable\":true})) + \"/><img\" + (jade.attrs({ 'src':(item.getPortraitURL()), 'draggable':(\"false\"), \"class\": [('item-shadow')] }, {\"src\":true,\"draggable\":true})) + \"/></div><img src=\\\"/images/pages/play/modal/hr.png\\\" draggable=\\\"false\\\" class=\\\"hr\\\"/>\");\n// iterate stats\n;(function(){\n  var $$obj = stats;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var stat = $$obj[$index];\n\nbuf.push(\"<div\" + (jade.attrs({ \"class\": [(\"stat-row big-font\" + (/^en/.test(me.get('preferredLanguage')) && stat.matchedShortName ? \" short-name\" : \"\"))] }, {\"class\":true})) + \"><div class=\\\"stat-label\\\">\" + (jade.escape(null == (jade.interp = stat.name) ? \"\" : jade.interp)) + \"</div><div class=\\\"stat\\\">\" + (jade.escape(null == (jade.interp = stat.display) ? \"\" : jade.interp)) + \"</div></div><img\" + (jade.attrs({ 'src':(\"/images/pages/play/modal/hr.png\"), 'draggable':(\"false\"), \"class\": [('hr'),(stat.isLast ? \"\" : \"faded\")] }, {\"class\":true,\"src\":true,\"draggable\":true})) + \"/>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var stat = $$obj[$index];\n\nbuf.push(\"<div\" + (jade.attrs({ \"class\": [(\"stat-row big-font\" + (/^en/.test(me.get('preferredLanguage')) && stat.matchedShortName ? \" short-name\" : \"\"))] }, {\"class\":true})) + \"><div class=\\\"stat-label\\\">\" + (jade.escape(null == (jade.interp = stat.name) ? \"\" : jade.interp)) + \"</div><div class=\\\"stat\\\">\" + (jade.escape(null == (jade.interp = stat.display) ? \"\" : jade.interp)) + \"</div></div><img\" + (jade.attrs({ 'src':(\"/images/pages/play/modal/hr.png\"), 'draggable':(\"false\"), \"class\": [('hr'),(stat.isLast ? \"\" : \"faded\")] }, {\"class\":true,\"src\":true,\"draggable\":true})) + \"/>\");\n    }\n\n  }\n}).call(this);\n\nif ( item.description)\n{\nbuf.push(\"<div class=\\\"item-description\\\">\" + (jade.escape(null == (jade.interp = item.description) ? \"\" : jade.interp)) + \"</div>\");\n}\nif ( props.length)\n{\nbuf.push(\"<div id=\\\"skills\\\"><h3 data-i18n=\\\"play.skills_granted\\\" class=\\\"big-font\\\"></h3>\");\n// iterate props\n;(function(){\n  var $$obj = props;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var prop = $$obj[$index];\n\nbuf.push(\"<p><strong>\" + (jade.escape(null == (jade.interp = prop.name) ? \"\" : jade.interp)) + \"</strong><span class=\\\"spr\\\">:</span><span>\" + (null == (jade.interp = prop.description) ? \"\" : jade.interp) + \"</span></p>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var prop = $$obj[$index];\n\nbuf.push(\"<p><strong>\" + (jade.escape(null == (jade.interp = prop.name) ? \"\" : jade.interp)) + \"</strong><span class=\\\"spr\\\">:</span><span>\" + (null == (jade.interp = prop.description) ? \"\" : jade.interp) + \"</span></p>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div>\");\n}\nif ( item.comingSoon)\n{\nbuf.push(\"<div class=\\\"text-center\\\"><h3>This item has no stats.</h3><p>Only admins will see it for now.</p></div>\");\n}\nbuf.push(\"</div></div>\");\n}\nbuf.push(\"</div>\");\nif ( item && !item.owned)\n{\nif ( item.unequippable)\n{\nbuf.push(\"<button class=\\\"btn big-font disabled unequippable\\\">\" + (jade.escape((jade.interp = item.get('heroClass')) == null ? '' : jade.interp)) + \" Only</button>\");\n}\nelse\n{\nbuf.push(\"<button\" + (jade.attrs({ 'id':('selected-item-unlock-button'), 'data-item-id':(item.id), \"class\": [('btn'),('big-font'),('unlock-button')] }, {\"data-item-id\":true})) + \"><span data-i18n=\\\"play.unlock\\\">Unlock</span><span class=\\\"spl\\\">\" + (jade.escape(null == (jade.interp = '('+item.get('gems')) ? \"\" : jade.interp)) + \"</span><img src=\\\"/images/common/gem.png\\\" draggable=\\\"false\\\"/><span>)</span></button>\");\n}\n};return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","CocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/play/modal/item-details-view'\r\nCocoCollection = require 'collections/CocoCollection'\r\nLevelComponent = require 'models/LevelComponent'\r\n\r\n{downTheChain} = require 'lib/world/world_utils'\r\nutils = require 'core/utils'\r\n\r\nmodule.exports = class ItemDetailsView extends CocoView\r\n  id: \"item-details-view\"\r\n  template: template\r\n\r\n  constructor: ->\r\n    super(arguments...)\r\n    @propDocs = {}\r\n    @spellDocs = {}\r\n\r\n  setItem: (@item) ->\r\n    if @item\r\n      @spellDocs = {}\r\n      @item.name = utils.i18n @item.attributes, 'name'\r\n      @item.description = utils.i18n @item.attributes, 'description'\r\n      @item.affordable = me.gems() >= @item.get('gems')\r\n      @item.owned = me.ownsItem @item.get('original')\r\n      @item.comingSoon = not @item.getFrontFacingStats().props.length and not _.size @item.getFrontFacingStats().stats  # Temp: while there are placeholder items\r\n      @componentConfigs = (c.config for c in @item.get('components') when c.config)\r\n\r\n      stats = @item.getFrontFacingStats()\r\n      props = (p for p in stats.props when not @propDocs[p])\r\n      if props.length > 0 or ('cast' in stats.props)\r\n\r\n        docs = new CocoCollection([], {\r\n          url: '/db/level.component?view=prop-doc-lookup'\r\n          model: LevelComponent\r\n          project: [\r\n            'name'\r\n            'propertyDocumentation.name'\r\n            'propertyDocumentation.description'\r\n            'propertyDocumentation.i18n'\r\n          ]\r\n        })\r\n\r\n        docs.fetch({ data: {\r\n          componentOriginals: [c.original for c in @item.get('components')].join(',')\r\n          propertyNames: props.join(',')\r\n        }})\r\n        @listenToOnce docs, 'sync', @onDocsLoaded\r\n\r\n    @render()\r\n\r\n  onDocsLoaded: (levelComponents) ->\r\n    for component in levelComponents.models\r\n      for propDoc in component.get('propertyDocumentation')\r\n        if /^cast.+/.test propDoc.name\r\n          @spellDocs[propDoc.name] = propDoc\r\n        else\r\n          @propDocs[propDoc.name] = propDoc\r\n    @render()\r\n\r\n  afterRender: ->\r\n    super()\r\n    @$el.find('.nano:visible').nanoScroller({alwaysVisible: true})\r\n\r\n  getRenderData: ->\r\n    c = super()\r\n    c.item = @item\r\n    if @item\r\n      stats = @item.getFrontFacingStats()\r\n      c.stats = _.values(stats.stats)\r\n      _.last(c.stats).isLast = true if c.stats.length\r\n      c.props = []\r\n      stats.props = _.union stats.props, _.keys @spellDocs\r\n      codeLanguage = (me.get('aceConfig') ? {}).language or 'python'\r\n      for prop in stats.props\r\n        doc = @propDocs[prop] ? @spellDocs[prop] ? {}\r\n        description = utils.i18n doc, 'description'\r\n\r\n        if _.isObject description\r\n          description = description[codeLanguage] or _.values(description)[0]\r\n        if _.isString description\r\n          description = description.replace(/#{spriteName}/g, 'hero')\r\n          if fact = stats.stats.shieldDefenseFactor\r\n            description = description.replace(/#{shieldDefensePercent}%/g, fact.display)\r\n          if prop is 'buildTypes'\r\n            buildsConfig = _.find @componentConfigs, 'buildables'\r\n            description = description.replace '#{buildTypes}', \"`[\\\"#{_.keys(buildsConfig.buildables).join('\\\", \\\"')}\\\"]`\"\r\n          # We don't have the full components loaded here, so we can't really get most of these values.\r\n          componentConfigs = @componentConfigs ? []\r\n          description = description.replace /#{([^.]+?)}/g, (match, keyChain) ->\r\n            for componentConfig in componentConfigs\r\n              if value = downTheChain componentConfig, keyChain\r\n                return value\r\n            #console.log 'gotta find', keyChain, 'from', match\r\n            match\r\n          description = description.replace(/#{(.+?)}/g, '`$1`')\r\n          description = $(marked(description)).html()\r\n\r\n        c.props.push {\r\n          name: prop\r\n          description: description or '...'\r\n        }\r\n    c\r\n"]}