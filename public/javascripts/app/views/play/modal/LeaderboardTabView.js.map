{"version":3,"sources":["app/templates/play/modal/leaderboard-tab-view.jade","app/views/play/modal/LeaderboardTabView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/modal/LeaderboardTabView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),scoreType = locals_.scoreType,timespan = locals_.timespan,topScores = locals_.topScores,me = locals_.me,_ = locals_._,loading = locals_.loading;buf.push(\"<h1><span data-i18n=\\\"leaderboard.top_players\\\" class=\\\"spr\\\">Top Players by</span><span\" + (jade.attrs({ 'data-i18n':(\"leaderboard.\" + (scoreType.replace('-', '_')) + \"\") }, {\"data-i18n\":true})) + \"></span><span class=\\\"spr\\\">,</span><span\" + (jade.attrs({ 'data-i18n':(\"leaderboard.\" + (timespan) + \"\") }, {\"data-i18n\":true})) + \"></span></h1>\");\nif ( topScores)\n{\nbuf.push(\"<table class=\\\"table table-bordered table-condensed table-hover\\\"><thead><tr><th colspan=\\\"4\\\" data-i18n=\\\"general.player\\\"></th><th data-i18n=\\\"general.score\\\"></th><th data-i18n=\\\"general.when\\\"></th><th></th></tr></thead><tbody>\");\n// iterate topScores\n;(function(){\n  var $$obj = topScores;\n  if ('number' == typeof $$obj.length) {\n\n    for (var rank = 0, $$l = $$obj.length; rank < $$l; rank++) {\n      var row = $$obj[rank];\n\nvar isMyRow = row.creator == me.id\nvar viewable = rank >= 5 || me.isAdmin();\nbuf.push(\"<tr\" + (jade.attrs({ 'data-player-id':(row.creator), 'data-session-id':(row.session), 'title':(viewable ? \"View solution\" : \"Can't view top 5 solutions\"), \"class\": [(isMyRow ? \"success\" : \"\" + (viewable ? \" viewable\" : \"\"))] }, {\"class\":true,\"data-player-id\":true,\"data-session-id\":true,\"title\":true})) + \"><td class=\\\"rank-cell\\\">\" + (jade.escape(null == (jade.interp = rank + 1) ? \"\" : jade.interp)) + \"</td><td\" + (jade.attrs({ 'style':(\"background-image: url(/images/common/code_languages/\" + (row.codeLanguage) + \"_small.png)\"), 'title':(_.string.capitalize(row.codeLanguage)), \"class\": [('code-language-cell')] }, {\"style\":true,\"title\":true})) + \"></td><td\" + (jade.attrs({ 'style':(\"background-image: url(/file/db/thang.type/\" + (row.hero) + \"/portrait.png)\"), \"class\": [('hero-portrait-cell')] }, {\"style\":true})) + \"></td><td class=\\\"name-col-cell\\\">\" + (jade.escape(null == (jade.interp = row.creatorName || \"Anonymous\") ? \"\" : jade.interp)) + \"</td><td class=\\\"score-cell\\\">\" + (jade.escape(null == (jade.interp = row.score) ? \"\" : jade.interp)) + \"</td><td class=\\\"ago-cell\\\">\" + (jade.escape(null == (jade.interp = row.ago) ? \"\" : jade.interp)) + \"</td><td class=\\\"viewable-cell\\\">\");\nif ( viewable)\n{\nif ( (me.get('preferredLanguage', true) || 'en-US').substr(0, 2) == 'en')\n{\nbuf.push(\"<div class=\\\"btn btn-xs btn-info\\\">Watch</div>\");\n}\nelse\n{\nbuf.push(\"<div class=\\\"glyphicon glyphicon-eye-open\\\"></div>\");\n}\n}\nelse\n{\nbuf.push(\"<div class=\\\"glyphicon glyphicon-eye-close\\\"></div>\");\n}\nbuf.push(\"</td></tr>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var rank in $$obj) {\n      $$l++;      var row = $$obj[rank];\n\nvar isMyRow = row.creator == me.id\nvar viewable = rank >= 5 || me.isAdmin();\nbuf.push(\"<tr\" + (jade.attrs({ 'data-player-id':(row.creator), 'data-session-id':(row.session), 'title':(viewable ? \"View solution\" : \"Can't view top 5 solutions\"), \"class\": [(isMyRow ? \"success\" : \"\" + (viewable ? \" viewable\" : \"\"))] }, {\"class\":true,\"data-player-id\":true,\"data-session-id\":true,\"title\":true})) + \"><td class=\\\"rank-cell\\\">\" + (jade.escape(null == (jade.interp = rank + 1) ? \"\" : jade.interp)) + \"</td><td\" + (jade.attrs({ 'style':(\"background-image: url(/images/common/code_languages/\" + (row.codeLanguage) + \"_small.png)\"), 'title':(_.string.capitalize(row.codeLanguage)), \"class\": [('code-language-cell')] }, {\"style\":true,\"title\":true})) + \"></td><td\" + (jade.attrs({ 'style':(\"background-image: url(/file/db/thang.type/\" + (row.hero) + \"/portrait.png)\"), \"class\": [('hero-portrait-cell')] }, {\"style\":true})) + \"></td><td class=\\\"name-col-cell\\\">\" + (jade.escape(null == (jade.interp = row.creatorName || \"Anonymous\") ? \"\" : jade.interp)) + \"</td><td class=\\\"score-cell\\\">\" + (jade.escape(null == (jade.interp = row.score) ? \"\" : jade.interp)) + \"</td><td class=\\\"ago-cell\\\">\" + (jade.escape(null == (jade.interp = row.ago) ? \"\" : jade.interp)) + \"</td><td class=\\\"viewable-cell\\\">\");\nif ( viewable)\n{\nif ( (me.get('preferredLanguage', true) || 'en-US').substr(0, 2) == 'en')\n{\nbuf.push(\"<div class=\\\"btn btn-xs btn-info\\\">Watch</div>\");\n}\nelse\n{\nbuf.push(\"<div class=\\\"glyphicon glyphicon-eye-open\\\"></div>\");\n}\n}\nelse\n{\nbuf.push(\"<div class=\\\"glyphicon glyphicon-eye-close\\\"></div>\");\n}\nbuf.push(\"</td></tr>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</tbody></table>\");\n}\nelse if ( loading)\n{\nbuf.push(\"<h3 data-i18n=\\\"common.loading\\\"></h3>\");\n}\nelse\n{\nbuf.push(\"<h3>No scores yet.</h3>\");\n};return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","CocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/play/modal/leaderboard-tab-view'\r\nCocoCollection = require 'collections/CocoCollection'\r\nLevelSession = require 'models/LevelSession'\r\n\r\nclass TopScoresCollection extends CocoCollection\r\n  url: ''\r\n  model: LevelSession\r\n\r\n  constructor: (@level, @scoreType, @timespan) ->\r\n    super()\r\n    @url = \"/db/level/#{@level.get('original')}/top_scores/#{@scoreType}/#{@timespan}\"\r\n\r\nmodule.exports = class LeaderboardTabView extends CocoView\r\n  template: template\r\n  className: 'leaderboard-tab-view'\r\n\r\n  events:\r\n    'click tbody tr.viewable': 'onClickRow'\r\n\r\n  constructor: (options) ->\r\n    super options\r\n    @level = @options.level\r\n    @scoreType = @options.scoreType ? 'time'\r\n    @timespan = @options.timespan\r\n\r\n  destroy: ->\r\n    super()\r\n\r\n  getRenderData: ->\r\n    c = super()\r\n    c.scoreType = @scoreType\r\n    c.timespan = @timespan\r\n    c.topScores = @formatTopScores()\r\n    c.loading = not @sessions or @sessions.loading\r\n    c._ = _\r\n    c\r\n\r\n  afterRender: ->\r\n    super()\r\n\r\n  formatTopScores: ->\r\n    return [] unless @sessions?.models\r\n    rows = []\r\n    for s in @sessions.models\r\n      row = {}\r\n      score = _.find s.get('state').topScores, type: @scoreType\r\n      row.ago = moment(new Date(score.date)).fromNow()\r\n      row.score = @formatScore score\r\n      row.creatorName = s.get 'creatorName'\r\n      row.creator = s.get 'creator'\r\n      row.session = s.id\r\n      row.codeLanguage = s.get 'codeLanguage'\r\n      row.hero = s.get('heroConfig')?.thangType\r\n      row.inventory = s.get('heroConfig')?.inventory\r\n      rows.push row\r\n    rows\r\n\r\n  formatScore: (score) ->\r\n    switch score.type\r\n      when 'time' then -score.score.toFixed(2) + 's'\r\n      when 'damage-taken' then -Math.round score.score\r\n      when 'damage-dealt', 'gold-collected', 'difficulty' then Math.round score.score\r\n      else score.score\r\n\r\n  onShown: ->\r\n    return if @hasShown\r\n    @hasShown = true\r\n    topScores = new TopScoresCollection @level, @scoreType, @timespan\r\n    @sessions = @supermodel.loadCollection(topScores, 'sessions', {cache: false}, 0).model\r\n\r\n  onClickRow: (e) ->\r\n    sessionID = $(e.target).closest('tr').data 'session-id'\r\n    url = \"/play/level/#{@level.get('slug')}?session=#{sessionID}&observing=true\"\r\n    window.open url, '_blank'\r\n"]}