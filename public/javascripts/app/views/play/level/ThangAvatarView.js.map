{"version":3,"sources":["app/views/play/level/ThangAvatarView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/ThangAvatarView.js","sourcesContent":["CocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/play/level/thang_avatar'\r\nThangType = require 'models/ThangType'\r\n\r\nmodule.exports = class ThangAvatarView extends CocoView\r\n  className: 'thang-avatar-view'\r\n  template: template\r\n\r\n  subscriptions:\r\n    'tome:problems-updated': 'onProblemsUpdated'\r\n    'god:new-world-created': 'onNewWorld'\r\n\r\n  constructor: (options) ->\r\n    super options\r\n    @thang = options.thang\r\n    @includeName = options.includeName\r\n    @thangType = @getSpriteThangType()\r\n    if not @thangType\r\n      console.error 'Thang avatar view expected a thang type to be provided.'\r\n      return\r\n\r\n    unless @thangType.isFullyLoaded() or @thangType.loading\r\n      @thangType.fetch()\r\n\r\n    # couldn't get the level view to load properly through the supermodel\r\n    # so just doing it manually this time.\r\n    @listenTo @thangType, 'sync', @render\r\n    @listenTo @thangType, 'build-complete', @render\r\n\r\n  getSpriteThangType: ->\r\n    thangs = @supermodel.getModels(ThangType)\r\n    thangs = (t for t in thangs when t.get('name') is @thang.spriteName)\r\n    loadedThangs = (t for t in thangs when t.isFullyLoaded())\r\n    return loadedThangs[0] or thangs[0] # try to return one with all the goods, otherwise a projection\r\n\r\n  getRenderData: (context={}) ->\r\n    context = super context\r\n    context.thang = @thang\r\n    options = @thang?.getLankOptions() or {}\r\n    #options.async = true  # sync builds fail during async builds, and we build HUD version sync\r\n    context.avatarURL = @thangType.getPortraitSource(options) unless @thangType.loading\r\n    context.includeName = @includeName\r\n    context\r\n\r\n  setProblems: (problemCount, level) ->\r\n    badge = @$el.find('.badge.problems').text(if problemCount then 'x' else '')\r\n    badge.removeClass('error warning info')\r\n    badge.addClass level if level\r\n\r\n  setSharedThangs: (sharedThangCount) ->\r\n    badge = @$el.find('.badge.shared-thangs').text(if sharedThangCount > 1 then sharedThangCount else '')\r\n    # TODO: change the alert color based on whether any of those things that aren't us have problems\r\n    #badge.removeClass('error warning info')\r\n    #badge.addClass level if level\r\n\r\n  setSelected: (selected) ->\r\n    @$el.toggleClass 'selected', Boolean(selected)\r\n\r\n  onProblemsUpdated: (e) ->\r\n    return unless @thang?.id is e.spell.thang?.thang.id\r\n    aether = e.spell.thang.castAether\r\n    myProblems = aether?.getAllProblems() ? []\r\n    worstLevel = null\r\n    for level in ['error', 'warning', 'info'] when _.some myProblems, {level: level}\r\n      worstLevel = level\r\n      break\r\n    @setProblems myProblems.length, worstLevel\r\n\r\n  onNewWorld: (e) ->\r\n    @options.thang = @thang = e.world.thangMap[@thang.id] if @thang and e.world.thangMap[@thang.id]\r\n\r\n  destroy: ->\r\n    super()\r\n"]}