{"version":3,"sources":["app/views/play/level/LevelLoadingView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/LevelLoadingView.js","sourcesContent":["CocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/play/level/level_loading'\r\nace = require 'ace'\r\nutils = require 'core/utils'\r\nSubscribeModal = require 'views/core/SubscribeModal'\r\n\r\nmodule.exports = class LevelLoadingView extends CocoView\r\n  id: 'level-loading-view'\r\n  template: template\r\n\r\n  events:\r\n    'mousedown .start-level-button': 'startUnveiling'  # Split into two for animation smoothness.\r\n    'click .start-level-button': 'onClickStartLevel'\r\n    'click .start-subscription-button': 'onClickStartSubscription'\r\n\r\n  subscriptions:\r\n    'level:loaded': 'onLevelLoaded'  # If Level loads after level loading view.\r\n    'level:session-loaded': 'onSessionLoaded'\r\n    'level:subscription-required': 'onSubscriptionRequired'  # If they'd need a subscription to start playing.\r\n    'level:course-membership-required': 'onCourseMembershipRequired'  # If they'd need a subscription to start playing.\r\n    'subscribe-modal:subscribed': 'onSubscribed'\r\n\r\n  shortcuts:\r\n    'enter': 'onEnterPressed'\r\n\r\n  afterRender: ->\r\n    super()\r\n    unless @level?.get('loadingTip')\r\n      @$el.find('.tip.rare').remove() if _.random(1, 10) < 9\r\n      tips = @$el.find('.tip').addClass('to-remove')\r\n      tip = _.sample(tips)\r\n      $(tip).removeClass('to-remove').addClass('secret')\r\n      @$el.find('.to-remove').remove()\r\n    @onLevelLoaded level: @options.level if @options.level?.get('goals')  # If Level was already loaded.\r\n    @configureACEEditors()\r\n\r\n  configureACEEditors: ->\r\n    codeLanguage = @session?.get('codeLanguage') or me.get('aceConfig')?.language or 'python'\r\n    oldEditor.destroy() for oldEditor in @aceEditors ? []\r\n    @aceEditors = []\r\n    aceEditors = @aceEditors\r\n    @$el.find('pre:has(code[class*=\"lang-\"])').each ->\r\n      aceEditor = utils.initializeACE @, codeLanguage\r\n      aceEditors.push aceEditor\r\n\r\n  afterInsert: ->\r\n    super()\r\n\r\n  onLevelLoaded: (e) ->\r\n    return if @level\r\n    @level = e.level\r\n    @prepareGoals e\r\n    @prepareTip()\r\n    @prepareIntro()\r\n\r\n  onSessionLoaded: (e) ->\r\n    return if @session\r\n    @session = e.session if e.session.get('creator') is me.id\r\n\r\n  prepareGoals: (e) ->\r\n    goalContainer = @$el.find('.level-loading-goals')\r\n    goalList = goalContainer.find('ul')\r\n    goalCount = 0\r\n    for goalID, goal of @level.get('goals') when (not goal.team or goal.team is (e.team or 'humans')) and not goal.hiddenGoal\r\n      continue if goal.optional and @level.isType('course')\r\n      name = utils.i18n goal, 'name'\r\n      goalList.append $('<li>').text(name)\r\n      ++goalCount\r\n    if goalCount\r\n      goalContainer.removeClass('secret')\r\n      if goalCount is 1\r\n        goalContainer.find('.panel-heading').text $.i18n.t 'play_level.goal'  # Not plural\r\n\r\n  prepareTip: ->\r\n    tip = @$el.find('.tip')\r\n    if @level.get('loadingTip')\r\n      loadingTip = utils.i18n @level.attributes, 'loadingTip'\r\n      loadingTip = marked(loadingTip)\r\n      tip.html(loadingTip).removeAttr('data-i18n')\r\n    tip.removeClass('secret')\r\n\r\n  prepareIntro: ->\r\n    @docs = @level.get('documentation') ? {}\r\n    specific = @docs.specificArticles or []\r\n    @intro = _.find specific, name: 'Intro'\r\n    if window.serverConfig.picoCTF\r\n      @intro ?= body: ''\r\n\r\n  showReady: ->\r\n    return if @shownReady\r\n    @shownReady = true\r\n    _.delay @finishShowingReady, 100  # Let any blocking JS hog the main thread before we show that we're done.\r\n\r\n  finishShowingReady: =>\r\n    return if @destroyed\r\n    showIntro = @getQueryVariable('intro')\r\n    autoUnveil = not showIntro and (@options.autoUnveil or @session?.get('state').complete)\r\n    if autoUnveil\r\n      @startUnveiling()\r\n      @unveil true\r\n    else\r\n      @playSound 'level_loaded', 0.75  # old: loading_ready\r\n      @$el.find('.progress').hide()\r\n      @$el.find('.start-level-button').show()\r\n      @unveil false\r\n\r\n  startUnveiling: (e) ->\r\n    @playSound 'menu-button-click'\r\n    @unveiling = true\r\n    Backbone.Mediator.publish 'level:loading-view-unveiling', {}\r\n    _.delay @onClickStartLevel, 1000  # If they never mouse-up for the click (or a modal shows up and interrupts the click), do it anyway.\r\n\r\n  onClickStartLevel: (e) =>\r\n    return if @destroyed\r\n    @unveil true\r\n\r\n  onEnterPressed: (e) ->\r\n    return unless @shownReady and not @unveiled\r\n    @startUnveiling()\r\n    @onClickStartLevel()\r\n\r\n  unveil: (full) ->\r\n    return if @destroyed or @unveiled\r\n    @unveiled = full\r\n    @$loadingDetails = @$el.find('#loading-details')\r\n    duration = parseFloat(@$loadingDetails.css 'transition-duration') * 1000\r\n    unless @$el.hasClass 'unveiled'\r\n      @$el.addClass 'unveiled'\r\n      @unveilWings duration\r\n    if full\r\n      @unveilLoadingFull()\r\n      _.delay @onUnveilEnded, duration\r\n    else\r\n      @unveilLoadingPreview duration\r\n\r\n  unveilLoadingFull: ->\r\n    # Get rid of the loading details screen entirely--the level is totally ready.\r\n    unless @unveiling\r\n      Backbone.Mediator.publish 'level:loading-view-unveiling', {}\r\n      @unveiling = true\r\n    if @$el.hasClass 'preview-screen'\r\n      @$loadingDetails.css 'right', -@$loadingDetails.outerWidth(true)\r\n    else\r\n      @$loadingDetails.css 'top', -@$loadingDetails.outerHeight(true)\r\n    @$el.removeClass 'preview-screen'\r\n    $('#canvas-wrapper').removeClass 'preview-overlay'\r\n\r\n  unveilLoadingPreview: (duration) ->\r\n    # Move the loading details screen over the code editor to preview the level.\r\n    return if @$el.hasClass 'preview-screen'\r\n    $('#canvas-wrapper').addClass 'preview-overlay'\r\n    @$el.addClass('preview-screen')\r\n    @$loadingDetails.addClass('preview')\r\n    @resize()\r\n    @onWindowResize = _.debounce @onWindowResize, 700  # Wait a bit for other views to resize before we resize\r\n    $(window).on 'resize', @onWindowResize\r\n    if @intro\r\n      @$el.find('.progress-or-start-container').addClass('intro-footer')\r\n      @$el.find('#tip-wrapper').remove()\r\n      _.delay @unveilIntro, duration\r\n\r\n  resize: ->\r\n    maxHeight = $('#page-container').outerHeight(true)\r\n    minHeight = $('#code-area').outerHeight(true)\r\n    minHeight -= 20\r\n    @$el.css height: maxHeight\r\n    @$loadingDetails.css minHeight: minHeight, maxHeight: maxHeight\r\n    if @intro\r\n      $intro = @$el.find('.intro-doc')\r\n      $intro.css height: minHeight - $intro.offset().top - @$el.find('.progress-or-start-container').outerHeight() - 30 - 20\r\n      _.defer -> $intro.find('.nano').nanoScroller alwaysVisible: true\r\n\r\n  unveilWings: (duration) ->\r\n    @playSound 'loading-view-unveil', 0.5\r\n    @$el.find('.left-wing').css left: '-100%', backgroundPosition: 'right -400px top 0'\r\n    @$el.find('.right-wing').css right: '-100%', backgroundPosition: 'left -400px top 0'\r\n    $('#level-footer-background').detach().appendTo('#page-container').slideDown(duration) unless @level?.isType('web-dev')\r\n\r\n  unveilIntro: =>\r\n    return if @destroyed or not @intro or @unveiled\r\n    if window.serverConfig.picoCTF and problem = @level.picoCTFProblem\r\n      html = marked \"\"\"\r\n        ### #{problem.name}\r\n\r\n        #{@intro.body}\r\n\r\n        #{problem.description}\r\n\r\n        #{problem.category} - #{problem.score} points\r\n      \"\"\", sanitize: false\r\n    else\r\n      language = @session?.get('codeLanguage')\r\n      html = marked utils.filterMarkdownCodeLanguages(utils.i18n(@intro, 'body'), language)\r\n    @$el.find('.intro-doc').removeClass('hidden').find('.intro-doc-content').html html\r\n    @resize()\r\n    @configureACEEditors()\r\n\r\n  onUnveilEnded: =>\r\n    return if @destroyed\r\n    Backbone.Mediator.publish 'level:loading-view-unveiled', view: @\r\n\r\n  onWindowResize: (e) =>\r\n    return if @destroyed\r\n    @$loadingDetails.css transition: 'none'\r\n    @resize()\r\n\r\n  onSubscriptionRequired: (e) ->\r\n    @$el.find('.level-loading-goals, .tip, .load-progress').hide()\r\n    @$el.find('.subscription-required').show()\r\n\r\n  onCourseMembershipRequired: (e) ->\r\n    @$el.find('.level-loading-goals, .tip, .load-progress').hide()\r\n    @$el.find('.course-membership-required').show()\r\n\r\n  onLoadError: (resource) ->\r\n    @$el.find('.level-loading-goals, .tip, .load-progress').hide()\r\n    @$el.find('.could-not-load').show()\r\n\r\n  onClickStartSubscription: (e) ->\r\n    @openModalView new SubscribeModal()\r\n    levelSlug = @level?.get('slug') or @options.level?.get('slug')\r\n    # TODO: Added levelID on 2/9/16. Remove level property and associated AnalyticsLogEvent 'properties.level' index later.\r\n    window.tracker?.trackEvent 'Show subscription modal', category: 'Subscription', label: 'level loading', level: levelSlug, levelID: levelSlug\r\n\r\n  onSubscribed: ->\r\n    document.location.reload()\r\n\r\n  destroy: ->\r\n    $(window).off 'resize', @onWindowResize\r\n    super()\r\n"]}