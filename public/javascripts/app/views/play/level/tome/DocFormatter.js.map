{"version":3,"sources":["app/views/play/level/tome/DocFormatter.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/tome/DocFormatter.js","sourcesContent":["popoverTemplate = require 'templates/play/level/tome/spell_palette_entry_popover'\r\n{downTheChain} = require 'lib/world/world_utils'\r\nwindow.Vector = require 'lib/world/vector'  # So we can document it\r\nutils = require 'core/utils'\r\n\r\nsafeJSONStringify = (input, maxDepth) ->\r\n  recursion = (input, path, depth) ->\r\n    output = {}\r\n    pPath = undefined\r\n    refIdx = undefined\r\n    path = path or ''\r\n    depth = depth or 0\r\n    depth++\r\n    return '{depth over ' + maxDepth + '}' if maxDepth and depth > maxDepth\r\n    for p of input\r\n      pPath = ((if path then (path + '.') else '')) + p\r\n      if typeof input[p] is 'function'\r\n        output[p] = '{function}'\r\n      else if typeof input[p] is 'object'\r\n        refIdx = refs.indexOf(input[p])\r\n        if -1 isnt refIdx\r\n          output[p] = '{reference to ' + refsPaths[refIdx] + '}'\r\n        else\r\n          refs.push input[p]\r\n          refsPaths.push pPath\r\n          output[p] = recursion(input[p], pPath, depth)\r\n      else\r\n        output[p] = input[p]\r\n    output\r\n  refs = []\r\n  refsPaths = []\r\n  maxDepth = maxDepth or 5\r\n  if typeof input is 'object'\r\n    output = recursion(input)\r\n  else\r\n    output = input\r\n  JSON.stringify output, null, 1\r\n\r\nmodule.exports = class DocFormatter\r\n  constructor: (@options) ->\r\n    @doc = _.cloneDeep @options.doc\r\n    @fillOutDoc()\r\n\r\n  fillOutDoc: ->\r\n    # TODO: figure out better ways to format html/css/scripting docs for web-dev levels\r\n    if _.isString @doc\r\n      @doc = name: @doc, type: typeof @options.thang[@doc]\r\n    if @options.isSnippet\r\n      @doc.type = 'snippet'\r\n      @doc.owner = 'snippets'\r\n      @doc.shortName = @doc.shorterName = @doc.title = @doc.name\r\n    else if @doc.owner in ['HTML', 'CSS', 'WebJavaScript', 'jQuery']\r\n      @doc.shortName = @doc.shorterName = @doc.title = @doc.name\r\n    else\r\n      @doc.owner ?= 'this'\r\n      ownerName = @doc.ownerName = if @doc.owner isnt 'this' then @doc.owner else switch @options.language\r\n        when 'python', 'lua' then (if @options.useHero then 'hero' else 'self')\r\n        when 'java' then 'hero'\r\n        when 'coffeescript' then '@'\r\n        else (if @options.useHero then 'hero' else 'this')\r\n      ownerName = 'game' if @options.level.isType('game-dev')\r\n      if @doc.type is 'function'\r\n        [docName, args] = @getDocNameAndArguments()\r\n        argNames = args.join ', '\r\n        argString = if argNames then '__ARGS__' else ''\r\n        @doc.shortName = switch @options.language\r\n          when 'coffeescript' then \"#{ownerName}#{if ownerName is '@' then '' else '.'}#{docName}#{if argString then ' ' + argString else '()'}\"\r\n          when 'python' then \"#{ownerName}.#{docName}(#{argString})\"\r\n          when 'lua' then \"#{ownerName}:#{docName}(#{argString})\"\r\n          else \"#{ownerName}.#{docName}(#{argString});\"\r\n      else\r\n        @doc.shortName = switch @options.language\r\n          when 'coffeescript' then \"#{ownerName}#{if ownerName is '@' then '' else '.'}#{@doc.name}\"\r\n          when 'python' then \"#{ownerName}.#{@doc.name}\"\r\n          when 'lua' then \"#{ownerName}.#{@doc.name}\"\r\n          else \"#{ownerName}.#{@doc.name};\"\r\n      @doc.shorterName = @doc.shortName\r\n      if @doc.type is 'function' and argString\r\n        @doc.shortName = @doc.shorterName.replace argString, argNames\r\n        @doc.shorterName = @doc.shorterName.replace argString, (if not /cast[A-Z]/.test(@doc.name) and argNames.length > 6 then '...' else argNames)\r\n      if @doc.type is 'event'\r\n        @doc.shortName = @doc.name\r\n        @doc.shorterName = @doc.name\r\n      if @options.language is 'javascript'\r\n        @doc.shorterName = @doc.shortName.replace ';', ''\r\n        if @doc.owner is 'this' or @options.tabbify or ownerName is 'game'\r\n          @doc.shorterName = @doc.shorterName.replace /^(this|hero)\\./, ''\r\n      else if (@options.language in ['python', 'lua']) and (@doc.owner is 'this' or @options.tabbify or ownerName is 'game')\r\n        @doc.shorterName = @doc.shortName.replace /^(self|hero|game)[:.]/, ''\r\n      @doc.title = if @options.shortenize then @doc.shorterName else @doc.shortName\r\n      translatedName = utils.i18n(@doc, 'name')\r\n      if translatedName isnt @doc.name\r\n        @doc.translatedShortName = @doc.shortName.replace(@doc.name, translatedName)\r\n\r\n\r\n    # Grab the language-specific documentation for some sub-properties, if we have it.\r\n    toTranslate = [{obj: @doc, prop: 'description'}, {obj: @doc, prop: 'example'}]\r\n    for arg in (@doc.args ? [])\r\n      toTranslate.push {obj: arg, prop: 'example'}, {obj: arg, prop: 'description'}\r\n    if @doc.returns\r\n      toTranslate.push {obj: @doc.returns, prop: 'example'}, {obj: @doc.returns, prop: 'description'}\r\n    for {obj, prop} in toTranslate\r\n      # Translate into chosen code language.\r\n      if val = obj[prop]?[@options.language]\r\n        obj[prop] = val\r\n      else unless _.isString obj[prop]\r\n        obj[prop] = null\r\n\r\n      # Translate into chosen spoken language.\r\n      if val = originalVal = obj[prop]\r\n        context = @doc.context\r\n        obj[prop] = val = utils.i18n obj, prop\r\n        # For multiplexed-by-both-code-and-spoken-language objects, now also get code language again.\r\n        if _.isObject(val)\r\n          if valByCodeLanguage = obj[prop]?[@options.language]\r\n            obj[prop] = val = valByCodeLanguage\r\n          else\r\n            obj[prop] = originalVal  # Never mind, we don't have that code language for that spoken language.\r\n        if @doc.i18n\r\n          spokenLanguage = me.get 'preferredLanguage'\r\n          while spokenLanguage\r\n            spokenLanguage = spokenLanguage.substr 0, spokenLanguage.lastIndexOf('-') if fallingBack?\r\n            if spokenLanguageContext = @doc.i18n[spokenLanguage]?.context\r\n              context = _.merge context, spokenLanguageContext\r\n              break\r\n            fallingBack = true\r\n        if context\r\n          try\r\n            obj[prop] = _.template val, context\r\n          catch e\r\n            console.error \"Couldn't create docs template of\", val, \"\\nwith context\", context, \"\\nError:\", e\r\n        obj[prop] = @replaceSpriteName obj[prop]  # Do this before using the template, otherwise marked might get us first.\r\n\r\n    # Temporary hack to replace self|this with hero until we can update the docs\r\n    if @options.useHero\r\n      thisToken =\r\n        'python': /self/g,\r\n        'javascript': /this/g,\r\n        'lua': /self/g\r\n\r\n      if thisToken[@options.language]\r\n        if @doc.example\r\n          @doc.example = @doc.example.replace thisToken[@options.language], 'hero'\r\n        if @doc.snippets?[@options.language]?.code\r\n          @doc.snippets[@options.language].code.replace thisToken[@options.language], 'hero'\r\n        if @doc.args\r\n          arg.example = arg.example.replace thisToken[@options.language], 'hero' for arg in @doc.args when arg.example\r\n\r\n    if @doc.shortName is 'loop' and @options.level.isType('course', 'course-ladder')\r\n      @replaceSimpleLoops()\r\n\r\n  replaceSimpleLoops: ->\r\n    # Temporary hackery to make it look like we meant while True: in our loop: docs until we can update everything\r\n    @doc.shortName = @doc.shorterName = @doc.title = @doc.name = switch @options.language\r\n      when 'coffeescript' then \"loop\"\r\n      when 'python' then \"while True:\"\r\n      when 'lua' then \"while true do\"\r\n      else \"while (true)\"\r\n    for field in ['example', 'description']\r\n      [simpleLoop, whileLoop] = switch @options.language\r\n        when 'coffeescript' then [/loop/g, \"loop\"]\r\n        when 'python' then [/loop:/g, \"while True:\"]\r\n        when 'lua' then [/loop/g, \"while true do\"]\r\n        else [/loop/g, \"while (true)\"]\r\n      @doc[field] = @doc[field].replace simpleLoop, whileLoop\r\n\r\n  formatPopover: ->\r\n    [docName, args] = @getDocNameAndArguments()\r\n    argumentExamples = (arg.example or arg.default or arg.name for arg in @doc.args ? [])\r\n    argumentExamples.unshift args[0] if args.length > argumentExamples.length\r\n    content = popoverTemplate {\r\n      doc: @doc\r\n      docName: docName\r\n      language: @options.language\r\n      value: @formatValue()\r\n      marked: marked\r\n      argumentExamples: argumentExamples\r\n      writable: @options.writable\r\n      selectedMethod: @options.selectedMethod\r\n      cooldowns: @inferCooldowns()\r\n      item: @options.item\r\n      _: _\r\n    }\r\n    owner = if @doc.owner is 'this' then @options.thang else window[@doc.owner]\r\n    content = @replaceSpriteName content\r\n    content = content.replace /\\#\\{(.*?)\\}/g, (s, properties) => @formatValue downTheChain(owner, properties.split('.'))\r\n    content = content.replace /{([a-z]+)}([^]*?){\\/\\1}/g, (s, language, text) =>\r\n      if language is @options.language then return text\r\n      return ''\r\n\r\n  replaceSpriteName: (s) ->\r\n    # Prefer type, and excluded the quotes we'd get with @formatValue\r\n    name = @options.thang.type ? @options.thang.spriteName\r\n    name = 'hero' if /Hero Placeholder/.test @options.thang.id\r\n    s.replace /#{spriteName}/g, name\r\n\r\n  getDocNameAndArguments: ->\r\n    return [@doc.name, []] unless @doc.type is 'function'\r\n    docName = @doc.name\r\n    args = (arg.name for arg in @doc.args ? [])\r\n    if /cast[A-Z]/.test docName\r\n      docName = 'cast'\r\n      args.unshift '\"' + _.string.dasherize(@doc.name).replace('cast-', '') + '\"'\r\n    [docName, args]\r\n\r\n  formatValue: (v) ->\r\n    return null if @options.level.isType('web-dev')\r\n    return null if @doc.type is 'snippet'\r\n    return @options.thang.now() if @doc.name is 'now'\r\n    return '[Function]' if not v and @doc.type is 'function'\r\n    unless v?\r\n      if @doc.owner is 'this'\r\n        v = @options.thang[@doc.name]\r\n      else\r\n        v = window[@doc.owner][@doc.name]  # grab Math or Vector\r\n    if @doc.type is 'number' and not _.isNaN v\r\n      if v is Math.round v\r\n        return v\r\n      if _.isNumber v\r\n        return v.toFixed 2\r\n      unless v\r\n        return 'null'\r\n      return '' + v\r\n    if _.isString v\r\n      return \"\\\"#{v}\\\"\"\r\n    if v?.id\r\n      return v.id\r\n    if v?.name\r\n      return v.name\r\n    if _.isArray v\r\n      return '[' + (@formatValue v2 for v2 in v).join(', ') + ']'\r\n    if _.isPlainObject v\r\n      return safeJSONStringify v, 2\r\n    v\r\n\r\n  inferCooldowns: ->\r\n    return null unless @doc.type is 'function' and @doc.owner is 'this'\r\n    owner = @options.thang\r\n    cooldowns = null\r\n    spellName = @doc.name.match /^cast(.+)$/\r\n    if spellName\r\n      actionName = _.string.slugify _.string.underscored spellName[1]\r\n      action = owner.spells?[actionName]\r\n      type = 'spell'\r\n    else\r\n      actionName = _.string.slugify _.string.underscored @doc.name\r\n      action = owner.actions?[actionName]\r\n      type = 'action'\r\n    return null unless action\r\n    cooldowns = cooldown: action.cooldown, specificCooldown: action.specificCooldown, name: actionName, type: type\r\n    for prop in ['range', 'radius', 'duration', 'damage']\r\n      v = owner[_.string.camelize actionName + _.string.capitalize(prop)]\r\n      continue if prop is 'range' and v <= 5  # Don't confuse players by showing melee ranges, they will inappropriately use distanceTo(enemy) < 3.\r\n      cooldowns[prop] = v\r\n      if _.isNumber(v) and v isnt Math.round v\r\n        cooldowns[prop] = v.toFixed 2\r\n    cooldowns\r\n"]}