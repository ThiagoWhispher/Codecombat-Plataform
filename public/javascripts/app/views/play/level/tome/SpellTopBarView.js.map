{"version":3,"sources":["app/templates/play/level/tome/spell-top-bar-view.jade","app/views/play/level/tome/SpellTopBarView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/tome/SpellTopBarView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),features = locals_.features,me = locals_.me,maximizeShortcutVerbose = locals_.maximizeShortcutVerbose,codeLanguage = locals_.codeLanguage,beautifyShortcutVerbose = locals_.beautifyShortcutVerbose,view = locals_.view,i18nName = locals_.i18nName,translate = locals_.translate;if ( features.codePlay)\n{\nbuf.push(\"<img id=\\\"codeplay-powered-by-banner\\\" src=\\\"/images/common/codeplay/CodePlay.png\\\"/>\");\n}\nbuf.push(\"<div class=\\\"hinge hinge-0\\\"></div><div class=\\\"hinge hinge-1\\\"></div><div class=\\\"hinge hinge-2\\\"></div><div class=\\\"hinge hinge-3\\\"></div><div class=\\\"spell-tool-buttons\\\"><div data-i18n=\\\"[title]play_level.tome_reload_method\\\" class=\\\"btn btn-small btn-illustrated btn-warning reload-code\\\"><div class=\\\"glyphicon glyphicon-repeat\\\"></div>\");\nif ( !features.codePlay)\n{\nbuf.push(\"<span data-i18n=\\\"play_level.restart\\\" class=\\\"spl\\\"></span>\");\n}\nbuf.push(\"</div>\");\nif ( me.level() >= 15)\n{\nbuf.push(\"<div\" + (jade.attrs({ 'title':(maximizeShortcutVerbose), \"class\": [('btn'),('btn-small'),('btn-illustrated'),('fullscreen-code')] }, {\"title\":true})) + \"><div class=\\\"glyphicon glyphicon-fullscreen\\\"></div><div class=\\\"glyphicon glyphicon-resize-small\\\"></div></div>\");\n}\nif ( codeLanguage === 'javascript' && me.level() >= 15)\n{\nbuf.push(\"<div\" + (jade.attrs({ 'title':(beautifyShortcutVerbose), \"class\": [('btn'),('btn-small'),('btn-illustrated'),('beautify-code')] }, {\"title\":true})) + \"><div class=\\\"glyphicon glyphicon-magnet\\\"></div></div>\");\n}\nif ( view.hintsState && view.hintsState.get('total') > 0)\n{\nbuf.push(\"<div class=\\\"btn btn-small btn-illustrated hints-button\\\"><span data-i18n=\\\"play_level.hints\\\"></span></div>\");\n}\nif ( view.options.level.isType('web-dev'))\n{\nbuf.push(\"<div class=\\\"btn btn-small btn-illustrated image-gallery-button\\\"><span data-i18n=\\\"web_dev.image_gallery_title\\\"></span></div>\");\n}\nif ( view.options.level.get('shareable'))\n{\ni18nName = view.options.level.isType('game-dev') ? 'sharing.game' : 'sharing.webpage'\nif ( view.options.session.isFake())\n{\nbuf.push(\"<button\" + (jade.attrs({ 'data-i18n':(i18nName), 'data-toggle':(\"popover\"), 'data-placement':(\"bottom\"), 'data-content':(translate('sharing.your_students_preview')), 'data-trigger':(\"hover\"), \"class\": [('btn'),('btn-small'),('btn-illustrated')] }, {\"data-i18n\":true,\"data-toggle\":true,\"data-placement\":true,\"data-content\":true,\"data-trigger\":true})) + \"></button>\");\n}\nelse\n{\nvar url = '/play/' + view.options.level.get('type') + '-level/' + view.options.level.get('slug') + '/' + view.options.session.id;\nif (view.options.courseID) url += '?course=' + view.options.courseID;\nbuf.push(\"<a\" + (jade.attrs({ 'href':(url), 'data-i18n':(i18nName), \"class\": [('btn'),('btn-small'),('btn-illustrated')] }, {\"href\":true,\"data-i18n\":true})) + \"></a>\");\n}\n}\nbuf.push(\"<div class=\\\"clearfix\\\"></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","template = require 'templates/play/level/tome/spell-top-bar-view'\r\nReloadLevelModal = require 'views/play/level/modal/ReloadLevelModal'\r\nCocoView = require 'views/core/CocoView'\r\nImageGalleryModal = require 'views/play/level/modal/ImageGalleryModal'\r\n\r\nmodule.exports = class SpellTopBarView extends CocoView\r\n  template: template\r\n  id: 'spell-top-bar-view'\r\n  controlsEnabled: true\r\n\r\n  subscriptions:\r\n    'level:disable-controls': 'onDisableControls'\r\n    'level:enable-controls': 'onEnableControls'\r\n    'tome:spell-loaded': 'onSpellLoaded'\r\n    'tome:spell-changed': 'onSpellChanged'\r\n    'tome:spell-changed-language': 'onSpellChangedLanguage'\r\n    'tome:toggle-maximize': 'onToggleMaximize'\r\n\r\n  events:\r\n    'click .reload-code': 'onCodeReload'\r\n    'click .beautify-code': 'onBeautifyClick'\r\n    'click .fullscreen-code': 'onToggleMaximize'\r\n    'click .hints-button': 'onClickHintsButton'\r\n    'click .image-gallery-button': 'onClickImageGalleryButton'\r\n\r\n  constructor: (options) ->\r\n    @hintsState = options.hintsState\r\n    @spell = options.spell\r\n    super(options)\r\n\r\n  getRenderData: (context={}) ->\r\n    context = super context\r\n    ctrl = if @isMac() then 'Cmd' else 'Ctrl'\r\n    shift = $.i18n.t 'keyboard_shortcuts.shift'\r\n    context.beautifyShortcutVerbose = \"#{ctrl}+#{shift}+B: #{$.i18n.t 'keyboard_shortcuts.beautify'}\"\r\n    context.maximizeShortcutVerbose = \"#{ctrl}+#{shift}+M: #{$.i18n.t 'keyboard_shortcuts.maximize_editor'}\"\r\n    context.codeLanguage = @options.codeLanguage\r\n    context\r\n\r\n  afterRender: ->\r\n    super()\r\n    @attachTransitionEventListener()\r\n    @$('[data-toggle=\"popover\"]').popover()\r\n\r\n  onDisableControls: (e) -> @toggleControls e, false\r\n  onEnableControls: (e) -> @toggleControls e, true\r\n\r\n  onClickImageGalleryButton: (e) ->\r\n    @openModalView new ImageGalleryModal()\r\n\r\n  onClickHintsButton: ->\r\n    return unless @hintsState?\r\n    @hintsState.set('hidden', not @hintsState.get('hidden'))\r\n    window.tracker?.trackEvent 'Hints Clicked', category: 'Students', levelSlug: @options.level.get('slug'), hintCount: @hintsState.get('hints')?.length ? 0, []\r\n\r\n  onCodeReload: (e) ->\r\n    if key.shift\r\n      Backbone.Mediator.publish 'level:restart', {}\r\n    else\r\n      @openModalView new ReloadLevelModal()\r\n\r\n  onBeautifyClick: (e) ->\r\n    return unless @controlsEnabled\r\n    Backbone.Mediator.publish 'tome:spell-beautify', spell: @spell\r\n\r\n  onToggleMaximize: (e) ->\r\n    $codearea = $('html')\r\n    $('#code-area').css 'z-index', 20 unless $codearea.hasClass 'fullscreen-editor'\r\n    $('html').toggleClass 'fullscreen-editor'\r\n    $('.fullscreen-code').toggleClass 'maximized'\r\n    Backbone.Mediator.publish 'tome:maximize-toggled', {}\r\n\r\n  updateReloadButton: ->\r\n    changed = @spell.hasChanged null, @spell.getSource()\r\n    @$el.find('.reload-code').css('display', if changed then 'inline-block' else 'none')\r\n\r\n  onSpellLoaded: (e) ->\r\n    return unless e.spell is @spell\r\n    @updateReloadButton()\r\n\r\n  onSpellChanged: (e) ->\r\n    return unless e.spell is @spell\r\n    @updateReloadButton()\r\n\r\n  onSpellChangedLanguage: (e) ->\r\n    return unless e.spell is @spell\r\n    @options.codeLanguage = e.language\r\n    @render()\r\n    @updateReloadButton()\r\n\r\n  toggleControls: (e, enabled) ->\r\n    return if e.controls and not ('editor' in e.controls)\r\n    return if enabled is @controlsEnabled\r\n    @controlsEnabled = enabled\r\n    @$el.toggleClass 'read-only', not enabled\r\n\r\n  attachTransitionEventListener: =>\r\n    transitionListener = ''\r\n    testEl = document.createElement 'fakeelement'\r\n    transitions =\r\n      'transition':'transitionend'\r\n      'OTransition':'oTransitionEnd'\r\n      'MozTransition':'transitionend'\r\n      'WebkitTransition':'webkitTransitionEnd'\r\n    for transition, transitionEvent of transitions\r\n      unless testEl.style[transition] is undefined\r\n        transitionListener = transitionEvent\r\n        break\r\n    $codearea = $('#code-area')\r\n    $codearea.on transitionListener, =>\r\n      $codearea.css 'z-index', 2 unless $('html').hasClass 'fullscreen-editor'\r\n\r\n  destroy: ->\r\n    super()\r\n"]}