{"version":3,"sources":["app/views/play/level/tome/SpellPaletteThangEntryView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/tome/SpellPaletteThangEntryView.js","sourcesContent":["CocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/play/level/tome/spell-palette-thang-entry'\r\npopoverTemplate = require 'templates/play/level/tome/spell_palette_entry_popover'\r\n{me} = require 'core/auth'\r\nfilters = require 'lib/image_filter'\r\nDocFormatter = require './DocFormatter'\r\nutils = require 'core/utils'\r\n\r\nmodule.exports = class SpellPaletteThangEntryView extends CocoView\r\n  tagName: 'div'  # Could also try <code> instead of <div>, but would need to adjust colors\r\n  className: 'spell-palette-thang-entry-view'\r\n  template: template\r\n \r\n  subscriptions:\r\n    'surface:frame-changed': 'onFrameChanged'\r\n    'tome:palette-hovered': 'onPaletteHovered'\r\n    'tome:palette-clicked': 'onPaletteClicked'\r\n    'tome:spell-debug-property-hovered': 'onSpellDebugPropertyHovered'\r\n\r\n  events:\r\n    'mouseenter': 'onMouseEnter'\r\n    'mouseleave': 'onMouseLeave'\r\n    'click': 'onClick'\r\n\r\n  constructor: (options) ->\r\n    super options\r\n    @thang = options.thang\r\n    if options.doc.example?\r\n      example = options.doc.example?[options.language]\r\n    else\r\n      example = \"\\# usage code \\ngame.spawnXY(\\\"#{options.buildableName}\\\", 21, 20)\"\r\n    @doc =\r\n      name: options.buildableName\r\n      initialHTML: popoverTemplate _: _, marked: marked, doc:\r\n        #shortName: @thang.get('name')\r\n        shortName: options.doc.name\r\n        type: \"spawnable\"\r\n        description: \"![#{@thang.get('name')}](#{@thang.getPortraitURL()}) #{options.doc.description}\"\r\n        example: example\r\n      example: example\r\n\r\n    #@aceEditors = []\r\n\r\n  afterRender: ->\r\n    super()\r\n    #@$el.addClass _.string.slugify @doc.type\r\n\r\n  resetPopoverContent: ->\r\n    #@$el.data('bs.popover').options.content = @docFormatter.formatPopover()\r\n    #@$el.popover('setContent')\r\n\r\n  onMouseEnter: (e) ->\r\n    return if @popoverPinned or @otherPopoverPinned\r\n    #@resetPopoverContent()\r\n    #@$el.popover 'show'\r\n\r\n  onMouseLeave: (e) ->\r\n    #@$el.popover 'hide' unless @popoverPinned or @otherPopoverPinned\r\n\r\n\r\n  onPaletteClicked: (e) =>\r\n    @$el.toggleClass('selected', e.prop is @doc.name)\r\n\r\n  onClick: (e) =>\r\n    if key.shift\r\n      Backbone.Mediator.publish 'tome:insert-snippet', doc: @options.doc, language: @options.language, formatted: @doc\r\n      return\r\n    Backbone.Mediator.publish 'tome:palette-clicked', thang: @thang, prop: @doc.name, entry: @\r\n\r\n  onFrameChanged: (e) ->\r\n    #return unless e.selectedThang?.id is @thang.id\r\n    #@options.thang = @thang = @docFormatter.options.thang = e.selectedThang  # Update our thang to the current version\r\n\r\n  onPaletteHovered: (e) ->\r\n    return if e.entry is @\r\n\r\n  onSpellDebugPropertyHovered: (e) ->\r\n    matched = e.property is @doc.name and e.owner is @doc.owner\r\n    if matched and not @debugHovered\r\n      @debugHovered = true\r\n      @togglePinned() unless @popoverPinned\r\n    else if @debugHovered and not matched\r\n      @debugHovered = false\r\n      @togglePinned() if @popoverPinned\r\n    null\r\n\r\n  destroy: ->\r\n    @$el.off()\r\n    oldEditor.destroy() for oldEditor in @aceEditors\r\n    super()\r\n"]}