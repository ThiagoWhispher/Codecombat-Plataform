{"version":3,"sources":["app/views/play/level/tome/ProblemAlertView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/tome/ProblemAlertView.js","sourcesContent":["CocoView = require 'views/core/CocoView'\r\nGameMenuModal = require 'views/play/menu/GameMenuModal'\r\ntemplate = require 'templates/play/level/tome/problem_alert'\r\n{me} = require 'core/auth'\r\n\r\nmodule.exports = class ProblemAlertView extends CocoView\r\n  id: 'problem-alert-view'\r\n  className: 'problem-alert'\r\n  template: template\r\n\r\n  subscriptions:\r\n    'tome:show-problem-alert': 'onShowProblemAlert'\r\n    'tome:hide-problem-alert': 'onHideProblemAlert'\r\n    'level:restart': 'onHideProblemAlert'\r\n    'tome:jiggle-problem-alert': 'onJiggleProblemAlert'\r\n    'tome:manual-cast': 'onHideProblemAlert'\r\n\r\n  events:\r\n    'click .close': 'onRemoveClicked'\r\n    'click': -> Backbone.Mediator.publish 'tome:focus-editor', {}\r\n\r\n  constructor: (options) ->\r\n    @supermodel = options.supermodel # Has to go before super so events are hooked up\r\n    super options\r\n    @level = options.level\r\n    @session = options.session\r\n    if options.problem?\r\n      @problem = options.problem\r\n      @onWindowResize()\r\n    else\r\n      @$el.hide()\r\n    $(window).on 'resize', @onWindowResize\r\n\r\n  destroy: ->\r\n    $(window).off 'resize', @onWindowResize\r\n    super()\r\n\r\n  afterRender: ->\r\n    super()\r\n    if @problem?\r\n      @$el.addClass('alert').addClass(\"alert-#{@problem.level}\").hide().fadeIn('slow')\r\n      @$el.addClass('no-hint') unless @problem.hint\r\n      @playSound 'error_appear'\r\n\r\n  setProblemMessage: ->\r\n    if @problem?\r\n      format = (s) -> marked(s.replace(/</g, '&lt;').replace(/>/g, '&gt;')) if s?\r\n      message = @problem.message\r\n      # Add time to problem message if hint is for a missing null check\r\n      # NOTE: This may need to be updated with Aether error hint changes\r\n      if @problem.hint? and /(?:null|undefined)/.test @problem.hint\r\n        age = @problem.userInfo?.age\r\n        if age?\r\n          if /^Line \\d+:/.test message\r\n            message = message.replace /^(Line \\d+)/, \"$1, time #{age.toFixed(1)}\"\r\n          else\r\n            message = \"Time #{age.toFixed(1)}: #{message}\"\r\n      @message = format message\r\n      @hint = format @problem.hint\r\n\r\n  onShowProblemAlert: (data) ->\r\n    return unless $('#code-area').is(\":visible\")\r\n    if @problem?\r\n      if @$el.hasClass \"alert-#{@problem.level}\"\r\n        @$el.removeClass \"alert-#{@problem.level}\"\r\n      if @$el.hasClass \"no-hint\"\r\n        @$el.removeClass \"no-hint\"\r\n    @problem = data.problem\r\n    @lineOffsetPx = data.lineOffsetPx or 0\r\n    @$el.show()\r\n    @onWindowResize()\r\n    @setProblemMessage()\r\n    @render()\r\n    @onJiggleProblemAlert()\r\n    application.tracker?.trackEvent 'Show problem alert', {levelID: @level.get('slug'), ls: @session?.get('_id')}\r\n\r\n  onJiggleProblemAlert: ->\r\n    return unless @problem?\r\n    @$el.show() unless @$el.is(\":visible\")\r\n    @$el.addClass 'jiggling'\r\n    @playSound 'error_appear'\r\n    pauseJiggle = =>\r\n      @$el?.removeClass 'jiggling'\r\n    _.delay pauseJiggle, 1000\r\n\r\n  onHideProblemAlert: ->\r\n    return unless @$el.is(':visible')\r\n    @onRemoveClicked()\r\n\r\n  onRemoveClicked: ->\r\n    @playSound 'menu-button-click'\r\n    @$el.hide()\r\n    Backbone.Mediator.publish 'tome:focus-editor', {}\r\n\r\n  onWindowResize: (e) =>\r\n    # TODO: This all seems a little hacky\r\n    if @problem?\r\n      levelContentWidth = $('.level-content').outerWidth(true)\r\n      goalsViewWidth = $('#goals-view').outerWidth(true)\r\n      codeAreaWidth = $('#code-area').outerWidth(true)\r\n      # problem alert view has 20px padding\r\n      @$el.css('max-width', levelContentWidth - codeAreaWidth - goalsViewWidth + 40 + 'px')\r\n      @$el.css('right', codeAreaWidth + 'px')\r\n\r\n      # 110px from top roughly aligns top of alert with top of first code line\r\n      # TODO: calculate this in a more dynamic, less sketchy way\r\n      @$el.css('top', (110 + @lineOffsetPx) + 'px')\r\n"]}