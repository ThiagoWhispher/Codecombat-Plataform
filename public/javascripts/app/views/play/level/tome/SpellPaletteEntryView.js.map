{"version":3,"sources":["app/views/play/level/tome/SpellPaletteEntryView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/tome/SpellPaletteEntryView.js","sourcesContent":["CocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/play/level/tome/spell_palette_entry'\r\n{me} = require 'core/auth'\r\nfilters = require 'lib/image_filter'\r\nDocFormatter = require './DocFormatter'\r\nace = require 'ace'\r\nutils = require 'core/utils'\r\n\r\nmodule.exports = class SpellPaletteEntryView extends CocoView\r\n  tagName: 'div'  # Could also try <code> instead of <div>, but would need to adjust colors\r\n  className: 'spell-palette-entry-view'\r\n  template: template\r\n  popoverPinned: false\r\n  overridePopoverTemplate: '<div class=\"popover spell-palette-popover\" role=\"tooltip\"><div class=\"arrow\"></div><h3 class=\"popover-title\"></h3><div class=\"popover-content\"></div></div>'\r\n\r\n  subscriptions:\r\n    'surface:frame-changed': 'onFrameChanged'\r\n    'tome:palette-hovered': 'onPaletteHovered'\r\n    'tome:palette-clicked': 'onPaletteClicked'\r\n    'tome:palette-pin-toggled': 'onPalettePinToggled'\r\n    'tome:spell-debug-property-hovered': 'onSpellDebugPropertyHovered'\r\n\r\n  events:\r\n    'mouseenter': 'onMouseEnter'\r\n    'mouseleave': 'onMouseLeave'\r\n    'click': 'onClick'\r\n\r\n  constructor: (options) ->\r\n    super options\r\n    @thang = options.thang\r\n    @docFormatter = new DocFormatter options\r\n    @doc = @docFormatter.doc\r\n    @doc.initialHTML = @docFormatter.formatPopover()\r\n    @aceEditors = []\r\n\r\n  afterRender: ->\r\n    super()\r\n    @$el.addClass _.string.slugify @doc.type\r\n\r\n  resetPopoverContent: ->\r\n    #@$el.data('bs.popover').options.content = @docFormatter.formatPopover()\r\n    #@$el.popover('setContent')\r\n\r\n  onMouseEnter: (e) ->\r\n    return if @popoverPinned or @otherPopoverPinned\r\n    #@resetPopoverContent()\r\n    #@$el.popover 'show'\r\n\r\n  onMouseLeave: (e) ->\r\n    #@$el.popover 'hide' unless @popoverPinned or @otherPopoverPinned\r\n\r\n  togglePinned: ->\r\n    if @popoverPinned\r\n      @popoverPinned = false\r\n      @$el.add('.spell-palette-popover.popover').removeClass 'pinned'\r\n      $('.spell-palette-popover.popover .close').remove()\r\n      @$el.popover 'hide'\r\n      @playSound 'spell-palette-entry-unpin'\r\n    else\r\n      @popoverPinned = true\r\n      @resetPopoverContent()\r\n      @$el.add('.spell-palette-popover.popover').addClass 'pinned'\r\n      @$el.popover 'show'\r\n      x = $('<button type=\"button\" data-dismiss=\"modal\" aria-hidden=\"true\" class=\"close\">Ã—</button>')\r\n      $('.spell-palette-popover.popover').append x\r\n      x.on 'click', @onClick\r\n      @playSound 'spell-palette-entry-pin'\r\n    Backbone.Mediator.publish 'tome:palette-pin-toggled', entry: @, pinned: @popoverPinned\r\n\r\n  onPaletteClicked: (e) =>\r\n    @$el.toggleClass('selected', e.prop is @doc.name)\r\n\r\n  onClick: (e) =>\r\n    if key.shift\r\n      Backbone.Mediator.publish 'tome:insert-snippet', doc: @options.doc, language: @options.language, formatted: @doc\r\n      return\r\n    #@togglePinned()\r\n    Backbone.Mediator.publish 'tome:palette-clicked', thang: @thang, prop: @doc.name, entry: @\r\n\r\n  onFrameChanged: (e) ->\r\n    return unless e.selectedThang?.id is @thang.id\r\n    @options.thang = @thang = @docFormatter.options.thang = e.selectedThang  # Update our thang to the current version\r\n\r\n  onPaletteHovered: (e) ->\r\n    return if e.entry is @\r\n    @togglePinned() if @popoverPinned\r\n\r\n  onPalettePinToggled: (e) ->\r\n    return if e.entry is @\r\n    @otherPopoverPinned = e.pinned\r\n\r\n  onSpellDebugPropertyHovered: (e) ->\r\n    matched = e.property is @doc.name and e.owner is @doc.owner\r\n    if matched and not @debugHovered\r\n      @debugHovered = true\r\n      @togglePinned() unless @popoverPinned\r\n    else if @debugHovered and not matched\r\n      @debugHovered = false\r\n      @togglePinned() if @popoverPinned\r\n    null\r\n\r\n  destroy: ->\r\n    $('.popover.pinned').remove() if @popoverPinned  # @$el.popover('destroy') doesn't work\r\n    @togglePinned() if @popoverPinned\r\n    @$el.popover 'destroy'\r\n    @$el.off()\r\n    oldEditor.destroy() for oldEditor in @aceEditors\r\n    super()\r\n"]}