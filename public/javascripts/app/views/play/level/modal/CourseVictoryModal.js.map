{"version":3,"sources":["app/templates/play/level/modal/course-victory-modal.jade","app/views/play/level/modal/CourseVictoryModal.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/modal/CourseVictoryModal.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nbuf.push(\"<div class=\\\"modal-dialog\\\"><div class=\\\"background-wrapper\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-body\\\"></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","ModalView = require 'views/core/ModalView'\r\ntemplate = require 'templates/play/level/modal/course-victory-modal'\r\nLevel = require 'models/Level'\r\nCourse = require 'models/Course'\r\nLevelSessions = require 'collections/LevelSessions'\r\nProgressView = require './ProgressView'\r\nClassroom = require 'models/Classroom'\r\nutils = require 'core/utils'\r\n\r\nmodule.exports = class CourseVictoryModal extends ModalView\r\n  id: 'course-victory-modal'\r\n  template: template\r\n  closesOnClickOutside: false\r\n\r\n  initialize: (options) ->\r\n    @courseID = options.courseID\r\n    @courseInstanceID = options.courseInstanceID or @getQueryVariable('course-instance') or @getQueryVariable('league')\r\n    @views = []\r\n\r\n    @session = options.session\r\n    @level = options.level\r\n\r\n    if @courseInstanceID\r\n      @classroom = new Classroom()\r\n      @supermodel.trackRequest(@classroom.fetchForCourseInstance(@courseInstanceID))\r\n\r\n    @playSound 'victory'\r\n    @nextLevel = new Level()\r\n    @nextLevelRequest = @supermodel.trackRequest(@nextLevel.fetchNextForCourse({\r\n      levelOriginalID: @level.get('original')\r\n      @courseInstanceID\r\n      @courseID\r\n      sessionID: @session.id\r\n    }))\r\n\r\n    @course = options.course\r\n    if @courseID and not @course\r\n      @course = new Course().setURL \"/db/course/#{@courseID}\"\r\n      @course = @supermodel.loadModel(@course).model\r\n\r\n    if @courseInstanceID\r\n      @levelSessions = new LevelSessions()\r\n      @levelSessions.fetchForCourseInstance(@courseInstanceID)\r\n      @levelSessions = @supermodel.loadCollection(@levelSessions, 'sessions', {\r\n        data: { project: 'state.complete level.original playtime changed' }\r\n      }).model\r\n\r\n      if not @course\r\n        @course = new Course()\r\n        @supermodel.trackRequest @course.fetchForCourseInstance(@courseInstanceID)\r\n\r\n    window.tracker?.trackEvent 'Play Level Victory Modal Loaded', category: 'Students', levelSlug: @level.get('slug'), []\r\n\r\n  onResourceLoadFailed: (e) ->\r\n    if e.resource.jqxhr is @nextLevelRequest\r\n      return\r\n    super(arguments...)\r\n\r\n  onLoaded: ->\r\n    super()\r\n    @courseID ?= @course.id\r\n    @views = []\r\n\r\n    @levelSessions?.remove(@session)\r\n    @levelSessions?.add(@session)\r\n    progressView = new ProgressView({\r\n      level: @level\r\n      nextLevel: @nextLevel\r\n      course: @course\r\n      classroom: @classroom\r\n      levelSessions: @levelSessions\r\n      session: @session\r\n    })\r\n\r\n    progressView.once 'done', @onDone, @\r\n    progressView.once 'next-level', @onNextLevel, @\r\n    progressView.once 'ladder', @onLadder, @\r\n    for view in @views\r\n      view.on 'continue', @onViewContinue, @\r\n    @views.push(progressView)\r\n\r\n    @showView(_.first(@views))\r\n\r\n  afterRender: ->\r\n    super()\r\n    @showView(@currentView)\r\n\r\n  showView: (view) ->\r\n    return unless view\r\n    view.setElement(@$('.modal-content'))\r\n    view.$el.attr('id', view.id)\r\n    view.$el.addClass(view.className)\r\n    view.render()\r\n    @currentView = view\r\n\r\n  onViewContinue: ->\r\n    index = _.indexOf(@views, @currentView)\r\n    @showView(@views[index+1])\r\n\r\n  onNextLevel: ->\r\n    window.tracker?.trackEvent 'Play Level Victory Modal Next Level', category: 'Students', levelSlug: @level.get('slug'), nextLevelSlug: @nextLevel.get('slug'), []\r\n    if me.isSessionless()\r\n      link = \"/play/level/#{@nextLevel.get('slug')}?course=#{@courseID}&codeLanguage=#{utils.getQueryVariable('codeLanguage', 'python')}\"\r\n    else\r\n      link = \"/play/level/#{@nextLevel.get('slug')}?course=#{@courseID}&course-instance=#{@courseInstanceID}\"\r\n      link += \"&codeLanguage=\" + @level.get('primerLanguage') if @level.get('primerLanguage')\r\n    application.router.navigate(link, {trigger: true})\r\n\r\n  onDone: ->\r\n    window.tracker?.trackEvent 'Play Level Victory Modal Done', category: 'Students', levelSlug: @level.get('slug'), []\r\n    if me.isSessionless()\r\n      link = '/teachers/courses'\r\n    else\r\n      link = '/students'\r\n    application.router.navigate(link, {trigger: true})\r\n\r\n  onLadder: ->\r\n    # Preserve the supermodel as we navigate back to the ladder.\r\n    viewArgs = [{supermodel: if @options.hasReceivedMemoryWarning then null else @supermodel}, @level.get('slug')]\r\n    ladderURL = \"/play/ladder/#{@level.get('slug') || @level.id}\"\r\n    if leagueID = (@courseInstanceID or @getQueryVariable 'league')\r\n      leagueType = if @level.get('type') is 'course-ladder' then 'course' else 'clan'\r\n      viewArgs.push leagueType\r\n      viewArgs.push leagueID\r\n      ladderURL += \"/#{leagueType}/#{leagueID}\"\r\n    ladderURL += '#my-matches'\r\n    Backbone.Mediator.publish 'router:navigate', route: ladderURL, viewClass: 'views/ladder/LadderView', viewArgs: viewArgs\r\n"]}