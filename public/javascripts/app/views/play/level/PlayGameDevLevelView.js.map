{"version":3,"sources":["app/templates/play/level/play-game-dev-level-view.jade","app/views/play/level/PlayGameDevLevelView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/PlayGameDevLevelView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),view = locals_.view;var ready = !(view.state.get('errorMessage') || view.state.get('loading'))\nbuf.push(\"<div class=\\\"container-fluid style-flat\\\"><div id=\\\"game-row\\\" class=\\\"row\\\"><div class=\\\"col-xs-9\\\"><div id=\\\"canvas-wrapper\\\"><canvas width=\\\"924\\\" height=\\\"589\\\" id=\\\"webgl-surface\\\"></canvas><canvas width=\\\"924\\\" height=\\\"589\\\" id=\\\"normal-surface\\\"></canvas></div></div><div id=\\\"info-col\\\" class=\\\"col-xs-3\\\"><div class=\\\"panel panel-default\\\"><div class=\\\"panel-body text-center\\\">\");\nif ( view.state.get('errorMessage'))\n{\nbuf.push(\"<div class=\\\"alert alert-danger\\\">\" + (jade.escape(null == (jade.interp = view.state.get('errorMessage')) ? \"\" : jade.interp)) + \"</div>\");\n}\nif ( view.level.id && view.session.id)\n{\nbuf.push(\"<h3 class=\\\"m-y-1\\\">\" + (jade.escape(null == (jade.interp = view.level.get('name')) ? \"\" : jade.interp)) + \"</h3><h4>\" + (jade.escape(null == (jade.interp = view.state.get('creatorString')) ? \"\" : jade.interp)) + \"</h4><hr/>\");\n}\nif ( view.state.get('loading'))\n{\nbuf.push(\"<h1 data-i18n=\\\"common.loading\\\" class=\\\"m-y-1\\\"></h1><div class=\\\"progress\\\"><div\" + (jade.attrs({ 'style':(\"width: \" + (view.state.get('progress')) + \"\"), \"class\": [('progress-bar')] }, {\"style\":true})) + \"></div></div>\");\n}\nif ( ready)\n{\nbuf.push(\"<h3><span data-i18n=\\\"play_level.directions\\\"></span>:</h3><p>\" + (null == (jade.interp = view.howToPlayText) ? \"\" : jade.interp) + \"</p><hr/>\");\n}\nbuf.push(\"</div>\");\nif ( ready)\n{\nbuf.push(\"<div class=\\\"panel-footer\\\">\");\nvar playing = view.state.get('playing')\nif ( playing)\n{\nbuf.push(\"<button id=\\\"play-btn\\\" data-i18n=\\\"play_game_dev_level.restart\\\" class=\\\"btn btn-lg btn-burgandy btn-block\\\"></button>\");\n}\nelse\n{\nbuf.push(\"<button id=\\\"play-btn\\\" data-i18n=\\\"play_game_dev_level.play\\\" class=\\\"btn btn-lg btn-forest btn-block\\\"></button>\");\n}\nif ( view.state.get('isOwner'))\n{\nbuf.push(\"<br/><button id=\\\"edit-level-btn\\\" data-i18n=\\\"play_level.edit_level\\\" class=\\\"btn btn-lg btn-warning btn-block\\\"></button>\");\n}\nbuf.push(\"</div>\");\n}\nbuf.push(\"</div></div></div><div id=\\\"share-row\\\" class=\\\"m-t-3\\\">\");\nif ( ready)\n{\nbuf.push(\"<div class=\\\"panel panel-default\\\"><div id=\\\"share-panel-body\\\" class=\\\"panel-body\\\"><div id=\\\"share-text-div\\\" class=\\\"text-right\\\"><b data-i18n=\\\"sharing.share_game\\\"></b></div><input\" + (jade.attrs({ 'id':('copy-url-input'), 'value':(view.state.get('shareURL')), \"class\": [('text-h4'),('semibold'),('form-control'),('input-lg')] }, {\"value\":true})) + \"/><div id=\\\"copy-url-div\\\"><button id=\\\"copy-url-btn\\\" class=\\\"btn btn-lg btn-navy-alt\\\"><span data-i18n=\\\"sharing.copy_url\\\"></span></button></div></div>\");\nif ( !view.state.get('isOwner'))\n{\nbuf.push(\"<div class=\\\"panel-body\\\"><a id=\\\"play-more-codecombat-btn\\\" href=\\\"/\\\" data-i18n=\\\"play_game_dev_level.play_more_codecombat\\\" class=\\\"btn btn-lg btn-navy-alt pull-right\\\"></a></div>\");\n}\nbuf.push(\"</div>\");\n}\nbuf.push(\"</div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","RootView = require 'views/core/RootView'\r\n\r\nGameUIState = require 'models/GameUIState'\r\nGod = require 'lib/God'\r\nLevelLoader = require 'lib/LevelLoader'\r\nGoalManager = require 'lib/world/GoalManager'\r\nScriptManager = require 'lib/scripts/ScriptManager'\r\nSurface = require 'lib/surface/Surface'\r\nThangType = require 'models/ThangType'\r\nLevel = require 'models/Level'\r\nLevelSession = require 'models/LevelSession'\r\nState = require 'models/State'\r\nutils = require 'core/utils'\r\nurls = require 'core/urls'\r\nCourse = require 'models/Course'\r\nGameDevVictoryModal = require './modal/GameDevVictoryModal'\r\n\r\nrequire 'game-libraries'\r\n\r\nTEAM = 'humans'\r\n\r\nmodule.exports = class PlayGameDevLevelView extends RootView\r\n  id: 'play-game-dev-level-view'\r\n  template: require 'templates/play/level/play-game-dev-level-view'\r\n  \r\n  subscriptions:\r\n    'god:new-world-created': 'onNewWorld'\r\n\r\n  events:\r\n    'click #edit-level-btn': 'onEditLevelButton'\r\n    'click #play-btn': 'onClickPlayButton'\r\n    'click #copy-url-btn': 'onClickCopyURLButton'\r\n    'click #play-more-codecombat-btn': 'onClickPlayMoreCodeCombatButton'\r\n\r\n  initialize: (@options, @levelID, @sessionID) ->\r\n    @state = new State({\r\n      loading: true\r\n      progress: 0\r\n      creatorString: ''\r\n      isOwner: false\r\n    })\r\n\r\n    @supermodel.on 'update-progress', (progress) =>\r\n      @state.set({progress: (progress*100).toFixed(1)+'%'})\r\n    @level = new Level()\r\n    @session = new LevelSession()\r\n    @gameUIState = new GameUIState()\r\n    @courseID = @getQueryVariable 'course'\r\n    @god = new God({ @gameUIState, indefiniteLength: true })\r\n    @levelLoader = new LevelLoader({ @supermodel, @levelID, @sessionID, observing: true, team: TEAM, @courseID })\r\n    @supermodel.setMaxProgress 1 # Hack, why are we setting this to 0.2 in LevelLoader?\r\n    @listenTo @state, 'change', _.debounce @renderAllButCanvas\r\n\r\n    @levelLoader.loadWorldNecessities()\r\n\r\n    .then (levelLoader) =>\r\n      { @level, @session, @world } = levelLoader\r\n      @god.setLevel(@level.serialize {@supermodel, @session})\r\n      @god.setWorldClassMap(@world.classMap)\r\n      @goalManager = new GoalManager(@world, @level.get('goals'), @team)\r\n      @god.setGoalManager(@goalManager)\r\n      @god.angelsShare.firstWorld = false # HACK\r\n      me.team = TEAM\r\n      @session.set 'team', TEAM\r\n      @scriptManager = new ScriptManager({\r\n        scripts: @world.scripts or [], view: @, @session, levelID: @level.get('slug')})\r\n      @scriptManager.loadFromSession() # Should we? TODO: Figure out how scripts work for game dev levels\r\n      @howToPlayText = utils.i18n(@level.attributes, 'studentPlayInstructions')\r\n      @howToPlayText ?= $.i18n.t('play_game_dev_level.default_student_instructions')\r\n      @howToPlayText = marked(@howToPlayText, { sanitize: true })\r\n      @renderAllButCanvas()\r\n      @supermodel.finishLoading()\r\n\r\n    .then (supermodel) =>\r\n      @levelLoader.destroy()\r\n      @levelLoader = null\r\n      webGLSurface = @$('canvas#webgl-surface')\r\n      normalSurface = @$('canvas#normal-surface')\r\n      @surface = new Surface(@world, normalSurface, webGLSurface, {\r\n        thangTypes: @supermodel.getModels(ThangType)\r\n        levelType: @level.get('type', true)\r\n        @gameUIState\r\n        resizeStrategy: 'wrapper-size'\r\n      })\r\n      @listenTo @surface, 'resize', @onSurfaceResize\r\n      worldBounds = @world.getBounds()\r\n      bounds = [{x: worldBounds.left, y: worldBounds.top}, {x: worldBounds.right, y: worldBounds.bottom}]\r\n      @surface.camera.setBounds(bounds)\r\n      @surface.camera.zoomTo({x: 0, y: 0}, 0.1, 0)\r\n      @surface.setWorld(@world)\r\n      @scriptManager.initializeCamera()\r\n      @renderSelectors '#info-col'\r\n      @spells = @session.generateSpellsObject level: @level\r\n      goalNames = (utils.i18n(goal, 'name') for goal in @goalManager.goals)\r\n      \r\n      course = if @courseID then new Course({_id: @courseID}) else null\r\n      shareURL = urls.playDevLevel({@level, @session, course})\r\n      \r\n      @state.set({\r\n        loading: false\r\n        goalNames\r\n        shareURL\r\n        creatorString: $.i18n.t('play_game_dev_level.created_by').replace('{{name}}', @session.get('creatorName'))\r\n        isOwner: me.id is @session.get('creator')\r\n      })\r\n      @eventProperties = {\r\n        category: 'Play GameDev Level'\r\n        @courseID\r\n        sessionID: @session.id\r\n        levelID: @level.id\r\n        levelSlug: @level.get('slug')\r\n      }\r\n      window.tracker?.trackEvent 'Play GameDev Level - Load', @eventProperties, ['Mixpanel']\r\n      @god.createWorld(@spells, false, false, true)\r\n\r\n    .catch (e) =>\r\n      throw e if e.stack\r\n      @state.set('errorMessage', e.message)\r\n\r\n  onEditLevelButton: ->\r\n    viewClass = 'views/play/level/PlayLevelView'\r\n    route = \"/play/level/#{@level.get('slug')}\"\r\n    Backbone.Mediator.publish 'router:navigate', {\r\n      route, viewClass\r\n      viewArgs: [{}, @levelID]\r\n    }\r\n\r\n  onClickPlayButton: ->\r\n    @god.createWorld(@spells, false, true)\r\n    Backbone.Mediator.publish('playback:real-time-playback-started', {})\r\n    Backbone.Mediator.publish('level:set-playing', {playing: true})\r\n    action = if @state.get('playing') then 'Play GameDev Level - Restart Level' else 'Play GameDev Level - Start Level'\r\n    window.tracker?.trackEvent(action, @eventProperties, ['Mixpanel'])\r\n    @state.set('playing', true)\r\n\r\n  onClickCopyURLButton: ->\r\n    @$('#copy-url-input').val(@state.get('shareURL')).select()\r\n    @tryCopy()\r\n    window.tracker?.trackEvent('Play GameDev Level - Copy URL', @eventProperties, ['Mixpanel'])\r\n\r\n  onClickPlayMoreCodeCombatButton: ->\r\n    window.tracker?.trackEvent('Play GameDev Level - Click Play More CodeCombat', @eventProperties, ['Mixpanel'])\r\n    \r\n  onSurfaceResize: ({height}) ->\r\n    @state.set('surfaceHeight', height)\r\n    \r\n  renderAllButCanvas: ->\r\n    @renderSelectors('#info-col', '#share-row')\r\n    height = @state.get('surfaceHeight')\r\n    if height\r\n      @$el.find('#info-col').css('height', @state.get('surfaceHeight'))\r\n\r\n  onNewWorld: (e) ->\r\n    if @goalManager.checkOverallStatus() is 'success'\r\n      modal = new GameDevVictoryModal({ shareURL: @state.get('shareURL'), @eventProperties })\r\n      @openModalView(modal)\r\n      modal.once 'replay', @onClickPlayButton, @\r\n\r\n  destroy: ->\r\n    @levelLoader?.destroy()\r\n    @surface?.destroy()\r\n    @god?.destroy()\r\n    @goalManager?.destroy()\r\n    @scriptManager?.destroy()\r\n    delete window.world # not sure where this is set, but this is one way to clean it up\r\n    super()\r\n"]}