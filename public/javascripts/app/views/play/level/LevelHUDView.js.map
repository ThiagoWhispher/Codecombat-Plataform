{"version":3,"sources":["app/views/play/level/LevelHUDView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/LevelHUDView.js","sourcesContent":["CocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/play/level/hud'\r\nprop_template = require 'templates/play/level/hud_prop'\r\nutils = require 'core/utils'\r\n\r\nmodule.exports = class LevelHUDView extends CocoView\r\n  id: 'thang-hud'\r\n  template: template\r\n\r\n  subscriptions:\r\n    'surface:frame-changed': 'onFrameChanged'\r\n    'level:disable-controls': 'onDisableControls'\r\n    'level:enable-controls': 'onEnableControls'\r\n    'surface:sprite-selected': 'onSpriteSelected'\r\n    'sprite:thang-began-talking': 'onThangBeganTalking'\r\n    'sprite:thang-finished-talking': 'onThangFinishedTalking'\r\n    'god:new-world-created': 'onNewWorld'\r\n\r\n  events:\r\n    'click': 'onClick'\r\n\r\n  afterRender: ->\r\n    super()\r\n    @$el.addClass 'no-selection'\r\n    if @options.level.get('hidesHUD')\r\n      @hidesHUD = true\r\n      @$el.addClass 'hide-hud-properties'\r\n\r\n  onClick: (e) ->\r\n    Backbone.Mediator.publish 'tome:focus-editor', {} unless $(e.target).parents('.thang-props').length\r\n\r\n  onFrameChanged: (e) ->\r\n    @timeProgress = e.progress\r\n    @update()\r\n\r\n  onDisableControls: (e) ->\r\n    return if e.controls and not ('hud' in e.controls)\r\n    @disabled = true\r\n    @$el.addClass 'controls-disabled'\r\n\r\n  onEnableControls: (e) ->\r\n    return if e.controls and not ('hud' in e.controls)\r\n    @disabled = false\r\n    @$el.removeClass 'controls-disabled'\r\n\r\n  onSpriteSelected: (e) ->\r\n    return if @disabled\r\n    @setThang e.thang, e.sprite?.thangType\r\n\r\n  onNewWorld: (e) ->\r\n    hadThang = @thang\r\n    @thang = e.world.thangMap[@thang.id] if @thang\r\n    if hadThang and not @thang\r\n      @setThang null, null\r\n\r\n  setThang: (thang, thangType) ->\r\n    if not thang? and not @thang? then return\r\n    if thang? and @thang? and thang.id is @thang.id then return\r\n    if thang? and @hidesHUD and thang.id isnt 'Hero Placeholder' then return  # Don't let them find the names of their opponents this way\r\n    return unless thang  # Don't let them deselect anything, ever.\r\n    @thang = thang\r\n    @thangType = thangType\r\n    return unless @thang\r\n    @createAvatar thangType, @thang\r\n    @createProperties()\r\n    @update()\r\n\r\n  createAvatar: (thangType, thang, colorConfig) ->\r\n    unless thangType.isFullyLoaded()\r\n      args = arguments\r\n      unless @listeningToCreateAvatar\r\n        @listenToOnce thangType, 'sync', -> @createAvatar(args...)\r\n        @listeningToCreateAvatar = true\r\n      return\r\n    @listeningToCreateAvatar = false\r\n    options = thang.getLankOptions() or {}\r\n    options.async = false\r\n    options.colorConfig = colorConfig if colorConfig\r\n    wrapper = @$el.find '.thang-canvas-wrapper'\r\n    team = @thang?.team\r\n    wrapper.removeClass (i, css) -> (css.match(/\\bteam-\\S+/g) or []).join ' '\r\n    wrapper.addClass \"team-#{team}\"\r\n    if thangType.get('raster')\r\n      wrapper.empty().append($('<img draggable=\"false\"/>').addClass('avatar').attr('src', '/file/'+thangType.get('raster')))\r\n    else\r\n      return unless stage = thangType.getPortraitStage options, 100\r\n      newCanvas = $(stage.canvas).addClass('thang-canvas avatar')\r\n      wrapper.empty().append(newCanvas)\r\n      stage.update()\r\n      @stage?.stopTalking()\r\n      @stage = stage\r\n    wrapper.append($('<img draggable=\"false\" />').addClass('avatar-frame').attr('src', '/images/level/thang_avatar_frame.png'))\r\n\r\n  onThangBeganTalking: (e) ->\r\n    return unless @stage and @thang is e.thang\r\n    @stage?.startTalking()\r\n\r\n  onThangFinishedTalking: (e) ->\r\n    return unless @stage and @thang is e.thang\r\n    @stage?.stopTalking()\r\n\r\n  createProperties: ->\r\n    if @options.level.isType('game-dev')\r\n      name = 'Game'  # TODO: we don't need the HUD at all\r\n    else if @thang.id in ['Hero Placeholder', 'Hero Placeholder 1']\r\n      name = @thangType?.getHeroShortName() or 'Hero'\r\n    else\r\n      name = @thang.hudName or (if @thang.type then \"#{@thang.id} - #{@thang.type}\" else @thang.id)\r\n    utils.replaceText @$el.find('.thang-name'), name\r\n    props = @$el.find('.thang-props')\r\n    props.find('.prop').remove()\r\n    #propNames = _.without @thang.hudProperties ? [], 'action'\r\n    propNames = @thang.hudProperties\r\n    for prop, i in propNames ? []\r\n      pel = @createPropElement prop\r\n      continue unless pel?\r\n      if pel.find('.bar').is('*') and props.find('.bar').is('*')\r\n        props.find('.bar-prop').last().after pel  # Keep bars together\r\n      else\r\n        props.append pel\r\n    null\r\n\r\n  update: ->\r\n    return unless @thang\r\n    @$el.find('.thang-props-column').toggleClass 'nonexistent', not @thang.exists\r\n    if @thang.exists\r\n      @updatePropElement(prop, @thang[prop]) for prop in @thang.hudProperties ? []\r\n\r\n  createPropElement: (prop) ->\r\n    if prop in ['maxHealth']\r\n      return null  # included in the bar\r\n    context =\r\n      prop: prop\r\n      hasIcon: prop in ['health', 'pos', 'target', 'collectedThangIDs', 'gold', 'bountyGold', 'value', 'visualRange', 'attackDamage', 'attackRange', 'maxSpeed', 'attackNearbyEnemyRange']\r\n      hasBar: prop in ['health']\r\n    $(prop_template(context))\r\n\r\n  updatePropElement: (prop, val) ->\r\n    pel = @$el.find '.thang-props *[name=' + prop + ']'\r\n    if prop in ['maxHealth']\r\n      return  # Don't show maxes--they're built into bar labels.\r\n    if prop in ['health']\r\n      max = @thang['max' + prop.charAt(0).toUpperCase() + prop.slice(1)]\r\n      regen = @thang[prop + 'ReplenishRate']\r\n      percent = Math.round 100 * val / max\r\n      pel.find('.bar').css 'width', percent + '%'\r\n      labelText = prop + ': ' + @formatValue(prop, val) + ' / ' + @formatValue(prop, max)\r\n      if regen\r\n        labelText += ' (+' + @formatValue(prop, regen) + '/s)'\r\n      utils.replaceText pel.find('.bar-prop-value'), Math.round(val)\r\n    else\r\n      s = @formatValue(prop, val)\r\n      labelText = \"#{prop}: #{s}\"\r\n      if prop is 'attackDamage'\r\n        cooldown = @thang.actions.attack.cooldown\r\n        dps = @thang.attackDamage / cooldown\r\n        labelText += \" / #{cooldown.toFixed(2)}s (DPS: #{dps.toFixed(2)})\"\r\n      utils.replaceText pel.find('.prop-value'), s\r\n    pel.attr 'title', labelText\r\n    pel\r\n\r\n  formatValue: (prop, val) ->\r\n    if prop is 'target' and not val\r\n      val = @thang['targetPos']\r\n      val = null if val?.isZero()\r\n    if prop is 'rotation'\r\n      return (val * 180 / Math.PI).toFixed(0) + '˚'\r\n    if prop.search(/Range$/) isnt -1\r\n      return val + 'm'\r\n    if typeof val is 'number'\r\n      if Math.round(val) == val or prop is 'gold' then return val.toFixed(0)  # int\r\n      if -10 < val < 10 then return val.toFixed(2)\r\n      if -100 < val < 100 then return val.toFixed(1)\r\n      return val.toFixed(0)\r\n    if val and typeof val is 'object'\r\n      if val.id\r\n        return val.id\r\n      else if val.x and val.y\r\n        return \"x: #{val.x.toFixed(0)} y: #{val.y.toFixed(0)}\"\r\n        #return \"x: #{val.x.toFixed(0)} y: #{val.y.toFixed(0)}, z: #{val.z.toFixed(0)}\"  # Debugging: include z\r\n    else if not val?\r\n      return 'No ' + prop\r\n    return val\r\n\r\n  destroy: ->\r\n    @stage?.stopTalking()\r\n    super()\r\n"]}