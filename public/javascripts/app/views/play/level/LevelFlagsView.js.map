{"version":3,"sources":["app/templates/play/level/level-flags-view.jade","app/views/play/level/LevelFlagsView.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;AAAA;;ACAA;EAAA;;;AAAA,WAAW,QAAQ,qBAAR;;AACX,WAAW,QAAQ,uCAAR;;AACV,KAAM,QAAQ,WAAR,EAAN;;AAED,MAAM,CAAC,OAAP,GAAuB;;;2BACrB,KAAI;;2BACJ,WAAU;;2BACV,YAAW;;2BAEX,gBACE;IAAA,uCAAuC,2BAAvC;IACA,qCAAqC,yBADrC;IAEA,4BAA4B,kBAF5B;IAGA,yBAAyB,YAHzB;IAIA,+BAA+B,YAJ/B;IAKA,uBAAuB,cALvB;;;2BAOF,SACE;IAAA,qBAAqB;aAAG,IAAC,eAAD,CAAgB;QAAA,OAAO,OAAP;QAAgB,QAAQ,QAAxB;OAAhB;IAAH,CAArB;IACA,qBAAqB;aAAG,IAAC,eAAD,CAAgB;QAAA,OAAO,OAAP;QAAgB,QAAQ,QAAxB;OAAhB;IAAH,CADrB;IAEA,sBAAsB;aAAG,IAAC,eAAD,CAAgB;QAAA,OAAO,QAAP;QAAiB,QAAQ,QAAzB;OAAhB;IAAH,CAFtB;;;2BAIF,YACE;IAAA,KAAK;aAAG,IAAC,eAAD,CAAgB;QAAA,OAAO,OAAP;QAAgB,QAAQ,UAAxB;OAAhB;IAAH,CAAL;IACA,KAAK;aAAG,IAAC,eAAD,CAAgB;QAAA,OAAO,OAAP;QAAgB,QAAQ,UAAxB;OAAhB;IAAH,CADL;IAEA,KAAK;aAAG,IAAC,eAAD,CAAgB;QAAA,OAAO,QAAP;QAAiB,QAAQ,UAAzB;OAAhB;IAAH,CAFL;IAGA,OAAO;aAAG,IAAC,eAAD,CAAgB;QAAA,OAAO,IAAP;QAAa,QAAQ,UAArB;OAAhB;IAAH,CAHP;IAIA,0BAA0B,iBAJ1B;;;EAMW,wBAAC,OAAD;IACX,gDAAM,OAAN;IACA,IAAC,QAAD,GAAW,OAAO,CAAC;IACnB,IAAC,MAAD,GAAS,OAAO,CAAC;EAHN;;2BAKb,4BAA2B,SAAC,CAAD;IACzB,IAAC,SAAD,GAAY;IACZ,IAAC,IAAG,CAAC,IAAL;IACA,IAAC,MAAD,GAAS;WACT,IAAC,YAAD,GAAe;EAJU;;2BAM3B,0BAAyB,SAAC,CAAD;IACvB,IAAC,eAAD,CAAgB;MAAA,OAAO,IAAP;KAAhB;IACA,IAAC,SAAD,GAAY;WACZ,IAAC,IAAG,CAAC,IAAL;EAHuB;;2BAKzB,iBAAgB,SAAC,CAAD;AACd;IAAA,KAAc,IAAC,SAAf;AAAA;;IACA,IAAkC,CAAC,CAAC,KAApC;MAAA,IAAC,UAAD,CAAW,mBAAX;;IACA,QAAW,CAAC,CAAC,KAAF,KAAW,IAAC,UAAf,GAA8B,IAA9B,GAAwC,CAAC,CAAC;IAClD,IAAC,UAAD,GAAa;IACb,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,2BAA1B,EAAuD;MAAA,OAAO,KAAP;KAAvD;IACA,IAAC,IAAG,CAAC,IAAL,CAAU,cAAV,CAAyB,CAAC,WAA1B,CAAsC,QAAtC;IACA,IAAkD,KAAlD;aAAA,IAAC,IAAG,CAAC,IAAL,CAAU,MAAI,KAAJ,GAAU,OAApB,CAA2B,CAAC,QAA5B,CAAqC,QAArC;;EAPc;;2BAShB,mBAAkB,SAAC,CAAD;AAChB;IAAA,MAAc,IAAC,UAAD,IAAe,IAAC,SAA9B;AAAA;;IACA,IAAC,UAAD,CAAW,mBAAX;IACA,MAAM;MAAA,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAd;MAAiB,GAAG,CAAC,CAAC,QAAQ,CAAC,CAA/B;;IACN,MAAM,IAAC,MAAK,CAAC,EAAP,GAAY,IAAC,MAAK,CAAC,MAAM,CAAC;IAChC,OAAO;MAAA,QAAQ,EAAE,CAAC,EAAX;MAAe,MAAM,EAAE,CAAC,IAAxB;MAA8B,OAAO,IAAC,UAAtC;MAAiD,KAAK,GAAtD;MAA2D,MAAM,GAAjE;MAAsE,QAAQ,IAA9E;MAAoF,QAAQ,OAA5F;;IACP,IAAC,MAAM,KAAC,UAAD,CAAP,GAAqB;IACrB,IAAC,YAAW,CAAC,IAAb,CAAkB,IAAlB;;SACc,CAAE,MAAhB,CAAuB,IAAvB;;WACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,oBAA1B,EAAgD,IAAhD;EATgB;;2BAYlB,kBAAiB,SAAC,CAAD;IACf,KAAc,IAAC,SAAf;AAAA;;WACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,8BAA1B,EAA0D,EAA1D;EAFe;;2BAIjB,eAAc,SAAC,CAAD;AACZ;IAAA,OAAO,IAAC,MAAM,EAAC,CAAC,KAAF;IACd,MAAM,IAAC,MAAK,CAAC,EAAP,GAAY,IAAC,MAAK,CAAC,MAAM,CAAC;IAChC,OAAO;MAAA,QAAQ,EAAE,CAAC,EAAX;MAAe,MAAM,EAAE,CAAC,IAAxB;MAA8B,OAAO,CAAC,CAAC,KAAvC;MAA8C,MAAM,GAApD;MAAyD,QAAQ,KAAjE;MAAwE,QAAQ,OAAhF;;IACP,IAAC,YAAW,CAAC,IAAb,CAAkB,IAAlB;WACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,oBAA1B,EAAgD,IAAhD;EALY;;2BAQd,aAAY,SAAC,KAAD;IACV,IAAc,KAAK,CAAC,KAAK,CAAC,IAAZ,KAAoB,IAAC,MAAK,CAAC,IAAzC;AAAA;;WACA,IAAC,MAAD,GAAS,IAAC,QAAO,CAAC,KAAT,GAAiB,KAAK,CAAC;EAFtB;;;;GA1EgC","file":"public/javascripts/app/views/play/level/LevelFlagsView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nbuf.push(\"<button title=\\\"G: Place a green flag\\\" class=\\\"flag-button btn btn-lg green-flag\\\"><span class=\\\"glyphicon glyphicon-flag\\\"></span><span class=\\\"flag-caption\\\"><span class=\\\"flag-shortcut\\\">G</span>reen</span></button><button title=\\\"B: Place a black flag\\\" class=\\\"flag-button btn btn-lg black-flag\\\"><span class=\\\"glyphicon glyphicon-flag\\\"></span><span class=\\\"flag-caption\\\"><span class=\\\"flag-shortcut\\\">B</span>lack</span></button><button title=\\\"V: Place a violet flag\\\" class=\\\"flag-button btn btn-lg violet-flag\\\"><span class=\\\"glyphicon glyphicon-flag\\\"></span><span class=\\\"flag-caption\\\"><span class=\\\"flag-shortcut\\\">V</span>iolet</span></button>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","CocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/play/level/level-flags-view'\r\n{me} = require 'core/auth'\r\n\r\nmodule.exports = class LevelFlagsView extends CocoView\r\n  id: 'level-flags-view'\r\n  template: template\r\n  className: 'secret'\r\n\r\n  subscriptions:\r\n    'playback:real-time-playback-started': 'onRealTimePlaybackStarted'\r\n    'playback:real-time-playback-ended': 'onRealTimePlaybackEnded'\r\n    'surface:stage-mouse-down': 'onStageMouseDown'\r\n    'god:new-world-created': 'onNewWorld'\r\n    'god:streaming-world-updated': 'onNewWorld'\r\n    'surface:remove-flag': 'onRemoveFlag'\r\n\r\n  events:\r\n    'click .green-flag': -> @onFlagSelected color: 'green', source: 'button'\r\n    'click .black-flag': -> @onFlagSelected color: 'black', source: 'button'\r\n    'click .violet-flag': -> @onFlagSelected color: 'violet', source: 'button'\r\n\r\n  shortcuts:\r\n    'g': -> @onFlagSelected color: 'green', source: 'shortcut'\r\n    'b': -> @onFlagSelected color: 'black', source: 'shortcut'\r\n    'v': -> @onFlagSelected color: 'violet', source: 'shortcut'\r\n    'esc': -> @onFlagSelected color: null, source: 'shortcut'\r\n    'delete, del, backspace': 'onDeletePressed'\r\n\r\n  constructor: (options) ->\r\n    super options\r\n    @levelID = options.levelID\r\n    @world = options.world\r\n\r\n  onRealTimePlaybackStarted: (e) ->\r\n    @realTime = true\r\n    @$el.show()\r\n    @flags = {}\r\n    @flagHistory = []\r\n\r\n  onRealTimePlaybackEnded: (e) ->\r\n    @onFlagSelected color: null\r\n    @realTime = false\r\n    @$el.hide()\r\n\r\n  onFlagSelected: (e) ->\r\n    return unless @realTime\r\n    @playSound 'menu-button-click' if e.color\r\n    color = if e.color is @flagColor then null else e.color\r\n    @flagColor = color\r\n    Backbone.Mediator.publish 'level:flag-color-selected', color: color\r\n    @$el.find('.flag-button').removeClass('active')\r\n    @$el.find(\".#{color}-flag\").addClass('active') if color\r\n\r\n  onStageMouseDown: (e) ->\r\n    return unless @flagColor and @realTime\r\n    @playSound 'menu-button-click'  # TODO: different flag placement sound?\r\n    pos = x: e.worldPos.x, y: e.worldPos.y\r\n    now = @world.dt * @world.frames.length\r\n    flag = player: me.id, team: me.team, color: @flagColor, pos: pos, time: now, active: true, source: 'click'\r\n    @flags[@flagColor] = flag\r\n    @flagHistory.push flag\r\n    @realTimeFlags?.create flag\r\n    Backbone.Mediator.publish 'level:flag-updated', flag\r\n    #console.log 'trying to place flag at', @world.age, 'and think it will happen by', flag.time\r\n\r\n  onDeletePressed: (e) ->\r\n    return unless @realTime\r\n    Backbone.Mediator.publish 'surface:remove-selected-flag', {}\r\n\r\n  onRemoveFlag: (e) ->\r\n    delete @flags[e.color]\r\n    now = @world.dt * @world.frames.length\r\n    flag = player: me.id, team: me.team, color: e.color, time: now, active: false, source: 'click'\r\n    @flagHistory.push flag\r\n    Backbone.Mediator.publish 'level:flag-updated', flag\r\n    #console.log e.color, 'deleted at time', flag.time\r\n\r\n  onNewWorld: (event) ->\r\n    return unless event.world.name is @world.name\r\n    @world = @options.world = event.world\r\n"]}