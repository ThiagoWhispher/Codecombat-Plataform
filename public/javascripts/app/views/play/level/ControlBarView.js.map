{"version":3,"sources":["app/templates/play/level/control-bar-view.jade","app/views/play/level/ControlBarView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/ControlBarView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),homeLink = locals_.homeLink,me = locals_.me,ladderGame = locals_.ladderGame,view = locals_.view,i18n = locals_.i18n,difficultyTitle = locals_.difficultyTitle,worldName = locals_.worldName,levelDifficulty = locals_.levelDifficulty,observing = locals_.observing,spectateGame = locals_.spectateGame;buf.push(\"<div class=\\\"left-cap\\\"></div><div class=\\\"right-cap\\\"></div><div class=\\\"center-chain\\\"></div><div class=\\\"right-chain\\\"></div><div class=\\\"wood-background\\\"></div><div class=\\\"levels-link-area\\\"><a\" + (jade.attrs({ 'href':(homeLink || \"/\"), \"class\": [('levels-link')] }, {\"href\":true})) + \"><div class=\\\"glyphicon glyphicon-play\\\"></div><span\" + (jade.attrs({ 'data-i18n':(me.isSessionless() ? \"nav.courses\" : (ladderGame ? \"general.ladder\" : \"nav.play\")), \"class\": [('home-text')] }, {\"data-i18n\":true})) + \"></span></a></div><div class=\\\"level-name-area-container\\\"><div class=\\\"level-name-area\\\">\");\nif ( view.course)\n{\nbuf.push(\"<div class=\\\"level-label\\\">\" + (jade.escape(null == (jade.interp = i18n(view.course.attributes, 'name')) ? \"\" : jade.interp)) + \"</div>\");\n}\nbuf.push(\"<div\" + (jade.attrs({ 'title':(difficultyTitle || \"\"), \"class\": [('level-name')] }, {\"title\":true})) + \"><span>\" + (jade.escape((jade.interp = view.levelNumber ? view.levelNumber + '. ' : '') == null ? '' : jade.interp)) + \"\" + (jade.escape((jade.interp = worldName.replace('Course: ', '')) == null ? '' : jade.interp)) + \"</span>\");\nif ( levelDifficulty)\n{\nbuf.push(\"<sup class=\\\"level-difficulty\\\">\" + (jade.escape(null == (jade.interp = levelDifficulty) ? \"\" : jade.interp)) + \"</sup>\");\n}\nbuf.push(\"</div></div></div><div class=\\\"buttons-area\\\">\");\nif ( !observing)\n{\nbuf.push(\"<button id=\\\"game-menu-button\\\" data-i18n=\\\"[title]play_level.show_menu\\\" title=\\\"Show game menu\\\" class=\\\"btn btn-inverse\\\"><div class=\\\"hamburger\\\"><span class=\\\"icon-bar\\\"></span><span class=\\\"icon-bar\\\"></span><span class=\\\"icon-bar\\\"></span></div><span data-i18n=\\\"play_level.game_menu\\\" class=\\\"game-menu-text\\\">Game Menu</span></button>\");\n}\nif ( spectateGame)\n{\nbuf.push(\"<button id=\\\"next-game-button\\\" data-i18n=\\\"play_level.next_game\\\" class=\\\"btn btn-xs btn-inverse banner\\\">Next game</button>\");\n}\nif ( !observing)\n{\nbuf.push(\"<button id=\\\"level-done-button\\\" data-i18n=\\\"play_level.done\\\" class=\\\"btn btn-xs btn-primary banner\\\">Done</button>\");\n}\nif ( me.get('anonymous'))\n{\nbuf.push(\"<button id=\\\"control-bar-sign-up-button\\\" data-toggle=\\\"coco-modal\\\" data-target=\\\"core/CreateAccountModal\\\" data-i18n=\\\"signup.sign_up\\\" class=\\\"btn btn-xs btn-primary banner\\\"></button>\");\n}\nif ( me.isAdmin())\n{\nvar otherVersion = view.course ? 'Home' : 'Classroom'\nbuf.push(\"<button id=\\\"version-switch-button\\\" class=\\\"btn btn-xs btn-inverse banner\\\"><span>\" + (jade.escape(null == (jade.interp = otherVersion) ? \"\" : jade.interp)) + \"</span><span>\" + (jade.escape(null == (jade.interp = ' ') ? \"\" : jade.interp)) + \"</span><span data-code-language=\\\"javascript\\\" class=\\\"code-language-selector\\\">JS</span><span>\" + (jade.escape(null == (jade.interp = ' | ') ? \"\" : jade.interp)) + \"</span><span data-code-language=\\\"python\\\" class=\\\"code-language-selector\\\">PY</span></button>\");\n}\nbuf.push(\"</div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","storage = require 'core/storage'\r\n\r\nCocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/play/level/control-bar-view'\r\n{me} = require 'core/auth'\r\n\r\nCampaign = require 'models/Campaign'\r\nClassroom = require 'models/Classroom'\r\nCourse = require 'models/Course'\r\nCourseInstance = require 'models/CourseInstance'\r\nGameMenuModal = require 'views/play/menu/GameMenuModal'\r\nLevelSetupManager = require 'lib/LevelSetupManager'\r\n\r\nmodule.exports = class ControlBarView extends CocoView\r\n  id: 'control-bar-view'\r\n  template: template\r\n\r\n  subscriptions:\r\n    'level:disable-controls': 'onDisableControls'\r\n    'level:enable-controls': 'onEnableControls'\r\n    'ipad:memory-warning': 'onIPadMemoryWarning'\r\n\r\n  events:\r\n    'click #next-game-button': -> Backbone.Mediator.publish 'level:next-game-pressed', {}\r\n    'click #game-menu-button': 'showGameMenuModal'\r\n    'click': -> Backbone.Mediator.publish 'tome:focus-editor', {}\r\n    'click .levels-link-area': 'onClickHome'\r\n    'click .home a': 'onClickHome'\r\n    'click #control-bar-sign-up-button': 'onClickSignupButton'\r\n    'click #version-switch-button': 'onClickVersionSwitchButton'\r\n    'click #version-switch-button .code-language-selector': 'onClickVersionSwitchButton'\r\n\r\n  constructor: (options) ->\r\n    @supermodel = options.supermodel\r\n    @courseID = options.courseID\r\n    @courseInstanceID = options.courseInstanceID\r\n\r\n    @worldName = options.worldName\r\n    @session = options.session\r\n    @level = options.level\r\n    @levelSlug = @level.get('slug')\r\n    @levelID = @levelSlug or @level.id\r\n    @spectateGame = options.spectateGame ? false\r\n    @observing = options.session.get('creator') isnt me.id\r\n\r\n    @levelNumber = ''\r\n    if @level.isType('course', 'game-dev', 'web-dev') and @level.get('campaignIndex')?\r\n      @levelNumber = @level.get('campaignIndex') + 1\r\n    if @courseInstanceID\r\n      @courseInstance = new CourseInstance(_id: @courseInstanceID)\r\n      jqxhr = @courseInstance.fetch()\r\n      @supermodel.trackRequest(jqxhr)\r\n      new Promise(jqxhr.then).then(=>\r\n        @classroom = new Classroom(_id: @courseInstance.get('classroomID'))\r\n        @supermodel.trackRequest @classroom.fetch()\r\n      )\r\n    else if @courseID\r\n      @course = new Course(_id: @courseID)\r\n      jqxhr = @course.fetch()\r\n      @supermodel.trackRequest(jqxhr)\r\n      new Promise(jqxhr.then).then(=>\r\n        @campaign = new Campaign(_id: @course.get('campaignID'))\r\n        @supermodel.trackRequest(@campaign.fetch())\r\n      )\r\n    super options\r\n    if @level.get 'replayable'\r\n      @listenTo @session, 'change-difficulty', @onSessionDifficultyChanged\r\n\r\n  onLoaded: ->\r\n    if @classroom\r\n      @levelNumber = @classroom.getLevelNumber(@level.get('original'), @levelNumber)\r\n    else if @campaign\r\n      @levelNumber = @campaign.getLevelNumber(@level.get('original'), @levelNumber)\r\n    super()\r\n\r\n  setBus: (@bus) ->\r\n\r\n  getRenderData: (c={}) ->\r\n    super c\r\n    c.worldName = @worldName\r\n    c.ladderGame = @level.isType('ladder', 'hero-ladder', 'course-ladder')\r\n    if @level.get 'replayable'\r\n      c.levelDifficulty = @session.get('state')?.difficulty ? 0\r\n      if @observing\r\n        c.levelDifficulty = Math.max 0, c.levelDifficulty - 1  # Show the difficulty they won, not the next one.\r\n      c.difficultyTitle = \"#{$.i18n.t 'play.level_difficulty'}#{c.levelDifficulty}\"\r\n      @lastDifficulty = c.levelDifficulty\r\n    c.spectateGame = @spectateGame\r\n    c.observing = @observing\r\n    @homeViewArgs = [{supermodel: if @hasReceivedMemoryWarning then null else @supermodel}]\r\n    gameDevHoc = storage.load('should-return-to-game-dev-hoc')\r\n    if gameDevHoc\r\n      @homeLink = \"/play/game-dev-hoc\"\r\n      @homeViewClass = 'views/play/CampaignView'\r\n      @homeViewArgs.push 'game-dev-hoc'\r\n    else if me.isSessionless()\r\n      @homeLink = \"/teachers/courses\"\r\n      @homeViewClass = \"views/courses/TeacherCoursesView\"\r\n    else if @level.isType('ladder', 'ladder-tutorial', 'hero-ladder', 'course-ladder')\r\n      levelID = @level.get('slug')?.replace(/\\-tutorial$/, '') or @level.id\r\n      @homeLink = \"/play/ladder/#{levelID}\"\r\n      @homeViewClass = 'views/ladder/LadderView'\r\n      @homeViewArgs.push levelID\r\n      if leagueID = @getQueryVariable('league') or @getQueryVariable('course-instance')\r\n        leagueType = if @level.isType('course-ladder') then 'course' else 'clan'\r\n        @homeViewArgs.push leagueType\r\n        @homeViewArgs.push leagueID\r\n        @homeLink += \"/#{leagueType}/#{leagueID}\"\r\n    else if @level.isType('course') or @courseID\r\n      @homeLink = '/students'\r\n      @homeViewClass = 'views/courses/CoursesView'\r\n      if @courseID\r\n        @homeLink += \"/#{@courseID}\"\r\n        @homeViewArgs.push @courseID\r\n        @homeViewClass = 'views/courses/CourseDetailsView'\r\n        if @courseInstanceID\r\n          @homeLink += \"/#{@courseInstanceID}\"\r\n          @homeViewArgs.push @courseInstanceID\r\n    else if @level.isType('hero', 'hero-coop', 'game-dev', 'web-dev') or window.serverConfig.picoCTF\r\n      @homeLink = '/play'\r\n      @homeViewClass = 'views/play/CampaignView'\r\n      campaign = @level.get 'campaign'\r\n      @homeLink += '/' + campaign\r\n      @homeViewArgs.push campaign\r\n    else\r\n      @homeLink = '/'\r\n      @homeViewClass = 'views/HomeView'\r\n    c.editorLink = \"/editor/level/#{@level.get('slug') or @level.id}\"\r\n    c.homeLink = @homeLink\r\n    c\r\n\r\n  showGameMenuModal: (e, tab=null) ->\r\n    gameMenuModal = new GameMenuModal level: @level, session: @session, supermodel: @supermodel, showTab: tab\r\n    @openModalView gameMenuModal\r\n    @listenToOnce gameMenuModal, 'change-hero', ->\r\n      @setupManager?.destroy()\r\n      @setupManager = new LevelSetupManager({supermodel: @supermodel, level: @level, levelID: @levelID, parent: @, session: @session, courseID: @courseID, courseInstanceID: @courseInstanceID})\r\n      @setupManager.open()\r\n\r\n  onClickHome: (e) ->\r\n    if @level.isType('course')\r\n      category = if me.isTeacher() then 'Teachers' else 'Students'\r\n      window.tracker?.trackEvent 'Play Level Back To Levels', category: category, levelSlug: @levelSlug, ['Mixpanel']\r\n    e.preventDefault()\r\n    e.stopImmediatePropagation()\r\n    Backbone.Mediator.publish 'router:navigate', route: @homeLink, viewClass: @homeViewClass, viewArgs: @homeViewArgs\r\n\r\n  onClickSignupButton: (e) ->\r\n    window.tracker?.trackEvent 'Started Signup', category: 'Play Level', label: 'Control Bar', level: @levelID\r\n\r\n  onClickVersionSwitchButton: (e) ->\r\n    return if @destroyed\r\n    otherVersionLink = \"/play/level/#{@level.get('slug')}?dev=true\"\r\n    otherVersionLink += '&course=560f1a9f22961295f9427742' if not @course\r\n    otherVersionLink += \"&codeLanguage=#{codeLanguage}\" if codeLanguage = $(e.target).data('code-language')\r\n    #Backbone.Mediator.publish 'router:navigate', route: otherVersionLink, viewClass: 'views/play/level/PlayLevelView', viewArgs: [{supermodel: @supermodel}, @level.get('slug')]  # TODO: why doesn't this work?\r\n    document.location.href = otherVersionLink  # Loses all loaded resources :(\r\n\r\n  onDisableControls: (e) -> @toggleControls e, false\r\n  onEnableControls: (e) -> @toggleControls e, true\r\n  toggleControls: (e, enabled) ->\r\n    return if e.controls and not ('level' in e.controls)\r\n    return if enabled is @controlsEnabled\r\n    @controlsEnabled = enabled\r\n    @$el.toggleClass 'controls-disabled', not enabled\r\n\r\n  onIPadMemoryWarning: (e) ->\r\n    @hasReceivedMemoryWarning = true\r\n\r\n  onSessionDifficultyChanged: ->\r\n    return if @session.get('state')?.difficulty is @lastDifficulty\r\n    @render()\r\n\r\n  destroy: ->\r\n    @setupManager?.destroy()\r\n    super()\r\n"]}