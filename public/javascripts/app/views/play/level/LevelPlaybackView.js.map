{"version":3,"sources":["app/templates/play/level/level-playback-view.jade","app/views/play/level/LevelPlaybackView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/LevelPlaybackView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),view = locals_.view;buf.push(\"<button id=\\\"play-button\\\" title=\\\"Ctrl/Cmd + P: Toggle level play/pause\\\" class=\\\"btn btn-xs btn-inverse paused\\\"><div class=\\\"glyphicon glyphicon-play\\\"></div><div class=\\\"glyphicon glyphicon-pause\\\"></div><div class=\\\"glyphicon glyphicon-repeat\\\"></div></button><button id=\\\"volume-button\\\" title=\\\"Adjust volume\\\" class=\\\"btn btn-xs btn-inverse picoctf-hide\\\"><div class=\\\"glyphicon glyphicon-volume-off\\\"></div><div class=\\\"glyphicon glyphicon-volume-down\\\"></div><div class=\\\"glyphicon glyphicon-volume-up\\\"></div></button><button id=\\\"music-button\\\" title=\\\"Toggle Music\\\" class=\\\"btn btn-xs btn-inverse picoctf-hide\\\"><span>♫</span></button>\");\nif ( !view.options.level.isType('game-dev'))\n{\nbuf.push(\"<div class=\\\"scrubber\\\"><div class=\\\"scrubber-inner\\\"><div id=\\\"timeProgress\\\" class=\\\"progress secret\\\"><div class=\\\"progress-bar\\\"><div class=\\\"scrubber-handle\\\"></div><div id=\\\"timePopover\\\" class=\\\"popover fade top in\\\"><div class=\\\"arrow\\\"></div><h3 class=\\\"popover-title\\\"></h3><div class=\\\"popover-content\\\"></div></div></div></div></div></div>\");\n}\nbuf.push(\"<div id=\\\"playback-settings\\\" class=\\\"btn-group dropup\\\"><button title=\\\"Toggle fullscreen\\\" class=\\\"btn btn-xs btn-inverse toggle-fullscreen\\\"><div class=\\\"glyphicon glyphicon-fullscreen\\\"></div></button><button id=\\\"zoom-in-button\\\" title=\\\"Zoom In (or scroll down)\\\" class=\\\"btn btn-xs btn-inverse\\\"><div class=\\\"glyphicon glyphicon-zoom-in\\\"></div></button><button id=\\\"zoom-out-button\\\" title=\\\"Zoom Out (or scroll up)\\\" class=\\\"btn btn-xs btn-inverse\\\"><div class=\\\"glyphicon glyphicon-zoom-out\\\"></div></button></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","CocoView = require 'views/core/CocoView'\r\ntemplate = require 'templates/play/level/level-playback-view'\r\n{me} = require 'core/auth'\r\n\r\nmodule.exports = class LevelPlaybackView extends CocoView\r\n  id: 'playback-view'\r\n  template: template\r\n\r\n  subscriptions:\r\n    'level:disable-controls': 'onDisableControls'\r\n    'level:enable-controls': 'onEnableControls'\r\n    'level:set-playing': 'onSetPlaying'\r\n    'level:toggle-playing': 'onTogglePlay'\r\n    'level:scrub-forward': 'onScrubForward'\r\n    'level:scrub-back': 'onScrubBack'\r\n    'level:set-volume': 'onSetVolume'\r\n    'surface:frame-changed': 'onFrameChanged'\r\n    'god:new-world-created': 'onNewWorld'\r\n    'god:streaming-world-updated': 'onNewWorld'\r\n    'level:set-letterbox': 'onSetLetterbox'\r\n    'tome:cast-spells': 'onTomeCast'\r\n    'playback:real-time-playback-ended': 'onRealTimePlaybackEnded'\r\n    'playback:stop-real-time-playback': 'onStopRealTimePlayback'\r\n\r\n  events:\r\n    'click #music-button': 'onToggleMusic'\r\n    'click #zoom-in-button': -> Backbone.Mediator.publish 'camera:zoom-in', {} unless @shouldIgnore()\r\n    'click #zoom-out-button': -> Backbone.Mediator.publish 'camera:zoom-out', {} unless @shouldIgnore()\r\n    'click #volume-button': 'onToggleVolume'\r\n    'click #play-button': 'onTogglePlay'\r\n    'click': -> Backbone.Mediator.publish 'tome:focus-editor', {} unless @realTime\r\n    'mouseenter #timeProgress': 'onProgressEnter'\r\n    'mouseleave #timeProgress': 'onProgressLeave'\r\n    'mousemove #timeProgress': 'onProgressHover'\r\n    'tapstart #timeProgress': 'onProgressTapStart'\r\n    'tapend #timeProgress': 'onProgressTapEnd'\r\n    'tapmove #timeProgress': 'onProgressTapMove'\r\n\r\n  shortcuts:\r\n    '⌘+p, p, ctrl+p': 'onTogglePlay'\r\n    '⌘+[, ctrl+[': 'onScrubBack'\r\n    '⌘+⇧+[, ctrl+⇧+[': 'onSingleScrubBack'\r\n    '⌘+], ctrl+]': 'onScrubForward'\r\n    '⌘+⇧+], ctrl+⇧+]': 'onSingleScrubForward'\r\n\r\n  constructor: ->\r\n    super(arguments...)\r\n    me.on('change:music', @updateMusicButton, @)\r\n\r\n  afterRender: ->\r\n    super()\r\n    @$progressScrubber = $('.scrubber .progress', @$el)\r\n    @hookUpScrubber() unless @options.level.isType('game-dev')\r\n    @updateMusicButton()\r\n    $(window).on('resize', @onWindowResize)\r\n    ua = navigator.userAgent.toLowerCase()\r\n    if /safari/.test(ua) and not /chrome/.test(ua)\r\n      @$el.find('.toggle-fullscreen').hide()\r\n    @timePopup ?= new HoverPopup\r\n    t = $.i18n.t\r\n    @second = t 'units.second'\r\n    @seconds = t 'units.seconds'\r\n    @minute = t 'units.minute'\r\n    @minutes = t 'units.minutes'\r\n    @goto = t 'play_level.time_goto'\r\n    @current = t 'play_level.time_current'\r\n    @total = t 'play_level.time_total'\r\n    @$el.find('#play-button').css('visibility', 'hidden') if @options.level.get 'hidesPlayButton'  # Don't show for first few levels, confuses new players.\r\n\r\n  updatePopupContent: ->\r\n    @timePopup?.updateContent \"<h2>#{@timeToString @newTime}</h2>#{@formatTime(@current, @currentTime)}<br/>#{@formatTime(@total, @totalTime)}\"\r\n\r\n  # These functions could go to some helper class\r\n\r\n  pad2: (num) ->\r\n    if not num? or num is 0 then '00' else ((if num < 10 then '0' else '') + num)\r\n\r\n  formatTime: (text, time) =>\r\n    \"#{text}\\t#{@timeToString time}\"\r\n\r\n  timeToString: (time=0, withUnits=false) ->\r\n    mins = Math.floor(time / 60)\r\n    secs = (time - mins * 60).toFixed(1)\r\n    if withUnits\r\n      ret = ''\r\n      ret = (mins + ' ' + (if mins is 1 then @minute else @minutes)) if (mins > 0)\r\n      ret = (ret + ' ' + secs + ' ' + (if secs is 1 then @second else @seconds)) if (secs > 0 or mins is 0)\r\n    else\r\n      \"#{mins}:#{@pad2 secs}\"\r\n\r\n  # callbacks\r\n\r\n  updateMusicButton: ->\r\n    @$el.find('#music-button').toggleClass('music-on', me.get('music'))\r\n\r\n  onSetLetterbox: (e) ->\r\n    return if @realTime\r\n    @togglePlaybackControls !e.on\r\n    @disabled = e.on\r\n\r\n  togglePlaybackControls: (to) ->\r\n    buttons = @$el.find '#play-button, .scrubber-handle'\r\n    buttons.css 'visibility', if to then 'visible' else 'hidden'\r\n\r\n  onTomeCast: (e) ->\r\n    return unless e.realTime\r\n    @realTime = true\r\n    @togglePlaybackControls false\r\n    Backbone.Mediator.publish 'playback:real-time-playback-started', {}\r\n    @playSound 'real-time-playback-start'\r\n\r\n  onWindowResize: (s...) =>\r\n    @barWidth = $('.progress', @$el).width()\r\n\r\n  onNewWorld: (e) ->\r\n    @updateBarWidth e.world.frames.length, e.world.maxTotalFrames, e.world.dt\r\n\r\n  updateBarWidth: (loadedFrameCount, maxTotalFrames, dt) ->\r\n    @totalTime = (loadedFrameCount - 1) * dt\r\n    pct = parseInt(100 * loadedFrameCount / (maxTotalFrames - 1)) + '%'\r\n    @barWidth = $('.progress', @$el).css('width', pct).show().width()\r\n    $('.scrubber .progress', @$el).slider('enable', true)\r\n    @newTime = 0\r\n    @currentTime = 0\r\n    @lastLoadedFrameCount = loadedFrameCount\r\n\r\n  onDisableControls: (e) ->\r\n    if not e.controls or ('playback' in e.controls)\r\n      @disabled = true\r\n      $('button', @$el).addClass('disabled')\r\n      try\r\n        @$progressScrubber.slider('disable', true)\r\n      catch error\r\n        console.warn('error disabling scrubber', error)\r\n      @timePopup?.disable()\r\n      $('#volume-button', @$el).removeClass('disabled')\r\n      @$el.addClass 'controls-disabled'\r\n\r\n  onEnableControls: (e) ->\r\n    return if @realTime\r\n    if not e.controls or ('playback' in e.controls)\r\n      @disabled = false\r\n      $('button', @$el).removeClass('disabled')\r\n      try\r\n        @$progressScrubber.slider('enable', true)\r\n      catch error\r\n        console.warn('error enabling scrubber', error)\r\n      @timePopup?.enable()\r\n      @$el.removeClass 'controls-disabled'\r\n\r\n  onSetPlaying: (e) ->\r\n    @playing = (e ? {}).playing ? true\r\n    button = @$el.find '#play-button'\r\n    ended = button.hasClass 'ended'\r\n    changed = button.hasClass('playing') isnt @playing\r\n    button.toggleClass('playing', @playing and not ended).toggleClass('paused', not @playing and not ended)\r\n    @playSound (if @playing then 'playback-play' else 'playback-pause') unless @options.level.isType('game-dev')\r\n    return   # don't stripe the bar\r\n    bar = @$el.find '.scrubber .progress'\r\n    bar.toggleClass('progress-striped', @playing and not ended).toggleClass('active', @playing and not ended)\r\n\r\n  onSetVolume: (e) ->\r\n    classes = ['vol-off', 'vol-down', 'vol-up']\r\n    button = $('#volume-button', @$el)\r\n    button.removeClass(c) for c in classes\r\n    button.addClass(classes[0]) if e.volume <= 0.0\r\n    button.addClass(classes[1]) if e.volume > 0.0 and e.volume < 1.0\r\n    button.addClass(classes[2]) if e.volume >= 1.0\r\n\r\n  onScrub: (e, options) ->\r\n    e?.preventDefault?()\r\n    options.scrubDuration = 500\r\n    Backbone.Mediator.publish('level:set-time', options)\r\n\r\n  onScrubForward: (e) ->\r\n    @onScrub e, ratioOffset: 0.05\r\n\r\n  onSingleScrubForward: (e) ->\r\n    @onScrub e, frameOffset: 1\r\n\r\n  onScrubBack: (e) ->\r\n    @onScrub e, ratioOffset: -0.05\r\n\r\n  onSingleScrubBack: (e) ->\r\n    @onScrub e, frameOffset: -1\r\n\r\n  onFrameChanged: (e) ->\r\n    if e.progress isnt @lastProgress\r\n      @currentTime = e.frame / e.world.frameRate\r\n      @updatePopupContent() if @timePopup?.shown\r\n      @updateProgress(e.progress, e.world)\r\n      @updatePlayButton(e.progress)\r\n    @lastProgress = e.progress\r\n\r\n  onProgressEnter: (e) ->\r\n    # Why it needs itself as parameter you ask? Ask Twitter instead.\r\n    @timePopup?.enter @timePopup\r\n\r\n  onProgressLeave: (e) ->\r\n    @timePopup?.leave @timePopup\r\n\r\n  onProgressHover: (e, offsetX) ->\r\n    timeRatio = @$progressScrubber.width() / @totalTime\r\n    offsetX ?= e.clientX - $(e.target).closest('#timeProgress').offset().left\r\n    offsetX = Math.max 0, offsetX\r\n    @newTime = offsetX / timeRatio\r\n    @updatePopupContent()\r\n    @timePopup?.onHover e\r\n\r\n    # Show it instantaneously if close enough to current time.\r\n    if @timePopup and Math.abs(@currentTime - @newTime) < 1 and not @timePopup.shown\r\n      @timePopup.show()\r\n\r\n  onProgressTapStart: (e, touchData) ->\r\n    return unless application.isIPadApp\r\n    @onProgressEnter e\r\n    screenOffsetX = e.clientX ? touchData?.position.x ? 0\r\n    offsetX = screenOffsetX - $(e.target).closest('#timeProgress').offset().left\r\n    offsetX = Math.max offsetX, 0\r\n    @scrubTo offsetX / @$progressScrubber.width()\r\n    @onTogglePlay() if @$el.find('#play-button').hasClass 'playing'\r\n\r\n  onProgressTapEnd: (e, touchData) ->\r\n    return unless application.isIPadApp\r\n    @onProgressLeave e\r\n\r\n  onProgressTapMove: (e, touchData) ->\r\n    return unless application.isIPadApp  # Not sure why the tap events would fire when it's not one.\r\n    screenOffsetX = e.clientX ? touchData?.position.x ? 0\r\n    offsetX = screenOffsetX - $(e.target).closest('#timeProgress').offset().left\r\n    offsetX = Math.max offsetX, 0\r\n    @onProgressHover e, offsetX\r\n    @scrubTo offsetX / @$progressScrubber.width()\r\n\r\n  updateProgress: (progress, world) ->\r\n    if world.frames.length isnt @lastLoadedFrameCount\r\n      @updateBarWidth world.frames.length, world.maxTotalFrames, world.dt\r\n    wasLoaded = @worldCompletelyLoaded\r\n    @worldCompletelyLoaded = world.frames.length is world.totalFrames\r\n    if @realTime and @worldCompletelyLoaded and not wasLoaded\r\n      Backbone.Mediator.publish 'playback:real-time-playback-ended', {}\r\n      Backbone.Mediator.publish 'level:set-letterbox', on: false\r\n    $('.scrubber .progress-bar', @$el).css('width', \"#{progress * 100}%\")\r\n\r\n  updatePlayButton: (progress) ->\r\n    playButton = @$el.find('#play-button')\r\n    wasEnded = playButton.hasClass('ended')\r\n    if @worldCompletelyLoaded and progress >= 0.99 and @lastProgress < 0.99\r\n      playButton.removeClass('playing').removeClass('paused').addClass('ended')\r\n      Backbone.Mediator.publish 'level:set-letterbox', on: false if @realTime\r\n      Backbone.Mediator.publish 'playback:real-time-playback-ended', {} if @realTime\r\n    if progress < 0.99 and @lastProgress >= 0.99\r\n      playButton.removeClass('ended')\r\n      playButton.addClass(if @playing then 'playing' else 'paused')\r\n    isEnded = playButton.hasClass('ended')\r\n    if wasEnded isnt isEnded\r\n      Backbone.Mediator.publish 'playback:ended-changed', ended: isEnded\r\n\r\n  onRealTimePlaybackEnded: (e) ->\r\n    return unless @realTime\r\n    @realTime = false\r\n    @togglePlaybackControls true\r\n    @playSound 'real-time-playback-end'\r\n\r\n  onStopRealTimePlayback: (e) ->\r\n    Backbone.Mediator.publish 'level:set-letterbox', on: false\r\n    Backbone.Mediator.publish 'playback:real-time-playback-ended', {}\r\n\r\n  # to refactor\r\n\r\n  hookUpScrubber: ->\r\n    @sliderIncrements = 500  # max slider width before we skip pixels\r\n    @$progressScrubber.slider(\r\n      max: @sliderIncrements\r\n      animate: 'slow'\r\n      slide: (event, ui) =>\r\n        return if @shouldIgnore()\r\n        ++@slideCount\r\n        oldRatio = @getScrubRatio()\r\n        @scrubTo ui.value / @sliderIncrements\r\n        if ratioChange = @getScrubRatio() - oldRatio\r\n          sound = \"playback-scrub-slide-#{if ratioChange > 0 then 'forward' else 'back'}-#{@slideCount % 3}\"\r\n          unless /back/.test sound  # We don't have the back sounds in yet: http://discourse.codecombat.com/t/bug-some-mp3-lost/4830\r\n            @playSound sound, (Math.min 1, Math.abs ratioChange * 50)\r\n\r\n      start: (event, ui) =>\r\n        return if @shouldIgnore()\r\n        @slideCount = 0\r\n        @wasPlaying = @playing and not $('#play-button').hasClass('ended')\r\n        Backbone.Mediator.publish 'level:set-playing', {playing: false}\r\n        @playSound 'playback-scrub-start', 0.5\r\n\r\n\r\n      stop: (event, ui) =>\r\n        return if @shouldIgnore()\r\n        @actualProgress = ui.value / @sliderIncrements\r\n        Backbone.Mediator.publish 'playback:manually-scrubbed', ratio: @actualProgress  # For scripts\r\n        Backbone.Mediator.publish 'level:set-playing', {playing: @wasPlaying}\r\n        if @slideCount < 3\r\n          @wasPlaying = false\r\n          Backbone.Mediator.publish 'level:set-playing', {playing: false}\r\n          @$el.find('.scrubber-handle').effect('bounce', {times: 2})\r\n        else\r\n          @playSound 'playback-scrub-end', 0.5\r\n\r\n    )\r\n\r\n  getScrubRatio: ->\r\n    @$progressScrubber.find('.progress-bar').width() / @$progressScrubber.width()\r\n\r\n  scrubTo: (ratio, duration=0) ->\r\n    return if @shouldIgnore()\r\n    Backbone.Mediator.publish 'level:set-time', ratio: ratio, scrubDuration: duration\r\n\r\n  shouldIgnore: -> return @disabled or @realTime\r\n\r\n  onTogglePlay: (e) ->\r\n    e?.preventDefault?()\r\n    return if @shouldIgnore()\r\n    button = $('#play-button')\r\n    willPlay = button.hasClass('paused') or button.hasClass('ended')\r\n    Backbone.Mediator.publish 'level:set-playing', playing: willPlay\r\n    $(document.activeElement).blur()\r\n\r\n  onToggleVolume: (e) ->\r\n    button = $(e.target).closest('#volume-button')\r\n    classes = ['vol-off', 'vol-down', 'vol-up']\r\n    volumes = [0, 0.4, 1.0]\r\n    for oldClass, i in classes\r\n      if button.hasClass oldClass\r\n        newI = (i + 1) % classes.length\r\n        break\r\n      else if i is classes.length - 1  # no oldClass\r\n        newI = 2\r\n    Backbone.Mediator.publish 'level:set-volume', volume: volumes[newI]\r\n    $(document.activeElement).blur()\r\n\r\n  onToggleMusic: (e) ->\r\n    e?.preventDefault()\r\n    me.set('music', not me.get('music', true))\r\n    me.patch()\r\n    $(document.activeElement).blur()\r\n\r\n  destroy: ->\r\n    me.off('change:music', @updateMusicButton, @)\r\n    $(window).off('resize', @onWindowResize)\r\n    @onWindowResize = null\r\n    super()\r\n\r\n# popover that shows at the current mouse position on the progressbar, using the bootstrap popover.\r\n# Could make this into a jQuery plugins itself theoretically.\r\nclass HoverPopup extends $.fn.popover.Constructor\r\n  constructor: () ->\r\n    @enabled = true\r\n    @shown = false\r\n    @type = 'HoverPopup'\r\n    @options =\r\n      placement: 'top'\r\n      container: 'body'\r\n      animation: true\r\n      html: true\r\n      delay:\r\n        show: 400\r\n    @$element = $('#timeProgress')\r\n    @$tip = $('#timePopover')\r\n\r\n    @content = ''\r\n\r\n  getContent: -> @content\r\n\r\n  show: ->\r\n    unless @shown\r\n      super()\r\n      @shown = true\r\n\r\n  updateContent: (@content) ->\r\n    @setContent()\r\n    @$tip.addClass('fade top in')\r\n\r\n  onHover: (@e) ->\r\n    pos = @getPosition()\r\n    actualWidth  = @$tip[0].offsetWidth\r\n    actualHeight = @$tip[0].offsetHeight\r\n    calculatedOffset =\r\n      top: pos.top - actualHeight\r\n      left: pos.left + pos.width / 2 - actualWidth / 2\r\n    @applyPlacement(calculatedOffset, 'top')\r\n\r\n  getPosition: ->\r\n    top: @$element.offset().top\r\n    left: if @e? then @e.pageX else @$element.offset().left\r\n    height: 0\r\n    width: 0\r\n\r\n  hide: ->\r\n    super()\r\n    @shown = false\r\n\r\n  disable: ->\r\n    super()\r\n    @hide()\r\n"]}