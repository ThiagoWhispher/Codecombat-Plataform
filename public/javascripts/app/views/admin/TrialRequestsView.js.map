{"version":3,"sources":["app/views/admin/TrialRequestsView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/admin/TrialRequestsView.js","sourcesContent":["RootView = require 'views/core/RootView'\r\ntemplate = require 'templates/admin/trial-requests'\r\nCocoCollection = require 'collections/CocoCollection'\r\nTrialRequest = require 'models/TrialRequest'\r\n\r\nmodule.exports = class TrialRequestsView extends RootView\r\n  id: 'admin-trial-requests-view'\r\n  template: template\r\n\r\n  events:\r\n    'click .btn-approve': 'onClickApprove'\r\n    'click .btn-deny': 'onClickDeny'\r\n\r\n  constructor: (options) ->\r\n    super options\r\n    if me.isAdmin()\r\n      sortRequests = (a, b) ->\r\n        statusA = a.get('status')\r\n        statusB = b.get('status')\r\n        if statusA is 'submitted' and statusB is 'submitted'\r\n          if a.get('created') < b.get('created')\r\n            -1\r\n          else\r\n            1\r\n        else if statusA is 'submitted'\r\n          -1\r\n        else if statusB is 'submitted'\r\n          1\r\n        else if not b.get('reviewDate') or a.get('reviewDate') > b.get('reviewDate')\r\n          -1\r\n        else\r\n          1\r\n      @trialRequests = new CocoCollection([], { url: '/db/trial.request?conditions[sort]=\"-created\"&conditions[limit]=1000', model: TrialRequest, comparator: sortRequests })\r\n      @supermodel.loadCollection(@trialRequests, 'trial-requests', {cache: false})\r\n\r\n  getRenderData: ->\r\n    context = super()\r\n    context.trialRequests = @trialRequests?.models ? []\r\n    context\r\n\r\n  onClickApprove: (e) ->\r\n    trialRequestID = $(e.target).data('trial-request-id')\r\n    trialRequest = _.find @trialRequests.models, (a) -> a.id is trialRequestID\r\n    unless trialRequest\r\n      console.error 'Could not find trial request model for', trialRequestData\r\n      return\r\n    trialRequest.set('status', 'approved')\r\n    trialRequest.patch\r\n      error: (model, response, options) =>\r\n        console.error 'Error patching trial request', response\r\n      success: (model, response, options) =>\r\n        @render?()\r\n\r\n  onClickDeny: (e) ->\r\n    trialRequestID = $(e.target).data('trial-request-id')\r\n    trialRequest = _.find @trialRequests.models, (a) -> a.id is trialRequestID\r\n    unless trialRequest\r\n      console.error 'Could not find trial request model for', trialRequestData\r\n      return\r\n    return unless window.confirm(\"Deny #{trialRequest.get('properties').email}?\")\r\n    trialRequest.set('status', 'denied')\r\n    trialRequest.patch\r\n      error: (model, response, options) =>\r\n        console.error 'Error patching trial request', response\r\n      success: (model, response, options) =>\r\n        @render?()\r\n"]}