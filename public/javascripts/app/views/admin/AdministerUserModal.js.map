{"version":3,"sources":["app/templates/admin/administer-user-modal.jade","app/views/admin/AdministerUserModal.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1JA;AAAA;;ACAA;EAAA;;;AAAA,YAAY,QAAQ,sBAAR;;AACZ,WAAW,QAAQ,uCAAR;;AACX,OAAO,QAAQ,aAAR;;AACP,UAAU,QAAQ,gBAAR;;AACV,gBAAgB,QAAQ,2BAAR;;AAChB,QAAQ,QAAQ,YAAR;;AACR,WAAW,QAAQ,sBAAR;;AACX,aAAa,QAAQ,wBAAR;;AAEb,MAAM,CAAC,OAAP,GAAuB;;;;;;;gCACrB,KAAI;;gCACJ,WAAU;;gCAEV,SACE;IAAA,uBAAuB,oBAAvB;IACA,wBAAwB,uBADxB;IAEA,wBAAwB,wBAFxB;IAGA,wBAAwB,wBAHxB;IAIA,+BAA+B,8BAJ/B;IAKA,8BAA8B,4BAL9B;;;gCAOF,aAAY,SAAC,OAAD,EAAU,UAAV;IAAU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","file":"public/javascripts/app/views/admin/AdministerUserModal.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),view = locals_.view,moment = locals_.moment;buf.push(\"<div class=\\\"modal-dialog\\\"><div class=\\\"modal-content style-flat\\\"><div class=\\\"modal-header\\\">\");\nif ( view.closeButton)\n{\nbuf.push(\"<div type=\\\"button\\\" data-dismiss=\\\"modal\\\" aria-hidden=\\\"true\\\" class=\\\"button close\\\">&times;</div>\");\n}\nbuf.push(\"<div class=\\\"pull-right\\\">\");\nif ( view.user.isStudent())\n{\nbuf.push(\"<button id=\\\"destudent-btn\\\" class=\\\"btn btn-burgandy\\\">Destudent</button>\");\n}\nif ( view.user.isTeacher())\n{\nbuf.push(\"<button id=\\\"deteacher-btn\\\" class=\\\"btn btn-burgandy\\\">Deteacher</button>\");\n}\nbuf.push(\"</div><h3>Administer User</h3><h4>\" + (jade.escape((jade.interp = view.user.get('name') || 'Unnamed') == null ? '' : jade.interp)) + \" / \" + (jade.escape((jade.interp = view.user.get('email')) == null ? '' : jade.interp)) + \"</h4><span>\" + (jade.escape(null == (jade.interp = view.user.id) ? \"\" : jade.interp)) + \"</span>\");\nif ( view.user.get('cleverID'))\n{\nbuf.push(\"<br/><b>Clever ID:</b>\" + (jade.escape(null == (jade.interp = \" \") ? \"\" : jade.interp)) + \"<span>\" + (jade.escape(null == (jade.interp = view.user.get('cleverID')) ? \"\" : jade.interp)) + \"</span>\");\n}\nbuf.push(\"</div><div class=\\\"modal-body\\\"><h3 class=\\\"m-t-3\\\">Grant Student Licenses</h3><div id=\\\"prepaid-form\\\" class=\\\"form\\\">\");\nif ( view.state === 'creating-prepaid')\n{\nbuf.push(\"<div class=\\\"progress progress-striped active\\\"><div style=\\\"width: 100%\\\" class=\\\"progress-bar\\\"></div></div>\");\n}\nelse if ( view.state === 'made-prepaid')\n{\nbuf.push(\"<div class=\\\"alert alert-success\\\">Licenses created!</div>\");\n}\nelse\n{\nbuf.push(\"<div class=\\\"form-group\\\"><label>Number of Licenses</label><input id=\\\"seats-input\\\" type=\\\"number\\\" name=\\\"maxRedeemers\\\" class=\\\"form-control\\\"/></div><div class=\\\"form-group\\\"><label>Start Date</label><input\" + (jade.attrs({ 'type':(\"date\"), 'name':(\"startDate\"), 'value':(moment().format('YYYY-MM-DD')), \"class\": [('form-control')] }, {\"type\":true,\"name\":true,\"value\":true})) + \"/></div><div class=\\\"form-group\\\"><label>End Date</label><input\" + (jade.attrs({ 'type':(\"date\"), 'name':(\"endDate\"), 'value':(moment().add(1, 'year').format('YYYY-MM-DD')), \"class\": [('form-control')] }, {\"type\":true,\"name\":true,\"value\":true})) + \"/></div><div class=\\\"form-group\\\"><button id=\\\"add-seats-btn\\\" class=\\\"btn btn-primary\\\">Add Licenses</button></div>\");\n}\nbuf.push(\"</div>\");\nif ( view.prepaids.size())\n{\nbuf.push(\"<h3 class=\\\"m-t-3\\\">Existing Prepaids</h3><table class=\\\"table table-condensed\\\"><tr><th>ID</th><th>Type</th><th>Start</th><th>End</th><th>Used</th></tr>\");\n// iterate view.prepaids.models\n;(function(){\n  var $$obj = view.prepaids.models;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var prepaid = $$obj[$index];\n\nbuf.push(\"<tr><td>\" + (jade.escape(null == (jade.interp = prepaid.id) ? \"\" : jade.interp)) + \"</td><td>\" + (jade.escape(null == (jade.interp = prepaid.get('type')) ? \"\" : jade.interp)) + \"</td><td>\");\nif ( prepaid.get('startDate'))\n{\nbuf.push(jade.escape(null == (jade.interp = moment(prepaid.get('startDate')).utc().format('lll')) ? \"\" : jade.interp));\n}\nbuf.push(\"</td><td>\");\nif ( prepaid.get('endDate'))\n{\nbuf.push(jade.escape(null == (jade.interp = moment(prepaid.get('endDate')).utc().format('lll')) ? \"\" : jade.interp));\n}\nbuf.push(\"</td><td>\" + (jade.escape((jade.interp = (prepaid.get('redeemers') || []).length) == null ? '' : jade.interp)) + \" / \" + (jade.escape((jade.interp = prepaid.get('maxRedeemers') || 0) == null ? '' : jade.interp)) + \"</td></tr>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var prepaid = $$obj[$index];\n\nbuf.push(\"<tr><td>\" + (jade.escape(null == (jade.interp = prepaid.id) ? \"\" : jade.interp)) + \"</td><td>\" + (jade.escape(null == (jade.interp = prepaid.get('type')) ? \"\" : jade.interp)) + \"</td><td>\");\nif ( prepaid.get('startDate'))\n{\nbuf.push(jade.escape(null == (jade.interp = moment(prepaid.get('startDate')).utc().format('lll')) ? \"\" : jade.interp));\n}\nbuf.push(\"</td><td>\");\nif ( prepaid.get('endDate'))\n{\nbuf.push(jade.escape(null == (jade.interp = moment(prepaid.get('endDate')).utc().format('lll')) ? \"\" : jade.interp));\n}\nbuf.push(\"</td><td>\" + (jade.escape((jade.interp = (prepaid.get('redeemers') || []).length) == null ? '' : jade.interp)) + \" / \" + (jade.escape((jade.interp = prepaid.get('maxRedeemers') || 0) == null ? '' : jade.interp)) + \"</td></tr>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</table>\");\n}\nbuf.push(\"<h3>Stripe Benefit</h3><div class=\\\"form\\\"><div class=\\\"form-group\\\"><div class=\\\"radio\\\"><label><input\" + (jade.attrs({ 'type':(\"radio\"), 'name':(\"stripe-benefit\"), 'value':(\"\"), 'checked':(view.none) }, {\"type\":true,\"name\":true,\"value\":true,\"checked\":true})) + \"/>None</label></div><div class=\\\"radio\\\"><label><input\" + (jade.attrs({ 'type':(\"radio\"), 'name':(\"stripe-benefit\"), 'value':(\"free\"), 'checked':(view.free) }, {\"type\":true,\"name\":true,\"value\":true,\"checked\":true})) + \"/>Free</label></div><div class=\\\"radio\\\"><label><input\" + (jade.attrs({ 'type':(\"radio\"), 'name':(\"stripe-benefit\"), 'value':(\"free-until\"), 'checked':(view.freeUntil) }, {\"type\":true,\"name\":true,\"value\":true,\"checked\":true})) + \"/>Free Until<input\" + (jade.attrs({ 'type':(\"date\"), 'name':(\"stripe-free-until\"), 'value':(view.freeUntilDate), 'id':('free-until-date'), \"class\": [('form-control'),('spl')] }, {\"type\":true,\"name\":true,\"value\":true})) + \"/></label></div><div class=\\\"radio\\\"><label><input\" + (jade.attrs({ 'type':(\"radio\"), 'name':(\"stripe-benefit\"), 'value':(\"coupon\"), 'checked':(view.coupon) }, {\"type\":true,\"name\":true,\"value\":true,\"checked\":true})) + \"/>Coupon</label><select id=\\\"coupon-select\\\" class=\\\"form-control\\\">\");\n// iterate view.coupons.models\n;(function(){\n  var $$obj = view.coupons.models;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var coupon = $$obj[$index];\n\nbuf.push(\"<option\" + (jade.attrs({ 'value':(coupon.id), 'selected':(coupon.id===view.currentCouponID) }, {\"value\":true,\"selected\":true})) + \">\" + (jade.escape(null == (jade.interp = coupon.formatString()) ? \"\" : jade.interp)) + \"</option>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var coupon = $$obj[$index];\n\nbuf.push(\"<option\" + (jade.attrs({ 'value':(coupon.id), 'selected':(coupon.id===view.currentCouponID) }, {\"value\":true,\"selected\":true})) + \">\" + (jade.escape(null == (jade.interp = coupon.formatString()) ? \"\" : jade.interp)) + \"</option>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</select></div></div><button id=\\\"save-changes\\\" class=\\\"btn btn-primary\\\">Save Changes</button></div>\");\nif ( view.classrooms.size())\n{\nbuf.push(\"<h3 class=\\\"m-t-3\\\">Update Classrooms</h3><table id=\\\"classroom-table\\\" class=\\\"table\\\"><tr><th>Name</th><th>Lang</th><th># Levels / Courses</th><th></th></tr>\");\n// iterate view.classrooms.models\n;(function(){\n  var $$obj = view.classrooms.models;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var classroom = $$obj[$index];\n\nbuf.push(\"<tr><td>\" + (jade.escape(null == (jade.interp = classroom.get('name')) ? \"\" : jade.interp)));\nif ( classroom.get('archived'))\n{\nbuf.push(\"<i class=\\\"spl text-muted\\\">(archived)</i>\");\n}\nbuf.push(\"</td><td>\" + (jade.escape(null == (jade.interp = classroom.capitalLanguage) ? \"\" : jade.interp)) + \"</td><td>\" + (jade.escape((jade.interp = classroom.getLevels().size()) == null ? '' : jade.interp)) + \" / \" + (jade.escape((jade.interp = classroom.get('courses').length) == null ? '' : jade.interp)) + \"</td><td><button\" + (jade.attrs({ 'data-classroom-id':(classroom.id), \"class\": [('btn'),('btn-primary'),('update-classroom-btn')] }, {\"data-classroom-id\":true})) + \">Update All Levels</button><button\" + (jade.attrs({ 'data-classroom-id':(classroom.id), \"class\": [('btn'),('btn-primary'),('add-new-courses-btn')] }, {\"data-classroom-id\":true})) + \">Add New Courses</button></td></tr>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var classroom = $$obj[$index];\n\nbuf.push(\"<tr><td>\" + (jade.escape(null == (jade.interp = classroom.get('name')) ? \"\" : jade.interp)));\nif ( classroom.get('archived'))\n{\nbuf.push(\"<i class=\\\"spl text-muted\\\">(archived)</i>\");\n}\nbuf.push(\"</td><td>\" + (jade.escape(null == (jade.interp = classroom.capitalLanguage) ? \"\" : jade.interp)) + \"</td><td>\" + (jade.escape((jade.interp = classroom.getLevels().size()) == null ? '' : jade.interp)) + \" / \" + (jade.escape((jade.interp = classroom.get('courses').length) == null ? '' : jade.interp)) + \"</td><td><button\" + (jade.attrs({ 'data-classroom-id':(classroom.id), \"class\": [('btn'),('btn-primary'),('update-classroom-btn')] }, {\"data-classroom-id\":true})) + \">Update All Levels</button><button\" + (jade.attrs({ 'data-classroom-id':(classroom.id), \"class\": [('btn'),('btn-primary'),('add-new-courses-btn')] }, {\"data-classroom-id\":true})) + \">Add New Courses</button></td></tr>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</table>\");\n}\nbuf.push(\"</div><div class=\\\"modal-body wait secret\\\"><h3>Reticulating Splines...</h3><div class=\\\"progress progress-striped active\\\"><div class=\\\"progress-bar\\\"></div></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","ModalView = require 'views/core/ModalView'\r\ntemplate = require 'templates/admin/administer-user-modal'\r\nUser = require 'models/User'\r\nPrepaid = require 'models/Prepaid'\r\nStripeCoupons = require 'collections/StripeCoupons'\r\nforms = require 'core/forms'\r\nPrepaids = require 'collections/Prepaids'\r\nClassrooms = require 'collections/Classrooms'\r\n\r\nmodule.exports = class AdministerUserModal extends ModalView\r\n  id: 'administer-user-modal'\r\n  template: template\r\n\r\n  events:\r\n    'click #save-changes': 'onClickSaveChanges'\r\n    'click #add-seats-btn': 'onClickAddSeatsButton'\r\n    'click #destudent-btn': 'onClickDestudentButton'\r\n    'click #deteacher-btn': 'onClickDeteacherButton'\r\n    'click .update-classroom-btn': 'onClickUpdateClassroomButton'\r\n    'click .add-new-courses-btn': 'onClickAddNewCoursesButton'\r\n\r\n  initialize: (options, @userHandle) ->\r\n    @user = new User({_id:@userHandle})\r\n    @supermodel.trackRequest @user.fetch({cache: false})\r\n    @coupons = new StripeCoupons()\r\n    @supermodel.trackRequest @coupons.fetch({cache: false})\r\n    @prepaids = new Prepaids()\r\n    @supermodel.trackRequest @prepaids.fetchByCreator(@userHandle)\r\n    @classrooms = new Classrooms()\r\n    @supermodel.trackRequest @classrooms.fetchByOwner(@userHandle)\r\n    \r\n  onLoaded: ->\r\n    # TODO: Figure out a better way to expose this info, perhaps User methods?\r\n    stripe = @user.get('stripe') or {}\r\n    @free = stripe.free is true\r\n    @freeUntil = _.isString(stripe.free)\r\n    @freeUntilDate = if @freeUntil then stripe.free else new Date().toISOString()[...10]\r\n    @currentCouponID = stripe.couponID\r\n    @none = not (@free or @freeUntil or @coupon)\r\n    super()\r\n    \r\n  onClickSaveChanges: ->\r\n    stripe = _.clone(@user.get('stripe') or {})\r\n    delete stripe.free\r\n    delete stripe.couponID\r\n\r\n    selection = @$el.find('input[name=\"stripe-benefit\"]:checked').val()\r\n    dateVal = @$el.find('#free-until-date').val()\r\n    couponVal = @$el.find('#coupon-select').val()\r\n    switch selection\r\n      when 'free' then stripe.free = true\r\n      when 'free-until' then stripe.free = dateVal\r\n      when 'coupon' then stripe.couponID = couponVal\r\n\r\n    @user.set('stripe', stripe)\r\n    options = {}\r\n    options.success = => @hide()\r\n    @user.patch(options)\r\n\r\n  onClickAddSeatsButton: ->\r\n    attrs = forms.formToObject(@$('#prepaid-form'))\r\n    attrs.maxRedeemers = parseInt(attrs.maxRedeemers)\r\n    return unless _.all(_.values(attrs))\r\n    return unless attrs.maxRedeemers > 0\r\n    return unless attrs.endDate and attrs.startDate and attrs.endDate > attrs.startDate\r\n    attrs.startDate = new Date(attrs.startDate).toISOString()\r\n    attrs.endDate = new Date(attrs.endDate).toISOString()\r\n    _.extend(attrs, {\r\n      type: 'course'\r\n      creator: @user.id\r\n      properties:\r\n        adminAdded: me.id\r\n    })\r\n    prepaid = new Prepaid(attrs)\r\n    prepaid.save()\r\n    @state = 'creating-prepaid'\r\n    @renderSelectors('#prepaid-form')\r\n    @listenTo prepaid, 'sync', ->\r\n      @state = 'made-prepaid'\r\n      @renderSelectors('#prepaid-form')\r\n\r\n  onClickDestudentButton: (e) ->\r\n    button = $(e.currentTarget)\r\n    button.attr('disabled', true).text('...')\r\n    Promise.resolve(@user.destudent())\r\n    .then =>\r\n      button.remove()\r\n    .catch (e) =>\r\n      button.attr('disabled', false).text('Destudent')\r\n      noty { \r\n        text: e.message or e.responseJSON?.message or e.responseText or 'Unknown Error'\r\n        type: 'error'\r\n      }\r\n      if e.stack\r\n        throw e\r\n\r\n  onClickDeteacherButton: (e) ->\r\n    button = $(e.currentTarget)\r\n    button.attr('disabled', true).text('...')\r\n    Promise.resolve(@user.deteacher())\r\n    .then =>\r\n      button.remove()\r\n    .catch (e) =>\r\n      button.attr('disabled', false).text('Destudent')\r\n      noty {\r\n        text: e.message or e.responseJSON?.message or e.responseText or 'Unknown Error'\r\n        type: 'error'\r\n      }\r\n      if e.stack\r\n        throw e\r\n\r\n  onClickUpdateClassroomButton: (e) ->\r\n    classroom = @classrooms.get($(e.currentTarget).data('classroom-id'))\r\n    if confirm(\"Really update #{classroom.get('name')}?\")\r\n      Promise.resolve(classroom.updateCourses())\r\n      .then =>\r\n        noty({text: 'Updated classroom courses.'})\r\n        @renderSelectors('#classroom-table')\r\n      .catch ->\r\n        noty({text: 'Failed to update classroom courses.', type: 'error'})\r\n\r\n  onClickAddNewCoursesButton: (e) ->\r\n    classroom = @classrooms.get($(e.currentTarget).data('classroom-id'))\r\n    if confirm(\"Really update #{classroom.get('name')}?\")\r\n      Promise.resolve(classroom.updateCourses({data: {addNewCoursesOnly: true}}))\r\n      .then =>\r\n        noty({text: 'Updated classroom courses.'})\r\n        @renderSelectors('#classroom-table')\r\n      .catch ->\r\n        noty({text: 'Failed to update classroom courses.', type: 'error'})\r\n"]}