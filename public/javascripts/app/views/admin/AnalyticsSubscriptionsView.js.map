{"version":3,"sources":["app/views/admin/AnalyticsSubscriptionsView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/admin/AnalyticsSubscriptionsView.js","sourcesContent":["RootView = require 'views/core/RootView'\r\ntemplate = require 'templates/admin/analytics-subscriptions'\r\nThangType = require 'models/ThangType'\r\nUser = require 'models/User'\r\n\r\n# TODO: Graphing code copied/mangled from campaign editor level view.  OMG, DRY.\r\n\r\nrequire 'vendor/d3'\r\n\r\nmodule.exports = class AnalyticsSubscriptionsView extends RootView\r\n  id: 'admin-analytics-subscriptions-view'\r\n  template: template\r\n\r\n  events:\r\n    'click .btn-show-more-cancellations': 'onClickShowMoreCancellations'\r\n\r\n  constructor: (options) ->\r\n    super options\r\n    @showMoreCancellations = false\r\n    @resetSubscriptionsData()\r\n    @refreshData() if me.isAdmin()\r\n\r\n  getRenderData: ->\r\n    context = super()\r\n    context.analytics = @analytics ? graphs: []\r\n    context.cancellations = if @showMoreCancellations then @cancellations else (@cancellations ? []).slice(0, 40)\r\n    context.showMoreCancellations = @showMoreCancellations\r\n    context.subs = _.cloneDeep(@subs ? []).reverse()\r\n    context.subscribers = @subscribers ? []\r\n    context.subscriberCancelled = _.find context.subscribers, (subscriber) -> subscriber.cancel\r\n    context.subscriberSponsored = _.find context.subscribers, (subscriber) -> subscriber.user?.stripe?.sponsorID\r\n    context.total = @total ? 0\r\n    context.monthlyChurn = @monthlyChurn ? 0.0\r\n    context.monthlyGrowth = @monthlyGrowth ? 0.0\r\n    context.outstandingCancels = @outstandingCancels ? []\r\n    context.refreshDataState = @refreshDataState\r\n    context\r\n\r\n  afterRender: ->\r\n    super()\r\n    @updateAnalyticsGraphs()\r\n\r\n  onClickShowMoreCancellations: (e) ->\r\n    @showMoreCancellations = true\r\n    @render?()\r\n\r\n  resetSubscriptionsData: ->\r\n    @analytics = graphs: []\r\n    @subs = []\r\n    @total = 0\r\n    @monthlyChurn = 0.0\r\n    @monthlyGrowth = 0.0\r\n    @refreshDataState = 'Fetching dashboard data...'\r\n\r\n  refreshData: ->\r\n    return unless me.isAdmin()\r\n    @resetSubscriptionsData()\r\n    @getCancellations (cancellations) =>\r\n      @cancellations = cancellations\r\n      @render?()\r\n      @getOutstandingCancelledSubscriptions cancellations, (outstandingCancels) =>\r\n        @outstandingCancels = outstandingCancels\r\n        @getSubscriptions cancellations, (subscriptions) =>\r\n          @updateAnalyticsGraphData()\r\n          @render?()\r\n          @getSubscribers subscriptions, =>\r\n            @render?()\r\n\r\n  updateFetchDataState: (msg) ->\r\n    @refreshDataState = msg\r\n    @render?()\r\n\r\n  getCancellations: (done) ->\r\n    cancellations = []\r\n    @getCancellationEvents (cancelledSubscriptions) =>\r\n      # Get user objects for cancelled subscriptions\r\n      userIDs = _.filter(_.map(cancelledSubscriptions, (a) -> a.userID), (b) -> b?)\r\n      options =\r\n        url: '/db/user/-/users'\r\n        method: 'POST'\r\n        data: {ids: userIDs}\r\n      options.error = (model, response, options) =>\r\n        return if @destroyed\r\n        console.error 'Failed to get cancelled users', response\r\n      options.success = (cancelledUsers, response, options) =>\r\n        return if @destroyed\r\n        userMap = {}\r\n        userMap[user._id] = user for user in cancelledUsers\r\n        for cancellation in cancelledSubscriptions when cancellation.userID of userMap\r\n          cancellation.user = userMap[cancellation.userID]\r\n          cancellation.level = User.levelFromExp(cancellation.user.points)\r\n        cancelledSubscriptions.sort (a, b) -> if a.cancel > b.cancel then -1 else 1\r\n        done(cancelledSubscriptions)\r\n      @updateFetchDataState 'Fetching cancellations...'\r\n      @supermodel.addRequestResource('get_cancelled_users', options, 0).load()\r\n\r\n  getCancellationEvents: (done) ->\r\n    cancellationEvents = []\r\n    earliestEventDate = new Date()\r\n    earliestEventDate.setUTCMonth(earliestEventDate.getUTCMonth() - 2)\r\n    earliestEventDate.setUTCDate(earliestEventDate.getUTCDate() - 8)\r\n    nextBatch = (starting_after, done) =>\r\n      @updateFetchDataState \"Fetching cancellations #{cancellationEvents.length}...\"\r\n      options =\r\n        url: '/db/subscription/-/stripe_events'\r\n        method: 'POST'\r\n        data: {options: {limit: 100}}\r\n      options.data.options.starting_after = starting_after if starting_after\r\n      options.data.options.type = 'customer.subscription.updated'\r\n      options.data.options.created = gte: Math.floor(earliestEventDate.getTime() / 1000)\r\n      options.error = (model, response, options) =>\r\n        return if @destroyed\r\n        console.error 'Failed to get cancelled events', response\r\n      options.success = (events, response, options) =>\r\n        return if @destroyed\r\n        for event in events.data\r\n          continue unless event.data?.object?.cancel_at_period_end is true and event.data?.previous_attributes.cancel_at_period_end is false\r\n          continue unless event.data?.object?.plan?.id is 'basic'\r\n          continue unless event.data?.object?.id?\r\n          cancellationEvents.push\r\n            cancel: new Date(event.created * 1000)\r\n            customerID: event.data.object.customer\r\n            start: new Date(event.data.object.start * 1000)\r\n            subscriptionID: event.data.object.id\r\n            userID: event.data.object.metadata?.id\r\n\r\n        if events.has_more\r\n          return nextBatch(events.data[events.data.length - 1].id, done)\r\n        done(cancellationEvents)\r\n      @supermodel.addRequestResource('get_cancellation_events', options, 0).load()\r\n    nextBatch null, done\r\n\r\n  getOutstandingCancelledSubscriptions: (cancellations, done) ->\r\n    @updateFetchDataState \"Fetching oustanding cancellations...\"\r\n    trimmedCancellations = _.map(cancellations, (a) -> _.pick(a, ['customerID', 'subscriptionID']))\r\n    options =\r\n      url: '/db/subscription/-/stripe_subscriptions'\r\n      method: 'POST'\r\n      data: {subscriptions: trimmedCancellations}\r\n    options.error = (model, response, options) =>\r\n      return if @destroyed\r\n      console.error 'Failed to get outstanding cancellations', response\r\n    options.success = (subscriptions, response, options) =>\r\n      return if @destroyed\r\n      outstandingCancelledSubscriptions = []\r\n      for subscription in subscriptions\r\n        continue unless subscription?.cancel_at_period_end\r\n        outstandingCancelledSubscriptions.push\r\n          cancel: new Date(subscription.canceled_at * 1000)\r\n          customerID: subscription.customerID\r\n          start: new Date(subscription.start * 1000)\r\n          subscriptionID: subscription.id\r\n          userID: subscription.metadata?.id\r\n      done(outstandingCancelledSubscriptions)\r\n    @supermodel.addRequestResource('get_outstanding_cancelled_subscriptions', options, 0).load()\r\n\r\n  getSubscribers: (subscriptions, done) ->\r\n    # console.log 'getSubscribers', subscriptions.length\r\n    @updateFetchDataState \"Fetching recent subscribers...\"\r\n    @render?()\r\n    maxSubscribers = 40\r\n\r\n    subscribers = _.filter subscriptions, (a) -> a.userID?\r\n    subscribers.sort (a, b) -> if a.start > b.start then -1 else 1\r\n    subscribers = subscribers.slice(0, maxSubscribers)\r\n    subscriberUserIDs = _.map subscribers, (a) -> a.userID\r\n\r\n    options =\r\n      url: '/db/subscription/-/subscribers'\r\n      method: 'POST'\r\n      data: {ids: subscriberUserIDs}\r\n    options.error = (model, response, options) =>\r\n      return if @destroyed\r\n      console.error 'Failed to get subscribers', response\r\n    options.success = (userMap, response, options) =>\r\n      return if @destroyed\r\n      for subscriber in subscribers\r\n        continue unless subscriber.userID of userMap\r\n        subscriber.user = userMap[subscriber.userID]\r\n        subscriber.level = User.levelFromExp subscriber.user.points\r\n        if hero = subscriber.user.heroConfig?.thangType\r\n          subscriber.hero = _.invert(ThangType.heroes)[hero]\r\n      @subscribers = subscribers\r\n      done()\r\n    @supermodel.addRequestResource('get_subscribers', options, 0).load()\r\n\r\n  getSubscriptions: (cancellations=[], done) ->\r\n    @getInvoices (invoices) =>\r\n      subMap = {}\r\n      for invoice in invoices\r\n        subID = invoice.subscriptionID\r\n        if subID of subMap\r\n          subMap[subID].first = new Date(invoice.date)\r\n        else\r\n          subMap[subID] =\r\n            first: new Date(invoice.date)\r\n            last: new Date(invoice.date)\r\n            customerID: invoice.customerID\r\n        subMap[subID].userID = invoice.userID if invoice.userID\r\n\r\n      @getSponsors (sponsors) =>\r\n        @getRecipientSubscriptions sponsors, (recipientSubscriptions) =>\r\n          for subscription in recipientSubscriptions\r\n            subMap[subscription.id] =\r\n              first: new Date(subscription.start * 1000)\r\n            subMap[subscription.id].userID = subscription.metadata.id if subscription.metadata?.id?\r\n            if subscription.cancel_at_period_end\r\n              subMap[subscription.id].cancel = new Date(subscription.canceled_at * 1000)\r\n              subMap[subscription.id].end = new Date(subscription.current_period_end * 1000)\r\n\r\n          subs = []\r\n          for subID of subMap\r\n            sub =\r\n              customerID: subMap[subID].customerID\r\n              start: subMap[subID].first\r\n              subscriptionID: subID\r\n            sub.cancel = subMap[subID].cancel if subMap[subID].cancel\r\n            oneMonthAgo = new Date()\r\n            oneMonthAgo.setUTCMonth(oneMonthAgo.getUTCMonth() - 1)\r\n            if subMap[subID].end?\r\n              sub.end = subMap[subID].end\r\n            else if subMap[subID].last < oneMonthAgo\r\n              sub.end = subMap[subID].last\r\n              sub.end.setUTCMonth(sub.end.getUTCMonth() + 1)\r\n            sub.userID = subMap[subID].userID if subMap[subID].userID\r\n            subs.push sub\r\n\r\n          subDayMap = {}\r\n          for sub in subs\r\n            startDay = sub.start.toISOString().substring(0, 10)\r\n            subDayMap[startDay] ?= {}\r\n            subDayMap[startDay]['start'] ?= 0\r\n            subDayMap[startDay]['start']++\r\n            if endDay = sub?.end?.toISOString().substring(0, 10)\r\n              subDayMap[endDay] ?= {}\r\n              subDayMap[endDay]['end'] ?= 0\r\n              subDayMap[endDay]['end']++\r\n            for cancellation in cancellations\r\n              if cancellation.subscriptionID is sub.subscriptionID\r\n                sub.cancel = cancellation.cancel\r\n                cancelDay = cancellation.cancel.toISOString().substring(0, 10)\r\n                subDayMap[cancelDay] ?= {}\r\n                subDayMap[cancelDay]['cancel'] ?= 0\r\n                subDayMap[cancelDay]['cancel']++\r\n                break\r\n\r\n          today = new Date().toISOString().substring(0, 10)\r\n          for day of subDayMap\r\n            continue if day > today\r\n            @subs.push\r\n              day: day\r\n              started: subDayMap[day]['start'] or 0\r\n              cancelled: subDayMap[day]['cancel'] or 0\r\n              ended: subDayMap[day]['end'] or 0\r\n\r\n          @subs.sort (a, b) -> a.day.localeCompare(b.day)\r\n          cancelledThisMonth = 0\r\n          totalLastMonth = 0\r\n          for sub, i in @subs\r\n            @total += sub.started\r\n            @total -= sub.ended\r\n            sub.total = @total\r\n            cancelledThisMonth += sub.cancelled if @subs.length - i < 31\r\n            totalLastMonth = @total if @subs.length - i is 31\r\n          @monthlyChurn = cancelledThisMonth / totalLastMonth * 100.0 if totalLastMonth > 0\r\n          if @subs.length > 30 and @subs[@subs.length - 31].total > 0\r\n            startMonthTotal = @subs[@subs.length - 31].total\r\n            endMonthTotal = @subs[@subs.length - 1].total\r\n            @monthlyGrowth = (endMonthTotal / startMonthTotal - 1) * 100\r\n          done(subs)\r\n\r\n  getInvoices: (done) ->\r\n    invoices = {}\r\n\r\n    addInvoice = (invoice) =>\r\n      return unless invoice.paid\r\n      return unless invoice.subscription\r\n      return unless invoice.total > 0\r\n      return unless invoice.lines?.data?[0]?.plan?.id is 'basic'\r\n      invoices[invoice.id] =\r\n        customerID: invoice.customer\r\n        subscriptionID: invoice.subscription\r\n        date: new Date(invoice.date * 1000)\r\n      invoices[invoice.id].userID = invoice.lines.data[0].metadata.id if invoice.lines?.data?[0]?.metadata?.id\r\n\r\n    getLiveInvoices = (ending_before, done) =>\r\n\r\n      nextBatch = (ending_before, done) =>\r\n        @updateFetchDataState \"Fetching invoices #{Object.keys(invoices).length}...\"\r\n        options =\r\n          url: '/db/subscription/-/stripe_invoices'\r\n          method: 'POST'\r\n          data: {options: {ending_before: ending_before, limit: 100}}\r\n        options.error = (model, response, options) =>\r\n          return if @destroyed\r\n          console.error 'Failed to get live invoices', response\r\n        options.success = (invoiceData, response, options) =>\r\n          return if @destroyed\r\n          addInvoice(invoice) for invoice in invoiceData.data\r\n          if invoiceData.has_more\r\n            return nextBatch(invoiceData.data[0].id, done)\r\n          else\r\n            invoices = (invoice for invoiceID, invoice of invoices)\r\n            invoices.sort (a, b) -> if a.date > b.date then -1 else 1\r\n            return done(invoices)\r\n        @supermodel.addRequestResource('get_live_invoices', options, 0).load()\r\n\r\n      nextBatch ending_before, done\r\n\r\n    getAnalyticsInvoices = (done) =>\r\n      @updateFetchDataState \"Fetching invoices #{Object.keys(invoices).length}...\"\r\n      options =\r\n        url: '/db/analytics.stripe.invoice/-/all'\r\n        method: 'GET'\r\n      options.error = (model, response, options) =>\r\n        return if @destroyed\r\n        console.error 'Failed to get analytics stripe invoices', response\r\n      options.success = (docs, response, options) =>\r\n        return if @destroyed\r\n        docs.sort (a, b) -> b.date - a.date\r\n        addInvoice(doc.properties) for doc in docs\r\n        getLiveInvoices(docs[0]._id, done)\r\n      @supermodel.addRequestResource('get_analytics_invoices', options, 0).load()\r\n\r\n    getAnalyticsInvoices(done)\r\n\r\n  getRecipientSubscriptions: (sponsors, done) ->\r\n    @updateFetchDataState \"Fetching recipient subscriptions...\"\r\n    subscriptionsToFetch = []\r\n    for user in sponsors\r\n      for recipient in user.stripe?.recipients\r\n        subscriptionsToFetch.push\r\n          customerID: user.stripe.customerID\r\n          subscriptionID: recipient.subscriptionID\r\n    return done([]) if _.isEmpty subscriptionsToFetch\r\n    options =\r\n      url: '/db/subscription/-/stripe_subscriptions'\r\n      method: 'POST'\r\n      data: {subscriptions: subscriptionsToFetch}\r\n    options.error = (model, response, options) =>\r\n      return if @destroyed\r\n      console.error 'Failed to get recipient subscriptions', response\r\n    options.success = (subscriptions, response, options) =>\r\n      return if @destroyed\r\n      done(subscriptions)\r\n    @supermodel.addRequestResource('get_recipient_subscriptions', options, 0).load()\r\n\r\n  getSponsors: (done) ->\r\n    @updateFetchDataState \"Fetching sponsors...\"\r\n    options =\r\n      url: '/db/user/-/sub_sponsors'\r\n      method: 'POST'\r\n    options.error = (model, response, options) =>\r\n      return if @destroyed\r\n      console.error 'Failed to get sponsors', response\r\n    options.success = (sponsors, response, options) =>\r\n      return if @destroyed\r\n      done(sponsors)\r\n    @supermodel.addRequestResource('get_sponsors', options, 0).load()\r\n\r\n  updateAnalyticsGraphData: ->\r\n    # console.log 'updateAnalyticsGraphData'\r\n    # Build graphs based on available @analytics data\r\n    # Currently only one graph\r\n    @analytics.graphs = []\r\n\r\n    return unless @subs?.length > 0\r\n\r\n    @addGraphData(60)\r\n    @addGraphData(180, true)\r\n\r\n  addGraphData: (timeframeDays, skipCancelled=false) ->\r\n    graph = {graphID: 'total-subs', lines: []}\r\n\r\n    # TODO: Where should this metadata live?\r\n    # TODO: lineIDs assumed to be unique across graphs\r\n    totalSubsID = 'total-subs'\r\n    startedSubsID = 'started-subs'\r\n    cancelledSubsID = 'cancelled-subs'\r\n    netSubsID = 'net-subs'\r\n    averageNewID = 'average-new'\r\n    lineMetadata = {}\r\n    lineMetadata[totalSubsID] =\r\n      description: 'Total Active Subscriptions'\r\n      color: 'green'\r\n      strokeWidth: 1\r\n    lineMetadata[startedSubsID] =\r\n      description: 'New Subscriptions'\r\n      color: 'blue'\r\n      strokeWidth: 1\r\n    lineMetadata[cancelledSubsID] =\r\n      description: 'Cancelled Subscriptions'\r\n      color: 'red'\r\n      strokeWidth: 1\r\n    lineMetadata[netSubsID] =\r\n      description: '7-day Average Net Subscriptions (started - cancelled)'\r\n      color: 'black'\r\n      strokeWidth: 4\r\n    lineMetadata[averageNewID] =\r\n      description: '7-day Average New Subscriptions'\r\n      color: 'black'\r\n      strokeWidth: 4\r\n\r\n    days = (sub.day for sub in @subs)\r\n    if days.length > 0\r\n      currentIndex = 0\r\n      currentDay = days[currentIndex]\r\n      currentDate = new Date(currentDay + \"T00:00:00.000Z\")\r\n      lastDay = days[days.length - 1]\r\n      while currentDay isnt lastDay\r\n        days.splice currentIndex, 0, currentDay if days[currentIndex] isnt currentDay\r\n        currentIndex++\r\n        currentDate.setUTCDate(currentDate.getUTCDate() + 1)\r\n        currentDay = currentDate.toISOString().substr(0, 10)\r\n\r\n    ## Totals\r\n\r\n    # Build line data\r\n    levelPoints = []\r\n    for sub, i in @subs\r\n      levelPoints.push\r\n        x: i\r\n        y: sub.total\r\n        day: sub.day\r\n        pointID: \"#{totalSubsID}#{i}\"\r\n        values: []\r\n\r\n    # Ensure points for each day\r\n    for day, i in days\r\n      if levelPoints.length <= i or levelPoints[i].day isnt day\r\n        prevY = if i > 0 then levelPoints[i - 1].y else 0.0\r\n        levelPoints.splice i, 0,\r\n          y: prevY\r\n          day: day\r\n          values: []\r\n      levelPoints[i].x = i\r\n      levelPoints[i].pointID = \"#{totalSubsID}#{i}\"\r\n\r\n    levelPoints.splice(0, levelPoints.length - timeframeDays) if levelPoints.length > timeframeDays\r\n\r\n    graph.lines.push\r\n      lineID: totalSubsID\r\n      enabled: true\r\n      points: levelPoints\r\n      description: lineMetadata[totalSubsID].description\r\n      lineColor: lineMetadata[totalSubsID].color\r\n      strokeWidth: lineMetadata[totalSubsID].strokeWidth\r\n      min: 0\r\n      max: d3.max(@subs, (d) -> d.total)\r\n\r\n    ## Started\r\n\r\n    # Build line data\r\n    levelPoints = []\r\n    for sub, i in @subs\r\n      levelPoints.push\r\n        x: i\r\n        y: sub.started\r\n        day: sub.day\r\n        pointID: \"#{startedSubsID}#{i}\"\r\n        values: []\r\n\r\n    # Ensure points for each day\r\n    for day, i in days\r\n      if levelPoints.length <= i or levelPoints[i].day isnt day\r\n        prevY = if i > 0 then levelPoints[i - 1].y else 0.0\r\n        levelPoints.splice i, 0,\r\n          y: prevY\r\n          day: day\r\n          values: []\r\n      levelPoints[i].x = i\r\n      levelPoints[i].pointID = \"#{startedSubsID}#{i}\"\r\n\r\n    levelPoints.splice(0, levelPoints.length - timeframeDays) if levelPoints.length > timeframeDays\r\n\r\n    graph.lines.push\r\n      lineID: startedSubsID\r\n      enabled: true\r\n      points: levelPoints\r\n      description: lineMetadata[startedSubsID].description\r\n      lineColor: lineMetadata[startedSubsID].color\r\n      strokeWidth: lineMetadata[startedSubsID].strokeWidth\r\n      min: 0\r\n      max: d3.max(@subs[-timeframeDays..], (d) -> d.started + 2)\r\n\r\n    if skipCancelled\r\n\r\n      ## 7-Day average started\r\n\r\n      # Build line data\r\n      levelPoints = []\r\n      sevenStarts = []\r\n      for sub, i in @subs\r\n        average = 0\r\n        sevenStarts.push sub.started\r\n        if sevenStarts.length > 7\r\n          sevenStarts.shift()\r\n        if sevenStarts.length is 7\r\n          average = sevenStarts.reduce((a, b) -> a + b) / sevenStarts.length\r\n        levelPoints.push\r\n          x: i\r\n          y: average\r\n          day: sub.day\r\n          pointID: \"#{averageNewID}#{i}\"\r\n          values: []\r\n\r\n      # Ensure points for each day\r\n      for day, i in days\r\n        if levelPoints.length <= i or levelPoints[i].day isnt day\r\n          prevY = if i > 0 then levelPoints[i - 1].y else 0.0\r\n          levelPoints.splice i, 0,\r\n            y: prevY\r\n            day: day\r\n            values: []\r\n        levelPoints[i].x = i\r\n        levelPoints[i].pointID = \"#{averageNewID}#{i}\"\r\n\r\n      levelPoints.splice(0, levelPoints.length - timeframeDays) if levelPoints.length > timeframeDays\r\n\r\n      graph.lines.push\r\n        lineID: averageNewID\r\n        enabled: true\r\n        points: levelPoints\r\n        description: lineMetadata[averageNewID].description\r\n        lineColor: lineMetadata[averageNewID].color\r\n        strokeWidth: lineMetadata[averageNewID].strokeWidth\r\n        min: 0\r\n        max: d3.max(@subs[-timeframeDays..], (d) -> d.started + 2)\r\n\r\n    else\r\n\r\n      ## Cancelled\r\n\r\n      # Build line data\r\n      levelPoints = []\r\n      for sub, i in @subs\r\n        levelPoints.push\r\n          x: @subs.length - 30 + i\r\n          y: sub.cancelled\r\n          day: sub.day\r\n          pointID: \"#{cancelledSubsID}#{@subs.length - 30 + i}\"\r\n          values: []\r\n\r\n      # Ensure points for each day\r\n      for day, i in days\r\n        if levelPoints.length <= i or levelPoints[i].day isnt day\r\n          prevY = if i > 0 then levelPoints[i - 1].y else 0.0\r\n          levelPoints.splice i, 0,\r\n            y: prevY\r\n            day: day\r\n            values: []\r\n        levelPoints[i].x = i\r\n        levelPoints[i].pointID = \"#{cancelledSubsID}#{i}\"\r\n\r\n      levelPoints.splice(0, levelPoints.length - timeframeDays) if levelPoints.length > timeframeDays\r\n\r\n      graph.lines.push\r\n        lineID: cancelledSubsID\r\n        enabled: true\r\n        points: levelPoints\r\n        description: lineMetadata[cancelledSubsID].description\r\n        lineColor: lineMetadata[cancelledSubsID].color\r\n        strokeWidth: lineMetadata[cancelledSubsID].strokeWidth\r\n        min: 0\r\n        max: d3.max(@subs[-timeframeDays..], (d) -> d.started + 2)\r\n\r\n      ## 7-Day Net Subs\r\n\r\n      # Build line data\r\n      levelPoints = []\r\n      sevenNets = []\r\n      for sub, i in @subs\r\n        net = 0\r\n        sevenNets.push sub.started - sub.cancelled\r\n        if sevenNets.length > 7\r\n          sevenNets.shift()\r\n        if sevenNets.length is 7\r\n          net = sevenNets.reduce((a, b) -> a + b) / 7\r\n        levelPoints.push\r\n          x: i\r\n          y: net\r\n          day: sub.day\r\n          pointID: \"#{netSubsID}#{i}\"\r\n          values: []\r\n\r\n      # Ensure points for each day\r\n      for day, i in days\r\n        if levelPoints.length <= i or levelPoints[i].day isnt day\r\n          prevY = if i > 0 then levelPoints[i - 1].y else 0.0\r\n          levelPoints.splice i, 0,\r\n            y: prevY\r\n            day: day\r\n            values: []\r\n        levelPoints[i].x = i\r\n        levelPoints[i].pointID = \"#{netSubsID}#{i}\"\r\n\r\n      levelPoints.splice(0, levelPoints.length - timeframeDays) if levelPoints.length > timeframeDays\r\n\r\n      graph.lines.push\r\n        lineID: netSubsID\r\n        enabled: true\r\n        points: levelPoints\r\n        description: lineMetadata[netSubsID].description\r\n        lineColor: lineMetadata[netSubsID].color\r\n        strokeWidth: lineMetadata[netSubsID].strokeWidth\r\n        min: 0\r\n        max: d3.max(@subs[-timeframeDays..], (d) -> d.started + 2)\r\n\r\n    @analytics.graphs.push(graph)\r\n\r\n  updateAnalyticsGraphs: ->\r\n    # Build d3 graphs\r\n    return unless @analytics?.graphs?.length > 0\r\n    containerSelector = '.line-graph-container'\r\n    # console.log 'updateAnalyticsGraphs', containerSelector, @analytics.graphs\r\n\r\n    margin = 20\r\n    keyHeight = 20\r\n    xAxisHeight = 20\r\n    yAxisWidth = 40\r\n    containerWidth = $(containerSelector).width()\r\n    containerHeight = $(containerSelector).height()\r\n\r\n    for graph in @analytics.graphs\r\n      graphLineCount = _.reduce graph.lines, ((sum, item) -> if item.enabled then sum + 1 else sum), 0\r\n      svg = d3.select(containerSelector).append(\"svg\")\r\n        .attr(\"width\", containerWidth)\r\n        .attr(\"height\", containerHeight)\r\n      width = containerWidth - margin * 2 - yAxisWidth * 2\r\n      height = containerHeight - margin * 2 - xAxisHeight - keyHeight * graphLineCount\r\n      currentLine = 0\r\n      for line in graph.lines\r\n        continue unless line.enabled\r\n        xRange = d3.scale.linear().range([0, width]).domain([d3.min(line.points, (d) -> d.x), d3.max(line.points, (d) -> d.x)])\r\n        yRange = d3.scale.linear().range([height, 0]).domain([line.min, line.max])\r\n\r\n        # x-Axis\r\n        if currentLine is 0\r\n          startDay = new Date(line.points[0].day)\r\n          endDay = new Date(line.points[line.points.length - 1].day)\r\n          xAxisRange = d3.time.scale()\r\n            .domain([startDay, endDay])\r\n            .range([0, width])\r\n          xAxis = d3.svg.axis()\r\n            .scale(xAxisRange)\r\n          svg.append(\"g\")\r\n            .attr(\"class\", \"x axis\")\r\n            .call(xAxis)\r\n            .selectAll(\"text\")\r\n            .attr(\"dy\", \".35em\")\r\n            .attr(\"transform\", \"translate(\" + (margin + yAxisWidth) + \",\" + (height + margin) + \")\")\r\n            .style(\"text-anchor\", \"start\")\r\n\r\n        if line.lineID is 'started-subs'\r\n          # Horizontal guidelines\r\n          marks = (Math.round(i * line.max / 5) for i in [1...5])\r\n          svg.selectAll(\".line\")\r\n            .data(marks)\r\n            .enter()\r\n            .append(\"line\")\r\n            .attr(\"x1\", margin + yAxisWidth * 2)\r\n            .attr(\"y1\", (d) -> margin + yRange(d))\r\n            .attr(\"x2\", margin + yAxisWidth * 2 + width)\r\n            .attr(\"y2\", (d) -> margin + yRange(d))\r\n            .attr(\"stroke\", line.lineColor)\r\n            .style(\"opacity\", \"0.5\")\r\n\r\n        if currentLine < 2\r\n          # y-Axis\r\n          yAxisRange = d3.scale.linear().range([height, 0]).domain([line.min, line.max])\r\n          yAxis = d3.svg.axis()\r\n            .scale(yRange)\r\n            .orient(\"left\")\r\n          svg.append(\"g\")\r\n            .attr(\"class\", \"y axis\")\r\n            .attr(\"transform\", \"translate(\" + (margin + yAxisWidth * currentLine) + \",\" + margin + \")\")\r\n            .style(\"color\", line.lineColor)\r\n            .call(yAxis)\r\n            .selectAll(\"text\")\r\n            .attr(\"y\", 0)\r\n            .attr(\"x\", 0)\r\n            .attr(\"fill\", line.lineColor)\r\n            .style(\"text-anchor\", \"start\")\r\n\r\n        # Key\r\n        svg.append(\"line\")\r\n          .attr(\"x1\", margin)\r\n          .attr(\"y1\", margin + height + xAxisHeight + keyHeight * currentLine + keyHeight / 2)\r\n          .attr(\"x2\", margin + 40)\r\n          .attr(\"y2\", margin + height + xAxisHeight + keyHeight * currentLine + keyHeight / 2)\r\n          .attr(\"stroke\", line.lineColor)\r\n          .attr(\"class\", \"key-line\")\r\n        svg.append(\"text\")\r\n          .attr(\"x\", margin + 40 + 10)\r\n          .attr(\"y\", margin + height + xAxisHeight + keyHeight * currentLine + (keyHeight + 10) / 2)\r\n          .attr(\"fill\", if line.lineColor is 'gold' then 'orange' else line.lineColor)\r\n          .attr(\"class\", \"key-text\")\r\n          .text(line.description)\r\n\r\n        # Path and points\r\n        svg.selectAll(\".circle\")\r\n          .data(line.points)\r\n          .enter()\r\n          .append(\"circle\")\r\n          .attr(\"transform\", \"translate(\" + (margin + yAxisWidth * 2) + \",\" + margin + \")\")\r\n          .attr(\"cx\", (d) -> xRange(d.x))\r\n          .attr(\"cy\", (d) -> yRange(d.y))\r\n          .attr(\"r\", 2)\r\n          .attr(\"fill\", line.lineColor)\r\n          .attr(\"stroke-width\", 1)\r\n          .attr(\"class\", \"graph-point\")\r\n          .attr(\"data-pointid\", (d) -> \"#{line.lineID}#{d.x}\")\r\n        d3line = d3.svg.line()\r\n          .x((d) -> xRange(d.x))\r\n          .y((d) -> yRange(d.y))\r\n          .interpolate(\"linear\")\r\n        svg.append(\"path\")\r\n          .attr(\"d\", d3line(line.points))\r\n          .attr(\"transform\", \"translate(\" + (margin + yAxisWidth * 2) + \",\" + margin + \")\")\r\n          .style(\"stroke-width\", line.strokeWidth)\r\n          .style(\"stroke\", line.lineColor)\r\n          .style(\"fill\", \"none\")\r\n        currentLine++\r\n"]}