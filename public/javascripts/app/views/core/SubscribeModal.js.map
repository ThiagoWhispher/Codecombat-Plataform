{"version":3,"sources":["app/templates/core/subscribe-modal.jade","app/views/core/SubscribeModal.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/core/SubscribeModal.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),view = locals_.view,me = locals_.me;buf.push(\"<div class=\\\"modal-dialog\\\"><div class=\\\"modal-content\\\">\");\nif ( view.state === 'purchasing')\n{\nbuf.push(\"<div data-i18n=\\\"buy_gems.purchasing\\\" class=\\\"alert alert-info\\\"></div>\");\n}\nelse if ( view.state === 'retrying')\n{\nbuf.push(\"<div id=\\\"retrying-alert\\\" data-i18n=\\\"buy_gems.retrying\\\" class=\\\"alert alert-danger\\\"></div>\");\n}\nelse\n{\nbuf.push(\"<img id=\\\"subscribe-background\\\" src=\\\"/images/pages/play/modal/subscribe-background-blank.png\\\"/><h1 data-i18n=\\\"subscribe.subscribe_modal_title\\\"></h1><div id=\\\"close-modal\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span></div><div data-i18n=\\\"[html]subscribe.comparison_blurb\\\" class=\\\"comparison-blurb\\\"></div><table class=\\\"table table-condensed table-bordered comparison-table\\\"><thead><tr>\");\nif ( me.isOnPremiumServer())\n{\nbuf.push(\"<th></th>\");\n}\nelse\n{\nbuf.push(\"<th data-i18n=\\\"subscribe.free\\\" colspan=\\\"2\\\" class=\\\"free-cell\\\"></th>\");\n}\nbuf.push(\"<th data-i18n=\\\"subscribe.premium\\\"></th></tr></thead><tbody><tr><td class=\\\"feature-description\\\"><span\" + (jade.attrs({ 'data-i18n':(\"[html]subscribe.feature1\"), 'data-i18n-options':('{\"levelsCount\": ' + view.i18nData.levelsCount + ', \"worldsCount\": ' + view.i18nData.worldsCount + '}') }, {\"data-i18n\":true,\"data-i18n-options\":true})) + \"></span></td>\");\nif ( !me.isOnPremiumServer())\n{\nbuf.push(\"<td class=\\\"center-ok free-cell\\\"><span class=\\\"glyphicon glyphicon-ok\\\"></span></td>\");\n}\nbuf.push(\"<td class=\\\"center-ok\\\"><span class=\\\"glyphicon glyphicon-ok\\\"></span></td></tr><tr><td class=\\\"feature-description\\\"><span\" + (jade.attrs({ 'data-i18n':(\"[html]subscribe.feature3\"), 'data-i18n-options':('{\"bonusLevelsCount\": ' + view.i18nData.bonusLevelsCount + '}') }, {\"data-i18n\":true,\"data-i18n-options\":true})) + \">)</span></td>\");\nif ( !me.isOnPremiumServer())\n{\nbuf.push(\"<td class=\\\"free-cell\\\"></td>\");\n}\nbuf.push(\"<td class=\\\"center-ok\\\"><span class=\\\"glyphicon glyphicon-ok\\\"></span></td></tr><!-- Could try testing out things like features 6-8 in a new design with more space--><!--tr--><!--  td.feature-description--><!--    span(data-i18n=\\\"[html]subscribe.feature7\\\")--><!--  if !me.isOnPremiumServer()--><!--    td.free-cell--><!--  td.center-ok--><!--    span.glyphicon.glyphicon-ok--><!--tr--><!--  td.feature-description--><!--    span(data-i18n=\\\"subscribe.feature6\\\")--><!--  if !me.isOnPremiumServer()--><!--    td.free-cell--><!--  td.center-ok--><!--    span.glyphicon.glyphicon-ok--><!--if me.getCampaignAdsGroup() === 'leaderboard-ads'--><!--  tr--><!--    td.feature-description--><!--      span(data-i18n=\\\"[html]subscribe.feature8\\\")--><!--    if !me.isOnPremiumServer()--><!--      td.free-cell--><!--    td.center-ok--><!--      span.glyphicon.glyphicon-ok--><tr><td class=\\\"feature-description\\\"><span data-i18n=\\\"[html]subscribe.feature_game_dev\\\"></span></td>\");\nif ( !me.isOnPremiumServer())\n{\nbuf.push(\"<td class=\\\"free-cell\\\"></td>\");\n}\nbuf.push(\"<td class=\\\"center-ok\\\"><span class=\\\"glyphicon glyphicon-ok\\\"></span></td></tr><tr><td class=\\\"feature-description\\\"><span data-i18n=\\\"[html]subscribe.feature_web_dev\\\"></span></td>\");\nif ( !me.isOnPremiumServer())\n{\nbuf.push(\"<td class=\\\"free-cell\\\"></td>\");\n}\nbuf.push(\"<td class=\\\"center-ok\\\"><span class=\\\"glyphicon glyphicon-ok\\\"></span></td></tr><tr><td class=\\\"feature-description\\\"><span\" + (jade.attrs({ 'data-i18n':(\"[html]subscribe.feature2\"), 'data-i18n-options':('{\"heroesCount\": ' + view.i18nData.heroesCount + '}') }, {\"data-i18n\":true,\"data-i18n-options\":true})) + \"></span></td>\");\nif ( !me.isOnPremiumServer())\n{\nbuf.push(\"<td class=\\\"free-cell\\\"></td>\");\n}\nbuf.push(\"<td class=\\\"center-ok\\\"><span class=\\\"glyphicon glyphicon-ok\\\"></span></td></tr><tr><td class=\\\"feature-description gem-amount\\\"><span data-i18n=\\\"[html]subscribe.feature4\\\"></span></td>\");\nif ( !me.isOnPremiumServer())\n{\nbuf.push(\"<td class=\\\"free-cell\\\"></td>\");\n}\nbuf.push(\"<td class=\\\"center-ok\\\"><span class=\\\"glyphicon glyphicon-ok\\\"></span></td></tr></tbody></table>\");\nif ( view.basicProduct)\n{\nbuf.push(\"<div class=\\\"premium-pricing\\\"><span data-i18n=\\\"subscribe.premium_pricing_prefix\\\"></span><span>\" + (jade.escape(null == (jade.interp = ' ') ? \"\" : jade.interp)) + \"</span><span>$\" + (jade.escape((jade.interp = (view.basicProduct.get('amount') / 100)) == null ? '' : jade.interp)) + \"/</span><span data-i18n=\\\"subscribe.month\\\"></span><span>\" + (jade.escape(null == (jade.interp = ' ') ? \"\" : jade.interp)) + \"</span><span data-i18n=\\\"subscribe.premium_pricing_suffix\\\"></span></div><div id=\\\"parents-info\\\" data-i18n=\\\"subscribe.parents\\\"></div><div id=\\\"payment-methods-info\\\" data-i18n=\\\"subscribe.payment_methods\\\"></div>\");\n}\nbuf.push(\"<div class=\\\"subscribe-actions\\\">\");\nif ( !me.isOnPremiumServer())\n{\nbuf.push(\"<button data-i18n=\\\"subscribe.parent_button\\\" class=\\\"btn btn-lg btn-illustrated parent-button\\\"></button>\");\n}\nif ( view.yearProduct)\n{\nbuf.push(\"<button data-i18n=\\\"subscribe.sale_button\\\" class=\\\"btn btn-lg btn-illustrated sale-button\\\"></button>\");\n}\nbuf.push(\"<button data-i18n=\\\"subscribe.subscribe_title\\\" class=\\\"btn btn-lg btn-illustrated purchase-button\\\"></button></div>\");\nif ( view.state === 'declined')\n{\nbuf.push(\"<div id=\\\"declined-alert\\\" class=\\\"alert alert-danger alert-dismissible\\\"><span data-i18n=\\\"buy_gems.declined\\\"></span><button type=\\\"button\\\" data-dismiss=\\\"alert\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\">&times;</span></button></div>\");\n}\nif ( view.state === 'unknown_error')\n{\nbuf.push(\"<div id=\\\"error-alert\\\" class=\\\"alert alert-danger alert-dismissible\\\"><button type=\\\"button\\\" data-dismiss=\\\"alert\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\">&times;</span></button><p data-i18n=\\\"loading_error.unknown\\\"></p><p>\" + (jade.escape(null == (jade.interp = view.stateMessage) ? \"\" : jade.interp)) + \"</p></div>\");\n}\n}\nbuf.push(\"<div class=\\\"parent-button-popover-content hidden\\\"><div class=\\\"email-parent-form\\\"><p data-i18n=\\\"subscribe.parent_email_description\\\"></p><form><div class=\\\"form-group\\\"><label data-i18n=\\\"subscribe.parent_email_input_label\\\"></label><input type=\\\"email\\\" data-i18n=\\\"[placeholder]subscribe.parent_email_input_placeholder\\\" class=\\\"parent-input form-control\\\"/><div data-i18n=\\\"subscribe.parent_email_input_invalid\\\" class=\\\"parent-email-validator email_invalid\\\"></div></div><button type=\\\"submit\\\" data-i18n=\\\"subscribe.parent_email_send\\\" class=\\\"parent-send btn btn-default\\\"></button></form></div><div class=\\\"email-parent-complete\\\"><p data-i18n=\\\"subscribe.parent_email_sent\\\"></p><button type=\\\"button\\\" onclick=\\\"$('.parent-button').popover('hide');\\\" data-i18n=\\\"modal.close\\\" class=\\\"btn\\\"></button></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","ModalView = require 'views/core/ModalView'\r\ntemplate = require 'templates/core/subscribe-modal'\r\nstripeHandler = require 'core/services/stripe'\r\nutils = require 'core/utils'\r\nCreateAccountModal = require 'views/core/CreateAccountModal'\r\nProducts = require 'collections/Products'\r\n\r\nmodule.exports = class SubscribeModal extends ModalView\r\n  id: 'subscribe-modal'\r\n  template: template\r\n  plain: true\r\n  closesOnClickOutside: false\r\n  planID: 'basic'\r\n  i18nData:\r\n    levelsCount: '100'\r\n    worldsCount: '5'\r\n    heroesCount: '16'\r\n    bonusLevelsCount: '330'\r\n\r\n  subscriptions:\r\n    'stripe:received-token': 'onStripeReceivedToken'\r\n\r\n  events:\r\n    'click #close-modal': 'hide'\r\n    'click .popover-content .parent-send': 'onClickParentSendButton'\r\n    'click .email-parent-complete button': 'onClickParentEmailCompleteButton'\r\n    'click .purchase-button': 'onClickPurchaseButton'\r\n    'click .sale-button': 'onClickSaleButton'\r\n\r\n  constructor: (options) ->\r\n    super(options)\r\n    @state = 'standby'\r\n    @products = new Products()\r\n    @supermodel.loadCollection(@products, 'products')\r\n\r\n  onLoaded: ->\r\n    @basicProduct = @products.findWhere { name: 'basic_subscription' }\r\n    @yearProduct = @products.findWhere { name: me.getYearSubscriptionGroup() }\r\n    @yearProduct ?= @products.findWhere { name: 'year_subscription' }\r\n    if countrySpecificProduct = @products.findWhere { name: \"#{me.get('country')}_basic_subscription\" }\r\n      @basicProduct = countrySpecificProduct\r\n      @yearProduct = @products.findWhere { name: \"#{me.get('country')}_year_subscription\" }  # probably null\r\n    super()\r\n\r\n  afterRender: ->\r\n    super()\r\n    @setupParentButtonPopover()\r\n    @setupParentInfoPopover()\r\n    @setupPaymentMethodsInfoPopover()\r\n    if @basicProduct\r\n      @$el.find('.gem-amount').html $.i18n.t('subscribe.feature4').replace('{{gems}}', @basicProduct.get('gems'))\r\n      if @basicProduct.get('gems') < 3500\r\n        @$el.find('[data-i18n=\"subscribe.feature6\"]').parents('tr').hide()\r\n    @playSound 'game-menu-open'\r\n\r\n  setupParentButtonPopover: ->\r\n    popoverTitle = $.i18n.t 'subscribe.parent_email_title'\r\n    popoverTitle += '<button type=\"button\" class=\"close\" onclick=\"$(&#39;.parent-button&#39;).popover(&#39;hide&#39;);\">&times;</button>'\r\n    popoverContent = ->\r\n      $('.parent-button-popover-content').html()\r\n    @$el.find('.parent-button').popover(\r\n      animation: true\r\n      html: true\r\n      placement: 'top'\r\n      trigger: 'click'\r\n      title: popoverTitle\r\n      content: popoverContent\r\n      container: @$el\r\n    ).on 'shown.bs.popover', =>\r\n      application.tracker?.trackEvent 'Subscription ask parent button click'\r\n\r\n  setupParentInfoPopover: ->\r\n    return unless @products.size()\r\n    popoverTitle = $.i18n.t 'subscribe.parents_title'\r\n    levelsCompleted = me.get('stats')?.gamesCompleted or 'several'\r\n    popoverContent = \"<p>\" + $.i18n.t('subscribe.parents_blurb1', nLevels: levelsCompleted) + \"</p>\"\r\n    popoverContent += \"<p>\" + $.i18n.t('subscribe.parents_blurb1a') + \"</p>\"\r\n    popoverContent += \"<p>\" + $.i18n.t('subscribe.parents_blurb2') + \"</p>\"\r\n    price = (@basicProduct.get('amount') / 100).toFixed(2)\r\n    # TODO: Use i18next's interpolation system instead\r\n    popoverContent = popoverContent.replace('{{price}}', price)\r\n    popoverContent += \"<p>\" + $.i18n.t('subscribe.parents_blurb3') + \"</p>\"\r\n    @$el.find('#parents-info').popover(\r\n      animation: true\r\n      html: true\r\n      placement: 'top'\r\n      trigger: 'hover'\r\n      title: popoverTitle\r\n      content: popoverContent\r\n      container: @$el\r\n    ).on 'shown.bs.popover', =>\r\n      application.tracker?.trackEvent 'Subscription parent hover'\r\n\r\n  setupPaymentMethodsInfoPopover: ->\r\n    return unless @products.size()\r\n    popoverTitle = $.i18n.t('subscribe.payment_methods_title')\r\n    threeMonthPrice = (@basicProduct.get('amount') * 3 / 100).toFixed(2)\r\n    if @yearProduct\r\n      yearPrice = (@yearProduct.get('amount') / 100).toFixed(2)\r\n    else\r\n      yearPrice = (@basicProduct.get('amount') * 12 / 100).toFixed(2)\r\n    popoverTitle += '<button type=\"button\" class=\"close\" onclick=\"$(&#39;#payment-methods-info&#39;).popover(&#39;hide&#39;);\">&times;</button>'\r\n    popoverContent = \"<p>\" + $.i18n.t('subscribe.payment_methods_blurb1') + \"</p>\"\r\n    # TODO: Update i18next and use its own interpolation system instead\r\n    popoverContent = popoverContent.replace('{{three_month_price}}', threeMonthPrice)\r\n    popoverContent = popoverContent.replace('{{year_price}}', yearPrice)\r\n    popoverContent += \"<p>\" + $.i18n.t('subscribe.payment_methods_blurb2') + \" <a href='mailto:support@codecombat.com'>support@codecombat.com</a>.\"\r\n    @$el.find('#payment-methods-info').popover(\r\n      animation: true\r\n      html: true\r\n      placement: 'top'\r\n      trigger: 'click'\r\n      title: popoverTitle\r\n      content: popoverContent\r\n      container: @$el\r\n    ).on 'shown.bs.popover', =>\r\n      application.tracker?.trackEvent 'Subscription payment methods hover'\r\n\r\n  onClickParentSendButton: (e) ->\r\n    # TODO: Popover sometimes dismisses immediately after send\r\n\r\n    email = @$el.find('.popover-content .parent-input').val()\r\n    unless /[\\w\\.]+@\\w+\\.\\w+/.test email\r\n      @$el.find('.popover-content .parent-input').parent().addClass('has-error')\r\n      @$el.find('.popover-content .parent-email-validator').show()\r\n      return false\r\n\r\n    request = @supermodel.addRequestResource 'send_one_time_email', {\r\n      url: '/db/user/-/send_one_time_email'\r\n      data: {email: email, type: 'subscribe modal parent'}\r\n      method: 'POST'\r\n    }, 0\r\n    request.load()\r\n\r\n    @$el.find('.popover-content .email-parent-form').hide()\r\n    @$el.find('.popover-content .email-parent-complete').show()\r\n    false\r\n\r\n  onClickParentEmailCompleteButton: (e) ->\r\n    @$el.find('.parent-button').popover('hide')\r\n\r\n  onClickPurchaseButton: (e) ->\r\n    return unless @basicProduct\r\n    @playSound 'menu-button-click'\r\n    return @openModalView new CreateAccountModal() if me.get('anonymous')\r\n    application.tracker?.trackEvent 'Started subscription purchase'\r\n    options = {\r\n      description: $.i18n.t('subscribe.stripe_description')\r\n      amount: @basicProduct.get('amount')\r\n      alipay: if me.get('country') is 'china' or (me.get('preferredLanguage') or 'en-US')[...2] is 'zh' then true else 'auto'\r\n      alipayReusable: true\r\n    }\r\n\r\n    @purchasedAmount = options.amount\r\n    stripeHandler.open(options)\r\n\r\n  onClickSaleButton: (e) ->\r\n    @playSound 'menu-button-click'\r\n    return @openModalView new CreateAccountModal() if me.get('anonymous')\r\n    application.tracker?.trackEvent 'Started 1 year subscription purchase'\r\n    discount = @basicProduct.get('amount') * 12 - @yearProduct.get('amount')\r\n    discountString = (discount/100).toFixed(2)\r\n    options =\r\n      description: $.i18n.t('subscribe.stripe_description_year_sale').replace('{{discount}}', discountString)\r\n      amount: @yearProduct.get('amount')\r\n      alipay: if me.get('country') is 'china' or (me.get('preferredLanguage') or 'en-US')[...2] is 'zh' then true else 'auto'\r\n      alipayReusable: true\r\n    @purchasedAmount = options.amount\r\n    stripeHandler.open(options)\r\n\r\n  onStripeReceivedToken: (e) ->\r\n    @state = 'purchasing'\r\n    @render()\r\n\r\n    if @purchasedAmount is @basicProduct.get('amount')\r\n      stripe = _.clone(me.get('stripe') ? {})\r\n      stripe.planID = @basicProduct.get('planID')\r\n      stripe.token = e.token.id\r\n      me.set 'stripe', stripe\r\n      @listenToOnce me, 'sync', @onSubscriptionSuccess\r\n      @listenToOnce me, 'error', @onSubscriptionError\r\n      me.patch({headers: {'X-Change-Plan': 'true'}})\r\n    else if @purchasedAmount is @yearProduct.get('amount')\r\n      # Purchasing a year\r\n      data =\r\n        stripe:\r\n          token: e.token.id\r\n          timestamp: new Date().getTime()\r\n      jqxhr = $.post('/db/subscription/-/year_sale', data)\r\n      jqxhr.done (data, textStatus, jqXHR) =>\r\n        application.tracker?.trackEvent 'Finished 1 year subscription purchase', value: @purchasedAmount\r\n        me.set 'stripe', data?.stripe if data?.stripe?\r\n        Backbone.Mediator.publish 'subscribe-modal:subscribed', {}\r\n        @playSound 'victory'\r\n        @hide()\r\n      jqxhr.fail (xhr, textStatus, errorThrown) =>\r\n        console.error 'We got an error subscribing with Stripe from our server:', textStatus, errorThrown\r\n        application.tracker?.trackEvent 'Failed to finish 1 year subscription purchase', status: textStatus, value: @purchasedAmount\r\n        stripe = me.get('stripe') ? {}\r\n        delete stripe.token\r\n        delete stripe.planID\r\n        if xhr.status is 402\r\n          @state = 'declined'\r\n        else\r\n          @state = 'unknown_error'\r\n          @stateMessage = \"#{xhr.status}: #{xhr.responseText}\"\r\n        @render()\r\n    else\r\n      console.error \"Unexpected purchase amount received\", @purchasedAmount, e\r\n      @state = 'unknown_error'\r\n      @stateMessage = \"Uknown problem occurred while processing Stripe request\"\r\n\r\n  onSubscriptionSuccess: ->\r\n    application.tracker?.trackEvent 'Finished subscription purchase', value: @purchasedAmount\r\n    Backbone.Mediator.publish 'subscribe-modal:subscribed', {}\r\n    @playSound 'victory'\r\n    @hide()\r\n\r\n  onSubscriptionError: (user, response, options) ->\r\n    console.error 'We got an error subscribing with Stripe from our server:', response\r\n    application.tracker?.trackEvent 'Failed to finish subscription purchase', status: options.xhr?.status, value: @purchasedAmount\r\n    stripe = me.get('stripe') ? {}\r\n    delete stripe.token\r\n    delete stripe.planID\r\n    # TODO: Need me.set('stripe', stripe) here?\r\n    xhr = options.xhr\r\n    if xhr.status is 402\r\n      @state = 'declined'\r\n    else\r\n      @state = 'unknown_error'\r\n      @stateMessage = \"#{xhr.status}: #{xhr.responseText}\"\r\n    @render()\r\n\r\n  onHidden: ->\r\n    super()\r\n    @playSound 'game-menu-close'\r\n"]}