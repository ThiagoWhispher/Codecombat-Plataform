{"version":3,"sources":["app/views/core/ContactModal.coffee"],"names":[],"mappings":";AAAA;EAAA;;;AAAA,YAAY,QAAQ,sBAAR;;AACZ,WAAW,QAAQ,wBAAR;;AAEX,QAAQ,QAAQ,YAAR;;AACP,qBAAsB,QAAQ,cAAR,EAAtB;;AAED,gBACE;EAAA,sBAAsB,KAAtB;EACA,UAAU,CAAC,OAAD,EAAU,SAAV,CADV;EAEA,YACE;IAAA,OACE;MAAA,MAAM,QAAN;MACA,WAAW,GADX;MAEA,WAAW,CAFX;MAGA,QAAQ,OAHR;KADF;IAMA,SACE;MAAA,MAAM,QAAN;MACA,WAAW,CADX;KAPF;GAHF;;;AAaF,MAAM,CAAC,OAAP,GAAuB;;;;;;;yBACrB,KAAI;;yBACJ,WAAU;;yBACV,cAAa;;yBAEb,SACE;IAAA,gCAAgC,SAAhC;;;yBAEF,UAAS;AACP;IAAA,IAAC,UAAD,CAAW,mBAAX;IACA,KAAK,CAAC,eAAN,CAAsB,IAAC,IAAvB;IACA,iBAAiB,KAAK,CAAC,YAAN,CAAmB,IAAC,IAApB;IACjB,MAAM,GAAG,CAAC,gBAAJ,CAAqB,cAArB,EAAqC,aAArC;IACN,KAAuD,GAAG,CAAC,KAA3D;AAAA,aAAO,KAAK,CAAC,iBAAN,CAAwB,IAAC,IAAzB,EAA8B,GAAG,CAAC,MAAlC,EAAP;;IACA,IAAC,oBAAD,CAAqB,cAArB;IACA,iBAAiB,CAAC,CAAC,KAAF,CAAQ,cAAR,EAAwB,IAAC,QAAzB;IACjB,cAAc,CAAC,OAAf,GAAyB,EAAE,CAAC,GAAH,CAAO,SAAP;;SACX,CAAE,UAAhB,CAA2B,eAA3B,EAA4C;QAAA,SAAS,cAAT;OAA5C;;IACA,mBAAmB,cAAnB,EAAmC,IAAC,IAApC;WACA,CAAC,CAAC,IAAF,CAAO,cAAY,EAAE,CAAC,EAAf,GAAkB,2BAAzB;EAXO;;yBAaT,sBAAqB,SAAC,OAAD;AACnB;IAAA,IAAG,CAAC,CAAC,OAAL;MACE,OAAO,CAAC,OAAR,GAAqB,CAAC,CAAC,OAAO,CAAC,QAAX,GAAoB,GAApB,GAAuB,CAAC,CAAC,OAAO,CAAC,IAAjC,GAAsC,GAAtC,GAAyC,CAAC,CAAC,OAAO,CAAC,cADzE;;IAEA,OAAO,CAAC,UAAR,GAAuB,kGAAiB,EAAE,MAAF,CAAS,CAAC,KAAV,EAAjB,IAAmC,KAAnC,GAAuC,qGAAkB,EAAE,MAAF,CAAS,CAAC,MAAV,EAAlB;WAC9D,OAAO,CAAC,aAAR,GAAwB,IAAC;EAJN;;yBAMrB,mBAAkB;AAChB;IAAA,KAAc,IAAC,cAAf;AAAA;;IACA,eAAe,IAAC,IAAG,CAAC,IAAL,CAAU,qBAAV,CAAgC,CAAC,WAAjC,CAA6C,QAA7C;IACf,YAAY,CAAC,IAAb,CAAkB,GAAlB,CAAsB,CAAC,IAAvB,CAA4B,MAA5B,EAAoC,IAAC,cAAa,CAAC,OAAf,CAAuB,wBAAvB,EAAiD,GAAjD,CAApC;WACA,YAAY,CAAC,IAAb,CAAkB,KAAlB,CAAwB,CAAC,IAAzB,CAA8B,KAA9B,EAAqC,IAAC,cAAa,CAAC,OAAf,CAAuB,wBAAvB,EAAiD,GAAjD,CAArC;EAJgB;;;;GA3BwB","file":"public/javascripts/app/views/core/ContactModal.js","sourcesContent":["ModalView = require 'views/core/ModalView'\r\ntemplate = require 'templates/core/contact'\r\n\r\nforms = require 'core/forms'\r\n{sendContactMessage} = require 'core/contact'\r\n\r\ncontactSchema =\r\n  additionalProperties: false\r\n  required: ['email', 'message']\r\n  properties:\r\n    email:\r\n      type: 'string'\r\n      maxLength: 100\r\n      minLength: 1\r\n      format: 'email'\r\n\r\n    message:\r\n      type: 'string'\r\n      minLength: 1\r\n\r\nmodule.exports = class ContactModal extends ModalView\r\n  id: 'contact-modal'\r\n  template: template\r\n  closeButton: true\r\n\r\n  events:\r\n    'click #contact-submit-button': 'contact'\r\n\r\n  contact: ->\r\n    @playSound 'menu-button-click'\r\n    forms.clearFormAlerts @$el\r\n    contactMessage = forms.formToObject @$el\r\n    res = tv4.validateMultiple contactMessage, contactSchema\r\n    return forms.applyErrorsToForm @$el, res.errors unless res.valid\r\n    @populateBrowserData contactMessage\r\n    contactMessage = _.merge contactMessage, @options\r\n    contactMessage.country = me.get('country')\r\n    window.tracker?.trackEvent 'Sent Feedback', message: contactMessage\r\n    sendContactMessage contactMessage, @$el\r\n    $.post \"/db/user/#{me.id}/track/contact_codecombat\"\r\n\r\n  populateBrowserData: (context) ->\r\n    if $.browser\r\n      context.browser = \"#{$.browser.platform} #{$.browser.name} #{$.browser.versionNumber}\"\r\n    context.screenSize = \"#{screen?.width ? $(window).width()} x #{screen?.height ? $(window).height()}\"\r\n    context.screenshotURL = @screenshotURL\r\n\r\n  updateScreenshot: ->\r\n    return unless @screenshotURL\r\n    screenshotEl = @$el.find('#contact-screenshot').removeClass('secret')\r\n    screenshotEl.find('a').prop('href', @screenshotURL.replace(\"http://codecombat.com/\", \"/\"))\r\n    screenshotEl.find('img').prop('src', @screenshotURL.replace(\"http://codecombat.com/\", \"/\"))\r\n"]}