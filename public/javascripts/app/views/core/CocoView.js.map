{"version":3,"sources":["app/views/core/CocoView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/core/CocoView.js","sourcesContent":["SuperModel = require 'models/SuperModel'\r\nutils = require 'core/utils'\r\nCocoClass = require 'core/CocoClass'\r\nloadingScreenTemplate = require 'templates/core/loading'\r\nloadingErrorTemplate = require 'templates/core/loading-error'\r\nauth = require 'core/auth'\r\n\r\nlastToggleModalCall = 0\r\nvisibleModal = null\r\nwaitingModal = null\r\nclassCount = 0\r\nmakeScopeName = -> \"view-scope-#{classCount++}\"\r\ndoNothing = ->\r\nViewLoadTimer = require 'core/ViewLoadTimer'\r\n\r\nmodule.exports = class CocoView extends Backbone.View\r\n  cache: false # signals to the router to keep this view around\r\n  retainSubviews: false # set to true if you don't want subviews to be destroyed whenever the view renders\r\n  template: -> ''\r\n\r\n  events:\r\n    'click #loading-error .login-btn': 'onClickLoadingErrorLoginButton'\r\n    'click #loading-error #create-account-btn': 'onClickLoadingErrorCreateAccountButton'\r\n    'click #loading-error #logout-btn': 'onClickLoadingErrorLogoutButton'\r\n    'click .contact-modal': 'onClickContactModal'\r\n\r\n  subscriptions: {}\r\n  shortcuts: {}\r\n\r\n  # load progress properties\r\n  loadProgress:\r\n    progress: 0\r\n\r\n  # Setup, Teardown\r\n\r\n  constructor: (options) ->\r\n    @loadProgress = _.cloneDeep @loadProgress\r\n    @supermodel ?= new SuperModel()\r\n    @options = options\r\n    if options?.supermodel # kind of a hacky way to get each view to store its own progress\r\n      @supermodel.models = options.supermodel.models\r\n      @supermodel.collections = options.supermodel.collections\r\n      @supermodel.shouldSaveBackups = options.supermodel.shouldSaveBackups\r\n\r\n    @subscriptions = utils.combineAncestralObject(@, 'subscriptions')\r\n    @events = utils.combineAncestralObject(@, 'events')\r\n    @scope = makeScopeName()\r\n    @shortcuts = utils.combineAncestralObject(@, 'shortcuts')\r\n    @subviews = {}\r\n    @listenToShortcuts()\r\n    @updateProgressBar = _.debounce @updateProgressBar, 100\r\n    # Backbone.Mediator handles subscription setup/teardown automatically\r\n\r\n    @listenTo(@supermodel, 'loaded-all', @onLoaded)\r\n    @listenTo(@supermodel, 'update-progress', @updateProgress)\r\n    @listenTo(@supermodel, 'failed', @onResourceLoadFailed)\r\n    @warnConnectionError = _.throttle(@warnConnectionError, 3000)\r\n\r\n    # Warn about easy-to-create race condition that only shows up in production\r\n    listenedSupermodel = @supermodel\r\n    _.defer =>\r\n      if listenedSupermodel isnt @supermodel and not @destroyed\r\n        throw new Error(\"#{@constructor?.name ? @}: Supermodel listeners not hooked up! Don't reassign @supermodel; CocoView does that for you.\")\r\n\r\n    super arguments...\r\n\r\n  destroy: ->\r\n    @stopListening()\r\n    @off()\r\n    @stopListeningToShortcuts()\r\n    @undelegateEvents() # removes both events and subs\r\n    view.destroy() for id, view of @subviews\r\n    $('#modal-wrapper .modal').off 'hidden.bs.modal', @modalClosed\r\n    @$el.find('.has-tooltip, [data-original-title]').tooltip 'destroy'\r\n    @endHighlight()\r\n    @getPointer(false).remove()\r\n    @[key] = undefined for key, value of @\r\n    @destroyed = true\r\n    @off = doNothing\r\n    @destroy = doNothing\r\n    $.noty.closeAll()\r\n\r\n  destroyAceEditor: (editor) ->\r\n    # convenience method to make sure the ace editor is as destroyed as can be\r\n    return unless editor\r\n    session = editor.getSession()\r\n    session.setMode ''\r\n    editor.destroy()\r\n\r\n  afterInsert: ->\r\n\r\n  willDisappear: ->\r\n    # the router removes this view but this view will be cached\r\n    @undelegateEvents()\r\n    @hidden = true\r\n    @stopListeningToShortcuts()\r\n    view.willDisappear() for id, view of @subviews\r\n    $.noty.closeAll()\r\n\r\n  didReappear: ->\r\n    # the router brings back this view from the cache\r\n    @delegateEvents()\r\n    wasHidden = @hidden\r\n    @hidden = false\r\n    @listenToShortcuts() if wasHidden\r\n    view.didReappear() for id, view of @subviews\r\n\r\n  # View Rendering\r\n\r\n  renderSelectors: (selectors...) ->\r\n    newTemplate = $(@template(@getRenderData()))\r\n    for selector, i in selectors\r\n      for elPair in _.zip(@$el.find(selector), newTemplate.find(selector))\r\n        $(elPair[0]).replaceWith($(elPair[1]))\r\n    @delegateEvents()\r\n    @$el.i18n()\r\n\r\n  render: ->\r\n    return @ unless me\r\n    if @retainSubviews\r\n      oldSubviews = _.values(@subviews)\r\n    else\r\n      view.destroy() for id, view of @subviews\r\n    @subviews = {}\r\n    super()\r\n    return @template if _.isString(@template)\r\n    @$el.html @template(@getRenderData())\r\n\r\n    if @retainSubviews\r\n      for view in oldSubviews\r\n        @insertSubView(view)\r\n\r\n    if not @supermodel.finished()\r\n      @showLoading()\r\n    else\r\n      @hideLoading()\r\n\r\n    @afterRender()\r\n    @$el.i18n()\r\n    @\r\n\r\n  getRenderData: (context) ->\r\n    context ?= {}\r\n    context.isProduction = application.isProduction()\r\n    context.me = me\r\n    context.pathname = document.location.pathname  # like '/play/level'\r\n    context.fbRef = context.pathname.replace(/[^a-zA-Z0-9+/=\\-.:_]/g, '').slice(0, 40) or 'home'\r\n    context.isMobile = @isMobile()\r\n    context.isIE = @isIE()\r\n    context.moment = moment\r\n    context.translate = $.i18n.t\r\n    context.view = @\r\n    context._ = _\r\n    context.document = document\r\n    context.i18n = utils.i18n\r\n    context.state = @state\r\n    context.serverConfig = window.serverConfig\r\n    context.features = window.features\r\n    context\r\n\r\n  afterRender: ->\r\n    @renderScrollbar()\r\n\r\n  renderScrollbar: ->\r\n    #Defer the call till the content actually gets rendered, nanoscroller requires content to be visible\r\n    _.defer => @$el.find('.nano').nanoScroller() unless @destroyed\r\n\r\n  updateProgress: (progress) ->\r\n    @loadProgress.progress = progress if progress > @loadProgress.progress\r\n    @updateProgressBar(progress)\r\n\r\n  updateProgressBar: (progress) =>\r\n    prog = \"#{parseInt(progress*100)}%\"\r\n    @$el?.find('.loading-container .progress-bar').css('width', prog)\r\n\r\n  onLoaded: -> @render()\r\n\r\n  # Error handling for loading\r\n  onResourceLoadFailed: (e) ->\r\n    r = e.resource\r\n    @stopListening @supermodel\r\n    return if r.jqxhr?.status is 402 # payment-required failures are handled separately\r\n    @showError(r.jqxhr)\r\n\r\n  warnConnectionError: ->\r\n    msg = $.i18n.t 'loading_error.connection_failure', defaultValue: 'Connection failed.'\r\n    noty text: msg, layout: 'center', type: 'error', killer: true, timeout: 3000\r\n\r\n  onClickContactModal: (e) ->\r\n    if me.isStudent()\r\n      console.error(\"Student clicked contact modal.\")\r\n      return\r\n    if me.isTeacher()\r\n      if application.isProduction()\r\n        window.Intercom?('show')\r\n      else\r\n        alert('Teachers, Intercom widget only available in production.')\r\n    else\r\n      ContactModal = require 'views/core/ContactModal'\r\n      @openModalView(new ContactModal())\r\n\r\n  onClickLoadingErrorLoginButton: (e) ->\r\n    e.stopPropagation() # Backbone subviews and superviews will handle this call repeatedly otherwise\r\n    AuthModal = require 'views/core/AuthModal'\r\n    @openModalView(new AuthModal())\r\n\r\n  onClickLoadingErrorCreateAccountButton: (e) ->\r\n    e.stopPropagation()\r\n    CreateAccountModal = require 'views/core/CreateAccountModal'\r\n    @openModalView(new CreateAccountModal({mode: 'signup'}))\r\n\r\n  onClickLoadingErrorLogoutButton: (e) ->\r\n    e.stopPropagation()\r\n    auth.logoutUser()\r\n\r\n  # Modals\r\n\r\n  @lastToggleModalCall = 0\r\n\r\n  toggleModal: (e) ->\r\n    if $(e.currentTarget).prop('target') is '_blank'\r\n      return true\r\n    # special handler for opening modals that are dynamically loaded, rather than static in the page. It works (or should work) like Bootstrap's modals, except use coco-modal for the data-toggle value.\r\n    elem = $(e.target)\r\n    return unless elem.data('toggle') is 'coco-modal'\r\n    return if elem.attr('disabled')\r\n    target = elem.data('target')\r\n    Modal = require 'views/'+target\r\n    e.stopPropagation()\r\n    @openModalView new Modal supermodel: @supermodal\r\n\r\n  openModalView: (modalView, softly=false) ->\r\n    return if waitingModal # can only have one waiting at once\r\n    if visibleModal\r\n      waitingModal = modalView\r\n      return if softly\r\n      return visibleModal.hide() if visibleModal.$el.is(':visible') # close, then this will get called again\r\n      return @modalClosed(visibleModal) # was closed, but modalClosed was not called somehow\r\n    viewLoad = new ViewLoadTimer(modalView)\r\n    modalView.render()\r\n    \r\n    # Redirect to the woo when trying to log in or signup\r\n    if features.codePlay\r\n      if modalView.id is 'create-account-modal'\r\n        return document.location.href = '//lenovogamestate.com/register/?cocoId='+me.id\r\n      if modalView.id is 'auth-modal'\r\n        return document.location.href = '//lenovogamestate.com/login/?cocoId='+me.id\r\n        \r\n    $('#modal-wrapper').removeClass('hide').empty().append modalView.el\r\n    modalView.afterInsert()\r\n    visibleModal = modalView\r\n    modalOptions = {show: true, backdrop: if modalView.closesOnClickOutside then true else 'static'}\r\n    $('#modal-wrapper .modal').modal(modalOptions).on 'hidden.bs.modal', @modalClosed\r\n    window.currentModal = modalView\r\n    @getRootView().stopListeningToShortcuts(true)\r\n    Backbone.Mediator.publish 'modal:opened', {}\r\n    viewLoad.record()\r\n    return modalView\r\n\r\n  modalClosed: =>\r\n    visibleModal.willDisappear() if visibleModal\r\n    visibleModal.destroy()\r\n    visibleModal = null\r\n    window.currentModal = null\r\n    #$('#modal-wrapper .modal').off 'hidden.bs.modal', @modalClosed\r\n    $('#modal-wrapper').addClass('hide')\r\n    if waitingModal\r\n      wm = waitingModal\r\n      waitingModal = null\r\n      @openModalView(wm)\r\n    else\r\n      @getRootView().listenToShortcuts(true)\r\n      Backbone.Mediator.publish 'modal:closed', {}\r\n\r\n  # Loading RootViews\r\n\r\n  showLoading: ($el=@$el) ->\r\n    $el.find('>').addClass('hidden')\r\n    $el.append(loadingScreenTemplate()).i18n()\r\n    @_lastLoading = $el\r\n\r\n  hideLoading: ->\r\n    return unless @_lastLoading?\r\n    @_lastLoading.find('.loading-screen').remove()\r\n    @_lastLoading.find('>').removeClass('hidden')\r\n    @_lastLoading = null\r\n\r\n  showError: (jqxhr) ->\r\n    return unless @_lastLoading?\r\n    context = {\r\n      jqxhr: jqxhr\r\n      view: @\r\n      me: me\r\n    }\r\n    @_lastLoading.find('.loading-screen').replaceWith((loadingErrorTemplate(context)))\r\n    @_lastLoading.i18n()\r\n\r\n  forumLink: ->\r\n    link = 'http://discourse.codecombat.com/'\r\n    lang = (me.get('preferredLanguage') or 'en-US').split('-')[0]\r\n    if lang in ['zh', 'ru', 'es', 'fr', 'pt', 'de', 'nl', 'lt']\r\n      link += \"c/other-languages/#{lang}\"\r\n    link\r\n\r\n  showReadOnly: ->\r\n    return if me.isAdmin() or me.isArtisan()\r\n    warning = $.i18n.t 'editor.read_only_warning2', defaultValue: 'Note: you can\\'t save any edits here, because you\\'re not logged in.'\r\n    noty text: warning, layout: 'center', type: 'information', killer: true, timeout: 5000\r\n\r\n  # Loading ModalViews\r\n\r\n  enableModalInProgress: (modal) ->\r\n    el = modal.find('.modal-content')\r\n    el.find('> div', modal).hide()\r\n    el.find('.wait', modal).show()\r\n\r\n  disableModalInProgress: (modal) ->\r\n    el = modal.find('.modal-content')\r\n    el.find('> div', modal).show()\r\n    el.find('.wait', modal).hide()\r\n\r\n  # Subscriptions\r\n\r\n  addNewSubscription: CocoClass.prototype.addNewSubscription\r\n\r\n  # Shortcuts\r\n\r\n  listenToShortcuts: (recurse) ->\r\n    return unless key\r\n    for shortcut, func of @shortcuts\r\n      func = utils.normalizeFunc(func, @)\r\n      key(shortcut, @scope, _.bind(func, @))\r\n    if recurse\r\n      for viewID, view of @subviews\r\n        view.listenToShortcuts()\r\n\r\n  stopListeningToShortcuts: (recurse) ->\r\n    return unless key\r\n    key.deleteScope(@scope)\r\n    if recurse\r\n      for viewID, view of @subviews\r\n        view.stopListeningToShortcuts()\r\n\r\n  # Subviews\r\n\r\n  insertSubView: (view, elToReplace=null) ->\r\n    # used to insert views with ids\r\n    key = @makeSubViewKey(view)\r\n    @subviews[key].destroy() if key of @subviews\r\n    elToReplace ?= @$el.find('#'+view.id)\r\n    if @retainSubviews\r\n      @registerSubView(view, key)\r\n      if elToReplace[0]\r\n        view.setElement(elToReplace[0])\r\n        view.render()\r\n        view.afterInsert()\r\n      return view\r\n\r\n    else\r\n      elToReplace.after(view.el).remove()\r\n      @registerSubView(view, key)\r\n      view.render()\r\n      view.afterInsert()\r\n      return view\r\n\r\n  registerSubView: (view, key) ->\r\n    # used to register views which are custom inserted into the view,\r\n    # like views where you add multiple instances of them\r\n    key = @makeSubViewKey(view)\r\n    view.parent = @\r\n    view.parentKey = key\r\n    @subviews[key] = view\r\n    view\r\n\r\n  makeSubViewKey: (view) ->\r\n    key = view.id or (view.constructor.name+classCount++)\r\n    key = _.string.underscored(key)  # handy for autocomplete in dev console\r\n    key\r\n\r\n  removeSubView: (view) ->\r\n    view.$el.empty()\r\n    delete @subviews[view.parentKey]\r\n    view.destroy()\r\n\r\n  # Pointing stuff out\r\n\r\n  highlightElement: (selector, options) ->\r\n    @endHighlight()\r\n    options ?= {}\r\n    if delay = options.delay\r\n      delete options.delay\r\n      return @pointerDelayTimeout = _.delay((=> @highlightElement selector, options), delay)\r\n    $pointer = @getPointer()\r\n    $target = $(selector + ':visible')\r\n    return if parseFloat($target.css('opacity')) is 0.0  # Don't point out invisible elements.\r\n    return unless offset = $target.offset()  # Don't point out elements we can't locate.\r\n    targetLeft = offset.left + $target.outerWidth() * 0.5\r\n    targetTop = offset.top + $target.outerHeight() * 0.5\r\n\r\n    if options.sides\r\n      if 'left' in options.sides then targetLeft = offset.left\r\n      if 'right' in options.sides then targetLeft = offset.left + $target.outerWidth()\r\n      if 'top' in options.sides then targetTop = offset.top\r\n      if 'bottom' in options.sides then targetTop = offset.top + $target.outerHeight()\r\n    else\r\n      # Aim to hit the side if the target is entirely on one side of the screen.\r\n      if offset.left > @$el.outerWidth() * 0.5\r\n        targetLeft = offset.left\r\n      else if offset.left + $target.outerWidth() < @$el.outerWidth() * 0.5\r\n        targetLeft = offset.left + $target.outerWidth()\r\n\r\n      # Aim to hit the bottom or top if the target is entirely on the top or bottom of the screen.\r\n      if offset.top > @$el.outerWidth() * 0.5\r\n        targetTop = offset.top\r\n      else if  offset.top + $target.outerHeight() < @$el.outerHeight() * 0.5\r\n        targetTop = offset.top + $target.outerHeight()\r\n\r\n    if options.offset\r\n      targetLeft += options.offset.x\r\n      targetTop += options.offset.y\r\n\r\n    @pointerRadialDistance = -47\r\n    @pointerRotation = options.rotation ? Math.atan2(@$el.outerWidth() * 0.5 - targetLeft, targetTop - @$el.outerHeight() * 0.5)\r\n    initialScale = Math.max 1, 20 - me.level()\r\n    $pointer.css\r\n      opacity: 1.0\r\n      transition: 'none'\r\n      transform: \"rotate(#{@pointerRotation}rad) translate(-3px, #{@pointerRadialDistance}px) scale(#{initialScale})\"\r\n      top: targetTop - 50\r\n      left: targetLeft - 50\r\n    _.defer =>\r\n      return if @destroyed\r\n      @animatePointer()\r\n      clearInterval @pointerInterval\r\n      @pointerInterval = setInterval(@animatePointer, 1200)\r\n    if options.duration\r\n      @pointerDurationTimeout = _.delay (=> @endHighlight() unless @destroyed), options.duration\r\n\r\n  animatePointer: =>\r\n    $pointer = @getPointer()\r\n    $pointer.css transition: 'all 0.6s ease-out', transform: \"rotate(#{@pointerRotation}rad) translate(-3px, #{@pointerRadialDistance-50}px)\"\r\n    setTimeout (=> $pointer.css transition: 'all 0.4s ease-in', transform: \"rotate(#{@pointerRotation}rad) translate(-3px, #{@pointerRadialDistance}px)\"), 800\r\n\r\n  endHighlight: ->\r\n    @getPointer(false).css({'opacity': 0.0, 'transition': 'none', top: '-50px', right: '-50px'})\r\n    clearInterval @pointerInterval\r\n    clearTimeout @pointerDelayTimeout\r\n    clearTimeout @pointerDurationTimeout\r\n    @pointerInterval = @pointerDelayTimeout = @pointerDurationTimeout = null\r\n\r\n  getPointer: (add=true) ->\r\n    return $pointer if ($pointer = $(\".highlight-pointer[data-cid='#{@cid}']\")) and ($pointer.length or not add)\r\n    $pointer = $(\"<img src='/images/level/pointer.png' class='highlight-pointer' data-cid='#{@cid}'>\")\r\n    $pointer.css('z-index', 1040) if @$el.parents('#modal-wrapper').length\r\n    $('body').append($pointer)\r\n    $pointer\r\n\r\n  # Utilities\r\n\r\n  getQueryVariable: (param, defaultValue) -> CocoView.getQueryVariable(param, defaultValue)\r\n  @getQueryVariable: (param, defaultValue) -> utils.getQueryVariable(param, defaultValue)  # Moved to utils; TODO finish migrating\r\n\r\n  getRootView: ->\r\n    view = @\r\n    view = view.parent while view.parent?\r\n    view\r\n\r\n  isMobile: ->\r\n    ua = navigator.userAgent or navigator.vendor or window.opera\r\n    return mobileRELong.test(ua) or mobileREShort.test(ua.substr(0, 4))\r\n\r\n  isIE: ->\r\n    # http://stackoverflow.com/questions/19999388/jquery-check-if-user-is-using-ie\r\n    navigator.userAgent.indexOf('MSIE') > 0 or !!navigator.userAgent.match(/Trident.*rv\\:11\\./)\r\n\r\n  isMac: ->\r\n    navigator.platform.toUpperCase().indexOf('MAC') isnt -1\r\n\r\n  isIPadApp: ->\r\n    return @_isIPadApp if @_isIPadApp?\r\n    return @_isIPadApp = webkit?.messageHandlers? and navigator.userAgent?.indexOf('iPad') isnt -1\r\n\r\n  isIPadBrowser: ->\r\n    navigator?.userAgent?.indexOf('iPad') isnt -1\r\n\r\n  isFirefox: ->\r\n    navigator.userAgent.toLowerCase().indexOf('firefox') isnt -1\r\n\r\n  initSlider: ($el, startValue, changeCallback) ->\r\n    slider = $el.slider({animate: 'fast'})\r\n    slider.slider('value', startValue)\r\n    slider.on('slide', changeCallback)\r\n    slider.on('slidechange', changeCallback)\r\n    slider\r\n\r\n  scrollToLink: (link, speed=300) ->\r\n    scrollTo = $(link).offset().top\r\n    $('html, body').animate({ scrollTop: scrollTo }, speed)\r\n\r\n  scrollToTop: (speed=300) ->\r\n    $('html, body').animate({ scrollTop: 0 }, speed)\r\n\r\n  toggleFullscreen: (e) ->\r\n    # https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Using_full_screen_mode?redirectlocale=en-US&redirectslug=Web/Guide/DOM/Using_full_screen_mode\r\n    # Whoa, even cooler: https://developer.mozilla.org/en-US/docs/WebAPI/Pointer_Lock\r\n    full = document.fullscreenElement or\r\n           document.mozFullScreenElement or\r\n           document.mozFullscreenElement or\r\n           document.webkitFullscreenElement or\r\n           document.msFullscreenElement\r\n    d = document.documentElement\r\n    if not full\r\n      req = d.requestFullScreen or\r\n            d.mozRequestFullScreen or\r\n            d.mozRequestFullscreen or\r\n            d.msRequestFullscreen or\r\n            (if d.webkitRequestFullscreen then -> d.webkitRequestFullscreen Element.ALLOW_KEYBOARD_INPUT else null)\r\n      req?.call d\r\n      @playSound 'full-screen-start' if req\r\n    else\r\n      nah = document.exitFullscreen or\r\n            document.mozCancelFullScreen or\r\n            document.mozCancelFullscreen or\r\n            document.msExitFullscreen or\r\n            document.webkitExitFullscreen\r\n      nah?.call document\r\n      @playSound 'full-screen-end' if req\r\n    return\r\n\r\n  playSound: (trigger, volume=1) ->\r\n    Backbone.Mediator.publish 'audio-player:play-sound', trigger: trigger, volume: volume\r\n\r\n  tryCopy: ->\r\n    try\r\n      document.execCommand('copy')\r\n    catch err\r\n      message = 'Oops, unable to copy'\r\n      noty text: message, layout: 'topCenter', type: 'error', killer: false\r\n\r\n  wait: (event) -> new Promise((resolve) => @once(event, resolve))\r\n\r\n  onClickTranslatedElement: (e) ->\r\n    return unless (key.ctrl or key.command) and key.alt\r\n    e.preventDefault()\r\n    e.stopImmediatePropagation()\r\n    i18nKey = _.last($(e.currentTarget).data('i18n').split(';')).replace(/\\[.*?\\]/, '')\r\n    base = $.i18n.t(i18nKey, {lng: 'en'})\r\n    translated = $.i18n.t(i18nKey)\r\n    en = require('locale/en')\r\n    [clickedSection, clickedKey] = i18nKey.split('.')\r\n    lineNumber = 2\r\n    found = false\r\n    for enSection, enEntries of en.translation\r\n      for enKey, enValue of enEntries\r\n        ++lineNumber\r\n        if clickedSection is enSection and clickedKey is enKey\r\n          found = true\r\n          break\r\n      break if found\r\n      lineNumber += 2\r\n    unless found\r\n      return console.log \"Couldn't find #{i18nKey} in app/locale/en.coffee.\"\r\n    targetLanguage = me.get('preferredLanguage') or 'en'\r\n    targetLanguage = 'en' if targetLanguage.split('-')[0] is 'en'\r\n    githubUrl = \"https://github.com/codecombat/codecombat/blob/master/app/locale/#{targetLanguage}.coffee#L#{lineNumber}\"\r\n    window.open githubUrl, target: '_blank'\r\n\r\nmobileRELong = /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i\r\n\r\nmobileREShort = /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i\r\n\r\nmodule.exports = CocoView\r\n"]}