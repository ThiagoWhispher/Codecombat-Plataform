{"version":3,"sources":["app/templates/account/subscription-view.jade","app/views/account/SubscriptionView.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnQA;AAAA;;ACAA;EAAA;;;;AAAA,WAAW,QAAQ,qBAAR;;AACX,WAAW,QAAQ,qCAAR;;AACX,iBAAiB,QAAQ,4BAAR;;AACjB,iBAAiB,QAAQ,2BAAR;;AACjB,UAAU,QAAQ,gBAAR;;AACV,gBAAgB,QAAQ,sBAAR;;AAChB,OAAO,QAAQ,aAAR;;AACP,QAAQ,QAAQ,YAAR;;AAmBR,iBAAiB;;AACjB,cAAc;;AAEd,MAAM,CAAC,OAAP,GAAuB;;;6BACrB,KAAI;;6BACJ,WAAU;;6BAEV,SACE;IAAA,oCAAoC,0BAApC;IACA,kCAAkC,wBADlC;IAEA,yCAAyC,8BAFzC;IAGA,0CAA0C,+BAH1C;IAIA,sCAAsC,4BAJtC;IAKA,+CAA+C,oCAL/C;IAMA,uCAAuC,6BANvC;;;6BAQF,gBACE;IAAA,8BAA8B,cAA9B;IACA,yBAAyB,uBADzB;;;EAGW,0BAAC,OAAD;AACX;IAAA,kDAAM,OAAN;IACA,cAAc,KAAK,CAAC,gBAAN,CAAuB,MAAvB;IACd,IAAC,YAAD,GAAmB,gBAAY,IAAC,WAAb,EAAyB,WAAzB;IACnB,IAAC,cAAD,GAAqB,kBAAc,IAAC,WAAf;IACrB,IAAC,eAAD,GAAsB,mBAAe,IAAC,WAAhB;IACtB,IAAC,YAAW,CAAC,MAAb,CAAoB;aAAA;oDAAG,KAAC;MAAJ;IAAA,QAApB;IACA,IAAC,cAAa,CAAC,MAAf,CAAsB;aAAA;oDAAG,KAAC;MAAJ;IAAA,QAAtB;EAPW;;6BAWb,2BAA0B,SAAC,CAAD;AACxB;IAAA,IAAG,IAAC,YAAW,CAAC,WAAhB;MACE,IAAC,YAAW,CAAC,SAAb,CAAuB;eAAA;sDAAG,KAAC;QAAJ;MAAA,QAAvB,EADF;KAAA;MAGE,IAAC,cAAD,CAAmB,oBAAnB,EAHF;;+CAIc,CAAE,UAAhB,CAA2B,yBAA3B,EAAsD;MAAA,UAAU,cAAV;MAA0B,OAAO,2BAAjC;KAAtD;EALwB;;6BAO1B,eAAc;WACZ,QAAQ,CAAC,QAAQ,CAAC,MAAlB;EADY;;6BAGd,yBAAwB,SAAC,CAAD;AACtB;;SAAc,CAAE,UAAhB,CAA2B,mBAA3B;;IACA,IAAC,IAAG,CAAC,IAAL,CAAU,0BAAV,CAAqC,CAAC,IAAtC,EAA4C,CAAC,QAA7C,CAAsD,UAAtD,EAAkE,GAAlE;WACA,IAAC,IAAG,CAAC,IAAL,CAAU,uBAAV,CAAkC,CAAC,IAAnC,CAAwC,GAAxC,CAA4C,CAAC,IAA7C,CAAkD,UAAlD,CAA6D,CAAC,KAA9D;EAHsB;;6BAKxB,+BAA8B,SAAC,CAAD;AAC5B;;SAAc,CAAE,UAAhB,CAA2B,oBAA3B;;IACA,IAAC,IAAG,CAAC,IAAL,CAAU,uBAAV,CAAkC,CAAC,IAAnC,CAAwC,GAAxC,CAA4C,CAAC,IAA7C,CAAkD,UAAlD,CAA6D,CAAC,IAA9D;WACA,IAAC,IAAG,CAAC,IAAL,CAAU,0BAAV,CAAqC,CAAC,KAAtC,EAA6C,CAAC,WAA9C,CAA0D,UAA1D,EAAsE,GAAtE;EAH4B;;6BAK9B,gCAA+B,SAAC,CAAD;AAC7B;IAAA,UAAU,IAAC,IAAG,CAAC,IAAL,CAAU,gCAAV,CAA2C,CAAC,GAA5C,EAAiD,CAAC,IAAlD;WACV,IAAC,YAAW,CAAC,WAAb,CAAyB,OAAzB;EAF6B;;6BAM/B,6BAA4B,SAAC,CAAD;AAC1B;IAAA,SAAS,IAAC,IAAG,CAAC,IAAL,CAAU,mBAAV,CAA8B,CAAC,GAA/B,EAAoC,CAAC,KAArC,CAA2C,IAA3C;IACT,QAAQ,IAAC,eAAc,CAAC,cAAhB,CAA+B,MAA/B,EAAuC;aAAA;oDAAE,KAAC;MAAH;IAAA,QAAvC;IACR,IAAyC,KAAzC;aAAA,IAAC,cAAa,CAAC,cAAf,CAA8B,MAA9B;;EAH0B;;6BAK5B,8BAA6B,SAAC,CAAD;IAC3B,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,QAAZ,CAAqB,MAArB;WACA,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,MAAZ,EAAoB,CAAC,IAArB,CAA0B,uCAA1B,CAAkE,CAAC,WAAnE,CAA+E,MAA/E;EAF2B;;6BAI7B,qCAAoC,SAAC,CAAD;AAClC;IAAA,QAAQ,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,OAAZ,CAAoB,IAApB,CAAyB,CAAC,IAA1B,CAA+B,oBAA/B,CAAoD,CAAC,IAArD;WACR,IAAC,cAAa,CAAC,WAAf,CAA2B,KAA3B,EAAkC;aAAA;oDAAG,KAAC;MAAJ;IAAA,QAAlC;EAFkC;;6BAIpC,wBAAuB,SAAC,CAAD;WACrB,IAAC,cAAa,CAAC,eAAf,CAA+B,CAAC,CAAC,KAAK,CAAC,EAAvC,EAA2C;aAAA;oDAAG,KAAC;MAAJ;IAAA,QAA3C;EADqB;;;;GAnEuB;;AAwE1C;;;2BAEJ,iBAAgB,SAAC,MAAD,EAAS,MAAT;AACd;IAAA,IAAC,WAAD,GAAc,MAAM,CAAC,IAAP,CAAY,IAAZ;IAEd,aAAa;IACb,IAAC,YAAD;;AAAgB;WAAA;;YAA+B,UAAU,CAAC,IAAX,CAAgB,KAAK,CAAC,IAAN,EAAY,CAAC,WAAb,EAAhB;uBAA/B;;AAAA;;;IAChB,IAAiC,IAAC,YAAW,CAAC,MAAb,GAAsB,MAAM,CAAC,MAA9D;AAAA,aAAO,IAAC,cAAD,CAAe,MAAf,EAAP;;AACA,WAAO,IAAC,YAAD,CAAa,MAAb;EANO;;2BAQhB,cAAa;IACX,KAAc,IAAC,YAAf;AAAA;;AACA,WAAO,IAAC,YAAW,CAAC,IAAb,CAAkB,IAAlB;EAFI;;2BAIb,gBAAe,SAAC,MAAD;IACb,IAAC,MAAD,GAAS;IACT;AACA,WAAO;EAHM;;2BAKf,cAAa,SAAC,MAAD;IACX,IAAC,MAAD,GAAS;IACT;AACA,WAAO;EAHI;;;;;;AAMT;EACS,qBAAC,UAAD,EAAc,YAAd;IAAC,IAAC,cAAD;IAAa,IAAC,eAAD;EAAd;;wBAEb,YAAW,SAAC,MAAD;AACT;IAAA,KAAc,IAAC,YAAf;AAAA;;IAEA,IAAG,IAAC,YAAD,4CAAgC,CAAE,qBAArC;MACE,OAAO,IAAC;AACR,aAAO,SAFT;;IAIA,IAAC,MAAD,GAAS;IACT,IAAC,aAAD,GAAgB;IAChB;IAEA,aAAa,CAAC,CAAC,KAAF,4CAA2B,EAA3B;IACb,UAAU,CAAC,MAAX,GAAoB;IACpB,UAAU,CAAC,WAAX,GAAyB,IAAC;IAC1B,EAAE,CAAC,GAAH,CAAO,QAAP,EAAiB,UAAjB;IAEA,EAAE,CAAC,IAAH,CAAQ,MAAR,EAAgB;aAAA;AACd;;cAAmB,CAAE,UAArB,CAAgC,gCAAhC,EAAkE;YAAA,OAAO,CAAP;WAAlE;;QACA,OAAO,KAAC;eACR,KAAC,OAAD,CAAQ,MAAR;MAHc;IAAA,QAAhB;IAIA,EAAE,CAAC,IAAH,CAAQ,OAAR,EAAiB;aAAA,SAAC,IAAD,EAAO,QAAP,EAAiB,OAAjB;AACf;QAAA,OAAO,CAAC,KAAR,CAAc,0DAAd,EAA0E,QAA1E;QACA,wDAAgC;QAChC,OAAO,UAAU,CAAC;QAClB,OAAO,UAAU,CAAC;QAClB,EAAE,CAAC,GAAH,CAAO,QAAP,EAAiB,UAAjB;QACA,MAAM,OAAO,CAAC;QACd,IAAG,GAAG,CAAC,MAAJ,KAAc,GAAjB;UACE,KAAC,MAAD,GAAS;UACT,KAAC,aAAD,GAAgB,GAFlB;SAAA;UAIE,IAAG,GAAG,CAAC,MAAJ,KAAc,GAAjB;YACE,OAAO,KAAC,aADV;;UAEA,KAAC,MAAD,GAAS;UACT,KAAC,aAAD,GAAmB,GAAG,CAAC,MAAL,GAAY,IAAZ,GAAgB,GAAG,CAAC,aAPxC;;eAQA;MAfe;IAAA,QAAjB;WAgBA,EAAE,CAAC,KAAH,CAAS;MAAC,SAAS;QAAC,iBAAiB,MAAlB;OAAV;KAAT;EApCS;;wBAsCX,cAAa,SAAC,OAAD;AACX;IAAA,eAAe;aAAA;AACb;QAAA,aAAa,CAAC,CAAC,KAAF,CAAQ,EAAE,CAAC,GAAH,CAAO,QAAP,CAAR;QACb,OAAO,UAAU,CAAC;QAClB,EAAE,CAAC,GAAH,CAAO,QAAP,EAAiB,UAAjB;QACA,EAAE,CAAC,IAAH,CAAQ,MAAR,EAAgB;AACd;;eAAc,CAAE,UAAhB,CAA2B,iBAA3B,EAA8C;cAAA,SAAS,OAAT;aAA9C;;iBACA,QAAQ,CAAC,QAAQ,CAAC,MAAlB;QAFc,CAAhB;eAGA,EAAE,CAAC,KAAH,CAAS;UAAC,SAAS;YAAC,iBAAiB,MAAlB;WAAV;SAAT;MAPa;IAAA;IAQf,IAAG,OAAH;aACE,CAAC,CAAC,IAAF,CAAO,UAAP,EAAmB;QAAA,SAAS,OAAT;QAAkB,SAAS,cAA3B;OAAnB,EAA8D,SAAC,QAAD;eAC5D;MAD4D,CAA9D,EADF;KAAA;aAIE,eAJF;;EATW;;wBAeb,SAAQ,SAAC,MAAD;AACN;IAAA,KAAc,cAAa,EAAE,CAAC,GAAH,CAAO,QAAP,CAAb,CAAd;AAAA;;IAEA,IAAC,MAAD,GAAS;IAET,IAAG,UAAU,CAAC,SAAd;MACE,IAAC,QAAD,GAAW;MACX,sBAAsB;eAAA,SAAC,WAAD;UACpB,KAAC,aAAD,GAAgB,WAAW,CAAC;UAC5B,KAAC,YAAD,GAAe,WAAW,CAAC;UAC3B,KAAC,UAAD,GAAa,UAAU,CAAC;UACxB,IAAG,WAAW,CAAC,YAAY,CAAC,oBAA5B;YACE,KAAC,QAAD,GAAe,SAAK,WAAW,CAAC,YAAY,CAAC,kBAAzB,GAA8C,IAAnD,EADjB;;UAEA,OAAO,KAAC;iBACR;QAPoB;MAAA;aAQtB,IAAC,WAAU,CAAC,kBAAZ,CAA+B,aAA/B,EAA8C;QAC5C,KAAK,wBADuC;QAE5C,QAAQ,MAFoC;QAG5C,SAAS,mBAHmC;OAA9C,EAIG,CAJH,CAIK,CAAC,IAJN,GAVF;KAAA,MAgBK,IAAG,UAAU,CAAC,WAAd;MACH,IAAC,iBAAD,GAAoB;MACpB,OAAO,IAAC;aACR,SAHG;KAAA,MAKA,IAAG,UAAU,CAAC,cAAd;MACH,IAAC,KAAD,GAAQ;MACR,IAAC,OAAD,GAAU,EAAE,CAAC,SAAH;MACV,IAAC,WAAD,GAAc;MAEd,UAAU;QAAE,OAAO,KAAT;QAAgB,KAAK,cAAY,EAAE,CAAC,EAAf,GAAkB,SAAvC;;MACV,OAAO,CAAC,OAAR,GAAkB;eAAA,SAAC,IAAD;AAChB;UAAA,IAAG,OAAO,IAAI,CAAC,IAAf;YACE,KAAC,KAAD,GAAW,IAAI,CAAC,KAAN,GAAY,KAAZ,GAAiB,IAAI,CAAC,MADlC;;UAEA,IAAG,MAAM,IAAI,CAAC,YAAd;YACE,YAAgB,SAAK,CAAC,GAAG,CAAC,SAAJ,IAAiB,GAAG,CAAC,kBAAtB,IAA4C,IAAjD;YAChB,IAAG,GAAG,CAAC,oBAAP;cACE,KAAC,YAAD,GAAe,UADjB;aAAA,MAEK,sEAAuB,CAAE,qBAAtB,KAA8B,MAAjC;cACH,KAAC,gBAAD,GAAmB;cACnB,KAAC,KAAD,GAAQ,MAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,MAAT,GAAgB,GAAjB,CAAqB,CAAC,OAAtB,CAA8B,CAA9B,CAAD,EAFR;aAJP;WAAA;YAQE,OAAO,CAAC,KAAR,CAAc,0CAAuC,yCAAiB,CAAE,mBAAnB,CAAvC,GAAqE,GAArE,GAAuE,yCAAiB,CAAE,uBAAnB,CAArF,EARF;;UASA,OAAO,KAAC;iBACR;QAbgB;MAAA;MAclB,IAAC,WAAU,CAAC,kBAAZ,CAA+B,uBAA/B,EAAwD,OAAxD,CAAgE,CAAC,IAAjE;MAEA,WAAe,mBAAe,EAAf,EAAmB;QAAE,KAAK,aAAP;QAAsB,OAAO,OAA7B;QAAsC,YAAW,KAAjD;OAAnB;MACf,QAAQ,CAAC,IAAT,CAAc,MAAd,EAAsB;AACpB;QAAA,IAAC,iBAAD,GAAoB;;AAAC;AAAA;eAAA;;gBAAgC,CAAI,CAAC,CAAC,GAAF,CAAM,WAAN;2BAApC;;AAAA;;YAAD,CAAwD,CAAC;eAC7E;MAFoB,CAAtB;aAGA,IAAC,WAAU,CAAC,cAAZ,CAA2B,QAA3B,EAAqC,UAArC,EAAiD;QAAC,OAAO,KAAR;OAAjD,EA1BG;KAAA,MA4BA,IAAG,UAAU,CAAC,IAAd;MACH,IAAC,KAAD,GAAQ,UAAU,CAAC;MACnB,OAAO,IAAC;aACR,SAHG;KAAA;MAMH,OAAO,IAAC;aACR,SAPG;;EAtDC;;;;;;AA+DJ;EACS,uBAAC,UAAD;IAAC,IAAC,cAAD;IACZ,IAAC,WAAD,GAAc;IACd,IAAC,wBAAD,GAA2B;EAFhB;;0BAIb,iBAAgB,SAAC,KAAD;WACd,IAAC,wBAAuB,CAAC,IAAzB,CAA8B,KAA9B;EADc;;0BAGhB,oBAAmB,SAAC,KAAD;WACjB,CAAC,CAAC,MAAF,CAAS,IAAC,wBAAV,EAAmC,SAAC,cAAD;aAAoB,mBAAkB;IAAtC,CAAnC;EADiB;;0BAGnB,iBAAgB,SAAC,MAAD;AACd;IAAA,IAAC,gBAAD;;AAAoB;WAAA;;qBAAA,KAAK,CAAC,IAAN,EAAY,CAAC,WAAb;AAAA;;;IACpB,CAAC,CAAC,MAAF,CAAS,IAAC,gBAAV,EAA2B,SAAC,KAAD;aAAW,CAAC,CAAC,OAAF,CAAU,KAAV;IAAX,CAA3B;IACA,IAAU,IAAC,gBAAe,CAAC,MAAjB,GAA0B,CAApC;AAAA;;;SAEc,CAAE,UAAhB,CAA2B,8BAA3B;;IAGA,iJAAyD;IACzD,cAAc,IAAC,gBAAe,CAAC,MAAjB,GAA0B;IACxC,SAAS,KAAK,CAAC,sBAAN,CAA6B,cAA7B,EAA6C,WAA7C,EAA0D,0EAA1D,IAA+F,KAAK,CAAC,sBAAN,CAA6B,cAA7B,EAA6C,eAA7C,EAA8D,0EAA9D;IACxG,UAAU;MACR,aAAa,CAAG,IAAC,gBAAe,CAAC,MAAlB,GAAyB,GAA3B,IAAgC,CAAC,CAAC,IAAI,CAAC,CAAP,CAAS,8BAAT,EAAyC;QAAA,cAAc,uBAAd;OAAzC,CADrC;MAER,QAAQ,MAFA;MAGR,QAAW,EAAE,CAAC,GAAH,CAAO,cAAP,KAA0B,CAAC,EAAE,CAAC,GAAH,CAAO,mBAAP,KAA+B,OAAhC,CAAyC,YAAzC,KAAkD,IAA/E,GAAyF,IAAzF,GAAmG,MAHnG;MAIR,gBAAgB,IAJR;;IAMV,IAAC,MAAD,GAAS;IACT,IAAC,aAAD,GAAgB;WAChB,aAAa,CAAC,IAAd,CAAmB,OAAnB;EAnBc;;0BAqBhB,kBAAiB,SAAC,OAAD,EAAU,MAAV;AACf;IAAA,IAAc,IAAC,MAAD,KAAU,iBAAxB;AAAA;;IAEA,IAAC,MAAD,GAAS;IACT,IAAC,aAAD,GAAgB;IAChB,IAAC,eAAD,GAAkB;IAClB;IAEA,aAAa,CAAC,CAAC,KAAF,0CAA2B,EAA3B;IACb,UAAU,CAAC,KAAX,GAAmB;IACnB,UAAU,CAAC,eAAX,GAA6B,IAAC;IAC9B,EAAE,CAAC,GAAH,CAAO,QAAP,EAAiB,UAAjB;IAEA,EAAE,CAAC,IAAH,CAAQ,MAAR,EAAgB;aAAA;AACd;;cAAmB,CAAE,UAArB,CAAgC,0CAAhC;;eACA,KAAC,OAAD,CAAQ,MAAR;MAFc;IAAA,QAAhB;IAGA,EAAE,CAAC,IAAH,CAAQ,OAAR,EAAiB;aAAA,SAAC,IAAD,EAAO,QAAP,EAAiB,OAAjB;AACf;QAAA,OAAO,CAAC,KAAR,CAAc,0DAAd,EAA0E,QAA1E;QACA,wDAAgC;QAChC,OAAO,UAAU,CAAC;QAClB,MAAM,OAAO,CAAC;QACd,IAAG,GAAG,CAAC,MAAJ,KAAc,GAAjB;UACE,KAAC,MAAD,GAAS;UACT,KAAC,aAAD,GAAgB,GAFlB;SAAA;UAIE,KAAC,MAAD,GAAS;UACT,KAAC,aAAD,GAAmB,GAAG,CAAC,MAAL,GAAY,IAAZ,GAAgB,GAAG,CAAC,aALxC;;eAMA;MAXe;IAAA,QAAjB;WAYA,EAAE,CAAC,KAAH,CAAS;MAAC,SAAS;QAAC,iBAAiB,MAAlB;OAAV;KAAT;EA5Be;;0BA8BjB,cAAa,SAAC,KAAD,EAAQ,MAAR;AACX;IAAA,OAAO,IAAC;IACR,IAAC,aAAD,GAAgB;IAChB,OAAO,IAAC;IACR,IAAC,eAAD,CAAgB,KAAhB;IACA;IACA,aAAa,CAAC,CAAC,KAAF,CAAQ,EAAE,CAAC,GAAH,CAAO,QAAP,CAAR;IACb,UAAU,CAAC,gBAAX,GAA8B;IAC9B,EAAE,CAAC,GAAH,CAAO,QAAP,EAAiB,UAAjB;IACA,EAAE,CAAC,IAAH,CAAQ,MAAR,EAAgB;aAAA;QACd,KAAC,kBAAD,CAAmB,KAAnB;eACA,KAAC,OAAD,CAAQ,MAAR;MAFc;IAAA,QAAhB;WAGA,EAAE,CAAC,KAAH,CAAS;MAAC,SAAS;QAAC,iBAAiB,MAAlB;OAAV;KAAT;EAZW;;0BAcb,SAAQ,SAAC,MAAD;AACN;IAAA,OAAO,IAAC;IACR,OAAO,IAAC;IACR,4CAA8B,CAAE,oBAAhC;AAAA;;IACA,IAAC,wBAAD,GAA2B;IAE3B,UAAU;MAAE,OAAO,KAAT;MAAgB,KAAK,cAAY,EAAE,CAAC,EAAf,GAAkB,SAAvC;;IACV,OAAO,CAAC,OAAR,GAAkB;aAAA,SAAC,IAAD;AAChB;QAAA,KAAC,WAAD,GAAc,IAAI,CAAC;QACnB,IAAG,OAAO,IAAI,CAAC,IAAf;UACE,KAAC,KAAD,GAAW,IAAI,CAAC,KAAN,GAAY,KAAZ,GAAiB,IAAI,CAAC,MADlC;;eAEA;MAJgB;IAAA;IAKlB,IAAC,WAAU,CAAC,kBAAZ,CAA+B,yBAA/B,EAA0D,OAA1D,CAAkE,CAAC,IAAnE;IAEA,yBAAyB;aAAA,SAAC,aAAD;AACvB;QAAA,KAAC,WAAD,GAAc;QACd,QAAQ;AACR;AAAA;;UACE,KAAe,SAAS,CAAC,oBAAzB;YAAA;;UACA,IAAG,mCAAsB,8BAAtB,IAA2C,iBAAS,CAAC,UAAV,eAAwB,KAAC,gBAAzB,aAA9C;YACE,KAAC,eAAc,CAAC,IAAhB,CAAqB,SAAS,CAAC,UAA/B,EADF;;AAFF;QAIA,KAAC,kBAAD,GAAqB,KAAK,CAAC,sBAAN,CAA6B,cAA7B,EAA6C,KAA7C,EAAoD,0EAApD;QACrB,KAAC,gBAAD,GAAmB;eACnB;MATuB;IAAA;WAUzB,IAAC,WAAU,CAAC,kBAAZ,CAA+B,gBAA/B,EAAiD;MAC/C,KAAK,2BAD0C;MAE/C,QAAQ,MAFuC;MAG/C,SAAS,sBAHsC;KAAjD,EAIG,CAJH,CAIK,CAAC,IAJN;EAxBM","file":"public/javascripts/app/views/account/SubscriptionView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),features = locals_.features,me = locals_.me,view = locals_.view,moment = locals_.moment,usesSocialMedia = locals_.usesSocialMedia,isIE = locals_.isIE,fbRef = locals_.fbRef;buf.push(\"<div id=\\\"site-nav\\\"><a href=\\\"/\\\"><img id=\\\"nav-logo\\\" src=\\\"/images/pages/base/logo.png\\\" title=\\\"CodeCombat - Learn how to code by playing a game\\\" alt=\\\"CodeCombat\\\"/></a><div id=\\\"site-nav-links\\\"><a href=\\\"/\\\"><img id=\\\"small-nav-logo\\\" src=\\\"/images/pages/base/logo.png\\\" title=\\\"CodeCombat - Learn how to code by playing a game\\\" alt=\\\"CodeCombat\\\"/></a><a href=\\\"/\\\"><span class=\\\"glyphicon glyphicon-home\\\"></span></a>\");\nif ( !features.playViewsOnly)\n{\nbuf.push(\"<a href=\\\"/play\\\" data-i18n=\\\"common.play\\\"></a><a href=\\\"/play/ladder\\\" data-i18n=\\\"game_menu.multiplayer_tab\\\"></a>\");\nif ( me.isStudent())\n{\nbuf.push(\"<a href=\\\"/students\\\" data-i18n=\\\"nav.my_courses\\\"></a>\");\n}\nif ( me.isTeacher())\n{\nbuf.push(\"<a href=\\\"/teachers/classes\\\" data-i18n=\\\"nav.my_classrooms\\\"></a>\");\n}\nbuf.push(\"<a href=\\\"/about\\\" data-i18n=\\\"nav.about\\\"></a><a\" + (jade.attrs({ 'href':(view.forumLink()), 'data-i18n':(\"nav.forum\") }, {\"href\":true,\"data-i18n\":true})) + \"></a><a href=\\\"/community\\\" data-i18n=\\\"nav.community\\\"></a>\");\nif ( me.get('anonymous') === false)\n{\nbuf.push(\"<span class=\\\"dropdown\\\"><button href=\\\"#\\\" data-toggle=\\\"dropdown\\\" class=\\\"btn btn-sm header-font dropdown-toggle\\\">\");\nif ( me.get('photoURL'))\n{\nbuf.push(\"<img\" + (jade.attrs({ 'src':(me.getPhotoURL(18)), 'alt':(\"\"), \"class\": [('account-settings-image')] }, {\"src\":true,\"alt\":true})) + \"/>\");\n}\nelse\n{\nbuf.push(\"<i class=\\\"glyphicon glyphicon-user\\\"></i>\");\n}\nbuf.push(\"<span data-i18n=\\\"nav.account\\\" href=\\\"/account\\\" class=\\\"spl spr\\\"></span><span class=\\\"caret\\\"></span></button><ul role=\\\"menu\\\" class=\\\"dropdown-menu\\\"><li class=\\\"user-dropdown-header\\\"><span class=\\\"user-level\\\">\" + (jade.escape(null == (jade.interp = me.level()) ? \"\" : jade.interp)) + \"</span><a\" + (jade.attrs({ 'href':(\"/user/\" + (me.getSlugOrID()) + \"\") }, {\"href\":true})) + \"><div\" + (jade.attrs({ 'style':(\"background-image: url(\" + (me.getPhotoURL()) + \")\"), \"class\": [('img-circle')] }, {\"style\":true})) + \"></div></a><h3>\" + (jade.escape(null == (jade.interp = me.broadName()) ? \"\" : jade.interp)) + \"</h3></li><li><a\" + (jade.attrs({ 'href':(\"/user/\" + (me.getSlugOrID()) + \"\"), 'data-i18n':(\"nav.profile\") }, {\"href\":true,\"data-i18n\":true})) + \"></a></li><li><a href=\\\"/account/settings\\\" data-i18n=\\\"play.settings\\\"></a></li>\");\nif ( me.isAdmin() || !(me.isTeacher() || me.isStudent()))\n{\nbuf.push(\"<li><a href=\\\"/account/payments\\\" data-i18n=\\\"account.payments\\\"></a></li>\");\n}\nif ( me.isAdmin() || !(me.isTeacher() || me.isStudent()) || me.hasSubscription())\n{\nbuf.push(\"<li><a href=\\\"/account/subscription\\\" data-i18n=\\\"account.subscription\\\"></a></li>\");\n}\nif ( me.isAdmin() || !(me.isTeacher() || me.isStudent()))\n{\nbuf.push(\"<li><a href=\\\"/account/prepaid\\\" data-i18n=\\\"account.prepaid_codes\\\"></a></li>\");\n}\nbuf.push(\"<li><a id=\\\"logout-button\\\" data-i18n=\\\"login.log_out\\\"></a></li></ul></span>\");\n}\nelse\n{\nbuf.push(\"<button data-i18n=\\\"login.sign_up\\\" class=\\\"btn btn-sm btn-primary header-font signup-button\\\"></button><button data-i18n=\\\"login.log_in\\\" class=\\\"btn btn-sm btn-default header-font login-button\\\"></button>\");\n}\n}\nbuf.push(\"<select class=\\\"language-dropdown form-control\\\"></select></div></div><div id=\\\"site-content-area\\\"><ol class=\\\"breadcrumb\\\"><li><a href=\\\"/\\\"><span class=\\\"glyphicon glyphicon-home\\\"></span></a></li><li><a href=\\\"/account\\\" data-i18n=\\\"nav.account\\\"></a></li><li data-i18n=\\\"account.subscription\\\" class=\\\"active\\\"></li></ol>\");\nif ( me.get('anonymous'))\n{\nbuf.push(\"<p data-i18n=\\\"subscribe.must_be_logged\\\" class=\\\"logged-out-blurb\\\"></p>\");\n}\nelse\n{\nbuf.push(\"<div class=\\\"panel panel-default\\\"><div class=\\\"panel-heading\\\"><h3 data-i18n=\\\"subscribe.personal_sub\\\"></h3>\");\nif ( view.personalSub.prepaidCode && !view.personalSub.usingPrepaidCode)\n{\nbuf.push(\"<div><span data-i18n=\\\"subscribe.subscribe_prepaid\\\"></span><span class=\\\"spl spr\\\">\" + (jade.escape(null == (jade.interp = view.personalSub.prepaidCode) ? \"\" : jade.interp)) + \"</span></div>\");\n}\nbuf.push(\"</div><div class=\\\"panel-body\\\">\");\nif ( view.personalSub.state === 'loading')\n{\nbuf.push(\"<div data-i18n=\\\"subscribe.loading_info\\\" class=\\\"alert alert-info\\\"></div>\");\n}\nelse if ( view.personalSub.state === 'subscribing')\n{\nbuf.push(\"<div data-i18n=\\\"subscribe.subscribing\\\" class=\\\"alert alert-info\\\"></div>\");\n}\nelse if ( view.personalSub.sponsor)\n{\nbuf.push(\"<div><span data-i18n=\\\"subscribe.managed_by\\\" class=\\\"spr\\\"></span><span>\" + (jade.escape((jade.interp = view.personalSub.sponsorName) == null ? '' : jade.interp)) + \" (\" + (jade.escape((jade.interp = view.personalSub.sponsorEmail) == null ? '' : jade.interp)) + \")</span></div>\");\nif ( view.personalSub.endDate)\n{\nbuf.push(\"<div><span data-i18n=\\\"subscribe.will_be_cancelled\\\" class=\\\"spr\\\"></span><span>\" + (jade.escape(null == (jade.interp = moment(view.personalSub.endDate).format('l')) ? \"\" : jade.interp)) + \"</span></div>\");\n}\n}\nelse if ( view.personalSub.usingPrepaidCode)\n{\nbuf.push(\"<div data-i18n=\\\"subscribe.using_prepaid\\\"></div>\");\n}\nelse if ( view.personalSub.self)\n{\nif ( view.personalSub.state === 'declined')\n{\nbuf.push(\"<div class=\\\"alert alert-danger alert-dismissible\\\"><span data-i18n=\\\"buy_gems.declined\\\"></span><button type=\\\"button\\\" data-dismiss=\\\"alert\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\">&times;</span></button></div><br/>\");\n}\nelse if ( view.personalSub.state === 'unknown_error')\n{\nbuf.push(\"<div class=\\\"alert alert-danger alert-dismissible\\\"><button type=\\\"button\\\" data-dismiss=\\\"alert\\\" class=\\\"close\\\"><span aria-hidden=\\\"true\\\">&times;</span></button><p data-i18n=\\\"loading_error.unknown\\\"></p><p>\" + (jade.escape(null == (jade.interp = view.personalSub.stateMessage) ? \"\" : jade.interp)) + \"</p></div><br/>\");\n}\nif ( !view.personalSub.subscribed || view.personalSub.prepaidCode)\n{\nbuf.push(\"<button data-i18n=\\\"subscribe.subscribe_title\\\" class=\\\"start-subscription-button btn btn-lg btn-success\\\"></button>\");\n}\nelse\n{\nbuf.push(\"<button data-i18n=\\\"subscribe.unsubscribe\\\" class=\\\"end-subscription-button btn btn-lg btn-warning\\\"></button>\");\n}\nbuf.push(\"<div class=\\\"unsubscribe-feedback row secret\\\"><div class=\\\"col-lg-7\\\"><h3>\");\nif ( view.personalSub.monthsSubscribed > 1)\n{\nbuf.push(\"<span data-i18n=\\\"subscribe.thank_you_months_prefix\\\" class=\\\"spr\\\"></span><span>\" + (jade.escape(null == (jade.interp = view.personalSub.monthsSubscribed) ? \"\" : jade.interp)) + \"</span><span data-i18n=\\\"subscribe.thank_you_months_suffix\\\" class=\\\"spl\\\"></span>\");\n}\nelse\n{\nbuf.push(\"<span data-i18n=\\\"subscribe.thank_you\\\"></span>\");\n}\nbuf.push(\"</h3><div data-i18n=\\\"subscribe.sorry_to_see_you_go\\\"></div><textarea rows=\\\"3\\\" data-i18n=\\\"[placeholder]subscribe.unsubscribe_feedback_placeholder\\\"></textarea></div><div class=\\\"col-lg-5\\\"><button data-i18n=\\\"subscribe.never_mind\\\" class=\\\"cancel-end-subscription-button btn btn-lg btn-default\\\"></button><button data-i18n=\\\"subscribe.confirm_unsubscribe\\\" class=\\\"confirm-end-subscription-button btn btn-lg btn-warning\\\"></button></div></div><table class=\\\"table table-striped table-condensed\\\"><tr><th data-i18n=\\\"user.status\\\"></th><td>\");\nif ( view.personalSub.subscribed)\n{\nbuf.push(\"<strong data-i18n=\\\"account.subscribed\\\"></strong>\");\n}\nelse\n{\nif ( view.personalSub.active)\n{\nbuf.push(\"<strong data-i18n=\\\"account.active\\\"></strong><div data-i18n=\\\"account.status_unsubscribed_active\\\" class=\\\"text-muted\\\"></div>\");\n}\nelse\n{\nbuf.push(\"<strong data-i18n=\\\"account.unsubscribed\\\"></strong><div data-i18n=\\\"account.status_unsubscribed\\\" class=\\\"text-muted\\\"></div>\");\n}\n}\nbuf.push(\"</td></tr>\");\nif ( view.personalSub.activeUntil)\n{\nbuf.push(\"<tr><th data-i18n=\\\"account.active_until\\\"></th><td>\" + (jade.escape(null == (jade.interp = moment(view.personalSub.activeUntil).format('l')) ? \"\" : jade.interp)) + \"</td></tr>\");\n}\nif ( view.personalSub.nextPaymentDate)\n{\nbuf.push(\"<tr><th data-i18n=\\\"account.next_payment\\\"></th><td>\" + (jade.escape(null == (jade.interp = moment(view.personalSub.nextPaymentDate).format('l')) ? \"\" : jade.interp)) + \"</td></tr>\");\n}\nif ( view.personalSub.cost)\n{\nbuf.push(\"<tr><th data-i18n=\\\"account.cost\\\"></th><td>\" + (jade.escape(null == (jade.interp = view.personalSub.cost) ? \"\" : jade.interp)) + \"</td></tr>\");\nif ( view.personalSub.card)\n{\nbuf.push(\"<tr><th data-i18n=\\\"account.card\\\"></th><td>\" + (jade.escape(null == (jade.interp = view.personalSub.card) ? \"\" : jade.interp)) + \"</td></tr>\");\n}\n}\nbuf.push(\"</table>\");\n}\nelse\n{\nif ( view.personalSub.free === true)\n{\nbuf.push(\"<div data-i18n=\\\"subscribe.currently_free\\\"></div>\");\n}\nelse if ( typeof view.personalSub.free === 'string')\n{\nif ( new Date() < new Date(view.personalSub.free))\n{\nbuf.push(\"<div><span data-i18n=\\\"subscribe.currently_free_until\\\" class=\\\"spr\\\"></span><span>\" + (jade.escape(null == (jade.interp = moment(new Date(view.personalSub.free)).format('l')) ? \"\" : jade.interp)) + \"</span></div>\");\n}\nelse\n{\nbuf.push(\"<span data-i18n=\\\"subscribe.was_free_until\\\" class=\\\"spr\\\"></span><span>\" + (jade.escape(null == (jade.interp = moment(new Date(view.personalSub.free)).format('l')) ? \"\" : jade.interp)) + \"</span>\");\n}\n}\nelse\n{\nbuf.push(\"<button data-i18n=\\\"subscribe.subscribe_title\\\" class=\\\"start-subscription-button btn btn-lg btn-success\\\"></button>\");\n}\n}\nbuf.push(\"</div></div><!-- - Prepaid Codes--><div class=\\\"panel panel-default\\\"><div class=\\\"panel-heading\\\"><h3 data-i18n=\\\"account.prepaid_codes\\\"></h3></div><div class=\\\"panel-body\\\"><p><span data-i18n=\\\"account_prepaid.you_can1\\\" class=\\\"spr\\\"></span><a href=\\\"/account/prepaid\\\" data-i18n=\\\"account_prepaid.you_can2\\\"></a><span data-i18n=\\\"account_prepaid.you_can3\\\" class=\\\"spl\\\"></span></p></div></div><div class=\\\"panel panel-default\\\"><div class=\\\"panel-heading\\\"><h3 data-i18n=\\\"subscribe.managed_subs\\\"></h3><p><span class=\\\"spr\\\">Managed subscriptions are discontinued. Please contact</span><a href=\\\"mailto:team@codecombat.com\\\">team@codecombat.com</a><span class=\\\"spl\\\">for more information.</span></p></div><div class=\\\"panel-body\\\">\");\nif ( view.recipientSubs.nextPaymentAmount > 0 && view.recipientSubs.sponsorSub)\n{\nbuf.push(\"<h4 data-i18n=\\\"account.next_payment\\\"></h4><p>\" + (jade.escape(null == (jade.interp = moment(new Date(view.recipientSubs.sponsorSub.current_period_end * 1000)).format('l')) ? \"\" : jade.interp)) + \"</p><p>$\" + (jade.escape((jade.interp = view.recipientSubs.nextPaymentAmount / 100) == null ? '' : jade.interp)) + \"</p><p>\" + (jade.escape(null == (jade.interp = view.recipientSubs.card) ? \"\" : jade.interp)) + \"</p>\");\n}\nbuf.push(\"<h4 data-i18n=\\\"subscribe.current_recipients\\\"></h4>\");\nif ( view.recipientSubs.unsubscribingRecipients && view.recipientSubs.unsubscribingRecipients.length > 0)\n{\nbuf.push(\"<div class=\\\"alert alert-info\\\"><span data-i18n=\\\"subscribe.unsubscribing\\\" class=\\\"spr\\\"></span><span>\" + (jade.escape(null == (jade.interp = view.recipientSubs.unsubscribingRecipients[0]) ? \"\" : jade.interp)) + \"</span></div>\");\n}\nelse\n{\nbuf.push(\"<table class=\\\"table table-striped table-condensed recipients-table\\\"><tr><th data-i18n=\\\"general.email\\\"></th><th data-i18n=\\\"general.name\\\"></th><th></th></tr>\");\n// iterate view.recipientSubs.recipients\n;(function(){\n  var $$obj = view.recipientSubs.recipients;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var recipient = $$obj[$index];\n\nbuf.push(\"<tr><td class=\\\"recipient-email\\\">\" + (jade.escape(null == (jade.interp = recipient.emailLower) ? \"\" : jade.interp)) + \"</td><td class=\\\"recipient-name\\\">\" + (jade.escape(null == (jade.interp = recipient.name) ? \"\" : jade.interp)) + \"</td><td class=\\\"recipient-unsubscribe\\\">\");\nif ( recipient.cancel_at_period_end)\n{\nbuf.push(\"<div>Ends \" + (jade.escape((jade.interp = moment(recipient.cancel_at_period_end).format('l')) == null ? '' : jade.interp)) + \"</div>\");\n}\nelse\n{\nbuf.push(\"<button data-i18n=\\\"subscribe.unsubscribe\\\" class=\\\"recipient-unsubscribe-button btn btn-sm btn-warning\\\"></button><button data-i18n=\\\"play.confirm\\\" class=\\\"confirm-recipient-unsubscribe-button btn btn-sm btn-primary hide\\\"></button>\");\n}\nbuf.push(\"</td></tr>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var recipient = $$obj[$index];\n\nbuf.push(\"<tr><td class=\\\"recipient-email\\\">\" + (jade.escape(null == (jade.interp = recipient.emailLower) ? \"\" : jade.interp)) + \"</td><td class=\\\"recipient-name\\\">\" + (jade.escape(null == (jade.interp = recipient.name) ? \"\" : jade.interp)) + \"</td><td class=\\\"recipient-unsubscribe\\\">\");\nif ( recipient.cancel_at_period_end)\n{\nbuf.push(\"<div>Ends \" + (jade.escape((jade.interp = moment(recipient.cancel_at_period_end).format('l')) == null ? '' : jade.interp)) + \"</div>\");\n}\nelse\n{\nbuf.push(\"<button data-i18n=\\\"subscribe.unsubscribe\\\" class=\\\"recipient-unsubscribe-button btn btn-sm btn-warning\\\"></button><button data-i18n=\\\"play.confirm\\\" class=\\\"confirm-recipient-unsubscribe-button btn btn-sm btn-primary hide\\\"></button>\");\n}\nbuf.push(\"</td></tr>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</table>\");\n}\nbuf.push(\"</div></div>\");\n}\nbuf.push(\"</div><div class=\\\"achievement-corner\\\"></div><div id=\\\"site-footer\\\"><img id=\\\"footer-background\\\" src=\\\"/images/pages/base/nav_background.png\\\"/><div\" + (jade.attrs({ 'id':('footer-links'), \"class\": [(features.playViewsOnly ? 'hide' : '')] }, {\"class\":true})) + \"><a href=\\\"/about\\\" data-i18n=\\\"nav.about\\\"></a>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<a tabindex=\\\"-1\\\" data-i18n=\\\"nav.contact\\\" class=\\\"contact-modal\\\"></a>\");\n}\nbuf.push(\"<a href=\\\"http://blog.codecombat.com/\\\" data-i18n=\\\"nav.blog\\\"></a><a href=\\\"https://jobs.lever.co/codecombat\\\" tabindex=\\\"-1\\\" data-i18n=\\\"nav.careers\\\"></a><a href=\\\"/legal\\\" tabindex=\\\"-1\\\" data-i18n=\\\"nav.legal\\\"></a><a href=\\\"/privacy\\\" tabindex=\\\"-1\\\" data-i18n=\\\"legal.privacy_title\\\"></a><a href=\\\"/contribute\\\" tabindex=\\\"-1\\\" data-i18n=\\\"nav.contribute\\\"></a>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<a href=\\\"/play/ladder\\\" tabindex=\\\"-1\\\" data-i18n=\\\"game_menu.multiplayer_tab\\\"></a>\");\n}\nif ( me.isAdmin())\n{\nbuf.push(\"<a href=\\\"/admin\\\">Admin</a>\");\n}\nif ( usesSocialMedia)\n{\nbuf.push(\"<div class=\\\"share-buttons\\\">\");\nif ( !isIE)\n{\nbuf.push(\"<div data-href=\\\"http://codecombat.com\\\" data-size=\\\"medium\\\" class=\\\"g-plusone\\\"></div>\");\n}\nbuf.push(\"<div\" + (jade.attrs({ 'data-href':(\"https://www.facebook.com/codecombat\"), 'data-send':(\"false\"), 'data-layout':(\"button_count\"), 'data-width':(\"350\"), 'data-show-faces':(\"true\"), 'data-ref':(\"coco_footer_\" + (fbRef) + \"\"), \"class\": [('fb-like')] }, {\"data-href\":true,\"data-send\":true,\"data-layout\":true,\"data-width\":true,\"data-show-faces\":true,\"data-ref\":true})) + \"></div>\");\nif ( !isIE)\n{\nbuf.push(\"<a href=\\\"https://twitter.com/CodeCombat\\\" data-show-count=\\\"true\\\" data-show-screen-name=\\\"false\\\" data-dnt=\\\"true\\\" data-align=\\\"right\\\" data-i18n=\\\"nav.twitter_follow\\\" class=\\\"twitter-follow-button\\\"></a><iframe src=\\\"https://ghbtns.com/github-btn.html?user=codecombat&amp;repo=codecombat&amp;type=watch&amp;count=true\\\" allowtransparency=\\\"true\\\" frameborder=\\\"0\\\" scrolling=\\\"0\\\" width=\\\"110\\\" height=\\\"20\\\" class=\\\"github-star-button\\\"></iframe>\");\n}\nbuf.push(\"</div>\");\n}\nbuf.push(\"</div><div id=\\\"footer-credits\\\"><span><span>© All Rights Reserved</span><br/><span>CodeCombat 2015</span></span><img id=\\\"footer-logo\\\" src=\\\"/images/pages/base/logo.png\\\" alt=\\\"CodeCombat\\\"/><span><span>Site Design by</span><br/><a href=\\\"http://www.fullyillustrated.com/\\\">Fully Illustrated</a></span><!--a.firebase-bade(href=\\\"https://www.firebase.com/\\\")  // Not using right now--><!--  img(src=\\\"/images/pages/base/firebase.png\\\", alt=\\\"Powered by Firebase\\\")--></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","RootView = require 'views/core/RootView'\r\ntemplate = require 'templates/account/subscription-view'\r\nCocoCollection = require 'collections/CocoCollection'\r\nSubscribeModal = require 'views/core/SubscribeModal'\r\nPayment = require 'models/Payment'\r\nstripeHandler = require 'core/services/stripe'\r\nUser = require 'models/User'\r\nutils = require 'core/utils'\r\n\r\n# TODO: Link to sponsor id /user/userID instead of plain text name\r\n# TODO: Link to sponsor email instead of plain text email\r\n# TODO: Conslidate the multiple class for personal and recipient subscription info into 2 simple server API calls\r\n# TODO: Track purchase amount based on actual users subscribed for a recipient subscribe event\r\n# TODO: Validate email address formatting\r\n# TODO: i18n pluralization for Stripe dialog description\r\n# TODO: Don't prompt for new card if we have one already, just confirm purchase\r\n# TODO: bulk discount isn't applied to personal sub\r\n# TODO: next payment amount incorrect if have an expiring personal sub\r\n# TODO: consider hiding managed subscription body UI while things are updating to avoid brief legacy data\r\n# TODO: Next payment info for personal sub displays most recent payment when resubscribing before trial end\r\n# TODO: PersonalSub and RecipientSubs have similar subscribe APIs\r\n# TODO: Better recovery from trying to reuse a prepaid\r\n# TODO: No way to unsubscribe from prepaid subscription\r\n# TODO: Refactor state machines driving the UI.  They've become a hot mess.\r\n\r\n# TODO: Get basic plan price dynamically\r\nbasicPlanPrice = 999\r\nbasicPlanID = 'basic'\r\n\r\nmodule.exports = class SubscriptionView extends RootView\r\n  id: \"subscription-view\"\r\n  template: template\r\n\r\n  events:\r\n    'click .start-subscription-button': 'onClickStartSubscription'\r\n    'click .end-subscription-button': 'onClickEndSubscription'\r\n    'click .cancel-end-subscription-button': 'onClickCancelEndSubscription'\r\n    'click .confirm-end-subscription-button': 'onClickConfirmEndSubscription'\r\n    'click .recipients-subscribe-button': 'onClickRecipientsSubscribe'\r\n    'click .confirm-recipient-unsubscribe-button': 'onClickRecipientConfirmUnsubscribe'\r\n    'click .recipient-unsubscribe-button': 'onClickRecipientUnsubscribe'\r\n\r\n  subscriptions:\r\n    'subscribe-modal:subscribed': 'onSubscribed'\r\n    'stripe:received-token': 'onStripeReceivedToken'\r\n\r\n  constructor: (options) ->\r\n    super(options)\r\n    prepaidCode = utils.getQueryVariable '_ppc'\r\n    @personalSub = new PersonalSub(@supermodel, prepaidCode)\r\n    @recipientSubs = new RecipientSubs(@supermodel)\r\n    @emailValidator = new EmailValidator(@superModel)\r\n    @personalSub.update => @render?()\r\n    @recipientSubs.update => @render?()\r\n\r\n  # Personal Subscriptions\r\n\r\n  onClickStartSubscription: (e) ->\r\n    if @personalSub.prepaidCode\r\n      @personalSub.subscribe(=> @render?())\r\n    else\r\n      @openModalView new SubscribeModal()\r\n    window.tracker?.trackEvent 'Show subscription modal', category: 'Subscription', label: 'account subscription view'\r\n\r\n  onSubscribed: ->\r\n    document.location.reload()\r\n\r\n  onClickEndSubscription: (e) ->\r\n    window.tracker?.trackEvent 'Unsubscribe Start'\r\n    @$el.find('.end-subscription-button').blur().addClass 'disabled', 250\r\n    @$el.find('.unsubscribe-feedback').show(500).find('textarea').focus()\r\n\r\n  onClickCancelEndSubscription: (e) ->\r\n    window.tracker?.trackEvent 'Unsubscribe Cancel'\r\n    @$el.find('.unsubscribe-feedback').hide(500).find('textarea').blur()\r\n    @$el.find('.end-subscription-button').focus().removeClass 'disabled', 250\r\n\r\n  onClickConfirmEndSubscription: (e) ->\r\n    message = @$el.find('.unsubscribe-feedback textarea').val().trim()\r\n    @personalSub.unsubscribe(message)\r\n\r\n  # Sponsored subscriptions\r\n\r\n  onClickRecipientsSubscribe: (e) ->\r\n    emails = @$el.find('.recipient-emails').val().split('\\n')\r\n    valid = @emailValidator.validateEmails(emails, =>@render?())\r\n    @recipientSubs.startSubscribe(emails) if valid\r\n\r\n  onClickRecipientUnsubscribe: (e) ->\r\n    $(e.target).addClass('hide')\r\n    $(e.target).parent().find('.confirm-recipient-unsubscribe-button').removeClass('hide')\r\n\r\n  onClickRecipientConfirmUnsubscribe: (e) ->\r\n    email = $(e.target).closest('tr').find('td.recipient-email').text()\r\n    @recipientSubs.unsubscribe(email, => @render?())\r\n\r\n  onStripeReceivedToken: (e) ->\r\n    @recipientSubs.finishSubscribe(e.token.id, => @render?())\r\n\r\n# Helper classes for managing subscription actions and updating UI state\r\n\r\nclass EmailValidator\r\n\r\n  validateEmails: (emails, render) ->\r\n    @lastEmails = emails.join('\\n')\r\n    #taken from http://www.regular-expressions.info/email.html\r\n    emailRegex = /[A-z0-9._%+-]+@[A-z0-9.-]+\\.[A-z]{2,63}/\r\n    @validEmails = (email for email in emails when emailRegex.test(email.trim().toLowerCase()))\r\n    return @emailsInvalid(render) if @validEmails.length < emails.length\r\n    return @emailsValid(render)\r\n\r\n  emailString: ->\r\n    return unless @validEmails\r\n    return @validEmails.join('\\n')\r\n\r\n  emailsInvalid: (render) ->\r\n    @state = \"invalid\"\r\n    render()\r\n    return false\r\n\r\n  emailsValid: (render) ->\r\n    @state = \"valid\"\r\n    render()\r\n    return true\r\n\r\n\r\nclass PersonalSub\r\n  constructor: (@supermodel, @prepaidCode) ->\r\n\r\n  subscribe: (render) ->\r\n    return unless @prepaidCode\r\n\r\n    if @prepaidCode is me.get('stripe')?.prepaidCode\r\n      delete @prepaidCode\r\n      return render()\r\n\r\n    @state = 'subscribing'\r\n    @stateMessage = ''\r\n    render()\r\n\r\n    stripeInfo = _.clone(me.get('stripe') ? {})\r\n    stripeInfo.planID = basicPlanID\r\n    stripeInfo.prepaidCode = @prepaidCode\r\n    me.set('stripe', stripeInfo)\r\n\r\n    me.once 'sync', =>\r\n      application.tracker?.trackEvent 'Finished subscription purchase', value: 0\r\n      delete @prepaidCode\r\n      @update(render)\r\n    me.once 'error', (user, response, options) =>\r\n      console.error 'We got an error subscribing with Stripe from our server:', response\r\n      stripeInfo = me.get('stripe') ? {}\r\n      delete stripeInfo.planID\r\n      delete stripeInfo.prepaidCode\r\n      me.set('stripe', stripeInfo)\r\n      xhr = options.xhr\r\n      if xhr.status is 402\r\n        @state = 'declined'\r\n        @stateMessage = ''\r\n      else\r\n        if xhr.status is 403\r\n          delete @prepaidCode\r\n        @state = 'unknown_error'\r\n        @stateMessage = \"#{xhr.status}: #{xhr.responseText}\"\r\n      render()\r\n    me.patch({headers: {'X-Change-Plan': 'true'}})\r\n\r\n  unsubscribe: (message) ->\r\n    removeStripe = =>\r\n      stripeInfo = _.clone(me.get('stripe'))\r\n      delete stripeInfo.planID\r\n      me.set('stripe', stripeInfo)\r\n      me.once 'sync', ->\r\n        window.tracker?.trackEvent 'Unsubscribe End', message: message\r\n        document.location.reload()\r\n      me.patch({headers: {'X-Change-Plan': 'true'}})\r\n    if message\r\n      $.post '/contact', message: message, subject: 'Cancellation', (response) ->\r\n        removeStripe()\r\n    else\r\n      removeStripe()\r\n\r\n  update: (render) ->\r\n    return unless stripeInfo = me.get('stripe')\r\n\r\n    @state = 'loading'\r\n\r\n    if stripeInfo.sponsorID\r\n      @sponsor = true\r\n      onSubSponsorSuccess = (sponsorInfo) =>\r\n        @sponsorEmail = sponsorInfo.email\r\n        @sponsorName = sponsorInfo.name\r\n        @sponsorID = stripeInfo.sponsorID\r\n        if sponsorInfo.subscription.cancel_at_period_end\r\n          @endDate = new Date(sponsorInfo.subscription.current_period_end * 1000)\r\n        delete @state\r\n        render()\r\n      @supermodel.addRequestResource('sub_sponsor', {\r\n        url: '/db/user/-/sub_sponsor'\r\n        method: 'POST'\r\n        success: onSubSponsorSuccess\r\n      }, 0).load()\r\n\r\n    else if stripeInfo.prepaidCode\r\n      @usingPrepaidCode = true\r\n      delete @state\r\n      render()\r\n\r\n    else if stripeInfo.subscriptionID\r\n      @self = true\r\n      @active = me.isPremium()\r\n      @subscribed = stripeInfo.planID?\r\n\r\n      options = { cache: false, url: \"/db/user/#{me.id}/stripe\" }\r\n      options.success = (info) =>\r\n        if card = info.card\r\n          @card = \"#{card.brand}: x#{card.last4}\"\r\n        if sub = info.subscription\r\n          periodEnd = new Date((sub.trial_end or sub.current_period_end) * 1000)\r\n          if sub.cancel_at_period_end\r\n            @activeUntil = periodEnd\r\n          else if sub.discount?.coupon?.id isnt 'free'\r\n            @nextPaymentDate = periodEnd\r\n            @cost = \"$#{(sub.plan.amount/100).toFixed(2)}\"\r\n        else\r\n          console.error \"Could not find personal subscription #{me.get('stripe')?.customerID} #{me.get('stripe')?.subscriptionID}\"\r\n        delete @state\r\n        render()\r\n      @supermodel.addRequestResource('personal_payment_info', options).load()\r\n\r\n      payments = new CocoCollection([], { url: '/db/payment', model: Payment, comparator:'_id' })\r\n      payments.once 'sync', ->\r\n        @monthsSubscribed = (x for x in payments.models when not x.get('productID')).length\r\n        render()\r\n      @supermodel.loadCollection(payments, 'payments', {cache: false})\r\n\r\n    else if stripeInfo.free\r\n      @free = stripeInfo.free\r\n      delete @state\r\n      render()\r\n\r\n    else\r\n      delete @state\r\n      render()\r\n\r\nclass RecipientSubs\r\n  constructor: (@supermodel) ->\r\n    @recipients = {}\r\n    @unsubscribingRecipients = []\r\n\r\n  addSubscribing: (email) ->\r\n    @unsubscribingRecipients.push email\r\n\r\n  removeSubscribing: (email) ->\r\n    _.remove(@unsubscribingRecipients, (recipientEmail) -> recipientEmail is email)\r\n\r\n  startSubscribe: (emails) ->\r\n    @recipientEmails = (email.trim().toLowerCase() for email in emails)\r\n    _.remove(@recipientEmails, (email) -> _.isEmpty(email))\r\n    return if @recipientEmails.length < 1\r\n\r\n    window.tracker?.trackEvent 'Start sponsored subscription'\r\n\r\n    # TODO: this sometimes shows a rounded amount (e.g. $8.00)\r\n    currentSubCount = me.get('stripe')?.recipients?.length ? 0\r\n    newSubCount = @recipientEmails.length + currentSubCount\r\n    amount = utils.getSponsoredSubsAmount(basicPlanPrice, newSubCount, me.get('stripe')?.subscriptionID?) - utils.getSponsoredSubsAmount(basicPlanPrice, currentSubCount, me.get('stripe')?.subscriptionID?)\r\n    options = {\r\n      description: \"#{@recipientEmails.length} \" + $.i18n.t('subscribe.stripe_description', defaultValue: 'Monthly Subscriptions')\r\n      amount: amount\r\n      alipay: if me.get('chinaVersion') or (me.get('preferredLanguage') or 'en-US')[...2] is 'zh' then true else 'auto'\r\n      alipayReusable: true\r\n    }\r\n    @state = 'start subscribe'\r\n    @stateMessage = ''\r\n    stripeHandler.open(options)\r\n\r\n  finishSubscribe: (tokenID, render) ->\r\n    return unless @state is 'start subscribe' # Don't intercept personal subcribe process\r\n\r\n    @state = 'subscribing'\r\n    @stateMessage = ''\r\n    @justSubscribed = []\r\n    render()\r\n\r\n    stripeInfo = _.clone(me.get('stripe') ? {})\r\n    stripeInfo.token = tokenID\r\n    stripeInfo.subscribeEmails = @recipientEmails\r\n    me.set('stripe', stripeInfo)\r\n\r\n    me.once 'sync', =>\r\n      application.tracker?.trackEvent 'Finished sponsored subscription purchase'\r\n      @update(render)\r\n    me.once 'error', (user, response, options) =>\r\n      console.error 'We got an error subscribing with Stripe from our server:', response\r\n      stripeInfo = me.get('stripe') ? {}\r\n      delete stripeInfo.token\r\n      xhr = options.xhr\r\n      if xhr.status is 402\r\n        @state = 'declined'\r\n        @stateMessage = ''\r\n      else\r\n        @state = 'unknown_error'\r\n        @stateMessage = \"#{xhr.status}: #{xhr.responseText}\"\r\n      render()\r\n    me.patch({headers: {'X-Change-Plan': 'true'}})\r\n\r\n  unsubscribe: (email, render) ->\r\n    delete @state\r\n    @stateMessage = ''\r\n    delete @justSubscribed\r\n    @addSubscribing(email)\r\n    render()\r\n    stripeInfo = _.clone(me.get('stripe'))\r\n    stripeInfo.unsubscribeEmail = email\r\n    me.set('stripe', stripeInfo)\r\n    me.once 'sync', =>\r\n      @removeSubscribing(email)\r\n      @update(render)\r\n    me.patch({headers: {'X-Change-Plan': 'true'}})\r\n\r\n  update: (render) ->\r\n    delete @state\r\n    delete @stateMessage\r\n    return unless me.get('stripe')?.recipients\r\n    @unsubscribingRecipients = []\r\n\r\n    options = { cache: false, url: \"/db/user/#{me.id}/stripe\" }\r\n    options.success = (info) =>\r\n      @sponsorSub = info.sponsorSubscription\r\n      if card = info.card\r\n        @card = \"#{card.brand}: x#{card.last4}\"\r\n      render()\r\n    @supermodel.addRequestResource('recipients_payment_info', options).load()\r\n\r\n    onSubRecipientsSuccess = (recipientsMap) =>\r\n      @recipients = recipientsMap\r\n      count = 0\r\n      for userID, recipient of @recipients\r\n        count++ unless recipient.cancel_at_period_end\r\n        if @recipientEmails? and @justSubscribed? and recipient.emailLower in @recipientEmails\r\n          @justSubscribed.push recipient.emailLower\r\n      @nextPaymentAmount = utils.getSponsoredSubsAmount(basicPlanPrice, count, me.get('stripe')?.subscriptionID?)\r\n      @recipientEmails = []\r\n      render()\r\n    @supermodel.addRequestResource('sub_recipients', {\r\n      url: '/db/user/-/sub_recipients'\r\n      method: 'POST'\r\n      success: onSubRecipientsSuccess\r\n    }, 0).load()\r\n"]}