{"version":3,"sources":["app/lib/world/systems/collision.coffee"],"names":[],"mappings":";AACA;;AAAA,MAAM,CAAC,OAAO,CAAC,iBAAf,GAAyC;EACvC,iBAAC,UAAD,GAAY;;EACC,2BAAC,IAAD,EAAO,eAAP,EAA6B,eAA7B;AAIX;IAJkB,IAAC,4CAAD,kBAAgB;IAAM,IAAC,mBAAD;IAIxC,IAAC,OAAD,GAAU,IAAI,CAAC,MAAL,CAAY,QAAZ,MAA2B,CAAC;IACtC,IAAC,IAAD,GAAO,IAAI,CAAC,MAAL,CAAY,KAAZ,MAAwB,CAAC;IAChC,IAAC,KAAD,GAAQ,iBAAiB,CAAC,OAAlB,CAA0B,IAA1B,EAAgC,IAAC,eAAjC;IACR,IAAwB,IAAC,OAAD,IAAW,IAAC,IAApC;;QAAA,IAAC,kBAAkB;OAAnB;;IACA,IAAC,OAAD,GAAU,KAAK,IAAC,gBAAe,CAAC,eAAjB;IACf,IAAG,IAAC,gBAAe,CAAC,eAAjB,GAAmC,EAAtC;MAA8C,OAAO,CAAC,GAAR,CAAY,+CAAZ,EAA9C;;IACA,IAAC,KAAD,GAAQ;IACR,IAAC,gBAAe,CAAC,aAAc,KAAC,KAAD,CAA/B,GAAwC;AACxC;AAAA;;MACE,IAAG,IAAC,aAAD,CAAc,QAAd,CAAH;QACE,IAAC,KAAD,GAAQ,IAAC,KAAD,GAAQ,QAAQ,CAAC;QACzB,QAAQ,CAAC,IAAT,GAAgB,QAAQ,CAAC,IAAT,GAAgB,IAAC,QAFnC;;AADF;EAZW;;8BAiBb,eAAc,SAAC,GAAD;AAEZ;IAAA,IAAgB,IAAC,KAAD,KAAS,MAAT,IAAmB,GAAG,CAAC,IAAJ,KAAY,MAA/C;AAAA,aAAO,MAAP;;IAGA,IAAe,GAAG,CAAC,IAAJ,KAAY,WAAZ,IAA2B,IAAC,KAAD,KAAS,WAAnD;AAAA,aAAO,KAAP;;IAGA,IAAkC,IAAC,KAAD,KAAS,MAA3C;AAAA,aAAO,GAAG,CAAC,IAAJ,KAAY,YAAnB;;IACA,IAA+B,GAAG,CAAC,IAAJ,KAAY,MAA3C;AAAA,aAAO,IAAC,KAAD,KAAS,YAAhB;;IAGA,WAAW,IAAC,eAAD,IAAoB,GAAG,CAAC,cAAJ,KAAsB,IAAC;IACtD,IAAgB,YAAa,IAAC,OAAd,IAAyB,IAAC,IAA1C;AAAA,aAAO,MAAP;;IAGA,IAAgB,IAAC,OAAD,IAAY,IAAC,IAAb,IAAqB,GAAG,CAAC,MAAzB,IAAoC,GAAG,CAAC,GAAxD;AAAA,aAAO,MAAP;;IAGA,IAAe,GAAG,CAAC,MAAJ,IAAe,IAAC,OAA/B;AAAA,aAAO,KAAP;;IAGA,IAAe,GAAG,CAAC,GAAJ,IAAY,IAAC,IAA5B;AAAA,aAAO,KAAP;;WAGA;EAzBY;;EA2Bd,iBAAC,QAAD,GAAU,SAAC,IAAD,EAAO,cAAP;;MAAO,iBAAe;;IAC9B,MAAmB,IAAI,CAAC,KAAL,CAAW,QAAX,KAAwB,IAAI,CAAC,KAAL,CAAW,KAAX,CAA3C;AAAA,aAAO,KAAP;;WACA,OAAO,GAAP,GAAa,CAAC,kBAAkB,CAAnB;EAFL","file":"public/javascripts/app/lib/world/systems/collision.js","sourcesContent":["# http://codingowl.com/readblog.php?blogid=124\r\nmodule.exports.CollisionCategory = class CollisionCategory\r\n  @className: 'CollisionCategory'\r\n  constructor: (name, @superteamIndex=null, @collisionSystem) ->\r\n    # @superteamIndex is null for 'none', 'obstacles', and 'dead'.\r\n    # It's 0 for 'ground', 'air', and 'ground_and_air' units with no superteams.\r\n    # It's 1, 2, or 3 for the superteams it gets after that. We can only have 16 collision categories.\r\n    @ground = name.search('ground') isnt -1\r\n    @air = name.search('air') isnt -1\r\n    @name = CollisionCategory.nameFor name, @superteamIndex\r\n    @superteamIndex ?= 0 if @ground or @air\r\n    @number = 1 << @collisionSystem.totalCategories++\r\n    if @collisionSystem.totalCategories > 16 then console.log 'There should only be 16 collision categories!'\r\n    @mask = 0\r\n    @collisionSystem.allCategories[@name] = @\r\n    for otherCatName, otherCat of @collisionSystem.allCategories\r\n      if @collidesWith otherCat\r\n        @mask = @mask | otherCat.number\r\n        otherCat.mask = otherCat.mask | @number\r\n\r\n  collidesWith: (cat) ->\r\n    # 'none' collides with nothing\r\n    return false if @name is 'none' or cat.name is 'none'\r\n\r\n    # 'obstacles' collides with everything; could also try letting air units (but not ground_and_air) fly over these\r\n    return true if cat.name is 'obstacles' or @name is 'obstacles'\r\n\r\n    # 'dead' collides only with obstacles\r\n    return cat.name is 'obstacles' if @name is 'dead'\r\n    return @name is 'obstacles' if cat.name is 'dead'\r\n\r\n    # 'ground_and_air_<team>' units don't hit ground or air units on their team (so missiles don't hit same team)\r\n    sameTeam = @superteamIndex and cat.superteamIndex is @superteamIndex\r\n    return false if sameTeam and @ground and @air\r\n\r\n    # actually, 'ground_and_air<team>' units don't hit any ground_and_air units (temp missile collision fix)\r\n    return false if @ground and @air and cat.ground and cat.air\r\n\r\n    # 'ground' collides with 'ground'\r\n    return true if cat.ground and @ground\r\n\r\n    # 'air' collides with 'air'\r\n    return true if cat.air and @air\r\n\r\n    # doesn't collide (probably 'ground' and 'air')\r\n    false\r\n\r\n  @nameFor: (name, superteamIndex=null) ->\r\n    return name unless name.match('ground') or name.match('air')\r\n    name + '_' + (superteamIndex or 0)\r\n"]}