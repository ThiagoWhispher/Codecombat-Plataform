{"version":3,"sources":["app/lib/image_filter.coffee"],"names":[],"mappings":";AAEA;EAAA;;AAAA,UAAU;;AAEV,OAAO,CAAC,SAAR,GAAoB,SAAC,GAAD;AAClB;EAAA,IAAI,IAAC,UAAD,CAAW,GAAG,CAAC,YAAf,EAA6B,GAAG,CAAC,aAAjC;EACJ,MAAM,CAAC,CAAC,UAAF,CAAa,IAAb;EACN,GAAG,CAAC,SAAJ,CAAc,GAAd,EAAmB,CAAnB,EAAsB,CAAtB;AACA,SAAO,GAAG,CAAC,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuB,CAAC,CAAC,KAAzB,EAAgC,CAAC,CAAC,MAAlC;AAJW;;AAMpB,OAAO,CAAC,SAAR,GAAoB,SAAC,CAAD,EAAI,CAAJ;AAClB;EAAA,IAAI,QAAQ,CAAC,aAAT,CAAuB,QAAvB;EACJ,CAAC,CAAC,KAAF,GAAU;EACV,CAAC,CAAC,MAAF,GAAW;AACX,SAAO;AAJW;;AAMpB,OAAO,CAAC,WAAR,GAAsB;AACpB;EADqB,uBAAQ,sBAAO;EACpC,OAAO,CAAC,IAAI,CAAC,SAAL,CAAe,KAAf,CAAD,CAAuB,CAAC,MAAxB,CAA+B,IAA/B;AACP,SAAO,mBAAO,IAAP;AAFa;;AAItB,OAAO,CAAC,UAAR,GAAqB,SAAC,MAAD,EAAS,UAAT;AACnB;EAAA,IAAI,MAAM,CAAC;EACX,IAAI;AACJ,SAAM,IAAI,CAAC,CAAC,MAAZ;IACE,CAAE,GAAF,IAAQ;IACR,CAAE,KAAE,CAAF,CAAF,IAAU;IACV,CAAE,KAAE,CAAF,CAAF,IAAU;IACV,KAAG;EAJL;AAKA,SAAO;AARY;;AAUrB,MAAM,CAAC,OAAO,CAAC,WAAf,GAA6B,cAAc,SAAC,GAAD,EAAM,mBAAN,EAA2B,GAA3B;AACzC;;IADoE,MAAI;;EACxE,QAAQ,EAAE,GAAF;EACR,cAAc,KAAK,CAAC,IAAN,CAAW,UAAX;EACd,IAAG,WAAH;IACE,EAAE,mBAAF,CAAsB,CAAC,GAAvB,CAA2B,qBAA3B,EAAkD,SAAS,WAAT,GAAuB,GAAzE;AACA,WAAO,GAAG,CAAC,GAAJ,GAAU,YAFnB;;EAGA,KAAuC,KAAK,CAAC,IAAN,CAAW,UAAX,CAAvC;IAAA,KAAK,CAAC,IAAN,CAAW,UAAX,EAAuB,GAAG,CAAC,GAA3B;;EACA,IAAG,CAAI,CAAC,GAAG,CAAC,YAAJ,GAAmB,CAAnB,IAAyB,GAAG,CAAC,aAAJ,GAAoB,CAA9C,CAAP;IACE,OAAO,CAAC,IAAR,CAAa,uBAAb,EAAsC,GAAtC,EAA2C,+BAA3C,EAA4E,GAAG,CAAC,YAAhF,EAA8F,GAAG,CAAC,aAAlG;AACA,WAAO,IAFT;;EAGA,YAAY,OAAO,CAAC,WAAR,CAAoB,OAAO,CAAC,UAA5B,EAAwC,GAAxC,EAA6C,GAA7C;EACZ,IAAI,OAAO,CAAC,SAAR,CAAkB,GAAG,CAAC,YAAtB,EAAoC,GAAG,CAAC,aAAxC;EACJ,MAAM,CAAC,CAAC,UAAF,CAAa,IAAb;EACN,GAAG,CAAC,YAAJ,CAAiB,SAAjB,EAA4B,CAA5B,EAA+B,CAA/B;EACA,GAAG,CAAC,GAAJ,GAAU,CAAC,CAAC,SAAF;EACV,EAAE,mBAAF,CAAsB,CAAC,GAAvB,CAA2B,qBAA3B,EAAkD,SAAS,GAAG,CAAC,GAAb,GAAmB,GAArE;SACA,KAAK,CAAC,IAAN,CAAW,UAAX,EAAuB,GAAG,CAAC,GAA3B;AAhByC;;AAkB3C,MAAM,CAAC,OAAO,CAAC,WAAf,GAA6B,cAAc,SAAC,GAAD,EAAM,mBAAN;AACzC;EAAA,QAAQ,EAAE,GAAF;EACR,KAAc,KAAK,CAAC,IAAN,CAAW,UAAX,CAAd;AAAA;;EACA,EAAE,mBAAF,CAAsB,CAAC,GAAvB,CAA2B,qBAA3B,EAAkD,SAAS,KAAK,CAAC,IAAN,CAAW,UAAX,CAAT,GAAkC,GAApF;SACA,GAAG,CAAC,GAAJ,GAAU,KAAK,CAAC,IAAN,CAAW,UAAX;AAJ+B","file":"public/javascripts/app/lib/image_filter.js","sourcesContent":["# Based on: http://www.html5rocks.com/en/tutorials/canvas/imagefilters/\r\n\r\nFilters = {}\r\n\r\nFilters.getPixels = (img) ->\r\n  c = @getCanvas(img.naturalWidth, img.naturalHeight)\r\n  ctx = c.getContext('2d')\r\n  ctx.drawImage(img, 0, 0)\r\n  return ctx.getImageData(0, 0, c.width, c.height)\r\n\r\nFilters.getCanvas = (w, h) ->\r\n  c = document.createElement('canvas')\r\n  c.width = w\r\n  c.height = h\r\n  return c\r\n\r\nFilters.filterImage = (filter, image, args...) ->\r\n  args = [this.getPixels(image)].concat(args)\r\n  return filter(args...)\r\n\r\nFilters.brightness = (pixels, adjustment) ->\r\n  d = pixels.data\r\n  i = 0\r\n  while i < d.length\r\n    d[i] *= adjustment\r\n    d[i+1] *= adjustment\r\n    d[i+2] *= adjustment\r\n    i+=4\r\n  return pixels\r\n\r\nmodule.exports.darkenImage = darkenImage = (img, borderImageSelector, pct=0.5) ->\r\n  jqimg = $(img)\r\n  cachedValue = jqimg.data('darkened')\r\n  if cachedValue\r\n    $(borderImageSelector).css 'border-image-source', 'url(' + cachedValue + ')'\r\n    return img.src = cachedValue \r\n  jqimg.data('original', img.src) unless jqimg.data('original')\r\n  if not (img.naturalWidth > 0 and img.naturalHeight > 0)\r\n    console.warn 'Tried to darken image', img, 'but it has natural dimensions', img.naturalWidth, img.naturalHeight\r\n    return img\r\n  imageData = Filters.filterImage(Filters.brightness, img, pct)\r\n  c = Filters.getCanvas(img.naturalWidth, img.naturalHeight)\r\n  ctx = c.getContext('2d')\r\n  ctx.putImageData(imageData, 0, 0)\r\n  img.src = c.toDataURL()\r\n  $(borderImageSelector).css 'border-image-source', 'url(' + img.src + ')'\r\n  jqimg.data('darkened', img.src)\r\n\r\nmodule.exports.revertImage = revertImage = (img, borderImageSelector) ->\r\n  jqimg = $(img)\r\n  return unless jqimg.data('original')\r\n  $(borderImageSelector).css 'border-image-source', 'url(' + jqimg.data('original') + ')'\r\n  img.src = jqimg.data('original')\r\n"]}