{"version":3,"sources":["app/lib/surface/CountdownScreen.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/lib/surface/CountdownScreen.js","sourcesContent":["CocoClass = require 'core/CocoClass'\r\n\r\nmodule.exports = class CountdownScreen extends CocoClass\r\n  subscriptions:\r\n    'playback:real-time-playback-started': 'onRealTimePlaybackStarted'\r\n    'playback:real-time-playback-ended': 'onRealTimePlaybackEnded'\r\n\r\n  constructor: (options) ->\r\n    super()\r\n    options ?= {}\r\n    @camera = options.camera\r\n    @layer = options.layer\r\n    @showsCountdown = options.showsCountdown\r\n    console.error @toString(), 'needs a camera.' unless @camera\r\n    console.error @toString(), 'needs a layer.' unless @layer\r\n    @build()\r\n\r\n  destroy: ->\r\n    clearInterval @countdownInterval if @countdownInterval\r\n    super()\r\n\r\n  onCastingBegins: (e) -> @show() unless e.preload\r\n  onCastingEnds: (e) -> @hide()\r\n\r\n  toString: -> '<CountdownScreen>'\r\n\r\n  build: ->\r\n    @dimLayer = new createjs.Container()\r\n    @dimLayer.mouseEnabled = @dimLayer.mouseChildren = false\r\n    @dimLayer.addChild @dimScreen = new createjs.Shape()\r\n    @dimScreen.graphics.beginFill('rgba(0,0,0,0.5)').rect 0, 0, @camera.canvasWidth, @camera.canvasHeight\r\n    @dimLayer.alpha = 0\r\n    @dimLayer.addChild @makeCountdownText()\r\n\r\n  makeCountdownText: ->\r\n    size = Math.ceil @camera.canvasHeight / 2\r\n    text = new createjs.Text '3...', \"#{size}px Open Sans Condensed\", '#F7B42C'\r\n    text.shadow = new createjs.Shadow '#000', Math.ceil(@camera.canvasHeight / 300), Math.ceil(@camera.canvasHeight / 300), Math.ceil(@camera.canvasHeight / 120)\r\n    text.textAlign = 'center'\r\n    text.textBaseline = 'middle'\r\n    text.x = @camera.canvasWidth / 2\r\n    text.y = @camera.canvasHeight / 2\r\n    @text = text\r\n    return text\r\n\r\n  show: ->\r\n    return if @showing\r\n    createjs.Tween.removeTweens @dimLayer\r\n    if @showsCountdown\r\n      @dimLayer.alpha = 0\r\n      @showing = true\r\n      createjs.Tween.get(@dimLayer).to({alpha: 1}, 500)\r\n      @secondsRemaining = 3\r\n      @countdownInterval = setInterval @decrementCountdown, 1000\r\n      @updateText()\r\n      @layer.addChild @dimLayer\r\n    else\r\n      @endCountdown()\r\n\r\n  hide: (duration=500) ->\r\n    return unless @showing\r\n    @showing = false\r\n    createjs.Tween.removeTweens @dimLayer\r\n    createjs.Tween.get(@dimLayer).to({alpha: 0}, duration).call => @layer.removeChild @dimLayer unless @destroyed\r\n\r\n  decrementCountdown: =>\r\n    return if @destroyed\r\n    --@secondsRemaining\r\n    @updateText()\r\n    unless @secondsRemaining\r\n      @endCountdown()\r\n\r\n  updateText: ->\r\n    @text.text = if @secondsRemaining then \"#{@secondsRemaining}...\" else '0!'\r\n\r\n  endCountdown: ->\r\n    console.log 'should actually start in 1s'\r\n    clearInterval @countdownInterval if @countdownInterval\r\n    @countdownInterval = null\r\n    @hide()\r\n\r\n  onRealTimePlaybackStarted: (e) ->\r\n    @show()\r\n\r\n  onRealTimePlaybackEnded: (e) ->\r\n    clearInterval @countdownInterval if @countdownInterval\r\n    @countdownInterval = null\r\n    @hide Math.max(500, 1000 * (@secondsRemaining or 0))\r\n"]}