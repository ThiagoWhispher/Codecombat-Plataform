{"version":3,"sources":["app/core/CocoClass.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/core/CocoClass.js","sourcesContent":["# Template for classes with common functions, like hooking into the Mediator.\r\nutils = require './../core/utils'\r\nclassCount = 0\r\nmakeScopeName = -> \"class-scope-#{classCount++}\"\r\ndoNothing = ->\r\n\r\nmodule.exports = class CocoClass\r\n  @nicks: []\r\n  @nicksUsed: {}\r\n  @remainingNicks: []\r\n  @nextNick: ->\r\n    return (@name or 'CocoClass') + ' ' + classCount unless @nicks.length\r\n    @remainingNicks = if @remainingNicks.length then @remainingNicks else @nicks.slice()\r\n    baseNick = @remainingNicks.splice(Math.floor(Math.random() * @remainingNicks.length), 1)[0]\r\n    i = 0\r\n    while true\r\n      nick = if i then \"#{baseNick} #{i}\" else baseNick\r\n      break unless @nicksUsed[nick]\r\n      i++\r\n    @nicksUsed[nick] = true\r\n    nick\r\n\r\n  subscriptions: {}\r\n  shortcuts: {}\r\n\r\n  # setup/teardown\r\n\r\n  constructor: ->\r\n    @nick = @constructor.nextNick()\r\n    @subscriptions = utils.combineAncestralObject(@, 'subscriptions')\r\n    @shortcuts = utils.combineAncestralObject(@, 'shortcuts')\r\n    @listenToSubscriptions()\r\n    @scope = makeScopeName()\r\n    @listenToShortcuts()\r\n    _.extend(@, Backbone.Events) if Backbone?\r\n\r\n  destroy: ->\r\n    # teardown subscriptions, prevent new ones\r\n    @stopListening?()\r\n    @off?()\r\n    @unsubscribeAll()\r\n    @stopListeningToShortcuts()\r\n    @constructor.nicksUsed[@nick] = false\r\n    @[key] = undefined for key of @\r\n    @destroyed = true\r\n    @off = doNothing\r\n    @destroy = doNothing\r\n\r\n  # subscriptions\r\n\r\n  listenToSubscriptions: ->\r\n    # for initting subscriptions\r\n    return unless Backbone?.Mediator?\r\n    for channel, func of @subscriptions\r\n      func = utils.normalizeFunc(func, @)\r\n      Backbone.Mediator.subscribe(channel, func, @)\r\n\r\n  addNewSubscription: (channel, func) ->\r\n    # this is for adding subscriptions on the fly, rather than at init\r\n    return unless Backbone?.Mediator?\r\n    return if @destroyed\r\n    return unless @subscriptions[channel] is undefined\r\n    func = utils.normalizeFunc(func, @)\r\n    @subscriptions[channel] = func\r\n    Backbone.Mediator.subscribe(channel, func, @)\r\n\r\n  unsubscribeAll: ->\r\n    return unless Backbone?.Mediator?\r\n    for channel, func of @subscriptions\r\n      func = utils.normalizeFunc(func, @)\r\n      Backbone.Mediator.unsubscribe(channel, func, @)\r\n\r\n  # keymaster shortcuts\r\n\r\n  listenToShortcuts: ->\r\n    return unless key?\r\n    for shortcut, func of @shortcuts\r\n      func = utils.normalizeFunc(func, @)\r\n      key(shortcut, @scope, _.bind(func, @))\r\n\r\n  stopListeningToShortcuts: ->\r\n    return unless key?\r\n    key.deleteScope(@scope)\r\n\r\n  playSound: (trigger, volume=1) ->\r\n    Backbone.Mediator.publish 'audio-player:play-sound', trigger: trigger, volume: volume\r\n\r\n  wait: (event) -> new Promise((resolve) => @once(event, resolve))\r\n"]}