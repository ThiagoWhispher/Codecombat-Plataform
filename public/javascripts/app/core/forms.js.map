{"version":3,"sources":["app/core/forms.coffee"],"names":[],"mappings":";AAAA;;AAAA,MAAM,CAAC,OAAO,CAAC,YAAf,GAA8B,SAAC,GAAD,EAAM,OAAN;AAC5B;EAAA,UAAU,CAAC,CAAC,MAAF,CAAS;IAAE,MAAM,IAAR;IAAc,mBAAmB,IAAjC;GAAT,EAAkD,OAAlD;EACV,MAAM;EAEN,SAAS,EAAE,yBAAF,EAA6B,GAA7B;AACT;;IACE,QAAQ,EAAE,KAAF;IACR,KAAgB,QAAO,KAAK,CAAC,IAAN,CAAW,MAAX,CAAP,CAAhB;AAAA;;IACA,IAAG,KAAK,CAAC,IAAN,CAAW,MAAX,MAAsB,UAAzB;;QACE,GAAI,SAAS;;MACb,IAAG,KAAK,CAAC,EAAN,CAAS,UAAT,CAAH;QACE,GAAI,MAAK,CAAC,IAAV,CAAe,KAAK,CAAC,GAAN,EAAf,EADF;OAFF;KAAA,MAIK,IAAG,KAAK,CAAC,IAAN,CAAW,MAAX,MAAsB,OAAzB;MACH,KAAgB,KAAK,CAAC,EAAN,CAAS,SAAT,CAAhB;AAAA;;MACA,GAAI,MAAJ,GAAY,KAAK,CAAC,GAAN,GAFT;KAAA;MAIH,QAAQ,KAAK,CAAC,GAAN,MAAe;MACvB,IAAgC,OAAO,CAAC,IAAxC;QAAA,QAAQ,CAAC,CAAC,MAAM,CAAC,IAAT,CAAc,KAAd,EAAR;;MACA,IAAG,SAAS,CAAC,CAAI,OAAO,CAAC,iBAAb,CAAZ;QACE,GAAI,MAAJ,GAAY,MADd;OANG;;AAPP;SAeA;AApB4B;;AAsB9B,MAAM,CAAC,OAAO,CAAC,YAAf,GAA8B,SAAC,GAAD,EAAM,GAAN,EAAW,OAAX;AAC5B;;IADuC,UAAQ;;EAC/C,UAAU,CAAC,CAAC,MAAF,CAAS;IAAE,mBAAmB,KAArB;GAAT,EAAuC,OAAvC;EACV,SAAS,EAAE,yBAAF,EAA6B,GAA7B;AACT;OAAA;;IACE,QAAQ,EAAE,KAAF;IACR,KAAgB,QAAO,KAAK,CAAC,IAAN,CAAW,MAAX,CAAP,CAAhB;AAAA;;IACA,IAAgB,iBAAhB;AAAA;;IACA,IAAG,KAAK,CAAC,IAAN,CAAW,MAAX,MAAsB,UAAzB;MACE,QAAQ,KAAK,CAAC,GAAN;MACR,IAAG,CAAC,CAAC,QAAF,CAAW,GAAI,MAAf,EAAsB,KAAtB,CAAH;qBACE,KAAK,CAAC,IAAN,CAAW,SAAX,EAAsB,IAAtB,GADF;OAAA;6BAAA;OAFF;KAAA,MAIK,IAAG,KAAK,CAAC,IAAN,CAAW,MAAX,MAAsB,OAAzB;MACH,QAAQ,KAAK,CAAC,GAAN;MACR,IAAG,GAAI,MAAJ,KAAa,KAAhB;qBACE,KAAK,CAAC,IAAN,CAAW,SAAX,EAAsB,IAAtB,GADF;OAAA;6BAAA;OAFG;KAAA;MAKH,IAAG,OAAO,CAAC,iBAAR,IAA6B,CAAC,CAAI,KAAK,CAAC,GAAN,EAAL,CAAhC;qBACE,KAAK,CAAC,GAAN,CAAU,GAAI,MAAd,GADF;OAAA;6BAAA;OALG;;AARP;;AAH4B;;AAmB9B,MAAM,CAAC,OAAO,CAAC,iBAAf,GAAmC,SAAC,EAAD,EAAK,MAAL,EAAa,OAAb;AACjC;;IAD8C,UAAQ;;EACtD,IAAqB,CAAI,CAAC,CAAC,OAAF,CAAU,MAAV,CAAzB;IAAA,SAAS,CAAC,MAAD,EAAT;;EACA,gBAAgB;AAChB;;IACE,IAAG,KAAK,CAAC,IAAN,KAAc,GAAG,CAAC,UAAU,CAAC,eAAhC;MACE,OAAO,CAAC,CAAC,IAAF,CAAO,CAAC,CAAC,MAAM,CAAC,KAAT,CAAe,KAAK,CAAC,OAArB,CAAP;MACP,UAAU,CAAC,CAAC,IAAI,CAAC,CAAP,CAAS,uBAAT,EAFZ;KAAA,MAIK,IAAG,KAAK,CAAC,QAAT;MACH,OAAO,KAAK,CAAC,QAAS;MACtB,UAAU,KAAK,CAAC,QAFb;KAAA;MAKH,UAAa,KAAK,CAAC,QAAP,GAAgB,GAAhB,GAAmB,KAAK,CAAC,OAAzB,GAAiC;MAC7C,UAAU,OAAQ,GAAE,CAAC,WAAX,KAA2B,OAAQ;MAC7C,IAA2B,KAAK,CAAC,SAAjC;QAAA,UAAU,KAAK,CAAC,QAAhB;;MACA,OAAO,KAAK,CAAC,SARV;;IAUL,IAAG,KAAK,CAAC,IAAN,KAAc,GAAG,CAAC,UAAU,CAAC,aAAhC;MACE,kBAAkB,yCAAyC,CAAC,IAA1C,CAA+C,OAA/C,CAAwD;MAC1E,KAAO,CAAC,CAAC,OAAF,CAAU,eAAV,CAAP;QACE,UAAU,gBADZ;OAFF;;IAKA,IAAG,KAAK,CAAC,IAAN,KAAc,GAAd,IAAsB,KAAK,CAAC,QAAN,KAAkB,OAA3C;MACE,WAAW,qCADb;;IAGA,KAAgC,mBAAmB,EAAnB,EAAuB,IAAvB,EAA6B,OAA7B,EAAsC,OAAtC,CAAhC;MAAA,aAAa,CAAC,IAAd,CAAmB,KAAnB;;AAvBF;SAwBA;AA3BiC;;AA8BnC,MAAM,CAAC,OAAO,CAAC,eAAf,GAAiC,kBAAkB,SAAC,EAAD,EAAK,OAAL,EAAc,OAAd;AACjD;;IAD+D,UAAQ;;EACvE,YAAY,EAAE,CAAC,OAAH,CAAW,aAAX;EACZ,KAAO,SAAS,CAAC,MAAjB;AACE,WAAO,OAAO,CAAC,KAAR,CAAc,EAAd,EAAkB,0DAAlB,EAA8E,OAA9E,EADT;;EAGA,OAAU,OAAH,GAAgB,SAAhB,GAA+B;EACtC,UAAU,EAAE,SAAS,CAAC,IAAV,CAAe,qDAAf,CAAsE,GAAxE;EACV,SAAS,CAAC,QAAV,CAAmB,SAAO,IAA1B;EACA,YAAY,EAAE,6BAA2B,IAA3B,GAAgC,eAAhC,GAA+C,OAA/C,GAAuD,SAAzD;EACZ,IAAG,OAAO,CAAC,MAAX;WACE,OAAO,CAAC,MAAR,CAAe,SAAf,EADF;GAAA;WAGE,SAAS,CAAC,MAAV,CAAiB,SAAjB,EAHF;;AATiD;;AAcnD,MAAM,CAAC,OAAO,CAAC,kBAAf,GAAoC,qBAAqB,SAAC,EAAD,EAAK,QAAL,EAAe,OAAf,EAAwB,OAAxB;AACvD;;IAD+E,UAAQ;;EACvF,QAAQ,EAAE,YAAU,QAAV,GAAmB,IAArB,EAA0B,EAA1B;EACR,KAAO,KAAK,CAAC,MAAb;AACE,WAAO,OAAO,CAAC,KAAR,CAAiB,QAAD,GAAU,eAA1B,EAA0C,EAA1C,EAA8C,2BAA9C,EAA2E,OAA3E,EADT;;SAGA,gBAAgB,KAAhB,EAAuB,OAAvB,EAAgC,OAAhC;AALuD;;AAOzD,MAAM,CAAC,OAAO,CAAC,kBAAf,GAAoC,SAAC,GAAD;AAClC;;IADmC,MAAI,EAAE,MAAF;;EACvC,SAAS,GAAG,CAAC,IAAJ,CAAS,iGAAT,CAA2G,CAAC,MAA5G,CAAmH,UAAnH,CAA8H,CAAC,KAA/H;EACT,IAAG,MAAM,CAAC,MAAV;WACE,EAAE,YAAF,CAAe,CAAC,OAAhB,CAAwB;MAAE,WAAW,MAAM,CAAC,MAAP,EAAe,CAAC,GAAhB,GAAsB,EAAnC;KAAxB,EAAiE,GAAjE,EADF;;AAFkC;;AAKpC,MAAM,CAAC,OAAO,CAAC,eAAf,GAAiC,SAAC,EAAD;EAC/B,EAAE,YAAF,EAAgB,EAAhB,CAAmB,CAAC,WAApB,CAAgC,WAAhC;EACA,EAAE,cAAF,EAAkB,EAAlB,CAAqB,CAAC,WAAtB,CAAkC,aAAlC;EACA,EAAE,qBAAF,EAAyB,EAAzB,CAA4B,CAAC,MAA7B;EACA,EAAE,sBAAF,EAA0B,EAA1B,CAA6B,CAAC,MAA9B;EACA,EAAE,CAAC,IAAH,CAAQ,8BAAR,CAAuC,CAAC,MAAxC;SACA,EAAE,CAAC,IAAH,CAAQ,gCAAR,CAAyC,CAAC,MAA1C;AAN+B;;AAQjC,MAAM,CAAC,OAAO,CAAC,aAAf,GAA+B,SAAC,EAAD;SAC7B,EAAE,CAAC,IAAH,CAAQ,QAAR,CAAiB,CAAC,IAAlB,CAAuB,SAAC,CAAD,EAAI,MAAJ;AACrB;IAAA,QAAQ,EAAE,MAAF,CAAS,CAAC,IAAV,CAAe,OAAf;WACR,EAAE,MAAF,CAAS,CAAC,GAAV,CAAc,KAAd;EAFqB,CAAvB;AAD6B;;AAK/B,MAAM,CAAC,OAAO,CAAC,aAAf,GAA+B,SAAC,KAAD;AAC7B;EAAA,SAAS;AACT,SAAO,MAAM,CAAC,IAAP,CAAY,KAAZ;AAFsB;;AAI/B,MAAM,CAAC,OAAO,CAAC,mBAAf,GAAqC,SAAC,WAAD;AACnC;EAAA,SAAS;AACT,SAAO,MAAM,CAAC,IAAP,CAAY,WAAZ;AAF4B;;AAIrC,MAAM,CAAC,OAAO,CAAC,aAAf,GAA+B,SAAC,EAAD,EAAK,OAAL;AAC7B;;IADkC,UAAQ;;EAC1C,MAAM,EAAE,EAAF;EACN,GAAG,CAAC,IAAJ,CAAS,eAAT,EAA0B,GAAG,CAAC,IAAJ,EAA1B;SACA,GAAG,CAAC,IAAJ,CAAS,OAAT,CAAiB,CAAC,IAAlB,CAAuB,UAAvB,EAAmC,IAAnC;AAH6B;;AAK/B,MAAM,CAAC,OAAO,CAAC,YAAf,GAA8B,SAAC,EAAD;AAC5B;EAAA,MAAM,EAAE,EAAF;SACN,GAAG,CAAC,IAAJ,CAAS,GAAG,CAAC,IAAJ,CAAS,eAAT,CAAT,CAAmC,CAAC,IAApC,CAAyC,UAAzC,EAAqD,KAArD;AAF4B","file":"public/javascripts/app/core/forms.js","sourcesContent":["module.exports.formToObject = ($el, options) ->\r\n  options = _.extend({ trim: true, ignoreEmptyString: true }, options)\r\n  obj = {}\r\n\r\n  inputs = $('input, textarea, select', $el)\r\n  for input in inputs\r\n    input = $(input)\r\n    continue unless name = input.attr('name')\r\n    if input.attr('type') is 'checkbox'\r\n      obj[name] ?= []\r\n      if input.is(':checked')\r\n        obj[name].push(input.val())\r\n    else if input.attr('type') is 'radio'\r\n      continue unless input.is('checked')\r\n      obj[name] = input.val()\r\n    else\r\n      value = input.val() or ''\r\n      value = _.string.trim(value) if options.trim\r\n      if value or (not options.ignoreEmptyString)\r\n        obj[name] = value\r\n  obj\r\n  \r\nmodule.exports.objectToForm = ($el, obj, options={}) ->\r\n  options = _.extend({ overwriteExisting: false }, options)\r\n  inputs = $('input, textarea, select', $el)\r\n  for input in inputs\r\n    input = $(input)\r\n    continue unless name = input.attr('name')\r\n    continue unless obj[name]?\r\n    if input.attr('type') is 'checkbox'\r\n      value = input.val()\r\n      if _.contains(obj[name], value)\r\n        input.attr('checked', true)\r\n    else if input.attr('type') is 'radio'\r\n      value = input.val()\r\n      if obj[name] is value\r\n        input.attr('checked', true)\r\n    else\r\n      if options.overwriteExisting or (not input.val())\r\n        input.val(obj[name])\r\n\r\nmodule.exports.applyErrorsToForm = (el, errors, warning=false) ->\r\n  errors = [errors] if not $.isArray(errors)\r\n  missingErrors = []\r\n  for error in errors\r\n    if error.code is tv4.errorCodes.OBJECT_REQUIRED\r\n      prop = _.last(_.string.words(error.message)) # hack\r\n      message = $.i18n.t('common.required_field')\r\n    \r\n    else if error.dataPath\r\n      prop = error.dataPath[1..]\r\n      message = error.message\r\n\r\n    else\r\n      message = \"#{error.property} #{error.message}.\"\r\n      message = message[0].toUpperCase() + message[1..]\r\n      message = error.message if error.formatted\r\n      prop = error.property\r\n\r\n    if error.code is tv4.errorCodes.FORMAT_CUSTOM\r\n      originalMessage = /Format validation failed \\(([^\\(\\)]+)\\)/.exec(message)[1]\r\n      unless _.isEmpty(originalMessage)\r\n        message = originalMessage\r\n    \r\n    if error.code is 409 and error.property is 'email'\r\n      message += ' <a class=\"login-link\">Log in?</a>'\r\n\r\n    missingErrors.push error unless setErrorToProperty el, prop, message, warning\r\n  missingErrors\r\n\r\n# Returns the jQuery form group element in case of success, otherwise undefined\r\nmodule.exports.setErrorToField = setErrorToField = (el, message, warning=false) ->\r\n  formGroup = el.closest('.form-group')\r\n  unless formGroup.length\r\n    return console.error el, \" did not contain a form group, so couldn't show message:\", message\r\n\r\n  kind = if warning then 'warning' else 'error'\r\n  afterEl = $(formGroup.find('.help-block, .form-control, input, select, textarea')[0])\r\n  formGroup.addClass \"has-#{kind}\"\r\n  helpBlock = $(\"<span class='help-block #{kind}-help-block'>#{message}</span>\")\r\n  if afterEl.length\r\n    afterEl.before helpBlock\r\n  else\r\n    formGroup.append helpBlock\r\n\r\nmodule.exports.setErrorToProperty = setErrorToProperty = (el, property, message, warning=false) ->\r\n  input = $(\"[name='#{property}']\", el)\r\n  unless input.length\r\n    return console.error \"#{property} not found in\", el, \"so couldn't show message:\", message\r\n\r\n  setErrorToField input, message, warning\r\n  \r\nmodule.exports.scrollToFirstError = ($el=$('body')) ->\r\n  $first = $el.find('.has-error, .alert-danger, .error-help-block, .has-warning, .alert-warning, .warning-help-block').filter(':visible').first()\r\n  if $first.length\r\n    $('html, body').animate({ scrollTop: $first.offset().top - 20 }, 300)\r\n\r\nmodule.exports.clearFormAlerts = (el) ->\r\n  $('.has-error', el).removeClass('has-error')\r\n  $('.has-warning', el).removeClass('has-warning')\r\n  $('.alert.alert-danger', el).remove()\r\n  $('.alert.alert-warning', el).remove()\r\n  el.find('.help-block.error-help-block').remove()\r\n  el.find('.help-block.warning-help-block').remove()\r\n  \r\nmodule.exports.updateSelects = (el) ->\r\n  el.find('select').each (i, select) ->\r\n    value = $(select).attr('value')\r\n    $(select).val(value)\r\n  \r\nmodule.exports.validateEmail = (email) ->\r\n  filter = /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,63}$/i  # https://news.ycombinator.com/item?id=5763990\r\n  return filter.test(email)\r\n\r\nmodule.exports.validatePhoneNumber = (phoneNumber) ->\r\n  filter = /^\\D*(\\d\\D*){10,}$/i  # Just make sure there's at least 10 digits\r\n  return filter.test(phoneNumber)\r\n\r\nmodule.exports.disableSubmit = (el, message='...') ->\r\n  $el = $(el)\r\n  $el.data('original-text', $el.text())\r\n  $el.text(message).attr('disabled', true)\r\n  \r\nmodule.exports.enableSubmit = (el) ->\r\n  $el = $(el)\r\n  $el.text($el.data('original-text')).attr('disabled', false)\r\n"]}