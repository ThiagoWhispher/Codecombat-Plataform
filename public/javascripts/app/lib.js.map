{"version":3,"sources":["app/lib/Angel.coffee","app/lib/AudioPlayer.coffee","app/lib/Bus.coffee","app/lib/DefaultScripts.coffee","app/lib/God.coffee","app/lib/HtmlExtractor.coffee","app/lib/LevelBus.coffee","app/lib/LevelLoader.coffee","app/lib/LevelSetupManager.coffee","app/lib/LocalMongo.coffee","app/lib/SolutionConceptTagger.coffee","app/lib/aether_utils.coffee","app/lib/coursesHelper.coffee","app/lib/image_filter.coffee","app/lib/requireUtils.coffee","app/lib/scripts/DOMScriptModule.coffee","app/lib/scripts/PlaybackScriptModule.coffee","app/lib/scripts/ScriptManager.coffee","app/lib/scripts/ScriptModule.coffee","app/lib/scripts/SoundScriptModule.coffee","app/lib/scripts/SpriteScriptModule.coffee","app/lib/scripts/SurfaceScriptModule.coffee","app/lib/simulator/Simulator.coffee","app/lib/sprites/SpriteBuilder.coffee","app/lib/sprites/SpriteExporter.coffee","app/lib/sprites/SpriteParser.coffee","app/lib/surface/Camera.coffee","app/lib/surface/CameraBorder.coffee","app/lib/surface/CoordinateDisplay.coffee","app/lib/surface/CoordinateGrid.coffee","app/lib/surface/CountdownScreen.coffee","app/lib/surface/DebugDisplay.coffee","app/lib/surface/Dimmer.coffee","app/lib/surface/Dropper.coffee","app/lib/surface/FlagLank.coffee","app/lib/surface/IndieLank.coffee","app/lib/surface/Label.coffee","app/lib/surface/Lank.coffee","app/lib/surface/LankBoss.coffee","app/lib/surface/LayerAdapter.coffee","app/lib/surface/Letterbox.coffee","app/lib/surface/Mark.coffee","app/lib/surface/MusicPlayer.coffee","app/lib/surface/PlaybackOverScreen.coffee","app/lib/surface/PointChooser.coffee","app/lib/surface/RegionChooser.coffee","app/lib/surface/SegmentedSprite.coffee","app/lib/surface/SingularSprite.coffee","app/lib/surface/Surface.coffee","app/lib/surface/TrailMaster.coffee","app/lib/surface/sprite_utils.coffee","app/lib/world/GoalManager.coffee","app/lib/world/Grid.coffee","app/lib/world/box2d.coffee","app/lib/world/component.coffee","app/lib/world/ellipse.coffee","app/lib/world/errors.coffee","app/lib/world/line_segment.coffee","app/lib/world/names.coffee","app/lib/world/rand.coffee","app/lib/world/rectangle.coffee","app/lib/world/script_event_prereqs.coffee","app/lib/world/system.coffee","app/lib/world/systems/action.coffee","app/lib/world/systems/collision.coffee","app/lib/world/systems/movement.coffee","app/lib/world/thang.coffee","app/lib/world/thang_state.coffee","app/lib/world/vector.coffee","app/lib/world/world.coffee","app/lib/world/world_frame.coffee","app/lib/world/world_script_note.coffee","app/lib/world/world_utils.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/lib.js","sourcesContent":["# Every Angel has one web worker attached to it. It will call methods inside the worker and kill it if it times out.\r\n# God is the public API; Angels are an implementation detail. Each God can have one or more Angels.\r\n\r\n{now} = require 'lib/world/world_utils'\r\nWorld = require 'lib/world/world'\r\nCocoClass = require 'core/CocoClass'\r\nGoalManager = require 'lib/world/GoalManager'\r\n{sendContactMessage} = require 'core/contact'\r\nerrors = require 'core/errors'\r\n\r\nreportedLoadErrorAlready = false\r\n\r\nmodule.exports = class Angel extends CocoClass\r\n  @nicks: ['Archer', 'Lana', 'Cyril', 'Pam', 'Cheryl', 'Woodhouse', 'Ray', 'Krieger']\r\n\r\n  infiniteLoopIntervalDuration: 10000  # check this often; must be longer than other two combined\r\n  infiniteLoopTimeoutDuration: 7500  # wait this long for a response when checking\r\n  abortTimeoutDuration: 500  # give in-process or dying workers this long to give up\r\n\r\n  subscriptions:\r\n    'level:flag-updated': 'onFlagEvent'\r\n    'playback:stop-real-time-playback': 'onStopRealTimePlayback'\r\n    'level:escape-pressed': 'onEscapePressed'\r\n\r\n  constructor: (@shared) ->\r\n    super()\r\n    @say 'Got my wings.'\r\n    isIE = window.navigator and (window.navigator.userAgent.search('MSIE') isnt -1 or window.navigator.appName is 'Microsoft Internet Explorer')\r\n    slowerSimulations = isIE  #or @shared.headless\r\n    # Since IE is so slow to serialize without transferable objects, we can't trust it.\r\n    # We also noticed the headless_client simulator needing more time. (This does both Simulators, though.) If we need to use lots of headless clients, enable this.\r\n    if slowerSimulations\r\n      @infiniteLoopIntervalDuration *= 10\r\n      @infiniteLoopTimeoutDuration *= 10\r\n      @abortTimeoutDuration *= 10\r\n    @initialized = false\r\n    @running = false\r\n    @allLogs = []\r\n    @hireWorker()\r\n    @shared.angels.push @\r\n    @listenTo @shared.gameUIState.get('realTimeInputEvents'), 'add', @onAddRealTimeInputEvent\r\n\r\n  destroy: ->\r\n    @fireWorker false\r\n    _.remove @shared.angels, @\r\n    super()\r\n\r\n  workIfIdle: ->\r\n    @doWork() unless @running\r\n\r\n  # say: debugging stuff, usually off; log: important performance indicators, keep on\r\n  say: (args...) -> #@log args...\r\n  log: ->\r\n    # console.info.apply is undefined in IE9, CoffeeScript splats invocation won't work.\r\n    # http://stackoverflow.com/questions/5472938/does-ie9-support-console-log-and-is-it-a-real-function\r\n    message = \"|#{@shared.godNick}'s #{@nick}|\"\r\n    message += \" #{arg}\" for arg in arguments\r\n    console.info message\r\n    @allLogs.push message\r\n\r\n  testWorker: =>\r\n    return if @destroyed\r\n    clearTimeout @condemnTimeout\r\n    @condemnTimeout = _.delay @infinitelyLooped, @infiniteLoopTimeoutDuration\r\n    @say 'Let\\'s give it', @infiniteLoopTimeoutDuration, 'to not loop.'\r\n    @worker.postMessage func: 'reportIn'\r\n\r\n  onWorkerMessage: (event) =>\r\n    return @say 'Currently aborting old work.' if @aborting and event.data.type isnt 'abort'\r\n\r\n    switch event.data.type\r\n      # First step: worker has to load the scripts.\r\n      when 'worker-initialized'\r\n        unless @initialized\r\n          @log \"Worker initialized after #{(new Date()) - @worker.creationTime}ms\"\r\n          @initialized = true\r\n          @doWork()\r\n\r\n      # We watch over the worker as it loads the world frames to make sure it doesn't infinitely loop.\r\n      when 'start-load-frames'\r\n        clearTimeout @condemnTimeout\r\n      when 'report-in'\r\n        @say 'Worker reported in.'\r\n        clearTimeout @condemnTimeout\r\n      when 'end-load-frames'\r\n        clearTimeout @condemnTimeout\r\n        @beholdGoalStates {goalStates: event.data.goalStates, overallStatus: event.data.overallStatus, preload: false, totalFrames: event.data.totalFrames, lastFrameHash: event.data.lastFrameHash, simulationFrameRate: event.data.simulationFrameRate}  # Work ends here if we're headless.\r\n      when 'end-preload-frames'\r\n        clearTimeout @condemnTimeout\r\n        @beholdGoalStates {goalStates: event.data.goalStates, overallStatus: event.data.overallStatus, preload: true, simulationFrameRate: event.data.simulationFrameRate}\r\n\r\n      # We have to abort like an infinite loop if we see one of these; they're not really recoverable\r\n      when 'non-user-code-problem'\r\n        @publishGodEvent 'non-user-code-problem', problem: event.data.problem\r\n        if @shared.firstWorld\r\n          @infinitelyLooped(false, true)  # For now, this should do roughly the right thing if it happens during load.\r\n        else\r\n          @fireWorker()\r\n\r\n      # If it didn't finish simulating successfully, or we abort the worker.\r\n      when 'abort'\r\n        @say 'Aborted.', event.data\r\n        clearTimeout @abortTimeout\r\n        @aborting = false\r\n        @running = false\r\n        _.remove @shared.busyAngels, @\r\n        @doWork()\r\n\r\n      # We pay attention to certain progress indicators as the world loads.\r\n      when 'console-log'\r\n        @log event.data.args...\r\n      when 'user-code-problem'\r\n        @publishGodEvent 'user-code-problem', problem: event.data.problem\r\n      when 'world-load-progress-changed'\r\n        progress = event.data.progress\r\n        progress = Math.min(progress, 0.9) if @work.indefiniteLength\r\n        @publishGodEvent 'world-load-progress-changed', { progress }\r\n        unless event.data.progress is 1 or @work.preload or @work.headless or @work.synchronous or @deserializationQueue.length or (@shared.firstWorld and not @shared.spectate)\r\n          @worker.postMessage func: 'serializeFramesSoFar'  # Stream it!\r\n\r\n      # We have some or all of the frames serialized, so let's send the (partially?) simulated world to the Surface.\r\n      when 'some-frames-serialized', 'new-world'\r\n        deserializationArgs = [event.data.serialized, event.data.goalStates, event.data.startFrame, event.data.endFrame, @streamingWorld]\r\n        @deserializationQueue.push deserializationArgs\r\n        if @deserializationQueue.length is 1\r\n          @beholdWorld deserializationArgs...\r\n\r\n      else\r\n        @log 'Received unsupported message:', event.data\r\n\r\n  beholdGoalStates: ({goalStates, overallStatus, preload, totalFrames, lastFrameHash, simulationFrameRate}) ->\r\n    return if @aborting\r\n    event = goalStates: goalStates, preload: preload ? false, overallStatus: overallStatus\r\n    event.totalFrames = totalFrames if totalFrames?\r\n    event.lastFrameHash = lastFrameHash if lastFrameHash?\r\n    event.simulationFrameRate = simulationFrameRate if simulationFrameRate?\r\n    @publishGodEvent 'goals-calculated', event\r\n    @finishWork() if @shared.headless\r\n\r\n  beholdWorld: (serialized, goalStates, startFrame, endFrame, streamingWorld) ->\r\n    return if @aborting\r\n    # Toggle BOX2D_ENABLED during deserialization so that if we have box2d in the namespace, the Collides Components still don't try to create bodies for deserialized Thangs upon attachment.\r\n    window.BOX2D_ENABLED = false\r\n    streamingWorld?.indefiniteLength = @work.indefiniteLength\r\n    @streamingWorld = World.deserialize serialized, @shared.worldClassMap, @shared.lastSerializedWorldFrames, @finishBeholdingWorld(goalStates), startFrame, endFrame, @work.level, streamingWorld\r\n    window.BOX2D_ENABLED = true\r\n    @shared.lastSerializedWorldFrames = serialized.frames\r\n\r\n  finishBeholdingWorld: (goalStates) -> (world) =>\r\n    return if @aborting or @destroyed\r\n    finished = world.frames.length is world.totalFrames\r\n    if @work?.indefiniteLength and world.victory?\r\n      finished = true\r\n      world.totalFrames = world.frames.length\r\n    firstChangedFrame = if @work?.indefiniteLength then 0 else world.findFirstChangedFrame @shared.world\r\n    eventType = if finished then 'new-world-created' else 'streaming-world-updated'\r\n    if finished\r\n      @shared.world = world\r\n    @publishGodEvent eventType, world: world, firstWorld: @shared.firstWorld, goalStates: goalStates, team: me.team, firstChangedFrame: firstChangedFrame, finished: finished\r\n    if finished\r\n      for scriptNote in @shared.world.scriptNotes\r\n        Backbone.Mediator.publish scriptNote.channel, scriptNote.event\r\n      @shared.goalManager?.world = world\r\n      @finishWork()\r\n    else\r\n      @deserializationQueue.shift()  # Finished with this deserialization.\r\n      if deserializationArgs = @deserializationQueue[0]  # Start another?\r\n        @beholdWorld deserializationArgs...\r\n\r\n  finishWork: ->\r\n    @streamingWorld = null\r\n    @shared.firstWorld = false\r\n    @deserializationQueue = []\r\n    @running = false\r\n    _.remove @shared.busyAngels, @\r\n    clearTimeout @condemnTimeout\r\n    clearInterval @purgatoryTimer\r\n    @condemnTimeout = @purgatoryTimer = null\r\n    @doWork()\r\n\r\n  finalizePreload: ->\r\n    @say 'Finalize preload.'\r\n    @worker.postMessage func: 'finalizePreload'\r\n    @work.preload = false\r\n\r\n  infinitelyLooped: (escaped=false, nonUserCodeProblem=false) =>\r\n    @say 'On infinitely looped! Aborting?', @aborting\r\n    return if @aborting\r\n    problem = type: 'runtime', level: 'error', id: 'runtime_InfiniteLoop', message: 'Code never finished. It\\'s either really slow or has an infinite loop.'\r\n    problem.message = 'Escape pressed; code aborted.' if escaped\r\n    @publishGodEvent 'user-code-problem', problem: problem\r\n    @publishGodEvent 'infinite-loop', firstWorld: @shared.firstWorld, nonUserCodeProblem: nonUserCodeProblem\r\n    @reportLoadError() if nonUserCodeProblem\r\n    @fireWorker()\r\n\r\n  publishGodEvent: (channel, e) ->\r\n    # For Simulator. TODO: refactor all the god:* Mediator events to be local events.\r\n    @shared.god.trigger channel, e\r\n    e.god = @shared.god\r\n    Backbone.Mediator.publish 'god:' + channel, e\r\n\r\n  reportLoadError: ->\r\n    return if me.isAdmin() or /dev=true/.test(window.location?.href ? '') or reportedLoadErrorAlready\r\n    reportedLoadErrorAlready = true\r\n    context = email: me.get('email')\r\n    context.message = \"Automatic Report - Unable to Load Level\\nLogs:\\n\" + @allLogs.join('\\n')\r\n    if $.browser\r\n      context.browser = \"#{$.browser.platform} #{$.browser.name} #{$.browser.versionNumber}\"\r\n    context.screenSize = \"#{screen?.width ? $(window).width()} x #{screen?.height ? $(window).height()}\"\r\n    context.subject = \"Level Load Error: #{@work?.level?.name or 'Unknown Level'}\"\r\n    context.levelSlug = @work?.level?.slug\r\n    sendContactMessage context\r\n\r\n  doWork: ->\r\n    return if @aborting\r\n    return @say 'Not initialized for work yet.' unless @initialized\r\n    if @shared.workQueue.length\r\n      @work = @shared.workQueue.shift()\r\n      return _.defer @simulateSync, @work if @work.synchronous\r\n      @say 'Running world...'\r\n      @running = true\r\n      @shared.busyAngels.push @\r\n      @deserializationQueue = []\r\n      @worker.postMessage func: 'runWorld', args: @work\r\n      clearTimeout @purgatoryTimer\r\n      @say 'Infinite loop timer started at interval of', @infiniteLoopIntervalDuration\r\n      @purgatoryTimer = setInterval @testWorker, @infiniteLoopIntervalDuration\r\n    else\r\n      @say 'No work to do.'\r\n      @hireWorker()\r\n\r\n  abort: ->\r\n    return unless @worker and @running\r\n    @say 'Aborting...'\r\n    @running = false\r\n    @work = null\r\n    @streamingWorld = null\r\n    @deserializationQueue = []\r\n    _.remove @shared.busyAngels, @\r\n    @abortTimeout = _.delay @fireWorker, @abortTimeoutDuration\r\n    @aborting = true\r\n    @worker.postMessage func: 'abort'\r\n\r\n  fireWorker: (rehire=true) =>\r\n    return if @destroyed\r\n    @aborting = false\r\n    @running = false\r\n    _.remove @shared.busyAngels, @\r\n    @worker?.removeEventListener 'message', @onWorkerMessage\r\n    @worker?.terminate()\r\n    @worker = null\r\n    clearTimeout @condemnTimeout\r\n    clearInterval @purgatoryTimer\r\n    @say 'Fired worker.'\r\n    @initialized = false\r\n    @work = null\r\n    @streamingWorld = null\r\n    @deserializationQueue = []\r\n    @hireWorker() if rehire\r\n\r\n  hireWorker: ->\r\n    unless Worker?\r\n      unless @initialized\r\n        @initialized = true\r\n        @doWork()\r\n      return null\r\n    return if @worker\r\n    @say 'Hiring worker.'\r\n    @worker = new Worker @shared.workerCode\r\n    @worker.addEventListener 'error', errors.onWorkerError\r\n    @worker.addEventListener 'message', @onWorkerMessage\r\n    @worker.creationTime = new Date()\r\n\r\n  onFlagEvent: (e) ->\r\n    return unless @running and @work.realTime\r\n    @worker.postMessage func: 'addFlagEvent', args: e\r\n\r\n  onAddRealTimeInputEvent: (realTimeInputEvent) ->\r\n    return unless @running and @work.realTime\r\n    @worker.postMessage func: 'addRealTimeInputEvent', args: realTimeInputEvent.toJSON()\r\n\r\n  onStopRealTimePlayback: (e) ->\r\n    return unless @running and @work.realTime\r\n    @work.realTime = false\r\n    @lastRealTimeWork = new Date()\r\n    @worker.postMessage func: 'stopRealTimePlayback'\r\n\r\n  onEscapePressed: (e) ->\r\n    return unless @running and not @work.realTime\r\n    return if (new Date() - @lastRealTimeWork) < 1000  # Fires right after onStopRealTimePlayback\r\n    @infinitelyLooped true\r\n\r\n  #### Synchronous code for running worlds on main thread (profiling / IE9) ####\r\n  simulateSync: (work) =>\r\n    console?.profile? \"World Generation #{(Math.random() * 1000).toFixed(0)}\" if imitateIE9?\r\n    work.t0 = now()\r\n    work.world = testWorld = new World work.userCodeMap\r\n    work.world.levelSessionIDs = work.levelSessionIDs\r\n    work.world.submissionCount = work.submissionCount\r\n    work.world.fixedSeed = work.fixedSeed\r\n    work.world.flagHistory = work.flagHistory ? []\r\n    work.world.difficulty = work.difficulty\r\n    work.world.loadFromLevel work.level\r\n    work.world.preloading = work.preload\r\n    work.world.headless = work.headless\r\n    work.world.realTime = work.realTime\r\n    if @shared.goalManager\r\n      testGM = new GoalManager(testWorld)\r\n      testGM.setGoals work.goals\r\n      testGM.setCode work.userCodeMap\r\n      testGM.worldGenerationWillBegin()\r\n      testWorld.setGoalManager testGM\r\n    @doSimulateWorld work\r\n    console?.profileEnd?() if imitateIE9?\r\n    console.log 'Construction:', (work.t1 - work.t0).toFixed(0), 'ms. Simulation:', (work.t2 - work.t1).toFixed(0), 'ms --', ((work.t2 - work.t1) / testWorld.frames.length).toFixed(3), 'ms per frame, profiled.'\r\n\r\n    # If performance was really a priority in IE9, we would rework things to be able to skip this step.\r\n    goalStates = testGM?.getGoalStates()\r\n    work.world.goalManager.worldGenerationEnded() if work.world.ended\r\n\r\n    if work.headless\r\n      simulationFrameRate = work.world.frames.length / (work.t2 - work.t1) * 1000 * 30 / work.world.frameRate\r\n      @beholdGoalStates {goalStates, overallStatus: testGM.checkOverallStatus(), preload: false, totalFrames: work.world.totalFrames, lastFrameHash: work.world.frames[work.world.totalFrames - 2]?.hash, simulationFrameRate: simulationFrameRate}\r\n      return\r\n\r\n    serialized = world.serialize()\r\n    window.BOX2D_ENABLED = false\r\n    World.deserialize serialized.serializedWorld, @shared.worldClassMap, @shared.lastSerializedWorldFrames, @finishBeholdingWorld(goalStates), serialized.startFrame, serialized.endFrame, work.level\r\n    window.BOX2D_ENABLED = true\r\n    @shared.lastSerializedWorldFrames = serialized.serializedWorld.frames\r\n\r\n  doSimulateWorld: (work) ->\r\n    work.t1 = now()\r\n    Math.random = work.world.rand.randf  # so user code is predictable\r\n    Aether.replaceBuiltin('Math', Math)\r\n    replacedLoDash = _.runInContext(window)\r\n    _[key] = replacedLoDash[key] for key, val of replacedLoDash\r\n    i = 0\r\n    while i < work.world.totalFrames\r\n      frame = work.world.getFrame i++\r\n    @publishGodEvent 'world-load-progress-changed', progress: 1\r\n    work.world.ended = true\r\n    system.finish work.world.thangs for system in work.world.systems\r\n    work.t2 = now()\r\n","CocoClass = require 'core/CocoClass'\r\ncache = {}\r\n{me} = require 'core/auth'\r\n\r\n# Top 20 obscene words (plus 'fiddlesticks') will trigger swearing Simlish with *beeps*.\r\n# Didn't like leaving so much profanity lying around in the source, so rot13'd.\r\nrot13 = (s) -> s.replace /[A-z]/g, (c) -> String.fromCharCode c.charCodeAt(0) + (if c.toUpperCase() <= 'M' then 13 else -13)\r\nswears = (rot13 s for s in ['nefrubyr', 'nffubyr', 'onfgneq', 'ovgpu', 'oybbql', 'obyybpxf', 'ohttre', 'pbpx', 'penc', 'phag', 'qnza', 'qnea', 'qvpx', 'qbhpur', 'snt', 'shpx', 'cvff', 'chffl', 'fuvg', 'fyhg', 'svqqyrfgvpxf'])\r\n\r\n# IE(11, 10, 9) throws an exception if createjs.FlashPlugin is undefined\r\n# Chrome and Firefox don't seem to care that it's undefined\r\nif createjs.FlashPlugin?\r\n  soundPlugins = [createjs.WebAudioPlugin, createjs.FlashPlugin, createjs.HTMLAudioPlugin]\r\nelse\r\n  soundPlugins = [createjs.WebAudioPlugin, createjs.HTMLAudioPlugin]\r\ncreatejs.Sound.registerPlugins(soundPlugins)\r\n\r\nclass Manifest\r\n  constructor: -> @storage = {}\r\n\r\n  add: (filename, group='misc') ->\r\n    name = name or filename\r\n    @storage[group] = [] unless @storage[group]?\r\n    return if filename in @storage[group]\r\n    @storage[group].push(filename)\r\n\r\n  addPrimarySound: (filename) -> @add(filename, 'primarySounds')\r\n  addSecondarySound: (filename) -> @add(filename, 'secondarySounds')\r\n  getData: -> return @storage\r\n\r\nclass Media\r\n  constructor: (name) -> @name = name if name\r\n\r\n  loaded: false\r\n  data: null\r\n  progress: 0.0\r\n  error: null\r\n  name: ''\r\n\r\nclass AudioPlayer extends CocoClass\r\n  subscriptions:\r\n    'audio-player:play-sound': (e) -> @playInterfaceSound e.trigger, e.volume\r\n\r\n  constructor: () ->\r\n    super()\r\n    @ext = if createjs.Sound.getCapability('mp3') then '.mp3' else '.ogg'\r\n    @camera = null\r\n    @listenToSound()\r\n    @createNewManifest()\r\n    @soundsToPlayWhenLoaded = {}\r\n\r\n  createNewManifest: ->\r\n    @manifest = new Manifest()\r\n\r\n  listenToSound: ->\r\n    # I would like to go through PreloadJS to organize loading by queue, but\r\n    # when I try to set it up, I get an error with the Sound plugin.\r\n    # So for now, we'll just load through SoundJS instead.\r\n    createjs.Sound.on 'fileload', @onSoundLoaded\r\n\r\n  applyPanning: (options, pos) ->\r\n    sup = @camera.worldToSurface pos\r\n    svp = @camera.surfaceViewport\r\n    pan = Math.max -1, Math.min 1, ((sup.x - svp.x) - svp.width / 2) / svp.width\r\n    pan = 0 if _.isNaN pan\r\n    dst = @camera.distanceRatioTo pos\r\n    dst = 0.8 if _.isNaN dst\r\n    vol = Math.min 1, options.volume / Math.pow (dst + 0.2), 2\r\n    volume: options.volume, delay: options.delay, pan: pan\r\n\r\n  # PUBLIC LOADING METHODS\r\n\r\n  soundForDialogue: (message, soundTriggers) ->\r\n    if _.isArray message then message = message.join ' '\r\n    return message unless _.isString message\r\n    return null unless say = soundTriggers?.say\r\n    message = _.string.slugify message\r\n    return sound if sound = say[message]\r\n    if _.string.startsWith message, 'attack'\r\n      return sound if sound = say.attack\r\n    if message.indexOf(\"i-dont-see-anyone\") isnt -1\r\n      return sound if sound = say['i-dont-see-anyone']\r\n    if message.indexOf(\"i-see-you\") isnt -1\r\n      return sound if sound = say['i-see-you']\r\n    if message.indexOf(\"repeating-loop\") isnt -1\r\n      return sound if sound = say['repeating-loop']\r\n    if /move(up|down|left|right)/.test message\r\n      return sound if sound = say[\"move-#{message[4...]}\"]\r\n    defaults = say.defaultSimlish\r\n    if say.swearingSimlish?.length and _.find(swears, (s) -> message.search(s) isnt -1)\r\n      defaults = say.swearingSimlish\r\n    return null unless defaults?.length\r\n    return defaults[message.length % defaults.length]\r\n\r\n  preloadInterfaceSounds: (names) ->\r\n    return unless me.get 'volume'\r\n    for name in names\r\n      filename = \"/file/interface/#{name}#{@ext}\"\r\n      @preloadSound filename, name\r\n\r\n  playInterfaceSound: (name, volume=1) ->\r\n    return unless volume and me.get 'volume'\r\n    filename = \"/file/interface/#{name}#{@ext}\"\r\n    if @hasLoadedSound filename\r\n      @playSound name, volume\r\n    else\r\n      @preloadInterfaceSounds [name] unless filename of cache\r\n      @soundsToPlayWhenLoaded[name] = volume\r\n\r\n  playSound: (name, volume=1, delay=0, pos=null) ->\r\n    return console.error 'Trying to play empty sound?' unless name\r\n    return unless volume and me.get 'volume'\r\n    audioOptions = {volume: volume, delay: delay}\r\n    filename = if _.string.startsWith(name, '/file/') then name else '/file/' + name\r\n    unless @hasLoadedSound filename\r\n      @soundsToPlayWhenLoaded[name] = audioOptions.volume\r\n    audioOptions = @applyPanning audioOptions, pos if @camera and not @camera.destroyed and pos\r\n    instance = createjs.Sound.play name, audioOptions\r\n    instance\r\n\r\n  hasLoadedSound: (filename, name) ->\r\n    return false unless filename of cache\r\n    return false unless createjs.Sound.loadComplete filename\r\n    true\r\n\r\n  preloadSoundReference: (sound) ->\r\n    return unless me.get 'volume'\r\n    return unless name = @nameForSoundReference sound\r\n    filename = '/file/' + name\r\n    @preloadSound filename, name\r\n    filename\r\n\r\n  nameForSoundReference: (sound) ->\r\n    sound[@ext.slice(1)]  # mp3 or ogg\r\n\r\n  preloadSound: (filename, name) ->\r\n    return unless filename\r\n    return if filename of cache\r\n    name ?= filename\r\n    # SoundJS flips out if you try to register the same file twice\r\n    result = createjs.Sound.registerSound(filename, name, 1)  # 1: 1 channel\r\n    cache[filename] = new Media(name)\r\n\r\n  # PROGRESS CALLBACKS\r\n\r\n  onSoundLoaded: (e) =>\r\n    media = cache[e.src]\r\n    return if not media\r\n    media.loaded = true\r\n    media.progress = 1.0\r\n    if volume = @soundsToPlayWhenLoaded[media.name]\r\n      @playSound media.name, volume\r\n      @soundsToPlayWhenLoaded[media.name] = false\r\n    @notifyProgressChanged()\r\n\r\n  onSoundLoadError: (e) =>\r\n    console.error 'Could not load sound', e\r\n\r\n  notifyProgressChanged: ->\r\n    Backbone.Mediator.publish('audio-player:loaded', {sender: @})\r\n\r\n  getStatus: (src) ->\r\n    return cache[src] or null\r\n\r\n\r\nmodule.exports = new AudioPlayer()\r\n","CocoClass = require 'core/CocoClass'\r\n\r\n{me} = require 'core/auth'\r\n\r\nCHAT_SIZE_LIMIT = 500 # no more than 500 messages\r\n\r\nmodule.exports = Bus = class Bus extends CocoClass\r\n  joined: null\r\n  players: null\r\n\r\n  @get: (docName) -> return @getFromCache or new Bus docName\r\n  @getFromCache: (docName) -> return Bus.activeBuses[docName]\r\n  @activeBuses: {}\r\n  @fireHost: 'https://codecombat.firebaseio.com'\r\n\r\n  constructor: (@docName) ->\r\n    super()\r\n    @players = {}\r\n    Bus.activeBuses[@docName] = @\r\n\r\n  subscriptions:\r\n    'auth:me-synced': 'onMeSynced'\r\n\r\n  connect: ->\r\n    # Put Firebase back in bower if you want to use this\r\n    Backbone.Mediator.publish 'bus:connecting', {bus: @}\r\n    Firebase.goOnline()\r\n    @fireRef = new Firebase(Bus.fireHost + '/' + @docName)\r\n    @fireRef.once 'value', @onFireOpen\r\n\r\n  onFireOpen: (snapshot) =>\r\n    if @destroyed\r\n      console.log(\"Leaving '#{@docName}' because class has been destroyed.\")\r\n      return\r\n    @init()\r\n    Backbone.Mediator.publish 'bus:connected', {bus: @}\r\n\r\n  disconnect: ->\r\n    @fireRef?.off()\r\n    @fireRef = null\r\n    @fireChatRef?.off()\r\n    @fireChatRef = null\r\n    @firePlayersRef?.off()\r\n    @firePlayersRef = null\r\n    @myConnection?.off()\r\n    @myConnection = null\r\n    @joined = false\r\n    Backbone.Mediator.publish 'bus:disconnected', {bus: @}\r\n\r\n  init: ->\r\n    \"\"\"\r\n    Init happens when we're connected.\r\n    \"\"\"\r\n    @fireChatRef = @fireRef.child('chat')\r\n    @firePlayersRef = @fireRef.child('players')\r\n    @join()\r\n    @listenForChanges()\r\n    @sendMessage('/me joined.', true)\r\n\r\n  join: ->\r\n    @joined = true\r\n    @myConnection = @firePlayersRef.child(me.id)\r\n    @myConnection.set({id: me.id, name: me.get('name'), connected: true})\r\n    @onDisconnect = @myConnection.child('connected').onDisconnect()\r\n    @onDisconnect.set(false)\r\n\r\n  listenForChanges: ->\r\n    @fireChatRef.limit(CHAT_SIZE_LIMIT).on 'child_added', @onChatAdded\r\n    @firePlayersRef.on 'child_added', @onPlayerJoined\r\n    @firePlayersRef.on 'child_removed', @onPlayerLeft\r\n    @firePlayersRef.on 'child_changed', @onPlayerChanged\r\n\r\n  onChatAdded: (snapshot) =>\r\n    Backbone.Mediator.publish('bus:new-message', {message: snapshot.val(), bus: @})\r\n\r\n  onPlayerJoined: (snapshot) =>\r\n    player = snapshot.val()\r\n    return unless player.connected\r\n    @players[player.id] = player\r\n    Backbone.Mediator.publish('bus:player-joined', {player: player, bus: @})\r\n\r\n  onPlayerLeft: (snapshot) =>\r\n    val = snapshot.val()\r\n    return unless val\r\n    player = @players[val.id]\r\n    return unless player\r\n    delete @players[player.id]\r\n    Backbone.Mediator.publish('bus:player-left', {player: player, bus: @})\r\n\r\n  onPlayerChanged: (snapshot) =>\r\n    player = snapshot.val()\r\n    wasConnected = @players[player.id]?.connected\r\n    @players[player.id] = player\r\n    @onPlayerLeft(snapshot) if wasConnected and not player.connected\r\n    @onPlayerJoined(snapshot) if player.connected and not wasConnected\r\n    Backbone.Mediator.publish('bus:player-states-changed', {states: @players, bus: @})\r\n\r\n  onMeSynced: ->\r\n    @myConnection?.child('name').set(me.get('name'))\r\n\r\n  countPlayers: -> _.size(@players)\r\n\r\n  onPoint: ->\r\n    # simple way to elect somone to do jobs that don't need to be done by each player\r\n    ids = _.keys(@players)\r\n    ids.sort()\r\n    return ids[0] is me.id\r\n\r\n  # MESSAGING\r\n\r\n  sendSystemMessage: (content) ->\r\n    @sendMessage(content, true)\r\n\r\n  sendMessage: (content, system=false) ->\r\n    MAX_MESSAGE_LENGTH = 400\r\n    message =\r\n      content: content[... MAX_MESSAGE_LENGTH]\r\n      authorName: me.displayName()\r\n      authorID: me.id\r\n      dateMade: new Date()\r\n    message.system = system if system\r\n    @fireChatRef.push(message)\r\n\r\n  # TEARDOWN\r\n\r\n  destroy: ->\r\n    @sendMessage('/me left.', true) if @joined\r\n    delete Bus.activeBuses[@docName] if @docName of Bus.activeBuses\r\n    @disconnect()\r\n    super()\r\n","module.exports = [\r\n  {\r\n    id: \"Introduction\"\r\n    channel: \"god:new-world-created\"\r\n    noteChain: [\r\n      name: \"Set camera, start music.\"\r\n      surface:\r\n        focus:\r\n          bounds: [{x: 0, y: 0}, {x: 80, y: 68}]\r\n          target: \"Hero Placeholder\"\r\n          zoom: 0.5\r\n      sound:\r\n        music:\r\n          file: \"/music/music_level_2\"\r\n          play: true\r\n      script:\r\n        duration: 1\r\n      playback:\r\n        playing: false\r\n    ]\r\n  }\r\n]\r\n","# Each LevelView or Simulator has a God which listens for spells cast and summons new Angels on the main thread to\r\n# oversee simulation of the World on worker threads. The Gods and Angels even have names. It's kind of fun.\r\n# (More fun than ThreadPool and WorkerAgentManager and such.)\r\n\r\n{now} = require 'lib/world/world_utils'\r\nWorld = require 'lib/world/world'\r\nCocoClass = require 'core/CocoClass'\r\nAngel = require 'lib/Angel'\r\nGameUIState = require 'models/GameUIState'\r\nerrors = require 'core/errors'\r\n\r\nmodule.exports = class God extends CocoClass\r\n  @nicks: ['Athena', 'Baldr', 'Crom', 'Dagr', 'Eris', 'Freyja', 'Great Gish', 'Hades', 'Ishtar', 'Janus', 'Khronos', 'Loki', 'Marduk', 'Negafook', 'Odin', 'Poseidon', 'Quetzalcoatl', 'Ra', 'Shiva', 'Thor', 'Umvelinqangi', 'Týr', 'Vishnu', 'Wepwawet', 'Xipe Totec', 'Yahweh', 'Zeus', '上帝', 'Tiamat', '盘古', 'Phoebe', 'Artemis', 'Osiris', '嫦娥', 'Anhur', 'Teshub', 'Enlil', 'Perkele', 'Chaos', 'Hera', 'Iris', 'Theia', 'Uranus', 'Stribog', 'Sabazios', 'Izanagi', 'Ao', 'Tāwhirimātea', 'Tengri', 'Inmar', 'Torngarsuk', 'Centzonhuitznahua', 'Hunab Ku', 'Apollo', 'Helios', 'Thoth', 'Hyperion', 'Alectrona', 'Eos', 'Mitra', 'Saranyu', 'Freyr', 'Koyash', 'Atropos', 'Clotho', 'Lachesis', 'Tyche', 'Skuld', 'Urðr', 'Verðandi', 'Camaxtli', 'Huhetotl', 'Set', 'Anu', 'Allah', 'Anshar', 'Hermes', 'Lugh', 'Brigit', 'Manannan Mac Lir', 'Persephone', 'Mercury', 'Venus', 'Mars', 'Azrael', 'He-Man', 'Anansi', 'Issek', 'Mog', 'Kos', 'Amaterasu Omikami', 'Raijin', 'Susanowo', 'Blind Io', 'The Lady', 'Offler', 'Ptah', 'Anubis', 'Ereshkigal', 'Nergal', 'Thanatos', 'Macaria', 'Angelos', 'Erebus', 'Hecate', 'Hel', 'Orcus', 'Ishtar-Deela Nakh', 'Prometheus', 'Hephaestos', 'Sekhmet', 'Ares', 'Enyo', 'Otrera', 'Pele', 'Hadúr', 'Hachiman', 'Dayisun Tngri', 'Ullr', 'Lua', 'Minerva']\r\n\r\n  subscriptions:\r\n    'tome:cast-spells': 'onTomeCast'\r\n    'tome:spell-debug-value-request': 'retrieveValueFromFrame'\r\n    'god:new-world-created': 'onNewWorldCreated'\r\n\r\n  constructor: (options) ->\r\n    options ?= {}\r\n    @retrieveValueFromFrame = _.throttle @retrieveValueFromFrame, 1000\r\n    @gameUIState ?= options.gameUIState or new GameUIState()\r\n    @indefiniteLength = options.indefiniteLength or false\r\n    super()\r\n\r\n    # Angels are all given access to this.\r\n    @angelsShare = {\r\n      workerCode: options.workerCode or '/javascripts/workers/worker_world.js'  # Either path or function\r\n      headless: options.headless  # Whether to just simulate the goals, or to deserialize all simulation results\r\n      spectate: options.spectate\r\n      god: @\r\n      godNick: @nick\r\n      @gameUIState\r\n      workQueue: []\r\n      firstWorld: true\r\n      world: undefined\r\n      goalManager: undefined\r\n      worldClassMap: undefined\r\n      angels: []\r\n      busyAngels: []  # Busy angels will automatically register here.\r\n    }\r\n\r\n    # Determine how many concurrent Angels/web workers to use at a time\r\n    # ~20MB per idle worker + angel overhead - every Angel maps to 1 worker\r\n    if options.maxAngels?\r\n      angelCount = options.maxAngels\r\n    else if window.application.isIPadApp\r\n      angelCount = 1\r\n    else\r\n      angelCount = 2\r\n\r\n    # Don't generate all Angels at once.\r\n    _.delay (=> new Angel @angelsShare unless @destroyed), 250 * i for i in [0 ... angelCount]\r\n\r\n  destroy: ->\r\n    angel.destroy() for angel in @angelsShare.angels.slice()\r\n    @angelsShare.goalManager?.destroy()\r\n    @debugWorker?.terminate()\r\n    @debugWorker?.removeEventListener 'message', @onDebugWorkerMessage\r\n    super()\r\n\r\n  setLevel: (@level) ->\r\n  setLevelSessionIDs: (@levelSessionIDs) ->\r\n  setGoalManager: (goalManager) ->\r\n    @angelsShare.goalManager?.destroy() unless @angelsShare.goalManager is goalManager\r\n    @angelsShare.goalManager = goalManager\r\n  setWorldClassMap: (worldClassMap) -> @angelsShare.worldClassMap = worldClassMap\r\n\r\n  onTomeCast: (e) ->\r\n    return unless e.god is @\r\n    @lastSubmissionCount = e.submissionCount\r\n    @lastFixedSeed = e.fixedSeed\r\n    @lastFlagHistory = (flag for flag in e.flagHistory when flag.source isnt 'code')\r\n    @lastDifficulty = e.difficulty\r\n    @createWorld e.spells, e.preload, e.realTime, e.justBegin\r\n\r\n  createWorld: (spells, preload, realTime, justBegin) ->\r\n    console.log \"#{@nick}: Let there be light upon #{@level.name}! (preload: #{preload})\"\r\n    userCodeMap = @getUserCodeMap spells\r\n\r\n    # We only want one world being simulated, so we abort other angels, unless we had one preloading this very code.\r\n    hadPreloader = false\r\n    for angel in @angelsShare.busyAngels\r\n      isPreloading = angel.running and angel.work.preload and _.isEqual angel.work.userCodeMap, userCodeMap, (a, b) ->\r\n        return a.raw is b.raw if a?.raw? and b?.raw?\r\n        undefined  # Let default equality test suffice.\r\n      if not hadPreloader and isPreloading and not realTime\r\n        angel.finalizePreload()\r\n        hadPreloader = true\r\n      else if preload and angel.running and not angel.work.preload\r\n        # It's still running for real, so let's not preload.\r\n        return\r\n      else\r\n        angel.abort()\r\n    return if hadPreloader\r\n\r\n    @angelsShare.workQueue = []\r\n    work = {\r\n      userCodeMap: userCodeMap\r\n      @level\r\n      levelSessionIDs: @levelSessionIDs\r\n      submissionCount: @lastSubmissionCount\r\n      fixedSeed: @lastFixedSeed\r\n      flagHistory: @lastFlagHistory\r\n      difficulty: @lastDifficulty\r\n      goals: @angelsShare.goalManager?.getGoals()\r\n      headless: @angelsShare.headless\r\n      preload\r\n      synchronous: not Worker?  # Profiling world simulation is easier on main thread, or we are IE9.\r\n      realTime\r\n      justBegin\r\n      indefiniteLength: @indefiniteLength and realTime\r\n    }\r\n    @angelsShare.workQueue.push work\r\n    angel.workIfIdle() for angel in @angelsShare.angels\r\n    work\r\n\r\n  getUserCodeMap: (spells) ->\r\n    userCodeMap = {}\r\n    for spellKey, spell of spells\r\n      (userCodeMap[spell.thang.thang.id] ?= {})[spell.name] = spell.thang.aether.serialize()\r\n    userCodeMap\r\n\r\n\r\n  #### New stuff related to debugging ####\r\n  retrieveValueFromFrame: (args) =>\r\n    return if @destroyed\r\n    return unless args.thangID and args.spellID and args.variableChain\r\n    return console.error 'Tried to retrieve debug value with no currentUserCodeMap' unless @currentUserCodeMap\r\n    @debugWorker ?= @createDebugWorker()\r\n    args.frame ?= @angelsShare.world.age / @angelsShare.world.dt\r\n    @debugWorker.postMessage\r\n      func: 'retrieveValueFromFrame'\r\n      args:\r\n        userCodeMap: @currentUserCodeMap\r\n        level: @level\r\n        levelSessionIDs: @levelSessionIDs\r\n        submissionCount: @lastSubmissionCount\r\n        fixedSeed: @fixedSeed\r\n        flagHistory: @lastFlagHistory\r\n        difficulty: @lastDifficulty\r\n        goals: @goalManager?.getGoals()\r\n        frame: args.frame\r\n        currentThangID: args.thangID\r\n        currentSpellID: args.spellID\r\n        variableChain: args.variableChain\r\n\r\n  createDebugWorker: ->\r\n    worker = new Worker '/javascripts/workers/worker_world.js'\r\n    worker.addEventListener 'message', @onDebugWorkerMessage\r\n    worker.addEventListener 'error', errors.onWorkerError\r\n    worker\r\n\r\n  onDebugWorkerMessage: (event) =>\r\n    switch event.data.type\r\n      when 'console-log'\r\n        console.log \"|#{@nick}'s debugger|\", event.data.args...\r\n      when 'debug-value-return'\r\n        Backbone.Mediator.publish 'god:debug-value-return', event.data.serialized, god: @\r\n      when 'debug-world-load-progress-changed'\r\n        Backbone.Mediator.publish 'god:debug-world-load-progress-changed', progress: event.data.progress, god: @\r\n\r\n  onNewWorldCreated: (e) ->\r\n    @currentUserCodeMap = @filterUserCodeMapWhenFromWorld e.world.userCodeMap\r\n\r\n  filterUserCodeMapWhenFromWorld: (worldUserCodeMap) ->\r\n    newUserCodeMap = {}\r\n    for thangName, thang of worldUserCodeMap\r\n      newUserCodeMap[thangName] = {}\r\n      for spellName, aether of thang\r\n        shallowFilteredObject = _.pick aether, ['raw', 'pure', 'originalOptions']\r\n        newUserCodeMap[thangName][spellName] = _.cloneDeep shallowFilteredObject\r\n        newUserCodeMap[thangName][spellName] = _.defaults newUserCodeMap[thangName][spellName],\r\n          flow: {}\r\n          metrics: {}\r\n          problems:\r\n            errors: []\r\n            infos: []\r\n            warnings: []\r\n          style: {}\r\n    newUserCodeMap\r\n\r\n\r\nimitateIE9 = false  # (and in world_utils.coffee)\r\nif imitateIE9\r\n  window.Worker = null\r\n  window.Float32Array = null\r\n  # Also uncomment vendor_with_box2d.js in index.html if you want Collision to run and Thangs to move.\r\n","# Convert htmlparser2-formatted DOM structure into Deku format\r\ndekuify = (elem) ->\r\n  return elem.data if elem.type is 'text'\r\n  return null if elem.type is 'comment'  # TODO: figure out how to make a comment in virtual dom\r\n  # Prevent Deku from including invalid attribute names (which DOMElement will choke on)\r\n  elem.attribs = _.omit elem.attribs, (val, attr) -> not attr.match(/^[^\\s\"'<>\\\\\\/=]+$/)\r\n  unless elem.name\r\n    console.log('Failed to dekuify', elem)\r\n    return elem.type\r\n  deku.element(elem.name, elem.attribs, (dekuify(c) for c in elem.children ? []))\r\n\r\n# Convert Deku-formatted DOM nodes into a flat list of their raw values\r\nunwrapDekuNodes = (dekuNode) ->\r\n  return dekuNode if _.isString(dekuNode)\r\n  if _.isArray(dekuNode)\r\n    return _.filter _.flatten(unwrapDekuNodes(child) for child in dekuNode)\r\n  else\r\n    return _.filter _.flatten [dekuNode.nodeValue, (unwrapDekuNodes(child) for child in (dekuNode.children or []))]\r\n\r\n# Parses user code into Deku format. Also guarantees an `html` and `body` element so that Deku doesn't explode when reading it.\r\n# Arguments:\r\n#   html — Raw HTML source code, possibly without html/body tags\r\n# Returns: Parsed Deku-format DOM that includes html/body tags\r\nparseUserHtml = (html) ->\r\n  dom = htmlparser2.parseDOM html, {}\r\n  bodyNode = _.find(dom, name: 'body') ? {name: 'body', attribs: null, children: dom}\r\n  htmlNode = _.find(dom, name: 'html') ? {name: 'html', attribs: null, children: [bodyNode]}\r\n  dekuify(htmlNode)\r\n\r\n# Creates a deku virtual DOM for given HTML, with the <script> and <style> tags separated out (and dekuified as well)\r\n# Arguments:\r\n#   html — raw HTML source code\r\n# Returns: Object\r\n#   virtualDom: The DekuTree for the main content\r\n#   scripts: A list of Deku nodes for the <script> tags\r\n#   styles: A list of Deku nodes for the <style> tags\r\nextractStylesAndScripts = (html) ->\r\n  dekuTree = parseUserHtml(html)\r\n  recurse = (dekuTree) ->\r\n    #base case\r\n    if dekuTree.type is '#text'\r\n      return { virtualDom: dekuTree, styles: [], scripts: [] }\r\n    if dekuTree.type is 'style'\r\n      return { styles: [dekuTree], scripts: [] }\r\n    if dekuTree.type is 'script'\r\n      return { styles: [], scripts: [dekuTree] }\r\n    # recurse over children\r\n    childStyles = []\r\n    childScripts = []\r\n    dekuTree.children?.forEach (dekuChild, index) =>\r\n      { virtualDom, styles, scripts } = recurse(dekuChild)\r\n      dekuTree.children[index] = virtualDom\r\n      childStyles = childStyles.concat(styles)\r\n      childScripts = childScripts.concat(scripts)\r\n    dekuTree.children = _.filter dekuTree.children # Remove the nodes we extracted\r\n    return { virtualDom: dekuTree, scripts: childScripts, styles: childStyles }\r\n\r\n  { virtualDom, scripts, styles } = recurse(dekuTree)\r\n  wrappedStyles = deku.element('head', {}, styles)\r\n  wrappedScripts = deku.element('head', {}, scripts)\r\n  return { virtualDom, scripts: wrappedScripts, styles: wrappedStyles }\r\n\r\n# Returns a list of CSS selectors found in CSS code and jQuery calls\r\nextractCssSelectors = (dekuStyles, dekuScripts) ->\r\n  cssSelectors = extractSelectorsFromCss dekuStyles\r\n  jQuerySelectors = extractSelectorsFromJS dekuScripts\r\n  return cssSelectors.concat(jQuerySelectors)\r\n\r\n# Returns a list of CSS selectors found in jQuery calls\r\n# Arguments:\r\n#   styles — one (or a list of) strings or Deku nodes.\r\nextractSelectorsFromCss = (styles) ->\r\n  styles = unwrapDekuNodes(styles)\r\n  styles = [styles] unless _.isArray(styles)\r\n  cssSelectors = _.flatten styles.map (rawCss) ->\r\n    try\r\n      parsedCss = parseCss(rawCss) # TODO: Don't put this in the global namespace\r\n      parsedCss.stylesheet.rules.map (rule) ->\r\n        rule.selectors.join(', ').trim()\r\n    catch e\r\n      # TODO: Report this error, handle CSS errors in general\r\n      []\r\n  cssSelectors\r\n\r\n# Returns a list of CSS selector strings found in jQuery calls\r\n# Arguments:\r\n#   scripts — one (or a list of) strings or Deku nodes.\r\nextractSelectorsFromJS = (scripts) ->\r\n  scripts = unwrapDekuNodes(scripts)\r\n  scripts = [scripts] unless _.isArray(scripts)\r\n  jQuerySelectors = _.flatten scripts.map (script) ->\r\n    (script.match(/\\$\\(\\s*['\"](?!<)(.*?)(?!>)['\"]\\s*\\)/g) or []).map (jQueryCall) ->\r\n      # Extract the argument (because capture groups don't work with /g)\r\n      jQueryCall.match(/\\$\\(\\s*['\"](?!<)(.*?)(?!>)['\"]\\s*\\)/)[1]\r\n  jQuerySelectors\r\n\r\n# Converts deku style nodes into a list of lines of CSS code.\r\n# Used to prefilter hovered lines for selectors.\r\nextractCssLines = (dekuStyles) ->\r\n  rawCssLines = []\r\n  dekuStyles.children.forEach (styleNode) =>\r\n    rawCss = styleNode.children[0].nodeValue\r\n    rawCssLines = rawCssLines.concat(rawCss.split('\\n'))\r\n  rawCssLines\r\n\r\n# Converts deku script nodes into a list of lines of lines of code that contain jQuery selectors\r\n# Used to prefilter hovered lines for selectors.\r\nextractJQueryLines = (dekuScripts) ->\r\n  _.flatten dekuScripts.children.map (dekuScript) ->\r\n    rawScript = dekuScript.children[0].nodeValue\r\n    _.filter (rawScript.split('\\n').map (line) -> (line.match(/^.*\\$\\(\\s*['\"].*['\"]\\s*\\).*$/g) or [])[0])\r\n\r\nmodule.exports = {\r\n  dekuify\r\n  unwrapDekuNodes\r\n  parseUserHtml\r\n  extractStylesAndScripts\r\n  extractCssSelectors\r\n  extractSelectorsFromCss\r\n  extractSelectorsFromJS\r\n  extractCssLines\r\n  extractJQueryLines\r\n}\r\n","Bus = require './Bus'\r\n{me} = require 'core/auth'\r\nLevelSession = require 'models/LevelSession'\r\nutils = require 'core/utils'\r\n\r\nmodule.exports = class LevelBus extends Bus\r\n\r\n  @get: (levelID, sessionID) ->\r\n    docName = \"play/level/#{levelID}/#{sessionID}\"\r\n    return Bus.getFromCache(docName) or new LevelBus docName\r\n\r\n  subscriptions:\r\n    'tome:editing-began': 'onEditingBegan'\r\n    'tome:editing-ended': 'onEditingEnded'\r\n    'script:state-changed': 'onScriptStateChanged'\r\n    'script:ended': 'onScriptEnded'\r\n    'script:reset': 'onScriptReset'\r\n    'surface:sprite-selected': 'onSpriteSelected'\r\n    'level:show-victory': 'onVictory'\r\n    'tome:spell-changed': 'onSpellChanged'\r\n    'tome:spell-created': 'onSpellCreated'\r\n    'tome:cast-spells': 'onCastSpells'\r\n    'tome:winnability-updated': 'onWinnabilityUpdated'\r\n    'application:idle-changed': 'onIdleChanged'\r\n    'goal-manager:new-goal-states': 'onNewGoalStates'\r\n    'god:new-world-created': 'onNewWorldCreated'\r\n\r\n  constructor: ->\r\n    super(arguments...)\r\n    @changedSessionProperties = {}\r\n    saveDelay = window.serverConfig?.sessionSaveDelay\r\n    [wait, maxWait] = switch\r\n      when not application.isProduction or not saveDelay then [1, 5]  # Save quickly in development.\r\n      when me.isAnonymous() then [saveDelay.anonymous.min, saveDelay.anonymous.max]\r\n      else [saveDelay.registered.min, saveDelay.registered.max]\r\n    @saveSession = _.debounce @reallySaveSession, wait * 1000, {maxWait: maxWait * 1000}\r\n    @playerIsIdle = false\r\n\r\n  init: ->\r\n    super()\r\n    @fireScriptsRef = @fireRef?.child('scripts')\r\n\r\n  setSession: (@session) ->\r\n    @timerIntervalID = setInterval(@incrementSessionPlaytime, 1000)\r\n\r\n  onIdleChanged: (e) ->\r\n    @playerIsIdle = e.idle\r\n\r\n  incrementSessionPlaytime: =>\r\n    if @playerIsIdle then return\r\n    @changedSessionProperties.playtime = true\r\n    @session.set('playtime', (@session.get('playtime') ? 0) + 1)\r\n\r\n  onPoint: ->\r\n    return true\r\n\r\n  onMeSynced: =>\r\n    super()\r\n\r\n  join: ->\r\n    super()\r\n\r\n  disconnect: ->\r\n    @fireScriptsRef?.off()\r\n    @fireScriptsRef = null\r\n    super()\r\n\r\n  removeFirebaseData: (callback) ->\r\n    return callback?() unless @myConnection\r\n    @myConnection.child('connected')\r\n    @fireRef.remove()\r\n    @onDisconnect.cancel(-> callback?())\r\n\r\n  # UPDATING FIREBASE AND SESSION\r\n\r\n  onEditingBegan: -> #@wizardRef?.child('editing').set(true)  # no more wizards\r\n  onEditingEnded: -> #@wizardRef?.child('editing').set(false)  # no more wizards\r\n\r\n  # HACK: Backbone does not work with nested documents, but we want to\r\n  #   patch only those props that have changed. Look into plugins to\r\n  #   give Backbone support for nested docs and update the code here.\r\n\r\n  # TODO: The LevelBus doesn't need to be in charge of updating the\r\n  #   LevelSession object. Either break this off into a separate class\r\n  #   or have the LevelSession object listen for all these events itself.\r\n\r\n  setSpells: (spells) ->\r\n    @onSpellCreated spell: spell for spellKey, spell of spells\r\n\r\n  onSpellChanged: (e) ->\r\n    return unless @onPoint()\r\n    code = @session.get('code')\r\n    code ?= {}\r\n    parts = e.spell.spellKey.split('/')\r\n\r\n    code[parts[0]] ?= {}\r\n    code[parts[0]][parts[1]] = e.spell.getSource()\r\n    @changedSessionProperties.code = true\r\n    @session.set({'code': code})\r\n    @saveSession()\r\n\r\n  onSpellCreated: (e) ->\r\n    return unless @onPoint()\r\n    spellTeam = e.spell.team\r\n    @teamSpellMap ?= {}\r\n    @teamSpellMap[spellTeam] ?= []\r\n\r\n    unless e.spell.spellKey in @teamSpellMap[spellTeam]\r\n      @teamSpellMap[spellTeam].push e.spell.spellKey\r\n    @changedSessionProperties.teamSpells = true\r\n    @session.set({'teamSpells': @teamSpellMap})\r\n    @saveSession()\r\n    if spellTeam is me.team or (e.spell.otherSession and spellTeam isnt e.spell.otherSession.get('team'))\r\n      # https://github.com/codecombat/codecombat/issues/81\r\n      @onSpellChanged e  # Save the new spell to the session, too.\r\n\r\n  onCastSpells: (e) ->\r\n    return unless @onPoint() and e.realTime\r\n    # We have incremented state.submissionCount and reset state.flagHistory.\r\n    @changedSessionProperties.state = true\r\n    @saveSession()\r\n\r\n  onWinnabilityUpdated: (e) ->\r\n    return unless @onPoint() and e.winnable\r\n    return unless e.level.get('slug') in ['ace-of-coders', 'elemental-wars', 'the-battle-of-sky-span']  # Mirror matches don't otherwise show victory, so we win here.\r\n    return if @session.get('state')?.complete\r\n    @onVictory()\r\n\r\n  onNewWorldCreated: (e) ->\r\n    return unless @onPoint()\r\n    # Record the flag history.\r\n    state = @session.get('state')\r\n    flagHistory = (flag for flag in e.world.flagHistory when flag.source isnt 'code')\r\n    return if _.isEqual state.flagHistory, flagHistory\r\n    state.flagHistory = flagHistory\r\n    @changedSessionProperties.state = true\r\n    @session.set('state', state)\r\n    @saveSession()\r\n\r\n  onScriptStateChanged: (e) ->\r\n    return unless @onPoint()\r\n    @fireScriptsRef?.update(e)\r\n    state = @session.get('state')\r\n    scripts = state.scripts ? {}\r\n    scripts.currentScript = e.currentScript\r\n    scripts.currentScriptOffset = e.currentScriptOffset\r\n    @changedSessionProperties.state = true\r\n    @session.set('state', state)\r\n    @saveSession()\r\n\r\n  onScriptEnded: (e) ->\r\n    return unless @onPoint()\r\n    state = @session.get('state')\r\n    scripts = state.scripts\r\n    scripts.ended ?= {}\r\n    return if scripts.ended[e.scriptID]?\r\n    index = _.keys(scripts.ended).length + 1\r\n    @fireScriptsRef?.child('ended').child(e.scriptID).set(index)\r\n    scripts.ended[e.scriptID] = index\r\n    @session.set('state', state)\r\n    @changedSessionProperties.state = true\r\n    @saveSession()\r\n\r\n  onScriptReset: ->\r\n    return unless @onPoint()\r\n    @fireScriptsRef?.set({})\r\n    state = @session.get('state')\r\n    state.scripts = {}\r\n    #state.complete = false  # Keep it complete once ever completed.\r\n    @session.set('state', state)\r\n    @changedSessionProperties.state = true\r\n    @saveSession()\r\n\r\n  onSpriteSelected: (e) ->\r\n    return unless @onPoint()\r\n    state = @session.get('state')\r\n    state.selected = e.thang?.id or null\r\n    @session.set('state', state)\r\n    @changedSessionProperties.state = true\r\n    @saveSession()\r\n\r\n  onVictory: ->\r\n    return unless @onPoint()\r\n    state = @session.get('state')\r\n    state.complete = true\r\n    @session.set('state', state)\r\n    @changedSessionProperties.state = true\r\n    @reallySaveSession()  # Make sure it saves right away; don't debounce it.\r\n\r\n  onNewGoalStates: (e) ->\r\n    # TODO: this log doesn't capture when null-status goals are being set during world streaming. Where can they be coming from?\r\n    goalStates = e.goalStates\r\n    return console.error(\"Somehow trying to save null goal states!\", newGoalStates) if _.find(newGoalStates, (gs) -> not gs.status)\r\n\r\n    return unless e.overallStatus is 'success'\r\n    newGoalStates = goalStates\r\n    state = @session.get('state')\r\n    oldGoalStates = state.goalStates or {}\r\n\r\n    changed = false\r\n    for goalKey, goalState of newGoalStates\r\n      continue if oldGoalStates[goalKey]?.status is 'success' and goalState.status isnt 'success' # don't undo success, this property is for keying off achievements\r\n      continue if utils.kindaEqual state.goalStates?[goalKey], goalState # Only save when goals really change\r\n      changed = true\r\n      oldGoalStates[goalKey] = _.cloneDeep newGoalStates[goalKey]\r\n\r\n    if changed\r\n      state.goalStates = oldGoalStates\r\n      @session.set 'state', state\r\n      @changedSessionProperties.state = true\r\n      @saveSession()\r\n\r\n  onPlayerJoined: (snapshot) =>\r\n    super(arguments...)\r\n    return unless @onPoint()\r\n    players = @session.get('players')\r\n    players ?= {}\r\n    player = snapshot.val()\r\n    return if players[player.id]?\r\n    players[player.id] = {}\r\n    @session.set('players', players)\r\n    @changedSessionProperties.players = true\r\n    @saveSession()\r\n\r\n  onChatAdded: (snapshot) =>\r\n    super(arguments...)\r\n    chat = @session.get('chat')\r\n    chat ?= []\r\n    message = snapshot.val()\r\n    return if message.system\r\n    chat.push(message)\r\n    chat = chat[chat.length-50...] if chat.length > 50\r\n    @session.set('chat', chat)\r\n    @changedSessionProperties.chat = true\r\n    @saveSession()\r\n\r\n  # Debounced as saveSession\r\n  reallySaveSession: ->\r\n    return if _.isEmpty @changedSessionProperties\r\n    # don't let peeking admins mess with the session accidentally\r\n    return unless @session.get('creator') is me.id\r\n    return if @session.fake\r\n    Backbone.Mediator.publish 'level:session-will-save', session: @session\r\n    patch = {}\r\n    patch[prop] = @session.get(prop) for prop of @changedSessionProperties\r\n    @changedSessionProperties = {}\r\n\r\n    # since updates are coming fast and loose for session objects\r\n    # don't let what the server returns overwrite changes since the save began\r\n    tempSession = new LevelSession _id: @session.id\r\n    tempSession.save(patch, {patch: true, type: 'PUT'})\r\n\r\n  destroy: ->\r\n    clearInterval(@timerIntervalID)\r\n    super()\r\n","Level = require 'models/Level'\r\nLevelComponent = require 'models/LevelComponent'\r\nLevelSystem = require 'models/LevelSystem'\r\nArticle = require 'models/Article'\r\nLevelSession = require 'models/LevelSession'\r\nThangType = require 'models/ThangType'\r\nThangNamesCollection = require 'collections/ThangNamesCollection'\r\n\r\nCocoClass = require 'core/CocoClass'\r\nAudioPlayer = require 'lib/AudioPlayer'\r\napp = require 'core/application'\r\nWorld = require 'lib/world/world'\r\nutils = require 'core/utils'\r\n\r\nLOG = me.get('name') is 'Shanakin'  # Debugging a hanging load issue in production\r\n\r\n# This is an initial stab at unifying loading and setup into a single place which can\r\n# monitor everything and keep a LoadingScreen visible overall progress.\r\n#\r\n# Would also like to incorporate into here:\r\n#  * World Building\r\n#  * Sprite map generation\r\n#  * Connecting to Firebase\r\n\r\n# LevelLoader depends on SuperModel retrying timed out requests, as these occasionally happen during play.\r\n# If LevelLoader ever moves away from SuperModel, it will have to manage its own retries.\r\n\r\nreportedLoadErrorAlready = false\r\n\r\nmodule.exports = class LevelLoader extends CocoClass\r\n\r\n  constructor: (options) ->\r\n    @t0 = new Date().getTime()\r\n    super()\r\n    @supermodel = options.supermodel\r\n    @supermodel.setMaxProgress 0.2\r\n    @levelID = options.levelID\r\n    @sessionID = options.sessionID\r\n    @opponentSessionID = options.opponentSessionID\r\n    @team = options.team\r\n    @headless = options.headless\r\n    @loadArticles = options.loadArticles\r\n    @sessionless = options.sessionless\r\n    @fakeSessionConfig = options.fakeSessionConfig\r\n    @spectateMode = options.spectateMode ? false\r\n    @observing = options.observing\r\n    @courseID = options.courseID\r\n    @courseInstanceID = options.courseInstanceID\r\n\r\n    @worldNecessities = []\r\n    @listenTo @supermodel, 'resource-loaded', @onWorldNecessityLoaded\r\n    @listenTo @supermodel, 'failed', @onWorldNecessityLoadFailed\r\n    @loadLevel()\r\n    @loadAudio()\r\n    @playJingle()\r\n    if @supermodel.finished()\r\n      @onSupermodelLoaded()\r\n    else\r\n      @loadTimeoutID = setTimeout @reportLoadError.bind(@), 30000\r\n      @listenToOnce @supermodel, 'loaded-all', @onSupermodelLoaded\r\n\r\n  # Supermodel (Level) Loading\r\n\r\n  loadWorldNecessities: ->\r\n    # TODO: Actually trigger loading, instead of in the constructor\r\n    new Promise((resolve, reject) =>\r\n      return resolve(@) if @world\r\n      @once 'world-necessities-loaded', => resolve(@)\r\n      @once 'world-necessity-load-failed', ({resource}) ->\r\n        { jqxhr } = resource\r\n        reject({message: jqxhr.responseJSON?.message or jqxhr.responseText or 'Unknown Error'})\r\n    )\r\n\r\n  loadLevel: ->\r\n    @level = @supermodel.getModel(Level, @levelID) or new Level _id: @levelID\r\n    if @level.loaded\r\n      @onLevelLoaded()\r\n    else\r\n      @level = @supermodel.loadModel(@level, 'level').model\r\n      @listenToOnce @level, 'sync', @onLevelLoaded\r\n\r\n  reportLoadError: ->\r\n    return if @destroyed\r\n    window.tracker?.trackEvent 'LevelLoadError',\r\n      category: 'Error',\r\n      levelSlug: @work?.level?.slug,\r\n      unloaded: JSON.stringify(@supermodel.report().map (m) -> _.result(m.model, 'url'))\r\n\r\n  onLevelLoaded: ->\r\n    if not @sessionless and @level.isType('hero', 'hero-ladder', 'hero-coop', 'course')\r\n      @sessionDependenciesRegistered = {}\r\n    if @level.isType('web-dev')\r\n      @headless = true\r\n      if @sessionless\r\n        # When loading a web-dev level in the level editor, pretend it's a normal hero level so we can put down our placeholder Thang.\r\n        # TODO: avoid this whole roundabout Thang-based way of doing web-dev levels\r\n        originalGet = @level.get\r\n        @level.get = ->\r\n          return 'hero' if arguments[0] is 'type'\r\n          return 'web-dev' if arguments[0] is 'realType'\r\n          originalGet.apply @, arguments\r\n    if (@courseID and not @level.isType('course', 'course-ladder', 'game-dev', 'web-dev')) or window.serverConfig.picoCTF\r\n      # Because we now use original hero levels for both hero and course levels, we fake being a course level in this context.\r\n      originalGet = @level.get\r\n      realType = @level.get('type')\r\n      @level.get = ->\r\n        return 'course' if arguments[0] is 'type'\r\n        return realType if arguments[0] is 'realType'\r\n        originalGet.apply @, arguments\r\n    if window.serverConfig.picoCTF\r\n      @supermodel.addRequestResource(url: '/picoctf/problems', success: (picoCTFProblems) =>\r\n        @level?.picoCTFProblem = _.find picoCTFProblems, pid: @level.get('picoCTFProblem')\r\n      ).load()\r\n    if @sessionless\r\n      null\r\n    else if @fakeSessionConfig?\r\n      @loadFakeSession()\r\n    else\r\n      @loadSession()\r\n    @populateLevel()\r\n\r\n  # Session Loading\r\n\r\n  loadFakeSession: ->\r\n    initVals =\r\n      level:\r\n        original: @level.get('original')\r\n        majorVersion: @level.get('version').major\r\n      creator: me.id\r\n      state:\r\n        complete: false\r\n        scripts: {}\r\n      permissions: [\r\n        {target: me.id, access: 'owner'}\r\n        {target: 'public', access: 'write'}\r\n      ]\r\n      codeLanguage: @fakeSessionConfig.codeLanguage or me.get('aceConfig')?.language or 'python'\r\n      _id: 'A Fake Session ID'\r\n    @session = new LevelSession initVals\r\n    @session.loaded = true\r\n    @fakeSessionConfig.callback? @session, @level\r\n\r\n    # TODO: set the team if we need to, for multiplayer\r\n    # TODO: just finish the part where we make the submit button do what is right when we are fake\r\n    # TODO: anything else to make teacher session-less play make sense when we are fake\r\n    # TODO: make sure we are not actually calling extra save/patch/put things throwing warnings because we know we are fake and so we shouldn't try to do that\r\n    for method in ['save', 'patch', 'put']\r\n      @session[method] = -> console.error \"We shouldn't be doing a session.#{method}, since it's a fake session.\"\r\n    @session.fake = true\r\n    @loadDependenciesForSession @session\r\n\r\n  loadSession: ->\r\n    if @sessionID\r\n      url = \"/db/level.session/#{@sessionID}\"\r\n      url += \"?interpret=true\" if @spectateMode\r\n    else\r\n      url = \"/db/level/#{@levelID}/session\"\r\n      if @team\r\n        url += \"?team=#{@team}\"\r\n      else if @courseID\r\n        url += \"?course=#{@courseID}\"\r\n        if @courseInstanceID\r\n          url += \"&courseInstance=#{@courseInstanceID}\"\r\n\r\n    session = new LevelSession().setURL url\r\n    if @headless and not @level.isType('web-dev')\r\n      session.project = ['creator', 'team', 'heroConfig', 'codeLanguage', 'submittedCodeLanguage', 'state', 'submittedCode', 'submitted']\r\n    @sessionResource = @supermodel.loadModel(session, 'level_session', {cache: false})\r\n    @session = @sessionResource.model\r\n    if @opponentSessionID\r\n      opponentURL = \"/db/level.session/#{@opponentSessionID}?interpret=true\"\r\n      opponentSession = new LevelSession().setURL opponentURL\r\n      opponentSession.project = session.project if @headless\r\n      @opponentSessionResource = @supermodel.loadModel(opponentSession, 'opponent_session', {cache: false})\r\n      @opponentSession = @opponentSessionResource.model\r\n\r\n    if @session.loaded\r\n      @session.setURL '/db/level.session/' + @session.id\r\n      @loadDependenciesForSession @session\r\n    else\r\n      @listenToOnce @session, 'sync', ->\r\n        @session.setURL '/db/level.session/' + @session.id\r\n        @loadDependenciesForSession @session\r\n    if @opponentSession\r\n      if @opponentSession.loaded\r\n        @loadDependenciesForSession @opponentSession\r\n      else\r\n        @listenToOnce @opponentSession, 'sync', @loadDependenciesForSession\r\n\r\n  loadDependenciesForSession: (session) ->\r\n    console.log \"Loading dependencies for session: \", session if LOG\r\n    if me.id isnt session.get 'creator'\r\n      session.patch = session.save = -> console.error \"Not saving session, since we didn't create it.\"\r\n    else if codeLanguage = utils.getQueryVariable 'codeLanguage'\r\n      session.set 'codeLanguage', codeLanguage\r\n    @loadCodeLanguagesForSession session\r\n    if compressed = session.get 'interpret'\r\n      uncompressed = LZString.decompressFromUTF16 compressed\r\n      code = session.get 'code'\r\n      code[if session.get('team') is 'humans' then 'hero-placeholder' else 'hero-placeholder-1'].plan = uncompressed\r\n      session.set 'code', code\r\n      session.unset 'interpret'\r\n    if session.get('codeLanguage') in ['io', 'clojure']\r\n      session.set 'codeLanguage', 'python'\r\n    if session is @session\r\n      @addSessionBrowserInfo session\r\n      # hero-ladder games require the correct session team in level:loaded\r\n      team = @team ? @session.get('team')\r\n      Backbone.Mediator.publish 'level:loaded', level: @level, team: team\r\n      Backbone.Mediator.publish 'level:session-loaded', level: @level, session: @session\r\n      @consolidateFlagHistory() if @opponentSession?.loaded\r\n    else if session is @opponentSession\r\n      @consolidateFlagHistory() if @session.loaded\r\n    if @level.isType('course')  # course-ladder is hard to handle because there's 2 sessions\r\n      heroThangType = me.get('heroConfig')?.thangType or ThangType.heroes.captain\r\n      console.log \"Course mode, loading custom hero: \", heroThangType if LOG\r\n      url = \"/db/thang.type/#{heroThangType}/version\"\r\n      if heroResource = @maybeLoadURL(url, ThangType, 'thang')\r\n        console.log \"Pushing resource: \", heroResource if LOG\r\n        @worldNecessities.push heroResource\r\n      @sessionDependenciesRegistered[session.id] = true\r\n    unless @level.isType('hero', 'hero-ladder', 'hero-coop')\r\n      # Return before loading heroConfig ThangTypes. Finish if all world necessities were completed by the time the session loaded.\r\n      if @checkAllWorldNecessitiesRegisteredAndLoaded()\r\n        @onWorldNecessitiesLoaded()\r\n      return\r\n    # Load the ThangTypes needed for the session's heroConfig for these types of levels\r\n    heroConfig = session.get('heroConfig')\r\n    heroConfig ?= me.get('heroConfig') if session is @session and not @headless\r\n    heroConfig ?= {}\r\n    heroConfig.inventory ?= feet: '53e237bf53457600003e3f05'  # If all else fails, assign simple boots.\r\n    heroConfig.thangType ?= '529ffbf1cf1818f2be000001'  # If all else fails, assign Tharin as the hero.\r\n    session.set 'heroConfig', heroConfig unless _.isEqual heroConfig, session.get('heroConfig')\r\n    url = \"/db/thang.type/#{heroConfig.thangType}/version\"\r\n    if heroResource = @maybeLoadURL(url, ThangType, 'thang')\r\n      @worldNecessities.push heroResource\r\n    else\r\n      heroThangType = @supermodel.getModel url\r\n      @loadDefaultComponentsForThangType heroThangType\r\n      @loadThangsRequiredByThangType heroThangType\r\n\r\n    for itemThangType in _.values(heroConfig.inventory)\r\n      url = \"/db/thang.type/#{itemThangType}/version?project=name,components,original,rasterIcon,kind\"\r\n      if itemResource = @maybeLoadURL(url, ThangType, 'thang')\r\n        @worldNecessities.push itemResource\r\n      else\r\n        itemThangType = @supermodel.getModel url\r\n        @loadDefaultComponentsForThangType itemThangType\r\n        @loadThangsRequiredByThangType itemThangType\r\n    @sessionDependenciesRegistered[session.id] = true\r\n    if _.size(@sessionDependenciesRegistered) is 2 and @checkAllWorldNecessitiesRegisteredAndLoaded()\r\n      @onWorldNecessitiesLoaded()\r\n\r\n  loadCodeLanguagesForSession: (session) ->\r\n    codeLanguages = _.uniq _.filter [session.get('codeLanguage') or 'python', session.get('submittedCodeLanguage')]\r\n    for codeLanguage in codeLanguages\r\n      continue if codeLanguage in ['clojure', 'io']\r\n      do (codeLanguage) =>\r\n        modulePath = \"vendor/aether-#{codeLanguage}\"\r\n        return unless application.moduleLoader?.load modulePath\r\n        languageModuleResource = @supermodel.addSomethingResource 'language_module'\r\n        onModuleLoaded = (e) ->\r\n          return unless e.id is modulePath\r\n          languageModuleResource.markLoaded()\r\n          @stopListening application.moduleLoader, 'loaded', onModuleLoaded  # listenToOnce might work here instead, haven't tried\r\n        @listenTo application.moduleLoader, 'loaded', onModuleLoaded\r\n\r\n  addSessionBrowserInfo: (session) ->\r\n    return unless me.id is session.get 'creator'\r\n    return unless $.browser?\r\n    browser = {}\r\n    browser['desktop'] = $.browser.desktop if $.browser.desktop\r\n    browser['name'] = $.browser.name if $.browser.name\r\n    browser['platform'] = $.browser.platform if $.browser.platform\r\n    browser['version'] = $.browser.version if $.browser.version\r\n    session.set 'browser', browser\r\n    session.patch() unless session.fake\r\n\r\n  consolidateFlagHistory: ->\r\n    state = @session.get('state') ? {}\r\n    myFlagHistory = _.filter state.flagHistory ? [], team: @session.get('team')\r\n    opponentFlagHistory = _.filter @opponentSession.get('state')?.flagHistory ? [], team: @opponentSession.get('team')\r\n    state.flagHistory = myFlagHistory.concat opponentFlagHistory\r\n    @session.set 'state', state\r\n\r\n  # Grabbing the rest of the required data for the level\r\n\r\n  populateLevel: ->\r\n    thangIDs = []\r\n    componentVersions = []\r\n    systemVersions = []\r\n    articleVersions = []\r\n\r\n    flagThang = thangType: '53fa25f25bc220000052c2be', id: 'Placeholder Flag', components: []\r\n    for thang in (@level.get('thangs') or []).concat [flagThang]\r\n      thangIDs.push thang.thangType\r\n      @loadThangsRequiredByLevelThang(thang)\r\n      for comp in thang.components or []\r\n        componentVersions.push _.pick(comp, ['original', 'majorVersion'])\r\n\r\n    for system in @level.get('systems') or []\r\n      systemVersions.push _.pick(system, ['original', 'majorVersion'])\r\n      if indieSprites = system?.config?.indieSprites\r\n        for indieSprite in indieSprites\r\n          thangIDs.push indieSprite.thangType\r\n\r\n    unless @headless and not @loadArticles\r\n      for article in @level.get('documentation')?.generalArticles or []\r\n        articleVersions.push _.pick(article, ['original', 'majorVersion'])\r\n\r\n    objUniq = (array) -> _.uniq array, false, (arg) -> JSON.stringify(arg)\r\n\r\n    worldNecessities = []\r\n\r\n    @thangIDs = _.uniq thangIDs\r\n    @thangNames = new ThangNamesCollection(@thangIDs)\r\n    worldNecessities.push @supermodel.loadCollection(@thangNames, 'thang_names')\r\n    @listenToOnce @thangNames, 'sync', @onThangNamesLoaded\r\n    worldNecessities.push @sessionResource if @sessionResource?.isLoading\r\n    worldNecessities.push @opponentSessionResource if @opponentSessionResource?.isLoading\r\n\r\n    for obj in objUniq componentVersions\r\n      url = \"/db/level.component/#{obj.original}/version/#{obj.majorVersion}\"\r\n      worldNecessities.push @maybeLoadURL(url, LevelComponent, 'component')\r\n    for obj in objUniq systemVersions\r\n      url = \"/db/level.system/#{obj.original}/version/#{obj.majorVersion}\"\r\n      worldNecessities.push @maybeLoadURL(url, LevelSystem, 'system')\r\n    for obj in objUniq articleVersions\r\n      url = \"/db/article/#{obj.original}/version/#{obj.majorVersion}\"\r\n      @maybeLoadURL url, Article, 'article'\r\n    if obj = @level.get 'nextLevel'  # TODO: update to get next level from campaigns, not this old property\r\n      url = \"/db/level/#{obj.original}/version/#{obj.majorVersion}\"\r\n      @maybeLoadURL url, Level, 'level'\r\n\r\n    @worldNecessities = @worldNecessities.concat worldNecessities\r\n\r\n  loadThangsRequiredByLevelThang: (levelThang) ->\r\n    @loadThangsRequiredFromComponentList levelThang.components\r\n\r\n  loadThangsRequiredByThangType: (thangType) ->\r\n    @loadThangsRequiredFromComponentList thangType.get('components')\r\n\r\n  loadThangsRequiredFromComponentList: (components) ->\r\n    return unless components\r\n    requiredThangTypes = []\r\n    for component in components when component.config\r\n      if component.original is LevelComponent.EquipsID\r\n        requiredThangTypes.push itemThangType for itemThangType in _.values (component.config.inventory ? {})\r\n      else if component.config.requiredThangTypes\r\n        requiredThangTypes = requiredThangTypes.concat component.config.requiredThangTypes\r\n    extantRequiredThangTypes = _.filter requiredThangTypes\r\n    if extantRequiredThangTypes.length < requiredThangTypes.length\r\n      console.error \"Some Thang had a blank required ThangType in components list:\", components\r\n    for thangType in extantRequiredThangTypes\r\n      url = \"/db/thang.type/#{thangType}/version?project=name,components,original,rasterIcon,kind,prerenderedSpriteSheetData\"\r\n      @worldNecessities.push @maybeLoadURL(url, ThangType, 'thang')\r\n\r\n  onThangNamesLoaded: (thangNames) ->\r\n    for thangType in thangNames.models\r\n      @loadDefaultComponentsForThangType(thangType)\r\n      @loadThangsRequiredByThangType(thangType)\r\n    @thangNamesLoaded = true\r\n    @onWorldNecessitiesLoaded() if @checkAllWorldNecessitiesRegisteredAndLoaded()\r\n\r\n  loadDefaultComponentsForThangType: (thangType) ->\r\n    return unless components = thangType.get('components')\r\n    for component in components\r\n      url = \"/db/level.component/#{component.original}/version/#{component.majorVersion}\"\r\n      @worldNecessities.push @maybeLoadURL(url, LevelComponent, 'component')\r\n\r\n  onWorldNecessityLoaded: (resource) ->\r\n    index = @worldNecessities.indexOf(resource)\r\n    if resource.name is 'thang'\r\n      @loadDefaultComponentsForThangType(resource.model)\r\n      @loadThangsRequiredByThangType(resource.model)\r\n\r\n    return unless index >= 0\r\n    @worldNecessities.splice(index, 1)\r\n    @worldNecessities = (r for r in @worldNecessities when r?)\r\n    @onWorldNecessitiesLoaded() if @checkAllWorldNecessitiesRegisteredAndLoaded()\r\n\r\n  onWorldNecessityLoadFailed: (event) ->\r\n    @reportLoadError()\r\n    @trigger('world-necessity-load-failed', event)\r\n\r\n  checkAllWorldNecessitiesRegisteredAndLoaded: ->\r\n    return false unless _.filter(@worldNecessities).length is 0\r\n    return false unless @thangNamesLoaded\r\n    return false if @sessionDependenciesRegistered and not @sessionDependenciesRegistered[@session.id] and not @sessionless\r\n    return false if @sessionDependenciesRegistered and @opponentSession and not @sessionDependenciesRegistered[@opponentSession.id] and not @sessionless\r\n    return false unless @session?.loaded or @sessionless\r\n    true\r\n\r\n  onWorldNecessitiesLoaded: ->\r\n    console.log \"World necessities loaded.\" if LOG\r\n    return if @initialized\r\n    @initialized = true\r\n    @initWorld()\r\n    @supermodel.clearMaxProgress()\r\n    @trigger 'world-necessities-loaded'\r\n    return if @headless\r\n    thangsToLoad = _.uniq( (t.spriteName for t in @world.thangs when t.exists) )\r\n    nameModelTuples = ([thangType.get('name'), thangType] for thangType in @thangNames.models)\r\n    nameModelMap = _.zipObject nameModelTuples\r\n    @spriteSheetsToBuild ?= []\r\n\r\n#    for thangTypeName in thangsToLoad\r\n#      thangType = nameModelMap[thangTypeName]\r\n#      continue if not thangType or thangType.isFullyLoaded()\r\n#      thangType.fetch()\r\n#      thangType = @supermodel.loadModel(thangType, 'thang').model\r\n#      res = @supermodel.addSomethingResource 'sprite_sheet', 5\r\n#      res.thangType = thangType\r\n#      res.markLoading()\r\n#      @spriteSheetsToBuild.push res\r\n\r\n    @buildLoopInterval = setInterval @buildLoop, 5 if @spriteSheetsToBuild.length\r\n\r\n  maybeLoadURL: (url, Model, resourceName) ->\r\n    return if @supermodel.getModel(url)\r\n    model = new Model().setURL url\r\n    @supermodel.loadModel(model, resourceName)\r\n\r\n  onSupermodelLoaded: ->\r\n    clearTimeout @loadTimeoutID\r\n    return if @destroyed\r\n    console.log 'SuperModel for Level loaded in', new Date().getTime() - @t0, 'ms' if LOG\r\n    @loadLevelSounds()\r\n    @denormalizeSession()\r\n\r\n  buildLoop: =>\r\n    someLeft = false\r\n    for spriteSheetResource, i in @spriteSheetsToBuild ? []\r\n      continue if spriteSheetResource.spriteSheetKeys\r\n      someLeft = true\r\n      thangType = spriteSheetResource.thangType\r\n      if thangType.loaded and not thangType.loading\r\n        keys = @buildSpriteSheetsForThangType spriteSheetResource.thangType\r\n        if keys and keys.length\r\n          @listenTo spriteSheetResource.thangType, 'build-complete', @onBuildComplete\r\n          spriteSheetResource.spriteSheetKeys = keys\r\n        else\r\n          spriteSheetResource.markLoaded()\r\n\r\n    clearInterval @buildLoopInterval unless someLeft\r\n\r\n  onBuildComplete: (e) ->\r\n    resource = null\r\n    for resource in @spriteSheetsToBuild\r\n      break if e.thangType is resource.thangType\r\n    return console.error 'Did not find spriteSheetToBuildResource for', e unless resource\r\n    resource.spriteSheetKeys = (k for k in resource.spriteSheetKeys when k isnt e.key)\r\n    resource.markLoaded() if resource.spriteSheetKeys.length is 0\r\n\r\n  denormalizeSession: ->\r\n    return if @sessionDenormalized or @spectateMode or @sessionless or me.isSessionless()\r\n    return if @headless and not @level.isType('web-dev')\r\n    # This is a way (the way?) PUT /db/level.sessions/undefined was happening\r\n    # See commit c242317d9\r\n    return if not @session.id\r\n    patch =\r\n      'levelName': @level.get('name')\r\n      'levelID': @level.get('slug') or @level.id\r\n    if me.id is @session.get 'creator'\r\n      patch.creatorName = me.get('name')\r\n    for key, value of patch\r\n      if @session.get(key) is value\r\n        delete patch[key]\r\n    unless _.isEmpty patch\r\n      @session.set key, value for key, value of patch\r\n      tempSession = new LevelSession _id: @session.id\r\n      tempSession.save(patch, {patch: true, type: 'PUT'})\r\n    @sessionDenormalized = true\r\n\r\n  # Building sprite sheets\r\n\r\n  buildSpriteSheetsForThangType: (thangType) ->\r\n    return if @headless\r\n    # TODO: Finish making sure the supermodel loads the raster image before triggering load complete, and that the cocosprite has access to the asset.\r\n#    if f = thangType.get('raster')\r\n#      queue = new createjs.LoadQueue()\r\n#      queue.loadFile('/file/'+f)\r\n    @grabThangTypeTeams() unless @thangTypeTeams\r\n    keys = []\r\n    for team in @thangTypeTeams[thangType.get('original')] ? [null]\r\n      spriteOptions = {resolutionFactor: SPRITE_RESOLUTION_FACTOR, async: true}\r\n      if thangType.get('kind') is 'Floor'\r\n        spriteOptions.resolutionFactor = 2\r\n      if team and color = @teamConfigs[team]?.color\r\n        spriteOptions.colorConfig = team: color\r\n      key = @buildSpriteSheet thangType, spriteOptions\r\n      if _.isString(key) then keys.push key\r\n    keys\r\n\r\n  grabThangTypeTeams: ->\r\n    @grabTeamConfigs()\r\n    @thangTypeTeams = {}\r\n    for thang in @level.get('thangs')\r\n      if @level.isType('hero', 'course') and thang.id is 'Hero Placeholder'\r\n        continue  # No team colors for heroes on single-player levels\r\n      for component in thang.components\r\n        if team = component.config?.team\r\n          @thangTypeTeams[thang.thangType] ?= []\r\n          @thangTypeTeams[thang.thangType].push team unless team in @thangTypeTeams[thang.thangType]\r\n          break\r\n    @thangTypeTeams\r\n\r\n  grabTeamConfigs: ->\r\n    for system in @level.get('systems')\r\n      if @teamConfigs = system.config?.teamConfigs\r\n        break\r\n    unless @teamConfigs\r\n      # Hack: pulled from Alliance System code. TODO: put in just one place.\r\n      @teamConfigs = {'humans': {'superteam': 'humans', 'color': {'hue': 0, 'saturation': 0.75, 'lightness': 0.5}, 'playable': true}, 'ogres': {'superteam': 'ogres', 'color': {'hue': 0.66, 'saturation': 0.75, 'lightness': 0.5}, 'playable': false}, 'neutral': {'superteam': 'neutral', 'color': {'hue': 0.33, 'saturation': 0.75, 'lightness': 0.5}}}\r\n    @teamConfigs\r\n\r\n  buildSpriteSheet: (thangType, options) ->\r\n    if thangType.get('name') is 'Wizard'\r\n      options.colorConfig = me.get('wizard')?.colorConfig or {}\r\n    thangType.buildSpriteSheet options\r\n\r\n  # World init\r\n\r\n  initWorld: ->\r\n    return if @level.isType('web-dev')\r\n    @world = new World()\r\n    @world.levelSessionIDs = if @opponentSessionID then [@sessionID, @opponentSessionID] else [@sessionID]\r\n    @world.submissionCount = @session?.get('state')?.submissionCount ? 0\r\n    @world.flagHistory = @session?.get('state')?.flagHistory ? []\r\n    @world.difficulty = @session?.get('state')?.difficulty ? 0\r\n    if @observing\r\n      @world.difficulty = Math.max 0, @world.difficulty - 1  # Show the difficulty they won, not the next one.\r\n    serializedLevel = @level.serialize {@supermodel, @session, @opponentSession, @headless, @sessionless}\r\n    @world.loadFromLevel serializedLevel, false\r\n    console.log 'World has been initialized from level loader.' if LOG\r\n\r\n  # Initial Sound Loading\r\n\r\n  playJingle: ->\r\n    return if @headless or not me.get('volume')\r\n    volume = 0.5\r\n    if me.level() < 3\r\n      volume = 0.25  # Start softly, since they may not be expecting it\r\n    # Apparently the jingle, when it tries to play immediately during all this loading, you can't hear it.\r\n    # Add the timeout to fix this weird behavior.\r\n    f = ->\r\n      jingles = ['ident_1', 'ident_2']\r\n      AudioPlayer.playInterfaceSound jingles[Math.floor Math.random() * jingles.length], volume\r\n    setTimeout f, 500\r\n\r\n  loadAudio: ->\r\n    return if @headless or not me.get('volume')\r\n    AudioPlayer.preloadInterfaceSounds ['victory']\r\n\r\n  loadLevelSounds: ->\r\n    return if @headless or not me.get('volume')\r\n    scripts = @level.get 'scripts'\r\n    return unless scripts\r\n\r\n    for script in scripts when script.noteChain\r\n      for noteGroup in script.noteChain when noteGroup.sprites\r\n        for sprite in noteGroup.sprites when sprite.say?.sound\r\n          AudioPlayer.preloadSoundReference(sprite.say.sound)\r\n\r\n    thangTypes = @supermodel.getModels(ThangType)\r\n    for thangType in thangTypes\r\n      for trigger, sounds of thangType.get('soundTriggers') or {} when trigger isnt 'say'\r\n        AudioPlayer.preloadSoundReference sound for sound in sounds\r\n\r\n  # everything else sound wise is loaded as needed as worlds are generated\r\n\r\n  progress: -> @supermodel.progress\r\n\r\n  destroy: ->\r\n    clearInterval @buildLoopInterval if @buildLoopInterval\r\n    super()\r\n","CocoClass = require 'core/CocoClass'\r\nPlayHeroesModal = require 'views/play/modal/PlayHeroesModal'\r\nInventoryModal = require 'views/play/menu/InventoryModal'\r\nLevel = require 'models/Level'\r\nLevelSession = require 'models/LevelSession'\r\nSuperModel = require 'models/SuperModel'\r\nThangType = require 'models/ThangType'\r\n\r\nlastHeroesEarned = me.get('earned')?.heroes ? []\r\nlastHeroesPurchased = me.get('purchased')?.heroes ? []\r\n\r\nmodule.exports = class LevelSetupManager extends CocoClass\r\n\r\n  constructor: (@options) ->\r\n    super()\r\n    @supermodel = @options.supermodel ? new SuperModel()\r\n    @session = @options.session\r\n    unless @level = @options.level\r\n      @loadLevel()\r\n    if @session\r\n      @fillSessionWithDefaults()\r\n    else\r\n      @loadSession()\r\n\r\n  loadLevel: ->\r\n    levelURL = \"/db/level/#{@options.levelID}\"\r\n    @level = new Level().setURL levelURL\r\n    @level = @supermodel.loadModel(@level).model\r\n    if @level.loaded then @onLevelSync() else @listenToOnce @level, 'sync', @onLevelSync\r\n\r\n  loadSession: ->\r\n    sessionURL = \"/db/level/#{@options.levelID}/session\"\r\n    #sessionURL += \"?team=#{@team}\" if @options.team  # TODO: figure out how to get the teams for multiplayer PVP hero style\r\n    sessionURL += \"?course=#{@options.courseID}\" if @options.courseID\r\n    @session = new LevelSession().setURL sessionURL\r\n    @session = @supermodel.loadModel(@session).model\r\n    if @session.loaded then @onSessionSync() else @listenToOnce @session, 'sync', @onSessionSync\r\n\r\n  onLevelSync: ->\r\n    return if @destroyed\r\n    if @waitingToLoadModals\r\n      @waitingToLoadModals = false\r\n      @loadModals()\r\n\r\n  onSessionSync: ->\r\n    return if @destroyed\r\n    @session.url = -> '/db/level.session/' + @id\r\n    @fillSessionWithDefaults()\r\n\r\n  fillSessionWithDefaults: ->\r\n    heroConfig = _.merge {}, me.get('heroConfig'), @session.get('heroConfig')\r\n    @session.set('heroConfig', heroConfig)\r\n    if @level.loaded\r\n      @loadModals()\r\n    else\r\n      @waitingToLoadModals = true\r\n\r\n  loadModals: ->\r\n    # build modals and prevent them from disappearing.\r\n    if @level.get('slug') is 'zero-sum'\r\n      sorcerer = '52fd1524c7e6cf99160e7bc9'\r\n      if @session.get('creator') is '532dbc73a622924444b68ed9'  # Wizard Dude gets his own avatar\r\n        sorcerer = '53e126a4e06b897606d38bef'\r\n      @session.set 'heroConfig', {\"thangType\":sorcerer,\"inventory\":{\"misc-0\":\"53e2396a53457600003e3f0f\",\"programming-book\":\"546e266e9df4a17d0d449be5\",\"minion\":\"54eb5dbc49fa2d5c905ddf56\",\"feet\":\"53e214f153457600003e3eab\",\"right-hand\":\"54eab7f52b7506e891ca7202\",\"left-hand\":\"5463758f3839c6e02811d30f\",\"wrists\":\"54693797a2b1f53ce79443e9\",\"gloves\":\"5469425ca2b1f53ce7944421\",\"torso\":\"546d4a549df4a17d0d449a97\",\"neck\":\"54693274a2b1f53ce79443c9\",\"eyes\":\"546941fda2b1f53ce794441d\",\"head\":\"546d4ca19df4a17d0d449abf\"}}\r\n      @onInventoryModalPlayClicked()\r\n      return\r\n    # TODO: Remove post-KR\r\n    if @level.get('slug') is 'the-gauntlet-kr'\r\n      lightseeker = '583d2cca6ffa3e65d170f29f'\r\n      @session.set 'heroConfig', {\"thangType\":lightseeker,\"inventory\":{\r\n        \"feet\":\"53e237bf53457600003e3f05\",\r\n        \"head\":\"546d38269df4a17d0d4499ff\",\r\n        \"eyes\":\"53e238df53457600003e3f0b\",\r\n        \"torso\":\"53e22eac53457600003e3efc\",\r\n        \"right-hand\":\"53e218d853457600003e3ebe\",\r\n        \"programming-book\":\"53e4108204c00d4607a89f78\"\r\n      }}\r\n      @onInventoryModalPlayClicked()\r\n      return\r\n    if @level.get('slug') is 'woodland-cleaver-kr'\r\n      lightseeker = '583d2cca6ffa3e65d170f29f'\r\n      @session.set 'heroConfig', {\"thangType\":lightseeker,\"inventory\":{\r\n        \"eyes\": \"53e238df53457600003e3f0b\",\r\n        \"head\": \"546d38269df4a17d0d4499ff\",\r\n        \"torso\": \"545d3f0b2d03e700001b5a5d\",\r\n        \"right-hand\": \"544d7d1f8494308424f564a3\",\r\n        \"wrists\": \"53e2396a53457600003e3f0f\",\r\n        \"feet\": \"53e2384453457600003e3f07\",\r\n        \"programming-book\": \"546e25d99df4a17d0d449be1\",\r\n        \"left-hand\": \"544c310ae0017993fce214bf\"\r\n      }}\r\n      @onInventoryModalPlayClicked()\r\n      return\r\n    if @level.get('slug') is 'crossroads-kr'\r\n      lightseeker = '583d2cca6ffa3e65d170f29f'\r\n      @session.set 'heroConfig', {\"thangType\":lightseeker,\"inventory\":{\r\n        \"wrists\": \"53e2396a53457600003e3f0f\",\r\n        \"eyes\": \"53e2167653457600003e3eb3\",\r\n        \"feet\": \"546d4d589df4a17d0d449ac9\",\r\n        \"left-hand\": \"544d7bb88494308424f56493\",\r\n        \"right-hand\": \"54694ba3a2b1f53ce794444d\",\r\n        \"waist\": \"5437002a7beba4a82024a97d\",\r\n        \"programming-book\": \"546e25d99df4a17d0d449be1\",\r\n        \"gloves\": \"5469425ca2b1f53ce7944421\",\r\n        \"head\": \"546d390b9df4a17d0d449a0b\",\r\n        \"torso\": \"546aaf1b3777d6186329285e\",\r\n        \"neck\": \"54693140a2b1f53ce79443bc\"\r\n        }\r\n      }\r\n      @onInventoryModalPlayClicked()\r\n      return\r\n\r\n    if @level.get('slug') in ['ace-of-coders', 'elemental-wars']\r\n      goliath = '55e1a6e876cb0948c96af9f8'\r\n      @session.set 'heroConfig', {\"thangType\":goliath,\"inventory\":{\"eyes\":\"53eb99f41a100989a40ce46e\",\"neck\":\"54693274a2b1f53ce79443c9\",\"wrists\":\"54693797a2b1f53ce79443e9\",\"feet\":\"546d4d8e9df4a17d0d449acd\",\"minion\":\"54eb5bf649fa2d5c905ddf4a\",\"programming-book\":\"557871261ff17fef5abee3ee\"}}\r\n      @onInventoryModalPlayClicked()\r\n      return\r\n    if @level.get('slug') is 'the-battle-of-sky-span'\r\n      wizard = '52fc1460b2b91c0d5a7b6af3'\r\n      @session.set 'heroConfig', {\r\n        \"thangType\": wizard\r\n        \"inventory\":{\r\n          \"eyes\": \"546941fda2b1f53ce794441d\",\r\n          \"feet\": \"546d4d8e9df4a17d0d449acd\",\r\n          \"torso\": \"546d4a549df4a17d0d449a97\",\r\n          \"head\": \"546d4ca19df4a17d0d449abf\",\r\n          \"minion\": \"54eb5d1649fa2d5c905ddf52\",\r\n          \"neck\": \"54693240a2b1f53ce79443c5\",\r\n          \"wrists\": \"54693830a2b1f53ce79443f1\",\r\n          \"programming-book\": \"557871261ff17fef5abee3ee\",\r\n          \"left-ring\": \"54692d2aa2b1f53ce794438f\"\r\n        }\r\n      }\r\n      @onInventoryModalPlayClicked()\r\n      return\r\n    if @level.get('slug') is 'assembly-speed'\r\n      raider = '55527eb0b8abf4ba1fe9a107'\r\n      @session.set 'heroConfig', {\"thangType\":raider,\"inventory\":{}}\r\n      @onInventoryModalPlayClicked()\r\n      return\r\n    if @level.isType('course', 'course-ladder', 'game-dev', 'web-dev') or window.serverConfig.picoCTF\r\n      @onInventoryModalPlayClicked()\r\n      return\r\n    @heroesModal = new PlayHeroesModal({supermodel: @supermodel, session: @session, confirmButtonI18N: 'play.next', level: @level, hadEverChosenHero: @options.hadEverChosenHero})\r\n    @inventoryModal = new InventoryModal({supermodel: @supermodel, session: @session, level: @level})\r\n    @heroesModalDestroy = @heroesModal.destroy\r\n    @inventoryModalDestroy = @inventoryModal.destroy\r\n    @heroesModal.destroy = @inventoryModal.destroy = _.noop\r\n    @listenTo @heroesModal, 'confirm-click', @onHeroesModalConfirmClicked\r\n    @listenToOnce @heroesModal, 'hero-loaded', @onceHeroLoaded\r\n    @listenTo @inventoryModal, 'choose-hero-click', @onChooseHeroClicked\r\n    @listenTo @inventoryModal, 'play-click', @onInventoryModalPlayClicked\r\n    @modalsLoaded = true\r\n    if @waitingToOpen\r\n      @waitingToOpen = false\r\n      @open()\r\n\r\n  open: ->\r\n    return @waitingToOpen = true unless @modalsLoaded\r\n    firstModal = if @options.hadEverChosenHero then @inventoryModal else @heroesModal\r\n    if (not _.isEqual(lastHeroesEarned, me.get('earned')?.heroes ? []) or\r\n        not _.isEqual(lastHeroesPurchased, me.get('purchased')?.heroes ? []))\r\n      console.log 'Showing hero picker because heroes earned/purchased has changed.'\r\n      firstModal = @heroesModal\r\n    else if allowedHeroSlugs = @level.get 'allowedHeroes'\r\n      unless _.find(allowedHeroSlugs, (slug) -> ThangType.heroes[slug] is me.get('heroConfig')?.thangType)\r\n        firstModal = @heroesModal\r\n    lastHeroesEarned = me.get('earned')?.heroes ? []\r\n    lastHeroesPurchased = me.get('purchased')?.heroes ? []\r\n\r\n    @options.parent.openModalView(firstModal)\r\n    @trigger 'open'\r\n    #    @inventoryModal.onShown() # replace?\r\n\r\n  #- Modal events\r\n\r\n  onceHeroLoaded: (e) ->\r\n    @inventoryModal.setHero(e.hero) if window.currentModal is @inventoryModal\r\n\r\n  onHeroesModalConfirmClicked: (e) ->\r\n    @options.parent.openModalView(@inventoryModal)\r\n    @inventoryModal.render()\r\n    @inventoryModal.didReappear()\r\n    @inventoryModal.onShown()\r\n    @inventoryModal.setHero(e.hero) if e.hero\r\n    window.tracker?.trackEvent 'Choose Inventory', category: 'Play Level'\r\n\r\n  onChooseHeroClicked: ->\r\n    @options.parent.openModalView(@heroesModal)\r\n    @heroesModal.render()\r\n    @heroesModal.didReappear()\r\n    @inventoryModal.endHighlight()\r\n    window.tracker?.trackEvent 'Change Hero', category: 'Play Level'\r\n\r\n  onInventoryModalPlayClicked: ->\r\n    @navigatingToPlay = true\r\n    PlayLevelView = 'views/play/level/PlayLevelView'\r\n    LadderView = 'views/ladder/LadderView'\r\n    viewClass = if @options.levelPath is 'ladder' then LadderView else PlayLevelView\r\n    route = \"/play/#{@options.levelPath || 'level'}/#{@options.levelID}\"\r\n    route += \"?codeLanguage=\" + @level.get('primerLanguage') if @level.get('primerLanguage')\r\n    Backbone.Mediator.publish 'router:navigate', {\r\n      route, viewClass\r\n      viewArgs: [{supermodel: @supermodel}, @options.levelID]\r\n    }\r\n\r\n  destroy: ->\r\n    @heroesModalDestroy?.call @heroesModal unless @heroesModal?.destroyed\r\n    @inventoryModalDestroy?.call @inventoryModal unless @inventoryModal?.destroyed\r\n    super()\r\n","LocalMongo = module.exports\r\n\r\n# Checks whether func(l, r) is true for at least one value of left for at least one value of right\r\nmapred = (left, right, func) ->\r\n  _.reduce(left, ((result, singleLeft) ->\r\n    result or (_.reduce (_.map right, (singleRight) -> func(singleLeft, singleRight)),\r\n      ((intermediate, value) -> intermediate or value), false)), false)\r\n\r\ndoQuerySelector = (originalValue, operatorObj) ->\r\n  value = if _.isArray originalValue then originalValue else [originalValue] # left hand can be an array too\r\n  for operator, originalBody of operatorObj\r\n    body = if _.isArray originalBody then originalBody else [originalBody] # right hand can be an array too\r\n    switch operator\r\n      when '$gt' then return false unless mapred value, body, (l, r) -> l > r\r\n      when '$gte' then return false unless mapred value, body, (l, r) -> l >= r\r\n      when '$lt' then return false unless mapred value, body, (l, r) -> l < r\r\n      when '$lte' then return false unless mapred value, body, (l, r) -> l <= r\r\n      when '$ne' then return false if mapred value, body, (l, r) -> l == r\r\n      when '$in' then return false unless _.reduce value, ((result, val) -> result or val in body), false\r\n      when '$nin' then return false if _.reduce value, ((result, val) -> result or val in body), false\r\n      when '$exists' then return false if value[0]? isnt body[0]\r\n      else \r\n        trimmedOperator = _.pick(operatorObj, operator)\r\n        return false unless _.isObject(originalValue) and matchesQuery(originalValue, trimmedOperator)\r\n  true\r\n\r\nmatchesQuery = (target, queryObj) ->\r\n  return true unless queryObj\r\n  throw new Error 'Expected an object to match a query against, instead got null' unless target\r\n  for prop, query of queryObj\r\n    if prop[0] == '$'\r\n      switch prop\r\n        when '$or' then return false unless _.reduce query, ((res, obj) -> res or matchesQuery target, obj), false\r\n        when '$and' then return false unless _.reduce query, ((res, obj) -> res and matchesQuery target, obj), true\r\n        else return false\r\n    else\r\n      # Do nested properties\r\n      pieces = prop.split('.')\r\n      obj = target\r\n      for piece in pieces\r\n        unless piece of obj\r\n          obj = null\r\n          break\r\n        obj = obj[piece]\r\n      if typeof query != 'object' or _.isArray query\r\n        return false unless obj == query or (query in obj if _.isArray obj)\r\n      else return false unless doQuerySelector obj, query\r\n  true\r\n\r\nLocalMongo.matchesQuery = matchesQuery\r\n","concepts = require 'schemas/concepts'\r\n\r\nmodule.exports = TagSolution = (solution) ->\r\n  code = solution.source\r\n  engine = new esper.Engine()\r\n  engine.load(code)\r\n  ast = engine.evaluator.ast\r\n  result = []\r\n  for key of concepts\r\n    tkn = concepts[key].tagger\r\n    continue unless tkn\r\n    if typeof tkn is 'function'\r\n      result.push concepts[key].concept if tkn(ast)\r\n    else\r\n      result.push concepts[key].concept if ast.find(tkn).length > 0\r\n   \r\n  console.log result\r\n  result\r\n","require 'aether'\r\nrequire 'esper'\r\n\r\nutils = require 'core/utils'\r\n\r\nAether.addGlobal 'Vector', require './world/vector'\r\nAether.addGlobal '_', _\r\n\r\nmodule.exports.createAetherOptions = (options) ->\r\n  throw new Error 'Specify a function name to create an Aether instance' unless options.functionName\r\n  throw new Error 'Specify a code language to create an Aether instance' unless options.codeLanguage\r\n\r\n  aetherOptions =\r\n    functionName: options.functionName\r\n    protectAPI: not options.skipProtectAPI\r\n    includeFlow: Boolean options.includeFlow\r\n    noVariablesInFlow: true\r\n    skipDuplicateUserInfoInFlow: true  # Optimization that won't work if we are stepping with frames\r\n    yieldConditionally: options.functionName is 'plan'\r\n    simpleLoops: true\r\n    whileTrueAutoYield: true\r\n    globals: ['Vector', '_']\r\n    problems:\r\n      jshint_W040: {level: 'ignore'}\r\n      jshint_W030: {level: 'ignore'}  # aether_NoEffect instead\r\n      jshint_W038: {level: 'ignore'}  # eliminates hoisting problems\r\n      jshint_W091: {level: 'ignore'}  # eliminates more hoisting problems\r\n      jshint_E043: {level: 'ignore'}  # https://github.com/codecombat/codecombat/issues/813 -- since we can't actually tell JSHint to really ignore things\r\n      jshint_Unknown: {level: 'ignore'}  # E043 also triggers Unknown, so ignore that, too\r\n      aether_MissingThis: {level: 'error'}\r\n    problemContext: options.problemContext\r\n    #functionParameters: # TODOOOOO\r\n    executionLimit: 3 * 1000 * 1000\r\n    language: options.codeLanguage\r\n    useInterpreter: true\r\n  parameters = functionParameters[options.functionName]\r\n  unless parameters\r\n    console.warn \"Unknown method #{options.functionName}: please add function parameters to lib/aether_utils.coffee.\"\r\n    parameters = []\r\n  if options.functionParameters and not _.isEqual options.functionParameters, parameters\r\n    console.error \"Update lib/aether_utils.coffee with the right function parameters for #{options.functionName} (had: #{parameters} but this gave #{options.functionParameters}.\"\r\n    parameters = options.functionParameters\r\n  aetherOptions.functionParameters = parameters.slice()\r\n  #console.log 'creating aether with options', aetherOptions\r\n  return aetherOptions\r\n\r\n# TODO: figure out some way of saving this info dynamically so that we don't have to hard-code it: #1329\r\nfunctionParameters =\r\n  hear: ['speaker', 'message', 'data']\r\n  makeBid: ['tileGroupLetter']\r\n  findCentroids: ['centroids']\r\n  isFriend: ['name']\r\n  evaluateBoard: ['board', 'player']\r\n  getPossibleMoves: ['board']\r\n  minimax_alphaBeta: ['board', 'player', 'depth', 'alpha', 'beta']\r\n  distanceTo: ['target']\r\n\r\n  chooseAction: []\r\n  plan: []\r\n  initializeCentroids: []\r\n  update: []\r\n  getNearestEnemy: []\r\n  die: []\r\n","Levels = require 'collections/Levels'\r\n\r\nmodule.exports =\r\n  # Result: Each course instance gains a property, numCompleted, that is the\r\n  #   number of students in that course instance who have completed ALL of\r\n  #   the levels in thate course\r\n  # TODO: simplify, classroom.sessions only includes sessions for assigned courses now\r\n  calculateDots: (classrooms, courses, courseInstances) ->\r\n    for classroom in classrooms.models\r\n      # map [user, level] => session so we don't have to do find TODO\r\n      for course, courseIndex in courses.models\r\n        instance = courseInstances.findWhere({ courseID: course.id, classroomID: classroom.id })\r\n        continue if not instance\r\n        instance.numCompleted = 0\r\n        instance.started = false\r\n        levels = classroom.getLevels({courseID: course.id})\r\n        levels.remove(levels.filter((level) => level.get('practice')))\r\n        for userID in instance.get('members')\r\n          instance.started ||= _.any levels.models, (level) ->\r\n            session = _.find classroom.sessions.models, (session) ->\r\n              session.get('creator') is userID and session.get('level').original is level.get('original')\r\n            session?\r\n          levelCompletes = _.map levels.models, (level) ->\r\n            #TODO: Hella slow! Do the mapping first!\r\n            sessions = _.filter classroom.sessions.models, (session) ->\r\n              session.get('creator') is userID and session.get('level').original is level.get('original')\r\n            # sessionMap[userID][level].completed()\r\n            _.find(sessions, (s) -> s.completed())\r\n          if _.every levelCompletes\r\n            instance.numCompleted += 1\r\n\r\n  calculateEarliestIncomplete: (classroom, courses, courseInstances, students) ->\r\n    # Loop through all the combinations of things, return the first one that somebody hasn't finished\r\n    for course, courseIndex in courses.models\r\n      instance = courseInstances.findWhere({ courseID: course.id, classroomID: classroom.id })\r\n      continue if not instance\r\n      levels = classroom.getLevels({courseID: course.id})\r\n      for level, levelIndex in levels.models\r\n        userIDs = []\r\n        for user in students.models\r\n          userID = user.id\r\n          sessions = _.filter classroom.sessions.models, (session) ->\r\n            session.get('creator') is userID and session.get('level').original is level.get('original')\r\n          if not _.find(sessions, (s) -> s.completed())\r\n            userIDs.push userID\r\n        if userIDs.length > 0\r\n          users = _.map userIDs, (id) ->\r\n            students.get(id)\r\n          levelNumber = classroom.getLevelNumber(level.get('original'), levelIndex + 1)\r\n          return {\r\n            courseName: course.get('name')\r\n            courseNumber: courseIndex + 1\r\n            levelNumber\r\n            levelName: level.get('name')\r\n            users: users\r\n          }\r\n    null\r\n\r\n  calculateLatestComplete: (classroom, courses, courseInstances, students) ->\r\n    # Loop through all the combinations of things in reverse order, return the level that anyone's finished\r\n    courseModels = courses.models.slice()\r\n    for course, courseIndex in courseModels.reverse() #\r\n      courseIndex = courses.models.length - courseIndex - 1 #compensate for reverse\r\n      instance = courseInstances.findWhere({ courseID: course.id, classroomID: classroom.id })\r\n      continue if not instance\r\n      levels = classroom.getLevels({courseID: course.id})\r\n      levelModels = levels.models.slice()\r\n      for level, levelIndex in levelModels.reverse() #\r\n        levelIndex = levelModels.length - levelIndex - 1 #compensate for reverse\r\n        userIDs = []\r\n        for user in students.models\r\n          userID = user.id\r\n          sessions = _.filter classroom.sessions.models, (session) ->\r\n            session.get('creator') is userID and session.get('level').original is level.get('original')\r\n          if _.find(sessions, (s) -> s.completed()) #\r\n            userIDs.push userID\r\n        if userIDs.length > 0\r\n          users = _.map userIDs, (id) ->\r\n            students.get(id)\r\n          levelNumber = classroom.getLevelNumber(level.get('original'), levelIndex + 1)\r\n          return {\r\n            courseName: course.get('name')\r\n            courseNumber: courseIndex + 1\r\n            levelNumber\r\n            levelName: level.get('name')\r\n            users: users\r\n          }\r\n    null\r\n    \r\n  calculateConceptsCovered: (classrooms, courses, campaigns, courseInstances, students) ->\r\n    # Loop through all level/user combination and record\r\n    #   whether they've started, and completed, each concept\r\n    conceptData = {}\r\n    for classroom in classrooms.models\r\n      conceptData[classroom.id] = {}\r\n      \r\n      for course, courseIndex in courses.models\r\n        levels = classroom.getLevels({courseID: course.id})\r\n        \r\n        for level in levels.models\r\n          levelID = level.get('original')\r\n          \r\n          for concept in level.get('concepts')\r\n            unless conceptData[classroom.id][concept]\r\n              conceptData[classroom.id][concept] = { completed: true, started: false }\r\n\r\n          for concept in level.get('concepts')\r\n            for userID in classroom.get('members')\r\n              sessions = _.filter classroom.sessions.models, (session) ->\r\n                session.get('creator') is userID and session.get('level').original is levelID\r\n              \r\n              if _.size(sessions) is 0 # haven't gotten to this level yet, but might have completed others before\r\n                for concept in level.get('concepts')\r\n                  conceptData[classroom.id][concept].completed = false\r\n              if _.size(sessions) > 0 # have gotten to the level and at least started it\r\n                for concept in level.get('concepts')\r\n                  conceptData[classroom.id][concept].started = true\r\n              if not _.find(sessions, (s) -> s.completed()) # level started but not completed\r\n                for concept in level.get('concepts')\r\n                  conceptData[classroom.id][concept].completed = false\r\n    conceptData\r\n      \r\n  calculateAllProgress: (classrooms, courses, courseInstances, students) ->\r\n    # Loop through all combinations and record:\r\n    #   Completeness for each student/course\r\n    #   Completeness for each student/level\r\n    #   Completeness for each class/course (across all students)\r\n    #   Completeness for each class/level (across all students)\r\n    \r\n    # class -> course\r\n    #   class -> course -> student\r\n    #   class -> course -> level\r\n    #     class -> course -> level -> student\r\n    \r\n    progressData = {}\r\n    for classroom in classrooms.models\r\n      progressData[classroom.id] = {}\r\n\r\n      for course, courseIndex in courses.models\r\n        instance = courseInstances.findWhere({ courseID: course.id, classroomID: classroom.id })\r\n        if not instance\r\n          progressData[classroom.id][course.id] = { completed: false, started: false }\r\n          continue\r\n        progressData[classroom.id][course.id] = { completed: true, started: false } # to be updated\r\n\r\n        levels = classroom.getLevels({courseID: course.id})\r\n        for level in levels.models\r\n          levelID = level.get('original')\r\n          progressData[classroom.id][course.id][levelID] = {\r\n            completed: students.size() > 0,\r\n            started: false\r\n            numStarted: 0\r\n            # numCompleted: 0\r\n          }\r\n          isPractice = level.get('practice')\r\n\r\n          for user in students.models\r\n            userID = user.id\r\n            courseProgress = progressData[classroom.id][course.id]\r\n            courseProgress[userID] ?= { completed: true, started: false, levelsCompleted: 0 } # Only set it the first time through a user\r\n            courseProgress[levelID][userID] = { completed: true, started: false } # These don't matter, will always be set\r\n            sessions = _.filter classroom.sessions.models, (session) ->\r\n              session.get('creator') is userID and session.get('level').original is levelID\r\n            \r\n            courseProgress[levelID][userID].session = _.find(sessions, (s) -> s.completed()) or _.first(sessions)\r\n\r\n            if _.size(sessions) is 0 # haven't gotten to this level yet, but might have completed others before\r\n              courseProgress.started ||= false unless isPractice #no-op\r\n              courseProgress.completed = false unless isPractice\r\n              courseProgress[userID].started ||= false unless isPractice #no-op\r\n              courseProgress[userID].completed = false unless isPractice\r\n              courseProgress[levelID].started ||= false #no-op\r\n              courseProgress[levelID].completed = false unless isPractice \r\n              courseProgress[levelID][userID].started = false\r\n              courseProgress[levelID][userID].completed = false\r\n              \r\n            if _.size(sessions) > 0 # have gotten to the level and at least started it\r\n              courseProgress.started = true unless isPractice\r\n              courseProgress[userID].started = true unless isPractice\r\n              courseProgress[levelID].started = true\r\n              courseProgress[levelID][userID].started = true\r\n              courseProgress[levelID][userID].lastPlayed = new Date(Math.max(_.map(sessions, 'changed')))\r\n              courseProgress[levelID].numStarted += 1\r\n            \r\n            if _.find(sessions, (s) -> s.completed()) # have finished this level\r\n              courseProgress.completed &&= true unless isPractice #no-op\r\n              courseProgress[userID].completed &&= true unless isPractice #no-op\r\n              courseProgress[userID].levelsCompleted += 1 unless isPractice\r\n              courseProgress[levelID].completed &&= true #no-op\r\n              # courseProgress[levelID].numCompleted += 1\r\n              courseProgress[levelID][userID].completed = true\r\n              dates = (s.get('dateFirstCompleted') || s.get('changed') for s in sessions)\r\n              courseProgress[levelID][userID].dateFirstCompleted = new Date(Math.max(dates...))\r\n            else # level started but not completed\r\n              courseProgress.completed = false unless isPractice\r\n              courseProgress[userID].completed = false unless isPractice\r\n              if isPractice\r\n                # Weird behavior! Since practice levels are optional, the level is considered 'incomplete'\r\n                # for the class as a whole only if any started-but-not-completed sessions exist\r\n                courseProgress[levelID].completed = false if courseProgress[levelID][userID].started\r\n              else\r\n                courseProgress[levelID].completed = false\r\n              courseProgress[levelID][userID].completed = false\r\n              courseProgress[levelID].dateFirstCompleted = null\r\n              courseProgress[levelID][userID].dateFirstCompleted = null\r\n              \r\n          if isPractice and courseProgress and not courseProgress[levelID].started\r\n            courseProgress[levelID].completed = false # edge for practice levels, not considered complete if never started either\r\n\r\n    _.assign(progressData, progressMixin)\r\n    return progressData\r\n  \r\n  courseLabelsArray: (courses) ->\r\n    labels = []\r\n    courseLabelIndexes = CS: 0, GD: 0, WD: 0\r\n    for course in courses\r\n      acronym = switch\r\n        when /game-dev/.test(course.get('slug')) then 'GD'\r\n        when /web-dev/.test(course.get('slug')) then 'WD'\r\n        else 'CS'\r\n      labels.push acronym + ++courseLabelIndexes[acronym]\r\n    labels\r\n\r\nprogressMixin =\r\n  get: (options={}) ->\r\n    { classroom, course, level, user } = options\r\n    throw new Error \"You must provide a classroom\" unless classroom\r\n    throw new Error \"You must provide a course\" unless course\r\n    defaultValue = { completed: false, started: false }\r\n    if options.level\r\n      levelID = level.get('original')\r\n      if options.user\r\n        return @[classroom.id]?[course.id]?[levelID]?[user.id] or defaultValue\r\n      else\r\n        return @[classroom.id]?[course.id]?[levelID] or defaultValue\r\n    else\r\n      if options.user\r\n        return @[classroom.id]?[course.id]?[user.id] or defaultValue\r\n      else\r\n        return @[classroom.id]?[course.id] or defaultValue\r\n","# Based on: http://www.html5rocks.com/en/tutorials/canvas/imagefilters/\r\n\r\nFilters = {}\r\n\r\nFilters.getPixels = (img) ->\r\n  c = @getCanvas(img.naturalWidth, img.naturalHeight)\r\n  ctx = c.getContext('2d')\r\n  ctx.drawImage(img, 0, 0)\r\n  return ctx.getImageData(0, 0, c.width, c.height)\r\n\r\nFilters.getCanvas = (w, h) ->\r\n  c = document.createElement('canvas')\r\n  c.width = w\r\n  c.height = h\r\n  return c\r\n\r\nFilters.filterImage = (filter, image, args...) ->\r\n  args = [this.getPixels(image)].concat(args)\r\n  return filter(args...)\r\n\r\nFilters.brightness = (pixels, adjustment) ->\r\n  d = pixels.data\r\n  i = 0\r\n  while i < d.length\r\n    d[i] *= adjustment\r\n    d[i+1] *= adjustment\r\n    d[i+2] *= adjustment\r\n    i+=4\r\n  return pixels\r\n\r\nmodule.exports.darkenImage = darkenImage = (img, borderImageSelector, pct=0.5) ->\r\n  jqimg = $(img)\r\n  cachedValue = jqimg.data('darkened')\r\n  if cachedValue\r\n    $(borderImageSelector).css 'border-image-source', 'url(' + cachedValue + ')'\r\n    return img.src = cachedValue \r\n  jqimg.data('original', img.src) unless jqimg.data('original')\r\n  if not (img.naturalWidth > 0 and img.naturalHeight > 0)\r\n    console.warn 'Tried to darken image', img, 'but it has natural dimensions', img.naturalWidth, img.naturalHeight\r\n    return img\r\n  imageData = Filters.filterImage(Filters.brightness, img, pct)\r\n  c = Filters.getCanvas(img.naturalWidth, img.naturalHeight)\r\n  ctx = c.getContext('2d')\r\n  ctx.putImageData(imageData, 0, 0)\r\n  img.src = c.toDataURL()\r\n  $(borderImageSelector).css 'border-image-source', 'url(' + img.src + ')'\r\n  jqimg.data('darkened', img.src)\r\n\r\nmodule.exports.revertImage = revertImage = (img, borderImageSelector) ->\r\n  jqimg = $(img)\r\n  return unless jqimg.data('original')\r\n  $(borderImageSelector).css 'border-image-source', 'url(' + jqimg.data('original') + ')'\r\n  img.src = jqimg.data('original')\r\n","module.exports.getParentFolders = (subPath, urlPrefix='/test/') ->\r\n  return [] unless subPath\r\n  paths = []\r\n  parts = subPath.split('/')\r\n  while parts.length\r\n    parts.pop()\r\n    paths.unshift {\r\n      name: parts[parts.length-1] or 'All'\r\n      url: urlPrefix + parts.join('/')\r\n    }\r\n  paths\r\n\r\nmodule.exports.parseImmediateChildren = (allChildren, subPath, baseRequirePath='test/app/', urlPrefix='/test/') ->\r\n  return [] unless allChildren\r\n  folders = {}\r\n  files = {}\r\n\r\n  requirePrefix = baseRequirePath + subPath\r\n  if requirePrefix[requirePrefix.length-1] isnt '/'\r\n    requirePrefix += '/'\r\n\r\n  for f in allChildren\r\n    f = f[requirePrefix.length..]\r\n    continue unless f\r\n    parts = f.split('/')\r\n    name = parts[0]\r\n    group = if parts.length is 1 then files else folders\r\n    group[name] ?= 0\r\n    group[name] += 1\r\n\r\n  children = []\r\n  urlPrefix += subPath\r\n  urlPrefix += '/' if urlPrefix[urlPrefix.length-1] isnt '/'\r\n\r\n  for name in _.keys(folders)\r\n    children.push {\r\n      type: 'folder',\r\n      url: urlPrefix+name\r\n      name: name+'/'\r\n      size: folders[name]\r\n    }\r\n  for name in _.keys(files)\r\n    children.push {\r\n      type: 'file',\r\n      url: urlPrefix+name\r\n      name: name\r\n    }\r\n  children\r\n","ScriptModule = require './ScriptModule'\r\n\r\nmodule.exports = class DOMScriptModule extends ScriptModule\r\n  @neededFor: (noteGroup) ->\r\n    return noteGroup.dom?\r\n\r\n  startNotes: ->\r\n    notes = []\r\n    notes.push(@highlightNote()) if @noteGroup.dom.highlight?\r\n    notes.push(@lockNote()) if @noteGroup.dom.lock?\r\n    notes.push(@focusNote()) if @noteGroup.dom.focus?\r\n    notes.push(@showVictoryNote()) if @noteGroup.dom.showVictory\r\n    notes.push(@letterboxNote()) if @noteGroup.dom.letterbox?\r\n    return notes\r\n\r\n  endNotes: ->\r\n    notes = []\r\n    notes.push({'channel': 'level:end-highlight-dom'}) if @noteGroup.dom.highlight?\r\n    notes.push({'channel': 'level:enable-controls'}) if @noteGroup.dom.lock?\r\n    return notes\r\n\r\n  skipNotes: ->\r\n    notes = []\r\n    notes.push(@showVictoryNote(false)) if @noteGroup.dom.showVictory?\r\n    notes.push(@letterboxNote()) if @noteGroup.dom.letterbox?\r\n    notes\r\n\r\n  highlightNote: ->\r\n    dom = @noteGroup.dom\r\n    note =\r\n      channel: 'level:highlight-dom'\r\n      event:\r\n        selector: dom.highlight.target\r\n        delay: dom.highlight.delay\r\n        sides: dom.highlight.sides\r\n        offset: dom.highlight.offset\r\n        rotation: dom.highlight.rotation\r\n    note.event = _.pick note.event, (value) -> not _.isUndefined value\r\n    @maybeApplyDelayToNote note\r\n    note\r\n\r\n  focusNote: ->\r\n    note =\r\n      channel: 'level:focus-dom'\r\n      event:\r\n        selector: @noteGroup.dom.focus\r\n    note\r\n\r\n  showVictoryNote: (showModal) ->\r\n    e = {}\r\n    e.showModal = @noteGroup.dom.showVictory in [true, 'Done Button And Modal']\r\n    e.showModal = showModal if showModal?\r\n    note =\r\n      channel: 'level:show-victory'\r\n      event: e\r\n    note\r\n\r\n  lockNote: ->\r\n    event = {}\r\n    lock = @noteGroup.dom.lock\r\n    event.controls = lock if _.isArray lock  # array: subset of controls\r\n    channel = if lock then 'level:disable-controls' else 'level:enable-controls'\r\n    return {channel: channel, event: event}\r\n\r\n  letterboxNote: ->\r\n    return {channel: 'level:set-letterbox', event: {on: @noteGroup.dom.letterbox}}\r\n","ScriptModule = require './ScriptModule'\r\n\r\nmodule.exports = class PlaybackScriptModule extends ScriptModule\r\n  @neededFor: (noteGroup) ->\r\n    return noteGroup.playback?\r\n\r\n  startNotes: ->\r\n    notes = []\r\n    notes.push(@playingNote()) if @noteGroup.playback.playing?\r\n    notes.push(@scrubNote()) if @noteGroup.playback.scrub?\r\n    return notes\r\n\r\n  endNotes: ->\r\n    notes = []\r\n    # TODO: Want scripts to end where the scrub should go, but this doesn't work\r\n    # when scripts go somewhere then do something else. Figure out a different technique?\r\n#    notes.push(@scrubNote(true)) if @noteGroup.playback.scrub?\r\n    return notes\r\n\r\n  skipNotes: ->\r\n    notes = []\r\n    notes.push(@playingNote()) if @noteGroup.playback.playing?\r\n    notes.push(@scrubNote(true)) if @noteGroup.playback.scrub?\r\n    return notes\r\n\r\n  playingNote: ->\r\n    note =\r\n      channel: 'level:set-playing'\r\n      event: {playing: @noteGroup.playback.playing}\r\n    return note\r\n\r\n  scrubNote: (instant=false) ->\r\n    scrub = @noteGroup.playback.scrub\r\n    note =\r\n      channel: 'level:set-time'\r\n      event:\r\n        frameOffset: scrub.frameOffset or 2\r\n        scrubDuration: if instant then 0 else scrub.duration\r\n    note.event.time = scrub.toTime if scrub.toTime?\r\n    note.event.ratio = scrub.toRatio if scrub.toRatio?\r\n    return note\r\n","CocoClass = require 'core/CocoClass'\r\nCocoView = require 'views/core/CocoView'\r\n{scriptMatchesEventPrereqs} = require './../world/script_event_prereqs'\r\n\r\nallScriptModules = []\r\nallScriptModules.push(require './SpriteScriptModule')\r\nallScriptModules.push(require './DOMScriptModule')\r\nallScriptModules.push(require './SurfaceScriptModule')\r\nallScriptModules.push(require './PlaybackScriptModule')\r\nallScriptModules.push(require './SoundScriptModule')\r\n\r\n\r\nDEFAULT_BOT_MOVE_DURATION = 500\r\nDEFAULT_SCRUB_DURATION = 1000\r\n\r\nmodule.exports = ScriptManager = class ScriptManager extends CocoClass\r\n  scriptInProgress: false\r\n  currentNoteGroup: null\r\n  currentTimeouts: []\r\n  worldLoading: true\r\n  ignoreEvents: false\r\n  quiet: false\r\n\r\n  triggered: []\r\n  ended: []\r\n  noteGroupQueue: []\r\n  originalScripts: [] # use these later when you want to revert to an original state\r\n\r\n  subscriptions:\r\n    'script:end-current-script': 'onEndNoteGroup'\r\n    'level:loading-view-unveiling': -> @setWorldLoading(false)\r\n    'level:restarted': 'onLevelRestarted'\r\n    'level:shift-space-pressed': 'onEndNoteGroup'\r\n    'level:escape-pressed': 'onEndAll'\r\n\r\n  shortcuts:\r\n    '⇧+space, space, enter': -> Backbone.Mediator.publish 'level:shift-space-pressed', {}\r\n    'escape': -> Backbone.Mediator.publish 'level:escape-pressed', {}\r\n\r\n  # SETUP / TEARDOWN\r\n\r\n  constructor: (options) ->\r\n    super(options)\r\n    @originalScripts = options.scripts\r\n    @session = options.session\r\n    @levelID = options.levelID\r\n    @debugScripts = application.isIPadApp or CocoView.getQueryVariable 'dev'\r\n    @initProperties()\r\n    @addScriptSubscriptions()\r\n    @beginTicking()\r\n\r\n  setScripts: (@originalScripts) ->\r\n    @quiet = true\r\n    @initProperties()\r\n    @loadFromSession()\r\n    @quiet = false\r\n    @addScriptSubscriptions()\r\n    @run()\r\n\r\n  initProperties: ->\r\n    @endAll({force:true}) if @scriptInProgress\r\n    @triggered = []\r\n    @ended = []\r\n    @noteGroupQueue = []\r\n    @scripts = $.extend(true, [], @originalScripts)\r\n\r\n  addScriptSubscriptions: ->\r\n    idNum = 0\r\n    makeCallback = (channel) => (event) => @onNote(channel, event)\r\n    for script in @scripts\r\n      script.id = (idNum++).toString() unless script.id\r\n      callback = makeCallback(script.channel) # curry in the channel argument\r\n      @addNewSubscription(script.channel, callback)\r\n\r\n  beginTicking: ->\r\n    @tickInterval = setInterval @tick, 5000\r\n\r\n  tick: =>\r\n    scriptStates = {}\r\n    now = new Date()\r\n    for script in @scripts\r\n      scriptStates[script.id] =\r\n        timeSinceLastEnded: (if script.lastEnded then now - script.lastEnded else 0) / 1000\r\n        timeSinceLastTriggered: (if script.lastTriggered then now - script.lastTriggered else 0) / 1000\r\n\r\n    stateEvent =\r\n      scriptRunning: @currentNoteGroup?.scriptID or ''\r\n      noteGroupRunning: @currentNoteGroup?.name or ''\r\n      scriptStates: scriptStates\r\n      timeSinceLastScriptEnded: (if @lastScriptEnded then now - @lastScriptEnded else 0) / 1000\r\n\r\n    Backbone.Mediator.publish 'script:tick', stateEvent  # Used to trigger level scripts.\r\n\r\n  loadFromSession: ->\r\n    # load the queue with note groups to skip through\r\n    @addEndedScriptsFromSession()\r\n    @addPartiallyEndedScriptFromSession()\r\n    for noteGroup in @noteGroupQueue\r\n      @processNoteGroup(noteGroup)\r\n\r\n  addPartiallyEndedScriptFromSession: ->\r\n    scripts = @session.get('state').scripts\r\n    return unless scripts?.currentScript\r\n    script = _.find @scripts, {id: scripts.currentScript}\r\n    return unless script\r\n    @triggered.push(script.id)\r\n    noteChain = @processScript(script)\r\n    return unless noteChain\r\n    if scripts.currentScriptOffset\r\n      noteGroup.skipMe = true for noteGroup in noteChain[..scripts.currentScriptOffset-1]\r\n    @addNoteChain(noteChain, false)\r\n\r\n  addEndedScriptsFromSession: ->\r\n    scripts = @session.get('state').scripts\r\n    return unless scripts\r\n    endedObj = scripts['ended'] or {}\r\n    sortedPairs = _.sortBy(_.pairs(endedObj), (pair) -> pair[1])\r\n    scriptsToSkip = (p[0] for p in sortedPairs)\r\n    for scriptID in scriptsToSkip\r\n      script = _.find @scripts, {id: scriptID}\r\n      unless script\r\n        console.warn 'Couldn\\'t find script for', scriptID, 'from scripts', @scripts, 'when restoring session scripts.'\r\n        continue\r\n      continue if script.repeats # repeating scripts are not 'rerun'\r\n      @triggered.push(scriptID)\r\n      @ended.push(scriptID)\r\n      noteChain = @processScript(script)\r\n      return unless noteChain\r\n      noteGroup.skipMe = true for noteGroup in noteChain\r\n      @addNoteChain(noteChain, false)\r\n\r\n  setWorldLoading: (@worldLoading) ->\r\n    @run() unless @worldLoading\r\n\r\n  initializeCamera: ->\r\n    # Fire off the first bounds-setting script now, before we're actually running any other ones.\r\n    for script in @scripts\r\n      for note in script.noteChain or []\r\n        if note.surface?.focus?\r\n          surfaceModule = _.find note.modules or [], (module) -> module.surfaceCameraNote\r\n          cameraNote = surfaceModule.surfaceCameraNote true\r\n          @publishNote cameraNote\r\n          return\r\n\r\n  destroy: ->\r\n    @onEndAll()\r\n    clearInterval @tickInterval\r\n    super()\r\n\r\n  # TRIGGERERING NOTES\r\n\r\n  onNote: (channel, event) ->\r\n    return if @ignoreEvents\r\n    for script in @scripts\r\n      alreadyTriggered = script.id in @triggered\r\n      continue unless script.channel is channel\r\n      continue if alreadyTriggered and not script.repeats\r\n      continue if script.lastTriggered? and script.repeats is 'session'\r\n      continue if script.lastTriggered? and new Date().getTime() - script.lastTriggered < 1\r\n      continue if script.neverRun\r\n\r\n      if script.notAfter\r\n        for scriptID in script.notAfter\r\n          if scriptID in @triggered\r\n            script.neverRun = true\r\n            break\r\n        continue if script.neverRun\r\n\r\n      continue unless @scriptPrereqsSatisfied(script)\r\n      continue unless scriptMatchesEventPrereqs(script, event)\r\n      # everything passed!\r\n      console.debug \"SCRIPT: Running script '#{script.id}'\" if @debugScripts\r\n      script.lastTriggered = new Date().getTime()\r\n      @triggered.push(script.id) unless alreadyTriggered\r\n      noteChain = @processScript(script)\r\n      if not noteChain then return @trackScriptCompletions (script.id)\r\n      @addNoteChain(noteChain)\r\n      @run()\r\n\r\n  scriptPrereqsSatisfied: (script) ->\r\n    _.every(script.scriptPrereqs or [], (prereq) => prereq in @triggered)\r\n\r\n  processScript: (script) ->\r\n    noteChain = script.noteChain\r\n    return null unless noteChain?.length\r\n    noteGroup.scriptID = script.id for noteGroup in noteChain\r\n    lastNoteGroup = noteChain[noteChain.length - 1]\r\n    lastNoteGroup.isLast = true\r\n    return noteChain\r\n\r\n  addNoteChain: (noteChain, clearYields=true) ->\r\n    @processNoteGroup(noteGroup) for noteGroup in noteChain\r\n    noteGroup.index = i for noteGroup, i in noteChain\r\n    if clearYields\r\n      noteGroup.skipMe = true for noteGroup in @noteGroupQueue when noteGroup.script.yields\r\n    @noteGroupQueue.push noteGroup for noteGroup in noteChain\r\n    @endYieldingNote()\r\n\r\n  processNoteGroup: (noteGroup) ->\r\n    return if noteGroup.modules?\r\n    if noteGroup.playback?.scrub?\r\n      noteGroup.playback.scrub.duration ?= DEFAULT_SCRUB_DURATION\r\n    noteGroup.sprites ?= []\r\n    for sprite in noteGroup.sprites\r\n      if sprite.move?\r\n        sprite.move.duration ?= DEFAULT_BOT_MOVE_DURATION\r\n      sprite.id ?= 'Hero Placeholder'\r\n    noteGroup.script ?= {}\r\n    noteGroup.script.yields ?= true\r\n    noteGroup.script.skippable ?= true\r\n    noteGroup.modules = (new Module(noteGroup) for Module in allScriptModules when Module.neededFor(noteGroup))\r\n\r\n  endYieldingNote: ->\r\n    if @scriptInProgress and @currentNoteGroup?.script.yields\r\n      @endNoteGroup()\r\n      return true\r\n\r\n  # STARTING NOTES\r\n\r\n  run: ->\r\n    # catch all for analyzing the current state and doing whatever needs to happen next\r\n    return if @scriptInProgress\r\n    @skipAhead()\r\n    return unless @noteGroupQueue.length\r\n    nextNoteGroup = @noteGroupQueue[0]\r\n    return if @worldLoading and nextNoteGroup.skipMe\r\n    return if @worldLoading and not nextNoteGroup.script?.beforeLoad\r\n    @noteGroupQueue = @noteGroupQueue[1..]\r\n    @currentNoteGroup = nextNoteGroup\r\n    @notifyScriptStateChanged()\r\n    @scriptInProgress = true\r\n    @currentTimeouts = []\r\n    scriptLabel = \"#{nextNoteGroup.scriptID} - #{nextNoteGroup.name}\"\r\n    application.tracker?.trackEvent 'Script Started', {levelID: @levelID, label: scriptLabel, ls: @session?.get('_id')}, ['Google Analytics']\r\n    console.debug \"SCRIPT: Starting note group '#{nextNoteGroup.name}'\" if @debugScripts\r\n    for module in nextNoteGroup.modules\r\n      @processNote(note, nextNoteGroup) for note in module.startNotes()\r\n    if nextNoteGroup.script.duration\r\n      f = => @onNoteGroupTimeout? nextNoteGroup\r\n      setTimeout(f, nextNoteGroup.script.duration)\r\n    Backbone.Mediator.publish 'script:note-group-started', {}\r\n\r\n  skipAhead: ->\r\n    return if @worldLoading\r\n    return unless @noteGroupQueue[0]?.skipMe\r\n    @ignoreEvents = true\r\n    for noteGroup, i in @noteGroupQueue\r\n      break unless noteGroup.skipMe\r\n      console.debug \"SCRIPT: Skipping note group '#{noteGroup.name}'\" if @debugScripts\r\n      @processNoteGroup(noteGroup)\r\n      for module in noteGroup.modules\r\n        notes = module.skipNotes()\r\n        @processNote(note, noteGroup) for note in notes\r\n      @trackScriptCompletionsFromNoteGroup(noteGroup)\r\n    @noteGroupQueue = @noteGroupQueue[i..]\r\n    @ignoreEvents = false\r\n\r\n  processNote: (note, noteGroup) ->\r\n    note.event ?= {}\r\n    if note.delay\r\n      f = => @sendDelayedNote noteGroup, note\r\n      @currentTimeouts.push setTimeout(f, note.delay)\r\n    else\r\n      @publishNote(note)\r\n\r\n  sendDelayedNote: (noteGroup, note) ->\r\n    # some events should only happen after the bot has moved into position\r\n    return unless noteGroup is @currentNoteGroup\r\n    @publishNote(note)\r\n\r\n  publishNote: (note) ->\r\n    Backbone.Mediator.publish note.channel, note.event ? {}\r\n\r\n  # ENDING NOTES\r\n\r\n  onLevelRestarted: ->\r\n    @quiet = true\r\n    @endAll({force:true})\r\n    @initProperties()\r\n    @resetThings()\r\n    Backbone.Mediator.publish 'script:reset', {}\r\n    @quiet = false\r\n    @run()\r\n\r\n  onEndNoteGroup: (e) ->\r\n    # press enter\r\n    return unless @currentNoteGroup?.script.skippable\r\n    @endNoteGroup()\r\n    @run()\r\n\r\n  endNoteGroup: ->\r\n    return if @ending # kill infinite loops right here\r\n    @ending = true\r\n    return unless @currentNoteGroup?\r\n    scriptLabel = \"#{@currentNoteGroup.scriptID} - #{@currentNoteGroup.name}\"\r\n    application.tracker?.trackEvent 'Script Ended', {levelID: @levelID, label: scriptLabel, ls: @session?.get('_id')}, ['Google Analytics']\r\n    console.debug \"SCRIPT: Ending note group '#{@currentNoteGroup.name}'\" if @debugScripts\r\n    clearTimeout(timeout) for timeout in @currentTimeouts\r\n    for module in @currentNoteGroup.modules\r\n      @processNote(note, @currentNoteGroup) for note in module.endNotes()\r\n    Backbone.Mediator.publish 'script:note-group-ended', {} unless @quiet\r\n    @scriptInProgress = false\r\n    @trackScriptCompletionsFromNoteGroup(@currentNoteGroup)\r\n    @currentNoteGroup = null\r\n    unless @noteGroupQueue.length\r\n      @notifyScriptStateChanged()\r\n      @resetThings()\r\n    @ending = false\r\n\r\n  onEndAll: (e) ->\r\n    # Escape was pressed.\r\n    @endAll()\r\n\r\n  endAll: (options) ->\r\n    options ?= {}\r\n    if @scriptInProgress\r\n      return if (not @currentNoteGroup.script.skippable) and (not options.force)\r\n      @endNoteGroup()\r\n\r\n    for noteGroup, i in @noteGroupQueue\r\n      if ((noteGroup.script?.skippable) is false) and not options.force\r\n        @noteGroupQueue = @noteGroupQueue[i..]\r\n        @run()\r\n        @notifyScriptStateChanged()\r\n        return\r\n\r\n      @processNoteGroup(noteGroup)\r\n      for module in noteGroup.modules\r\n        notes = module.skipNotes()\r\n        @processNote(note, noteGroup) for note in notes unless @quiet\r\n      @trackScriptCompletionsFromNoteGroup(noteGroup) unless @quiet\r\n\r\n    @noteGroupQueue = []\r\n\r\n    @resetThings()\r\n    @notifyScriptStateChanged()\r\n\r\n  onNoteGroupTimeout: (noteGroup) ->\r\n    return unless noteGroup is @currentNoteGroup\r\n    @endNoteGroup()\r\n    @run()\r\n\r\n  resetThings: ->\r\n    Backbone.Mediator.publish 'level:enable-controls', {}\r\n    Backbone.Mediator.publish 'level:set-letterbox', { on: false }\r\n\r\n  trackScriptCompletionsFromNoteGroup: (noteGroup) ->\r\n    return unless noteGroup.isLast\r\n    @trackScriptCompletions(noteGroup.scriptID)\r\n\r\n  trackScriptCompletions: (scriptID) ->\r\n    return if @quiet\r\n    @ended.push(scriptID) unless scriptID in @ended\r\n    for script in @scripts\r\n      if script.id is scriptID\r\n        script.lastEnded = new Date()\r\n    @lastScriptEnded = new Date()\r\n    Backbone.Mediator.publish 'script:ended', {scriptID: scriptID}\r\n\r\n  notifyScriptStateChanged: ->\r\n    return if @quiet\r\n    event =\r\n      currentScript: @currentNoteGroup?.scriptID or null\r\n      currentScriptOffset: @currentNoteGroup?.index or 0\r\n    Backbone.Mediator.publish 'script:state-changed', event\r\n","CocoClass = require 'core/CocoClass'\r\n\r\nmodule.exports = class ScriptModule extends CocoClass\r\n\r\n  scrubbingTime = 0\r\n  movementTime = 0\r\n\r\n  constructor: (@noteGroup) ->\r\n    super()\r\n    if not @noteGroup.prepared\r\n      @analyzeNoteGroup(@noteGroup)\r\n      @noteGroup.notes ?= []\r\n      @noteGroup.prepared = true\r\n\r\n  # subclass should overwrite these\r\n\r\n  @neededFor: -> false\r\n  startNotes: -> []\r\n  endNotes: -> []\r\n  skipNotes: -> @endNotes()\r\n\r\n  # common logic\r\n\r\n  analyzeNoteGroup: ->\r\n    # some notes need to happen after others. Calculate the delays\r\n    @movementTime = @calculateMovementMax(@noteGroup)\r\n    @scrubbingTime = @noteGroup.playback?.scrub?.duration or 0\r\n\r\n  calculateMovementMax: ->\r\n    sums = {}\r\n    for sprite in @noteGroup.sprites\r\n      continue unless sprite.move?\r\n      sums[sprite.id] ?= 0\r\n      sums[sprite.id] += sprite.move.duration\r\n    sums = (sums[k] for k of sums)\r\n    Math.max(0, sums...)\r\n\r\n  maybeApplyDelayToNote: (note) ->\r\n    note.delay = (@scrubbingTime + @movementTime) or 0\r\n","ScriptModule = require './ScriptModule'\r\n\r\ncurrentMusic = null\r\nstandingBy = null\r\n\r\n{me} = require('core/auth')\r\n\r\nmodule.exports = class SoundScriptModule extends ScriptModule\r\n  @neededFor: (noteGroup) ->\r\n    return noteGroup.sound?\r\n\r\n  startNotes: ->\r\n    notes = []\r\n    notes.push(@addSuppressSelectionSoundsNote()) if @noteGroup.sound.suppressSelectionSounds?\r\n    notes.push(@addMusicNote()) if @noteGroup.sound.music?\r\n    return notes\r\n\r\n  endNotes: ->\r\n    return []\r\n\r\n  skipNotes: ->\r\n    return @startNotes()\r\n\r\n  addSuppressSelectionSoundsNote: ->\r\n    note =\r\n      channel: 'level:suppress-selection-sounds'\r\n      event: {suppress: @noteGroup.sound.suppressSelectionSounds}\r\n    return note\r\n\r\n  addMusicNote: ->\r\n    note =\r\n      channel: 'music-player:play-music'\r\n      event: @noteGroup.sound.music\r\n    return note\r\n","ScriptModule = require './ScriptModule'\r\n{me} = require 'core/auth'\r\nutils = require 'core/utils'\r\n\r\nmodule.exports = class SpritesScriptModule extends ScriptModule\r\n  @neededFor: (noteGroup) ->\r\n    return noteGroup.sprites?.length\r\n\r\n  startNotes: ->\r\n    notes = []\r\n    @moveSums = {}\r\n    @speakingSprites = {}\r\n    for sprite in @noteGroup.sprites or []\r\n      notes.push(@spriteMoveNote sprite) if sprite.move?\r\n    for sprite in @noteGroup.sprites or []\r\n      notes.push(@spriteSayNote(sprite, @noteGroup.script)) if sprite.say?\r\n      notes.push(@spriteSelectNote sprite) if sprite.select?\r\n    return (n for n in notes when n)\r\n\r\n  spriteMoveNote: (sprite, instant=false) ->\r\n    duration = if instant then 0 else sprite.move.duration\r\n    note =\r\n      channel: 'sprite:move'\r\n      event:\r\n        pos: sprite.move.target\r\n        duration: duration\r\n        spriteID: sprite.id\r\n    if duration\r\n      @moveSums[sprite.id] ?= 0\r\n      note.delay = @scrubbingTime + @moveSums[sprite.id]\r\n      @moveSums[sprite.id] += sprite.move.duration\r\n    return note\r\n\r\n  spriteSayNote: (sprite, script) ->\r\n    return if @speakingSprites[sprite.id]\r\n    responses = sprite.say.responses\r\n    responses = [] unless script.skippable or responses\r\n    for response in responses ? []\r\n      response.text = utils.i18n response, 'text'\r\n    text = utils.i18n sprite.say, 'text'\r\n    blurb = utils.i18n sprite.say, 'blurb'\r\n    sound = utils.i18n sprite.say, 'sound'\r\n    note =\r\n      channel: 'level:sprite-dialogue'\r\n      event:\r\n        message: text\r\n        blurb: blurb\r\n        mood: sprite.say.mood or 'explain'\r\n        responses: responses\r\n        spriteID: sprite.id\r\n        sound: sound\r\n    @maybeApplyDelayToNote note\r\n    return note\r\n\r\n  spriteSelectNote: (sprite) ->\r\n    note =\r\n      channel: 'level:select-sprite'\r\n      event:\r\n        thangID: if sprite.select then sprite.id else null\r\n    return note\r\n\r\n  endNotes: ->\r\n    notes = {}\r\n    for sprite in @noteGroup.sprites or []\r\n      notes[sprite.id] ?= {}\r\n      notes[sprite.id]['move'] = (@spriteMoveNote sprite, true) if sprite.move?\r\n      notes[sprite.id]['say'] = { channel: 'level:sprite-clear-dialogue' } if sprite.say?\r\n    noteArray = []\r\n    for spriteID of notes\r\n      for type of notes[spriteID]\r\n        noteArray.push(notes[spriteID][type])\r\n    noteArray\r\n","ScriptModule = require './ScriptModule'\r\n\r\nmodule.exports = class SurfaceScriptModule extends ScriptModule\r\n  @neededFor: (noteGroup) ->\r\n    return noteGroup.surface?\r\n\r\n  startNotes: ->\r\n    notes = []\r\n    notes.push(@surfaceCameraNote()) if @noteGroup.surface.focus?\r\n    notes.push(@surfaceHighlightNote()) if @noteGroup.surface.highlight?\r\n    notes.push(@surfaceLockSelectNote()) if @noteGroup.surface.lockSelect?\r\n    return notes\r\n\r\n  endNotes: ->\r\n    notes = []\r\n    notes.push({channel:'sprite:highlight-sprites', event: {thangIDs: []}}) if @noteGroup.surface.highlight?\r\n    notes.push(@surfaceCameraNote(true)) if @noteGroup.surface.focus?\r\n    notes.push(@surfaceLockSelectNote()) if @noteGroup.surface.lockSelect?\r\n    return notes\r\n\r\n  skipNotes: ->\r\n    notes = []\r\n    notes.push(@surfaceCameraNote(true)) if @noteGroup.surface.focus?\r\n    notes.push(@surfaceLockSelectNote()) if @noteGroup.surface.lockSelect?\r\n    return notes\r\n\r\n  surfaceCameraNote: (instant=false) ->\r\n    focus = @noteGroup.surface.focus\r\n    e = {}\r\n    e.pos = focus.target if _.isPlainObject focus.target\r\n    e.thangID = focus.target if _.isString focus.target\r\n    e.zoom = focus.zoom or 2.0  # TODO: test only doing this if e.pos, e.thangID, or focus.zoom?\r\n    e.duration = if focus.duration? then focus.duration else 1500\r\n    e.duration = 0 if instant\r\n    e.bounds = focus.bounds if focus.bounds?\r\n    return { channel: 'camera:set-camera', event: e }\r\n\r\n  surfaceHighlightNote: ->\r\n    highlight = @noteGroup.surface.highlight\r\n    note =\r\n      channel: 'sprite:highlight-sprites'\r\n      event:\r\n        thangIDs: highlight.targets\r\n        delay: highlight.delay\r\n    @maybeApplyDelayToNote note, @noteGroup\r\n    return note\r\n\r\n  surfaceLockSelectNote: ->\r\n    return { channel: 'level:lock-select', event: {lock: @noteGroup.surface.lockSelect} }\r\n","SuperModel = require 'models/SuperModel'\r\nCocoClass = require 'core/CocoClass'\r\nLevelLoader = require 'lib/LevelLoader'\r\nGoalManager = require 'lib/world/GoalManager'\r\nGod = require 'lib/God'\r\n{createAetherOptions} = require 'lib/aether_utils'\r\n\r\nSIMULATOR_VERSION = 4\r\n\r\nsimulatorInfo = {}\r\nif $.browser\r\n  simulatorInfo['desktop'] = $.browser.desktop if $.browser.desktop\r\n  simulatorInfo['name'] = $.browser.name if $.browser.name\r\n  simulatorInfo['platform'] = $.browser.platform if $.browser.platform\r\n  simulatorInfo['version'] = $.browser.versionNumber if $.browser.versionNumber\r\n\r\nmodule.exports = class Simulator extends CocoClass\r\n  constructor: (@options) ->\r\n    @options ?= {}\r\n    simulatorType = if @options.headlessClient then 'headless' else 'browser'\r\n    @simulator =\r\n      type: simulatorType\r\n      version: SIMULATOR_VERSION\r\n      info: simulatorInfo\r\n    _.extend @, Backbone.Events\r\n    @trigger 'statusUpdate', 'Starting simulation!'\r\n    @retryDelayInSeconds = 2\r\n    @taskURL = '/queue/scoring'\r\n    @simulatedByYou = 0\r\n    @god = new God maxAngels: 1, workerCode: @options.workerCode, headless: true  # Start loading worker.\r\n\r\n  destroy: ->\r\n    @off()\r\n    @cleanupSimulation()\r\n    @god?.destroy()\r\n    super()\r\n\r\n  fetchAndSimulateOneGame: (humanGameID, ogresGameID) =>\r\n    return if @destroyed\r\n    $.ajax\r\n      url: '/queue/scoring/getTwoGames'\r\n      type: 'POST'\r\n      parse: true\r\n      data:\r\n        humansGameID: humanGameID\r\n        ogresGameID: ogresGameID\r\n        simulator: @simulator\r\n        background: Boolean(@options.background)\r\n        levelID: @options.levelID\r\n        leagueID: @options.leagueID\r\n      error: (errorData) ->\r\n        console.warn \"There was an error fetching two games! #{JSON.stringify errorData}\"\r\n        if errorData?.responseText?.indexOf(\"Old simulator\") isnt -1\r\n          noty {\r\n            text: errorData.responseText\r\n            layout: 'center'\r\n            type: 'error'\r\n          }\r\n      success: (taskData) =>\r\n        return if @destroyed\r\n        unless taskData\r\n          @retryDelayInSeconds = 10\r\n          @trigger 'statusUpdate', \"No games to simulate. Trying another game in #{@retryDelayInSeconds} seconds.\"\r\n          @simulateAnotherTaskAfterDelay()\r\n          return\r\n        @trigger 'statusUpdate', 'Setting up simulation...'\r\n        #refactor this\r\n        @task = new SimulationTask(taskData)\r\n\r\n        @supermodel ?= new SuperModel()\r\n        @supermodel.resetProgress()\r\n        @stopListening @supermodel, 'loaded-all'\r\n        @levelLoader = new LevelLoader supermodel: @supermodel, levelID: @task.getLevelName(), sessionID: @task.getFirstSessionID(), opponentSessionID: @task.getSecondSessionID(), headless: true\r\n\r\n        if @supermodel.finished()\r\n          @simulateSingleGame()\r\n        else\r\n          @listenToOnce @supermodel, 'loaded-all', @simulateSingleGame\r\n\r\n  simulateSingleGame: ->\r\n    return if @destroyed\r\n    @assignWorldAndLevelFromLevelLoaderAndDestroyIt()\r\n    @trigger 'statusUpdate', 'Simulating...'\r\n    @setupGod()\r\n    try\r\n      @commenceSingleSimulation()\r\n    catch error\r\n      @handleSingleSimulationError error\r\n\r\n  commenceSingleSimulation: ->\r\n    @listenToOnce @god, 'infinite-loop', @handleSingleSimulationInfiniteLoop\r\n    @listenToOnce @god, 'goals-calculated', @processSingleGameResults\r\n    @god.createWorld @generateSpellsObject()\r\n\r\n  handleSingleSimulationError: (error) ->\r\n    console.error 'There was an error simulating a single game!', error\r\n    return if @destroyed\r\n    if @options.headlessClient and @options.simulateOnlyOneGame\r\n      console.log 'GAMERESULT:tie'\r\n      process.exit(0)\r\n    @cleanupAndSimulateAnotherTask()\r\n\r\n  handleSingleSimulationInfiniteLoop: (e) ->\r\n    console.log 'There was an infinite loop in the single game!'\r\n    return if @destroyed\r\n    if @options.headlessClient and @options.simulateOnlyOneGame\r\n      console.log 'GAMERESULT:tie'\r\n      process.exit(0)\r\n    @cleanupAndSimulateAnotherTask()\r\n\r\n  processSingleGameResults: (simulationResults) ->\r\n    try\r\n      taskResults = @formTaskResultsObject simulationResults\r\n    catch error\r\n      console.log \"Failed to form task results:\", error\r\n      return @cleanupAndSimulateAnotherTask()\r\n    humanSessionRank = taskResults.sessions[0].metrics.rank\r\n    ogreSessionRank = taskResults.sessions[1].metrics.rank\r\n    if @options.headlessClient and @options.simulateOnlyOneGame\r\n      if humanSessionRank is ogreSessionRank\r\n        console.log 'GAMERESULT:tie'\r\n      else if humanSessionRank < ogreSessionRank\r\n        console.log 'GAMERESULT:humans'\r\n      else if ogreSessionRank < humanSessionRank\r\n        console.log 'GAMERESULT:ogres'\r\n      process.exit(0)\r\n    else\r\n      @sendSingleGameBackToServer(taskResults)\r\n\r\n  sendSingleGameBackToServer: (results) ->\r\n    @trigger 'statusUpdate', 'Simulation completed, sending results back to server!'\r\n\r\n    $.ajax\r\n      url: '/queue/scoring/recordTwoGames'\r\n      data: results\r\n      type: 'PUT'\r\n      parse: true\r\n      success: @handleTaskResultsTransferSuccess\r\n      error: @handleTaskResultsTransferError\r\n      complete: @cleanupAndSimulateAnotherTask\r\n\r\n  fetchAndSimulateTask: =>\r\n    return if @destroyed\r\n    # Because there's some bug where the chained rankings don't work, let's just do getTwoGames until we fix it.\r\n    return @fetchAndSimulateOneGame()\r\n\r\n    if @options.headlessClient\r\n      if @dumpThisTime # The first heapdump would be useless to find leaks.\r\n        console.log 'Writing snapshot.'\r\n        @options.heapdump.writeSnapshot()\r\n      @dumpThisTime = true if @options.heapdump\r\n\r\n      if @options.testing\r\n        _.delay @setupSimulationAndLoadLevel, 0, @options.testFile, 'Testing...', status: 400\r\n        return\r\n\r\n    @trigger 'statusUpdate', 'Fetching simulation data!'\r\n    $.ajax\r\n      url: @taskURL\r\n      type: 'GET'\r\n      parse: true\r\n      error: @handleFetchTaskError\r\n      success: @setupSimulationAndLoadLevel\r\n      cache: false\r\n\r\n  handleFetchTaskError: (errorData) =>\r\n    console.error \"There was a horrible Error: #{JSON.stringify errorData}\"\r\n    @trigger 'statusUpdate', 'There was an error fetching games to simulate. Retrying in 10 seconds.'\r\n    @simulateAnotherTaskAfterDelay()\r\n\r\n  handleNoGamesResponse: ->\r\n    @noTasks = true\r\n    info = 'Finding game to simulate...'\r\n    console.log info\r\n    @trigger 'statusUpdate', info\r\n    @fetchAndSimulateOneGame()\r\n\r\n  simulateAnotherTaskAfterDelay: =>\r\n    console.log \"Retrying in #{@retryDelayInSeconds}\"\r\n    retryDelayInMilliseconds = @retryDelayInSeconds * 1000\r\n    _.delay @fetchAndSimulateTask, retryDelayInMilliseconds\r\n\r\n  setupSimulationAndLoadLevel: (taskData, textStatus, jqXHR) =>\r\n    return @handleNoGamesResponse() if jqXHR.status is 204\r\n    @trigger 'statusUpdate', 'Setting up simulation!'\r\n    @task = new SimulationTask(taskData)\r\n    try\r\n      levelID = @task.getLevelName()\r\n    catch err\r\n      console.error err\r\n      @trigger 'statusUpdate', \"Error simulating game: #{err}. Trying another game in #{@retryDelayInSeconds} seconds.\"\r\n      @simulateAnotherTaskAfterDelay()\r\n      return\r\n\r\n    @supermodel ?= new SuperModel()\r\n    @supermodel.resetProgress()\r\n    @stopListening @supermodel, 'loaded-all'\r\n    @levelLoader = new LevelLoader supermodel: @supermodel, levelID: levelID, sessionID: @task.getFirstSessionID(), opponentSessionID: @task.getSecondSessionID(), headless: true\r\n    if @supermodel.finished()\r\n      @simulateGame()\r\n    else\r\n      @listenToOnce @supermodel, 'loaded-all', @simulateGame\r\n\r\n  simulateGame: ->\r\n    return if @destroyed\r\n    info = 'All resources loaded, simulating!'\r\n    console.log info\r\n    @assignWorldAndLevelFromLevelLoaderAndDestroyIt()\r\n    @trigger 'statusUpdate', info, @task.getSessions()\r\n    @setupGod()\r\n\r\n    try\r\n      @commenceSimulationAndSetupCallback()\r\n    catch err\r\n      console.error 'There was an error in simulation:', err, err.stack, \"-- trying again in #{@retryDelayInSeconds} seconds\"\r\n      @simulateAnotherTaskAfterDelay()\r\n\r\n  assignWorldAndLevelFromLevelLoaderAndDestroyIt: ->\r\n    @world = @levelLoader.world\r\n    @task.setWorld(@world)\r\n    @level = @levelLoader.level\r\n    @session = @levelLoader.session\r\n    @otherSession = @levelLoader.opponentSession\r\n    @levelLoader.destroy()\r\n    @levelLoader = null\r\n\r\n  setupGod: ->\r\n    @god.setLevel @level.serialize {@supermodel, @session, @otherSession, headless: true, sessionless: false}\r\n    @god.setLevelSessionIDs (session.sessionID for session in @task.getSessions())\r\n    @god.setWorldClassMap @world.classMap\r\n    @god.setGoalManager new GoalManager @world, @level.get('goals'), null, {headless: true}\r\n    humanFlagHistory = _.filter @session.get('state')?.flagHistory ? [], (event) => event.source isnt 'code' and event.team is (@session.get('team') ? 'humans')\r\n    ogreFlagHistory = _.filter @otherSession.get('state')?.flagHistory ? [], (event) => event.source isnt 'code' and event.team is (@otherSession.get('team') ? 'ogres')\r\n    @god.lastFlagHistory = humanFlagHistory.concat ogreFlagHistory\r\n    #console.log 'got flag history', @god.lastFlagHistory, 'from', humanFlagHistory, ogreFlagHistory, @session.get('state'), @otherSession.get('state')\r\n    @god.lastSubmissionCount = 0  # TODO: figure out how to combine submissionCounts from both players so we can use submissionCount random seeds again.\r\n    @god.lastDifficulty = 0\r\n\r\n  commenceSimulationAndSetupCallback: ->\r\n    @listenToOnce @god, 'infinite-loop', @onInfiniteLoop\r\n    @listenToOnce @god, 'goals-calculated', @processResults\r\n    @god.createWorld @generateSpellsObject()\r\n\r\n    # Search for leaks, headless-client only.\r\n    if @options.headlessClient and @options.leakTest and not @memwatch?\r\n      leakcount = 0\r\n      maxleakcount = 0\r\n      console.log 'Setting leak callbacks.'\r\n      @memwatch = require 'memwatch'\r\n\r\n      @memwatch.on 'leak', (info) =>\r\n        console.warn \"LEAK!!\\n\" + JSON.stringify(info)\r\n\r\n        unless @hd?\r\n          if (leakcount++ is maxleakcount)\r\n            @hd = new @memwatch.HeapDiff()\r\n\r\n            @memwatch.on 'stats', (stats) =>\r\n              console.warn 'stats callback: ' + stats\r\n              diff = @hd.end()\r\n              console.warn \"HeapDiff:\\n\" + JSON.stringify(diff)\r\n\r\n              if @options.exitOnLeak\r\n                console.warn 'Exiting because of Leak.'\r\n                process.exit()\r\n              @hd = new @memwatch.HeapDiff()\r\n\r\n  onInfiniteLoop: (e) ->\r\n    return if @destroyed\r\n    console.warn 'Skipping infinitely looping game.'\r\n    @trigger 'statusUpdate', \"Infinite loop detected; grabbing a new game in #{@retryDelayInSeconds} seconds.\"\r\n    _.delay @cleanupAndSimulateAnotherTask, @retryDelayInSeconds * 1000\r\n\r\n  processResults: (simulationResults) ->\r\n    try\r\n      taskResults = @formTaskResultsObject simulationResults\r\n    catch error\r\n      console.log \"Failed to form task results:\", error\r\n      return @cleanupAndSimulateAnotherTask()\r\n    unless taskResults.taskID\r\n      console.error \"*** Error: taskResults has no taskID ***\\ntaskResults:\", taskResults\r\n      @cleanupAndSimulateAnotherTask()\r\n    else\r\n      @sendResultsBackToServer taskResults\r\n\r\n  sendResultsBackToServer: (results) ->\r\n    status = 'Recording:'\r\n    for session in results.sessions\r\n      states = ['wins', if _.find(results.sessions, (s) -> s.metrics.rank is 0) then 'loses' else 'draws']\r\n      status += \" #{session.name} #{states[session.metrics.rank]}\"\r\n    @trigger 'statusUpdate', status\r\n    console.log 'Sending result back to server:'\r\n    console.log JSON.stringify results\r\n\r\n    if @options.headlessClient and @options.testing\r\n      return @fetchAndSimulateTask()\r\n\r\n    $.ajax\r\n      url: '/queue/scoring'\r\n      data: results\r\n      type: 'PUT'\r\n      parse: true\r\n      success: @handleTaskResultsTransferSuccess\r\n      error: @handleTaskResultsTransferError\r\n      complete: @cleanupAndSimulateAnotherTask\r\n\r\n  handleTaskResultsTransferSuccess: (result) =>\r\n    return if @destroyed\r\n    console.log \"Task registration result: #{JSON.stringify result}\"\r\n    @trigger 'statusUpdate', 'Results were successfully sent back to server!'\r\n    @simulatedByYou++\r\n    unless @options.headlessClient\r\n      simulatedBy = parseInt($('#simulated-by-you').text(), 10) + 1\r\n      $('#simulated-by-you').text(simulatedBy)\r\n\r\n  handleTaskResultsTransferError: (error) =>\r\n    return if @destroyed\r\n    @trigger 'statusUpdate', 'There was an error sending the results back to the server.'\r\n    console.log \"Task registration error: #{JSON.stringify error}\"\r\n\r\n  cleanupAndSimulateAnotherTask: =>\r\n    return if @destroyed\r\n    @cleanupSimulation()\r\n    if @options.background or @noTasks\r\n      @fetchAndSimulateOneGame()\r\n    else\r\n      @fetchAndSimulateTask()\r\n\r\n  cleanupSimulation: ->\r\n    @stopListening @god\r\n    @world = null\r\n    @level = null\r\n\r\n  formTaskResultsObject: (simulationResults) ->\r\n    taskResults =\r\n      taskID: @task.getTaskID()\r\n      receiptHandle: @task.getReceiptHandle()\r\n      originalSessionID: @task.getFirstSessionID()\r\n      originalSessionRank: -1\r\n      calculationTime: 500\r\n      sessions: []\r\n      simulator: @simulator\r\n      randomSeed: @task.world.randomSeed\r\n\r\n    for session in @task.getSessions()\r\n      sessionResult =\r\n        sessionID: session.sessionID\r\n        submitDate: session.submitDate\r\n        creator: session.creator\r\n        name: session.creatorName\r\n        totalScore: session.totalScore\r\n        metrics:\r\n          rank: @calculateSessionRank session.sessionID, simulationResults.goalStates, @task.generateTeamToSessionMap()\r\n        shouldUpdateLastOpponentSubmitDateForLeague: session.shouldUpdateLastOpponentSubmitDateForLeague\r\n      if session.sessionID is taskResults.originalSessionID\r\n        taskResults.originalSessionRank = sessionResult.metrics.rank\r\n        taskResults.originalSessionTeam = session.team\r\n      taskResults.sessions.push sessionResult\r\n\r\n    return taskResults\r\n\r\n  calculateSessionRank: (sessionID, goalStates, teamSessionMap) ->\r\n    ogreGoals = (goalState for key, goalState of goalStates when goalState.team is 'ogres')\r\n    humanGoals = (goalState for key, goalState of goalStates when goalState.team is 'humans')\r\n    ogresWon = _.all ogreGoals, {status: 'success'}\r\n    humansWon = _.all humanGoals, {status: 'success'}\r\n    if ogresWon is humansWon\r\n      return 0\r\n    else if ogresWon and teamSessionMap['ogres'] is sessionID\r\n      return 0\r\n    else if ogresWon and teamSessionMap['ogres'] isnt sessionID\r\n      return 1\r\n    else if humansWon and teamSessionMap['humans'] is sessionID\r\n      return 0\r\n    else\r\n      return 1\r\n\r\n  generateSpellsObject: ->\r\n    spells = {}\r\n    for {hero, team} in [{hero: 'Hero Placeholder', team: 'humans'}, {hero: 'Hero Placeholder 1', team: 'ogres'}]\r\n      sessionInfo = _.filter(@task.getSessions(), {team: team})[0]\r\n      fullSpellName = _.string.slugify(hero) + '/plan'\r\n      submittedCodeLanguage = sessionInfo?.submittedCodeLanguage ? 'javascript'\r\n      submittedCodeLanguage = 'javascript' if submittedCodeLanguage in ['clojure', 'io']  # No longer supported\r\n      submittedCode = LZString.decompressFromUTF16 sessionInfo?.submittedCode?[_.string.slugify(hero)]?.plan ? ''\r\n      aether = new Aether createAetherOptions functionName: 'plan', codeLanguage: submittedCodeLanguage, skipProtectAPI: false\r\n      try\r\n        aether.transpile submittedCode\r\n      catch e\r\n        console.log \"Couldn't transpile #{fullSpellName}:\\n#{submittedCode}\\n\", e\r\n        aether.transpile ''\r\n      spells[fullSpellName] = name: 'plan', team: team, thang: {thang: {id: hero}, aether: aether}\r\n    spells\r\n\r\n\r\nclass SimulationTask\r\n  constructor: (@rawData) ->\r\n\r\n  getLevelName: ->\r\n    levelName = @rawData.sessions?[0]?.levelID\r\n    return levelName if levelName?\r\n    @throwMalformedTaskError 'The level name couldn\\'t be deduced from the task.'\r\n\r\n  generateTeamToSessionMap: ->\r\n    teamSessionMap = {}\r\n    for session in @rawData.sessions\r\n      @throwMalformedTaskError 'Two players share the same team' if teamSessionMap[session.team]?\r\n      teamSessionMap[session.team] = session.sessionID\r\n\r\n    teamSessionMap\r\n\r\n  throwMalformedTaskError: (errorString) ->\r\n    throw new Error \"The task was malformed, reason: #{errorString}\"\r\n\r\n  getFirstSessionID: -> @rawData.sessions[0].sessionID\r\n\r\n  getSecondSessionID: -> @rawData.sessions[1].sessionID\r\n\r\n  getTaskID: -> @rawData.taskID\r\n\r\n  getReceiptHandle: -> @rawData.receiptHandle\r\n\r\n  getSessions: -> @rawData.sessions\r\n\r\n  setWorld: (@world) ->\r\n","{hexToHSL, hslToHex} = require 'core/utils'\r\n\r\nmodule.exports = class SpriteBuilder\r\n  constructor: (@thangType, @options) ->\r\n    @options ?= {}\r\n    raw = @thangType.get('raw') or {}\r\n    @shapeStore = raw.shapes\r\n    @containerStore = raw.containers\r\n    @animationStore = raw.animations\r\n    @buildColorMaps()\r\n\r\n  setOptions: (@options) ->\r\n\r\n  buildMovieClip: (animationName, mode, startPosition, loops, labels) ->\r\n    animData = @animationStore[animationName]\r\n    unless animData\r\n      console.error 'couldn\\'t find animData from', @animationStore, 'for', animationName\r\n      return null\r\n    locals = {}\r\n    _.extend locals, @buildMovieClipShapes(animData.shapes)\r\n    _.extend locals, @buildMovieClipContainers(animData.containers)\r\n    _.extend locals, @buildMovieClipAnimations(animData.animations)\r\n    _.extend locals, @buildMovieClipGraphics(animData.graphics)\r\n    anim = new createjs.MovieClip()\r\n    if not labels\r\n      labels = {}\r\n      labels[animationName] = 0\r\n    anim.initialize(mode ? createjs.MovieClip.INDEPENDENT, startPosition ? 0, loops ? true, labels)\r\n    for tweenData in animData.tweens\r\n      tween = createjs.Tween\r\n      stopped = false\r\n      for func in tweenData\r\n        args = _.cloneDeep(func.a)\r\n        @dereferenceArgs(args, locals)\r\n        if tween[func.n]\r\n          tween = tween[func.n](args...)\r\n        else\r\n          # If we, say, skipped a shadow get(), then the wait() may not be present\r\n          stopped = true\r\n          break\r\n      anim.timeline.addTween(tween) unless stopped\r\n\r\n    anim.nominalBounds = new createjs.Rectangle(animData.bounds...)\r\n    if animData.frameBounds\r\n      anim.frameBounds = (new createjs.Rectangle(bounds...) for bounds in animData.frameBounds)\r\n    anim\r\n\r\n  dereferenceArgs: (args, locals) ->\r\n    for key, val of args\r\n      if locals[val]\r\n        args[key] = locals[val]\r\n      else if val is null\r\n        args[key] = {}\r\n      else if _.isString(val) and val.indexOf('createjs.') is 0\r\n        args[key] = eval(val) # TODO: Security risk\r\n      else if _.isObject(val) or _.isArray(val)\r\n        @dereferenceArgs(val, locals)\r\n    args\r\n\r\n  buildMovieClipShapes: (localShapes) ->\r\n    map = {}\r\n    for localShape in localShapes\r\n      if localShape.im\r\n        shape = new createjs.Shape()\r\n        shape._off = true\r\n      else\r\n        shape = @buildShapeFromStore(localShape.gn)\r\n        if localShape.m\r\n          shape.mask = map[localShape.m]\r\n      map[localShape.bn] = shape\r\n    map\r\n\r\n  buildMovieClipContainers: (localContainers) ->\r\n    map = {}\r\n    for localContainer in localContainers\r\n      container = @buildContainerFromStore(localContainer.gn)\r\n      container.setTransform(localContainer.t...)\r\n      container._off = localContainer.o if localContainer.o?\r\n      container.alpha = localContainer.al if localContainer.al?\r\n      map[localContainer.bn] = container\r\n    map\r\n\r\n  buildMovieClipAnimations: (localAnimations) ->\r\n    map = {}\r\n    for localAnimation in localAnimations\r\n      animation = @buildMovieClip(localAnimation.gn, localAnimation.a...)\r\n      animation.setTransform(localAnimation.t...)\r\n      map[localAnimation.bn] = animation\r\n    map\r\n\r\n  buildMovieClipGraphics: (localGraphics) ->\r\n    map = {}\r\n    for localGraphic in localGraphics\r\n      graphic = new createjs.Graphics().p(localGraphic.p)\r\n      map[localGraphic.bn] = graphic\r\n    map\r\n\r\n  buildShapeFromStore: (shapeKey, debug=false) ->\r\n    shapeData = @shapeStore[shapeKey]\r\n    shape = new createjs.Shape()\r\n    if shapeData.lf?\r\n      shape.graphics.lf shapeData.lf...\r\n    else if shapeData.fc?\r\n      shape.graphics.f @colorMap[shapeKey] or shapeData.fc\r\n    else if shapeData.rf?\r\n      shape.graphics.rf shapeData.rf...\r\n    if shapeData.ls?\r\n      shape.graphics.ls shapeData.ls...\r\n    else if shapeData.sc?\r\n      shape.graphics.s shapeData.sc\r\n    shape.graphics.ss shapeData.ss... if shapeData.ss?\r\n    shape.graphics.de shapeData.de... if shapeData.de?\r\n    shape.graphics.p shapeData.p if shapeData.p?\r\n    shape.setTransform shapeData.t...\r\n    shape\r\n\r\n  buildContainerFromStore: (containerKey) ->\r\n    console.error 'Yo we don\\'t have no containerKey' unless containerKey\r\n    contData = @containerStore[containerKey]\r\n    cont = new createjs.Container()\r\n    cont.initialize()\r\n    for childData in contData.c\r\n      if _.isString(childData)\r\n        child = @buildShapeFromStore(childData)\r\n      else\r\n        continue if not childData.gn\r\n        child = @buildContainerFromStore(childData.gn)\r\n        child.setTransform(childData.t...)\r\n      cont.addChild(child)\r\n    cont.bounds = new createjs.Rectangle(contData.b...)\r\n    cont\r\n\r\n  buildColorMaps: ->\r\n    @colorMap = {}\r\n    colorGroups = @thangType.get('colorGroups')\r\n    return if _.isEmpty colorGroups\r\n    return unless _.size @shapeStore  # We don't have the shapes loaded because we are doing a prerendered spritesheet approach\r\n    colorConfig = @options.colorConfig\r\n#    colorConfig ?= {team: {hue:0.4, saturation: -0.5, lightness: -0.5}} # test config\r\n    return if not colorConfig\r\n\r\n    for group, config of colorConfig\r\n      continue unless colorGroups[group] # color group not found...\r\n      @buildColorMapForGroup(colorGroups[group], config)\r\n\r\n  buildColorMapForGroup: (shapes, config) ->\r\n    return unless shapes.length\r\n    colors = @initColorMap(shapes)\r\n    @adjustHuesForColorMap(colors, config.hue)\r\n    @adjustValueForColorMap(colors, 1, config.saturation)\r\n    @adjustValueForColorMap(colors, 2, config.lightness)\r\n    @applyColorMap(shapes, colors)\r\n\r\n  initColorMap: (shapes) ->\r\n    colors = {}\r\n    for shapeKey in shapes\r\n      shape = @shapeStore[shapeKey]\r\n      continue if (not shape.fc?) or colors[shape.fc]\r\n      hsl = hexToHSL(shape.fc)\r\n      colors[shape.fc] = hsl\r\n    colors\r\n\r\n  adjustHuesForColorMap: (colors, targetHue) ->\r\n    hues = (hsl[0] for hex, hsl of colors)\r\n\r\n    # 'rotate' the hue spectrum so averaging works\r\n    if Math.max(hues) - Math.min(hues) > 0.5\r\n      hues = (if h < 0.5 then h + 1.0 else h for h in hues)\r\n    averageHue = sum(hues) / hues.length\r\n    averageHue %= 1\r\n    # end result should be something like a hue array of [0.9, 0.3] gets an average of 0.1\r\n\r\n    targetHue ?= 0\r\n    diff = targetHue - averageHue\r\n    hsl[0] = (hsl[0] + diff + 1) % 1 for hex, hsl of colors\r\n\r\n  adjustValueForColorMap: (colors, index, targetValue) ->\r\n    values = (hsl[index] for hex, hsl of colors)\r\n    averageValue = sum(values) / values.length\r\n    targetValue ?= 0.5\r\n    diff = targetValue - averageValue\r\n    for hex, hsl of colors\r\n      hsl[index] = Math.max(0, Math.min(1, hsl[index] + diff))\r\n\r\n  applyColorMap: (shapes, colors) ->\r\n    for shapeKey in shapes\r\n      shape = @shapeStore[shapeKey]\r\n      continue if (not shape.fc?) or not(colors[shape.fc])\r\n      @colorMap[shapeKey] = hslToHex(colors[shape.fc])\r\n\r\nsum = (nums) -> _.reduce(nums, (s, num) -> s + num)\r\n","SpriteBuilder = require('./SpriteBuilder')\r\nThangType = require('models/ThangType')\r\nCocoClass = require('core/CocoClass')\r\n\r\n\r\nclass SpriteExporter extends CocoClass\r\n  '''\r\n  To be used by the ThangTypeEditView to export ThangTypes to single sprite sheets which can be uploaded to\r\n  GridFS and used in gameplay, avoiding rendering vector images.\r\n\r\n  Code has been copied and reworked and simplified from LayerAdapter. Some shared code has been refactored into\r\n  ThangType, but more work could be done to rethink and reorganize Sprite rendering.\r\n  '''\r\n\r\n  constructor: (thangType, options) ->\r\n    @thangType = thangType\r\n    options ?= {}\r\n    @colorConfig = options.colorConfig or {}\r\n    @resolutionFactor = options.resolutionFactor or 1\r\n    @actionNames = options.actionNames or (action.name for action in @thangType.getDefaultActions())\r\n    @spriteType = options.spriteType or @thangType.get('spriteType') or 'segmented'\r\n    super()\r\n\r\n  build: ->\r\n    spriteSheetBuilder = new createjs.SpriteSheetBuilder()\r\n    if @spriteType is 'segmented'\r\n      @renderSegmentedThangType(spriteSheetBuilder)\r\n    else\r\n      @renderSingularThangType(spriteSheetBuilder)\r\n    try\r\n      spriteSheetBuilder.buildAsync()\r\n    catch e\r\n      @resolutionFactor *= 0.9\r\n      return @build()\r\n    spriteSheetBuilder.on 'complete', @onBuildSpriteSheetComplete, @, true, spriteSheetBuilder\r\n    @asyncBuilder = spriteSheetBuilder\r\n\r\n  renderSegmentedThangType: (spriteSheetBuilder) ->\r\n    containersToRender = @thangType.getContainersForActions(@actionNames)\r\n    spriteBuilder = new SpriteBuilder(@thangType, {colorConfig: @colorConfig})\r\n    for containerGlobalName in containersToRender\r\n      container = spriteBuilder.buildContainerFromStore(containerGlobalName)\r\n      frame = spriteSheetBuilder.addFrame(container, null, @resolutionFactor * (@thangType.get('scale') or 1))\r\n      spriteSheetBuilder.addAnimation(containerGlobalName, [frame], false)\r\n\r\n  renderSingularThangType: (spriteSheetBuilder) ->\r\n    actionObjects = _.values(@thangType.getActions())\r\n    animationActions = []\r\n    for a in actionObjects\r\n      continue unless a.animation\r\n      continue unless a.name in @actionNames\r\n      animationActions.push(a)\r\n\r\n    spriteBuilder = new SpriteBuilder(@thangType, {colorConfig: @colorConfig})\r\n\r\n    animationGroups = _.groupBy animationActions, (action) -> action.animation\r\n    for animationName, actions of animationGroups\r\n      scale = actions[0].scale or @thangType.get('scale') or 1\r\n      mc = spriteBuilder.buildMovieClip(animationName, null, null, null, {'temp':0})\r\n      spriteSheetBuilder.addMovieClip(mc, null, scale * @resolutionFactor)\r\n      frames = spriteSheetBuilder._animations['temp'].frames\r\n      framesMap = _.zipObject _.range(frames.length), frames\r\n      for action in actions\r\n        if action.frames\r\n          frames = (framesMap[parseInt(frame)] for frame in action.frames.split(','))\r\n        else\r\n          frames = _.sortBy(_.values(framesMap))\r\n        next = @thangType.nextForAction(action)\r\n        spriteSheetBuilder.addAnimation(action.name, frames, next)\r\n\r\n    containerActions = []\r\n    for a in actionObjects\r\n      continue unless a.container\r\n      continue unless a.name in @actionNames\r\n      containerActions.push(a)\r\n\r\n    containerGroups = _.groupBy containerActions, (action) -> action.container\r\n    for containerName, actions of containerGroups\r\n      container = spriteBuilder.buildContainerFromStore(containerName)\r\n      scale = actions[0].scale or @thangType.get('scale') or 1\r\n      frame = spriteSheetBuilder.addFrame(container, null, scale * @resolutionFactor)\r\n      for action in actions\r\n        spriteSheetBuilder.addAnimation(action.name, [frame], false)\r\n\r\n  onBuildSpriteSheetComplete: (e, builder) ->\r\n    if builder.spriteSheet._images.length > 1\r\n      total = 0\r\n      # get a rough estimate of how much smaller the spritesheet needs to be\r\n      for image, index in builder.spriteSheet._images\r\n        total += image.height / builder.maxHeight\r\n      @resolutionFactor /= (Math.max(1.1, Math.sqrt(total)))\r\n      @_renderNewSpriteSheet(e.async)\r\n      return\r\n\r\n    @trigger 'build', { spriteSheet: builder.spriteSheet }\r\n\r\n\r\n\r\nmodule.exports = SpriteExporter","module.exports = class SpriteParser\r\n  constructor: (@thangTypeModel) ->\r\n    # Create a new ThangType, or work with one we've been building\r\n    @thangType = $.extend(true, {}, @thangTypeModel.attributes.raw)\r\n    @thangType ?= {}\r\n    @thangType.shapes ?= {}\r\n    @thangType.containers ?= {}\r\n    @thangType.animations ?= {}\r\n\r\n    # Internal parser state\r\n    @shapeLongKeys = {}\r\n    @containerLongKeys = {}\r\n    @containerRenamings = {}\r\n    @animationLongKeys = {}\r\n    @animationRenamings = {}\r\n    @populateLongKeys()\r\n\r\n  populateLongKeys: ->\r\n    for shortKey, shape of @thangType.shapes\r\n      longKey = JSON.stringify(_.values(shape))\r\n      @shapeLongKeys[longKey] = shortKey\r\n    for shortKey, container of @thangType.containers\r\n      longKey = JSON.stringify(_.values(container))\r\n      @containerLongKeys[longKey] = shortKey\r\n    for shortKey, animation of @thangType.animations\r\n      longKey = JSON.stringify(_.values(animation))\r\n      @animationLongKeys[longKey] = shortKey\r\n\r\n  parse: (source) ->\r\n    # Grab the library properties' width/height so we can subtract half of each from frame bounds\r\n    properties = source.match(/.*lib\\.properties = \\{\\n.*?width: (\\d+),\\n.*?height: (\\d+)/im)\r\n    @width = parseInt(properties?[1] ? '0', 10)\r\n    @height = parseInt(properties?[2] ? '0', 10)\r\n\r\n    # Remove webfontAvailable line, not relevant\r\n    source = source.replace /lib\\.webfontAvailable = (.|\\n)+?};/, ''\r\n\r\n    options = {loc: false, range: true}\r\n    ast = esprima.parse source, options\r\n    blocks = @findBlocks ast, source\r\n    containers = _.filter blocks, {kind: 'Container'}\r\n    movieClips = _.filter blocks, {kind: 'MovieClip'}\r\n\r\n    mainClip = _.last(movieClips) ? _.last(containers)\r\n    @animationName = mainClip.name\r\n    for container, index in containers\r\n      if index is containers.length - 1 and not movieClips.length and container.bounds?.length\r\n        container.bounds[0] -= @width / 2\r\n        container.bounds[1] -= @height / 2\r\n      [shapeKeys, localShapes] = @getShapesFromBlock container, source\r\n      localContainers = @getContainersFromMovieClip container, source, true # Added true because anya attack was breaking, but might break other imports\r\n      addChildArgs = @getAddChildCallArguments container, source\r\n      instructions = []\r\n      for bn in addChildArgs\r\n        gotIt = false\r\n        for shape in localShapes\r\n          if shape.bn is bn\r\n            instructions.push shape.gn\r\n            gotIt = true\r\n            break\r\n        continue if gotIt\r\n        for c in localContainers\r\n          if c.bn is bn\r\n            instructions.push {t: c.t, gn: c.gn}\r\n            break\r\n      continue unless container.bounds and instructions.length\r\n      @addContainer {c: instructions, b: container.bounds}, container.name\r\n\r\n    childrenMovieClips = []\r\n\r\n    for movieClip, index in movieClips\r\n      lastBounds = null\r\n      # fill in bounds which are null...\r\n      for bounds, boundsIndex in movieClip.frameBounds\r\n        if not bounds\r\n          movieClip.frameBounds[boundsIndex] = _.clone(lastBounds)\r\n        else\r\n          lastBounds = bounds\r\n\r\n      localGraphics = @getGraphicsFromBlock(movieClip, source)\r\n      [shapeKeys, localShapes] = @getShapesFromBlock movieClip, source\r\n      localContainers = @getContainersFromMovieClip movieClip, source, true\r\n      localAnimations = @getAnimationsFromMovieClip movieClip, source, true\r\n      for animation in localAnimations\r\n        childrenMovieClips.push(animation.gn)\r\n      localTweens = @getTweensFromMovieClip movieClip, source, localShapes, localContainers, localAnimations\r\n      @addAnimation {\r\n        shapes: localShapes\r\n        containers: localContainers\r\n        animations: localAnimations\r\n        tweens: localTweens\r\n        graphics: localGraphics\r\n        bounds: movieClip.bounds\r\n        frameBounds: movieClip.frameBounds\r\n      }, movieClip.name\r\n\r\n    for movieClip in movieClips\r\n      if movieClip.name not in childrenMovieClips\r\n        for bounds in movieClip.frameBounds\r\n          bounds[0] -= @width / 2\r\n          bounds[1] -= @height / 2\r\n        movieClip.bounds[0] -= @width / 2\r\n        movieClip.bounds[1] -= @height / 2\r\n\r\n    @saveToModel()\r\n    return movieClips[0]?.name\r\n\r\n  saveToModel: ->\r\n    @thangTypeModel.set('raw', @thangType)\r\n\r\n  addShape: (shape) ->\r\n    longKey = JSON.stringify(_.values(shape))\r\n    shortKey = @shapeLongKeys[longKey]\r\n    unless shortKey?\r\n      shortKey = '' + _.size @thangType.shapes\r\n      shortKey += '+' while @thangType.shapes[shortKey]\r\n      @thangType.shapes[shortKey] = shape\r\n      @shapeLongKeys[longKey] = shortKey\r\n    return shortKey\r\n\r\n  addContainer: (container, name) ->\r\n    longKey = JSON.stringify(_.values(container))\r\n    shortKey = @containerLongKeys[longKey]\r\n    if not shortKey?\r\n      shortKey = name\r\n      if @thangType.containers[shortKey]?\r\n        shortKey = @animationName + ':' + name\r\n      @thangType.containers[shortKey] = container\r\n      @containerLongKeys[longKey] = shortKey\r\n    @containerRenamings[name] = shortKey\r\n    return shortKey\r\n\r\n  addAnimation: (animation, name) ->\r\n    longKey = JSON.stringify(_.values(animation))\r\n    shortKey = @animationLongKeys[longKey]\r\n    if shortKey?\r\n      @animationRenamings[shortKey] = name\r\n    else\r\n      shortKey = name\r\n      if @thangType.animations[shortKey]?\r\n        shortKey = @animationName + ':' + name\r\n      @thangType.animations[shortKey] = animation\r\n      @animationLongKeys[longKey] = shortKey\r\n      @animationRenamings[name] = shortKey\r\n    return shortKey\r\n\r\n  walk: (node, parent, fn) ->\r\n    node.parent = parent\r\n    for key, child of node\r\n      continue if key is 'parent'\r\n      if _.isArray child\r\n        for grandchild in child\r\n          @walk grandchild, node, fn if _.isString grandchild?.type\r\n      else if _.isString child?.type\r\n        node.parent = parent\r\n        @walk child, node, fn\r\n    fn node\r\n\r\n  orphanify: (node) ->\r\n    delete node.parent if node.parent\r\n    for key, child of node\r\n      continue if key is 'parent'\r\n      if _.isArray child\r\n        for grandchild in child\r\n          @orphanify grandchild if _.isString grandchild?.type\r\n      else if _.isString child?.type\r\n        delete node.parent if node.parent\r\n        @orphanify child\r\n\r\n  subSourceFromRange: (range, source) ->\r\n    source[range[0] ... range[1]]\r\n\r\n  grabFunctionArguments: (source, literal=false) ->\r\n    # Replace first and last parens with brackets to turn args into array\r\n    args = source.replace(/.*?\\(/, '[').replace(/\\)[^)]*?$/, ']')\r\n    if literal then eval(args) else args\r\n\r\n  findBlocks: (ast, source) ->\r\n    functionExpressions = []\r\n    rectangles = []\r\n    gatherFunctionExpressions = (node) =>\r\n      if node.type is 'FunctionExpression'\r\n        name = node.parent?.left?.property?.name\r\n        if name\r\n          expression = node.parent.parent\r\n          unless expression.parent?.right?.right\r\n            if /frame_[\\d]+/.test name  # Skip some useless KR function things\r\n              return\r\n          kind = expression.parent.right.right.callee.property.name\r\n          statement = node.parent.parent.parent.parent\r\n          statementIndex = _.indexOf statement.parent.body, statement\r\n          nominalBoundsStatement = statement.parent.body[statementIndex + 1]\r\n          nominalBoundsRange = nominalBoundsStatement.expression.right.range\r\n          nominalBoundsSource = @subSourceFromRange nominalBoundsRange, source\r\n          nominalBounds = @grabFunctionArguments nominalBoundsSource, true\r\n\r\n          frameBoundsStatement = statement.parent.body[statementIndex + 2]\r\n          if frameBoundsStatement\r\n            frameBoundsRange = frameBoundsStatement.expression.right.range\r\n            frameBoundsSource = @subSourceFromRange frameBoundsRange, source\r\n            if frameBoundsSource.search(/\\[rect/) is -1  # some other statement; we don't have multiframe bounds\r\n              console.log 'Didn\\'t have multiframe bounds for this movie clip.'\r\n              frameBounds = [_.clone(nominalBounds)]\r\n            else\r\n              lastRect = nominalBounds\r\n              frameBounds = []\r\n              for arg, i in frameBoundsStatement.expression.right.elements\r\n                bounds = null\r\n                argSource = @subSourceFromRange arg.range, source\r\n                if arg.type is 'Identifier'\r\n                  bounds = lastRect\r\n                else if arg.type is 'NewExpression'\r\n                  bounds = @grabFunctionArguments argSource, true\r\n                else if arg.type is 'AssignmentExpression'\r\n                  bounds = @grabFunctionArguments argSource.replace('rect=', ''), true\r\n                  lastRect = bounds\r\n                else if arg.type is 'Literal' and arg.value is null\r\n                  bounds = [0, 0, 1, 1]  # Let's try this.\r\n                frameBounds.push _.clone bounds\r\n          else\r\n            frameBounds = [_.clone(nominalBounds)]\r\n\r\n          functionExpressions.push {name: name, bounds: nominalBounds, frameBounds: frameBounds, expression: node.parent.parent, kind: kind}\r\n    @walk ast, null, gatherFunctionExpressions\r\n    functionExpressions\r\n\r\n  ###\r\n    this.shape_1.graphics.f('#605E4A').s().p('AAOD/IgOgaIAEhkIgmgdIgMgBIgPgFIgVgJQA1h9g8jXQAQAHAOASQAQAUAKAeQARAuAJBJQAHA/gBA5IAAADIACAfIAFARIACAGIAEAHIAHAHQAVAXAQAUQAUAaANAUIABACIgsgdIgggXIAAAnIABAwIgBgBg');\r\n    this.shape_1.sett(23.2,30.1);\r\n\r\n    this.shape.graphics.f().s('#000000').ss(0.1,1,1).p('AAAAAQAAAAAAAA');\r\n    this.shape.sett(3.8,22.4);\r\n  ###\r\n\r\n  getGraphicsFromBlock: (block, source) ->\r\n    block = block.expression.object.right.body\r\n    localGraphics = []\r\n    gatherShapeDefinitions = (node) =>\r\n      return unless node.type is 'NewExpression' and node.callee.property.name is 'Graphics'\r\n      blockName = node.parent.parent.parent.id.name\r\n      graphicsString = node.parent.parent.arguments[0].value\r\n      localGraphics.push {p:graphicsString, bn:blockName}\r\n\r\n    @walk block, null, gatherShapeDefinitions\r\n    return localGraphics\r\n\r\n  getShapesFromBlock: (block, source) ->\r\n    block = block.expression.object.right.body\r\n    shapeKeys = []\r\n    localShapes = []\r\n    gatherShapeDefinitions = (node) =>\r\n      return unless node.type is 'MemberExpression'\r\n      name = node.object?.object?.property?.name\r\n      if not name\r\n        name = node.parent?.parent?.id?.name\r\n        return unless name and name.indexOf('mask') is 0 and node.property?.name is 'Shape'\r\n        shape = {bn: name, im: true}\r\n        localShapes.push shape\r\n        return\r\n      return unless name.search('shape') is 0 and node.object.property?.name is 'graphics'\r\n      fillCall = node.parent\r\n      if fillCall.callee.property.name is 'lf'\r\n        linearGradientFillSource = @subSourceFromRange fillCall.parent.range, source\r\n        linearGradientFill = @grabFunctionArguments linearGradientFillSource.replace(/.*?lf\\(/, 'lf('), true\r\n      else if fillCall.callee.property.name is 'rf'\r\n        radialGradientFillSource = @subSourceFromRange fillCall.parent.range, source\r\n        radialGradientFill = @grabFunctionArguments radialGradientFillSource.replace(/.*?lf\\(/, 'lf('), true\r\n      else\r\n        fillColor = fillCall.arguments[0]?.value ? null\r\n        callName = fillCall.callee.property.name\r\n        console.error 'What is this?! Not a fill!', callName unless callName is 'f'\r\n      strokeCall = node.parent.parent.parent.parent\r\n      if strokeCall.object.callee.property.name is 'ls'\r\n        linearGradientStrokeSource = @subSourceFromRange strokeCall.parent.range, source\r\n        linearGradientStroke = @grabFunctionArguments linearGradientStrokeSource.replace(/.*?ls\\(/, 'ls(').replace(/\\).ss\\(.*/, ')'), true\r\n      else\r\n        strokeColor = strokeCall.object.arguments?[0]?.value ? null\r\n        console.error 'What is this?! Not a stroke!' unless strokeCall.object.callee.property.name is 's'\r\n      strokeStyle = null\r\n      graphicsStatement = strokeCall.parent\r\n      if strokeColor or linearGradientStroke\r\n        # There might now be an extra node, ss, for stroke style\r\n        strokeStyleSource = @subSourceFromRange strokeCall.parent.range, source\r\n        if strokeStyleSource.search(/ss\\(/) isnt -1\r\n          strokeStyle = @grabFunctionArguments strokeStyleSource.replace(/.*?ss\\(/, 'ss('), true\r\n          graphicsStatement = strokeCall.parent.parent.parent\r\n      if graphicsStatement.callee.property.name is 'de'\r\n        drawEllipseSource = @subSourceFromRange graphicsStatement.parent.range, source\r\n        drawEllipse = @grabFunctionArguments drawEllipseSource.replace(/.*?de\\(/, 'de('), true\r\n      else\r\n        path = graphicsStatement.arguments?[0]?.value ? null\r\n        console.error 'What is this?! Not a path!' unless graphicsStatement.callee.property.name is 'p'\r\n      body = graphicsStatement.parent.parent.body\r\n      graphicsStatementIndex = _.indexOf body, graphicsStatement.parent\r\n      t = body[graphicsStatementIndex + 1].expression\r\n      tSource = @subSourceFromRange t.range, source\r\n      if tSource.search('setTransform') is -1\r\n        t = [0, 0]\r\n      else\r\n        t = @grabFunctionArguments tSource, true\r\n\r\n      for statement in body.slice(graphicsStatementIndex + 2)\r\n        # Handle things like\r\n        # this.shape.mask = this.shape_1.mask = this.shape_2.mask = this.shape_3.mask = mask;\r\n        continue unless statement.expression?.left?.property?.name is 'mask'\r\n        exp = statement.expression\r\n        matchedName = false\r\n        while exp\r\n          matchedName = matchedName or exp.left?.object?.property?.name is name\r\n          mask = exp.name\r\n          exp = exp.right\r\n        continue unless matchedName\r\n        break\r\n\r\n      shape = {t: t}\r\n      shape.p = path if path\r\n      shape.de = drawEllipse if drawEllipse\r\n      shape.sc = strokeColor if strokeColor\r\n      shape.ss = strokeStyle if strokeStyle\r\n      shape.fc = fillColor if fillColor\r\n      shape.lf = linearGradientFill if linearGradientFill\r\n      shape.rf = radialGradientFill if radialGradientFill\r\n      shape.ls = linearGradientStroke if linearGradientStroke\r\n      if name.search('shape') isnt -1 and shape.fc is 'rgba(0,0,0,0.451)' and not shape.ss and not shape.sc\r\n        console.log 'Skipping a shadow', name, shape, 'because we\\'re doing shadows separately now.'\r\n        return\r\n      #if name.search('shape') isnt -1 and shape.fc is 'rgba(0,0,0,0.498)' and not shape.ss and not shape.sc\r\n      #  console.log 'Skipping a KR shadow', name, shape, 'because we\\'re doing shadows separately now.'\r\n      #  return\r\n      shapeKeys.push shapeKey = @addShape shape\r\n      localShape = {bn: name, gn: shapeKey}\r\n      localShape.m = mask if mask\r\n      localShapes.push localShape\r\n\r\n    @walk block, null, gatherShapeDefinitions\r\n    return [shapeKeys, localShapes]\r\n\r\n  getContainersFromMovieClip: (movieClip, source, possibleAnimations=false) ->\r\n    block = movieClip.expression.object.right.body\r\n    localContainers = []\r\n    gatherContainerDefinitions = (node) =>\r\n      return unless node.type is 'Identifier' and node.name is 'lib'\r\n      args = node.parent.parent.arguments\r\n      libName = node.parent.property.name\r\n      return if args.length and not possibleAnimations  # might be animation, not container\r\n      gn = @containerRenamings[libName]\r\n      return if possibleAnimations and not gn  # not a container we know about\r\n      bn = node.parent.parent.parent.left.property.name\r\n      expressionStatement = node.parent.parent.parent.parent\r\n      body = expressionStatement.parent.body\r\n      expressionStatementIndex = _.indexOf body, expressionStatement\r\n      t = body[expressionStatementIndex + 1].expression\r\n      tSource = @subSourceFromRange t.range, source\r\n      t = @grabFunctionArguments tSource, true\r\n      o = body[expressionStatementIndex + 2].expression\r\n      localContainer = {bn: bn, t: t, gn: gn}\r\n      if o and o.left?.object?.property?.name is bn and o.left.property?.name is '_off'\r\n        localContainer.o = o.right.value\r\n      else if o and o.left?.property?.name is 'alpha'\r\n        localContainer.al = o.right.value\r\n      localContainers.push localContainer\r\n\r\n    @walk block, null, gatherContainerDefinitions\r\n    return localContainers\r\n\r\n  getAnimationsFromMovieClip: (movieClip, source, possibleContainers=false) ->\r\n    block = movieClip.expression.object.right.body\r\n    localAnimations = []\r\n    gatherAnimationDefinitions = (node) =>\r\n      return unless node.type is 'Identifier' and node.name is 'lib'\r\n      args = node.parent.parent.arguments\r\n      libName = node.parent.property.name\r\n      return unless args.length or possibleContainers  # might be container, not animation\r\n      return if @containerRenamings[libName] and not @animationRenamings[libName]  # we have it as a container\r\n      args = @grabFunctionArguments @subSourceFromRange(node.parent.parent.range, source), true\r\n      bn = node.parent.parent.parent.left.property.name\r\n      expressionStatement = node.parent.parent.parent.parent\r\n      body = expressionStatement.parent.body\r\n      expressionStatementIndex = _.indexOf body, expressionStatement\r\n      t = body[expressionStatementIndex + 1].expression\r\n      tSource = @subSourceFromRange t.range, source\r\n      t = @grabFunctionArguments tSource, true\r\n      gn = @animationRenamings[libName] ? libName\r\n      localAnimation = {bn: bn, t: t, gn: gn, a: args}\r\n      localAnimations.push localAnimation\r\n\r\n    @walk block, null, gatherAnimationDefinitions\r\n    return localAnimations\r\n\r\n  getTweensFromMovieClip: (movieClip, source, localShapes, localContainers, localAnimations) ->\r\n    block = movieClip.expression.object.right.body\r\n    localTweens = []\r\n    gatherTweens = (node) =>\r\n      return unless node.property?.name is 'addTween'\r\n      callExpressions = []\r\n      tweenNode = node\r\n      gatherCallExpressions = (node) =>\r\n        return unless node.type is 'CallExpression'\r\n        name = node.callee.property?.name\r\n        return unless name in ['get', 'to', 'wait']\r\n        return if name is 'get' and callExpressions.length # avoid Ease calls in the tweens\r\n        flattenedRanges = _.flatten [(a.range for a in node.arguments)]\r\n        range = [_.min(flattenedRanges), _.max(flattenedRanges)]\r\n        # Replace 'this.<local>' references with just the 'name'\r\n        argsSource = @subSourceFromRange(range, source)\r\n        argsSource = argsSource.replace(/mask/g, 'this.mask') # so the mask thing will be handled correctly as a blockName in the next line\r\n        argsSource = argsSource.replace(/this\\.([a-z_0-9]+)/ig, '\"$1\"') # turns this.shape literal to 'shape' string\r\n        argsSource = argsSource.replace(/cjs(.+)\\)/, '\"createjs$1)\"') # turns cjs.Ease.get(0.5)\r\n        argsSource = '{}' if argsSource is 'this' # not sure what this should be but it looks like we don't need it for KR sprites\r\n\r\n        args = eval \"[#{argsSource}]\"\r\n        shadowTween = args[0]?.search?('shape') is 0 and not _.find(localShapes, bn: args[0])\r\n        shadowTween = shadowTween or args[0]?.state?[0]?.t?.search?('shape') is 0 and not _.find(localShapes, bn: args[0].state[0].t)\r\n        if shadowTween\r\n          console.log 'Skipping tween', name, argsSource, args, 'from localShapes', localShapes, 'presumably because it\\'s a shadow we skipped.'\r\n          return\r\n        callExpressions.push {n: name, a: args}\r\n      @walk node.parent.parent, null, gatherCallExpressions\r\n      localTweens.push callExpressions\r\n\r\n    @walk block, null, gatherTweens\r\n    return localTweens\r\n\r\n  getAddChildCallArguments: (block, source) ->\r\n    block = block.expression.object.right.body\r\n    localArgs = []\r\n    gatherAddChildCalls = (node) =>\r\n      return unless node.type is 'Identifier' and node.name is 'addChild'\r\n      args = node.parent.parent.arguments\r\n      args = (arg.property.name for arg in args)\r\n      localArgs.push arg for arg in args\r\n      return\r\n\r\n    @walk block, null, gatherAddChildCalls\r\n    return localArgs\r\n###\r\n\r\n  this.timeline.addTween(cjs.Tween.get(this.instance).to({scaleX:0.82,scaleY:0.79,rotation:-10.8,x:98.4,y:-86.5},4).to({scaleY:0.7,rotation:9.3,x:95.6,y:-48.8},1).to({scaleX:0.82,scaleY:0.61,rotation:29.4,x:92.8,y:-11},1).to({regX:7.3,scaleX:0.82,scaleY:0.53,rotation:49.7,x:90.1,y:26.6},1).to({regX:7.2,regY:29.8,scaleY:0.66,rotation:19.3,x:101.2,y:-27.8},2).to({regY:29.9,scaleY:0.79,rotation:-10.8,x:98.4,y:-86.5},2).to({scaleX:0.84,scaleY:0.83,rotation:-30.7,x:68.4,y:-110},2).to({regX:7.3,scaleX:0.84,scaleY:0.84,rotation:-33.9,x:63.5,y:-114},1).wait(1));\r\n\r\n###\r\n\r\n###\r\nsimpleSample = \"\"\"\r\n(function (lib, img, cjs) {\r\n\r\nvar p; // shortcut to reference prototypes\r\n\r\n// stage content:\r\n(lib.enemy_flying_move_side = function(mode,startPosition,loop) {\r\n  this.initialize(mode,startPosition,loop,{});\r\n\r\n  // D_Head\r\n  this.instance = new lib.Dragon_Head();\r\n  this.instance.setTransform(227,200.5,1,1,0,0,0,51.9,42.5);\r\n\r\n  this.timeline.addTween(cjs.Tween.get(this.instance).to({y:182.9},7).to({y:200.5},7).wait(1));\r\n\r\n  // Layer 7\r\n  this.shape = new cjs.Shape();\r\n  this.shape.graphics.f('#4F6877').s().p('AgsAxQgSgVgB');\r\n  this.shape.setTransform(283.1,146.1);\r\n\r\n  // Layer 7 2\r\n  this.shape_1 = new cjs.Shape();\r\n  this.shape_1.graphics.f('rgba(255,255,255,0.4)').s().p('ArTs0QSMB7EbVGQhsBhiGBHQjg1IvVkhg');\r\n  this.shape_1.setTransform(400.2,185.5);\r\n\r\n  this.timeline.addTween(cjs.Tween.get({}).to({state:[]}).to({state:[{t:this.shape}]},7).to({state:[]},2).wait(6));\r\n\r\n  // Wing\r\n  this.instance_9 = new lib.Wing_Animation('synched',0);\r\n  this.instance_9.setTransform(313.9,145.6,1,1,0,0,0,49,-83.5);\r\n\r\n  this.timeline.addTween(cjs.Tween.get(this.instance_9).to({y:128,startPosition:7},7).wait(1));\r\n\r\n  // Example hard one with two shapes\r\n  this.timeline.addTween(cjs.Tween.get({}).to({state:[]}).to({state:[{t:this.shape}]},7).to({state:[{t:this.shape_1}]},1).to({state:[]},1).wait(7));\r\n\r\n\r\n}).prototype = p = new cjs.MovieClip();\r\np.nominalBounds = new cjs.Rectangle(7.1,48.9,528.7,431.1);\r\n\r\n(lib.Dragon_Head = function() {\r\n  this.initialize();\r\n\r\n  // Isolation Mode\r\n  this.shape = new cjs.Shape();\r\n  this.shape.graphics.f('#1D2226').s().p('AgVAwQgUgdgN');\r\n  this.shape.setTransform(75,25.8);\r\n\r\n  this.shape_1 = new cjs.Shape();\r\n  this.shape_1.graphics.f('#1D2226').s().p('AgnBXQACABAF');\r\n  this.shape_1.setTransform(80.8,22);\r\n\r\n  this.addChild(this.shape_1,this.shape);\r\n}).prototype = p = new cjs.Container();\r\np.nominalBounds = new cjs.Rectangle(5.8,0,87.9,85);\r\n\r\n(lib.WingPart_01 = function() {\r\n  this.initialize();\r\n\r\n  // Layer 1\r\n  this.shape = new cjs.Shape();\r\n  this.shape.graphics.f('#DBDDBC').s().p('Ag3BeQgCgRA');\r\n  this.shape.setTransform(10.6,19.7,1.081,1.081);\r\n\r\n  this.shape_1 = new cjs.Shape();\r\n  this.shape_1.graphics.f('#1D2226').s().p('AB4CDQgGg');\r\n  this.shape_1.setTransform(19.9,17.6,1.081,1.081);\r\n\r\n  this.shape_2 = new cjs.Shape();\r\n  this.shape_2.graphics.f('#605E4A').s().p('AiECbQgRg');\r\n  this.shape_2.setTransform(19.5,18.4,1.081,1.081);\r\n\r\n  this.addChild(this.shape_2,this.shape_1,this.shape);\r\n}).prototype = p = new cjs.Container();\r\np.nominalBounds = new cjs.Rectangle(0,-3.1,40,41.6);\r\n\r\n\r\n(lib.Wing_Animation = function(mode,startPosition,loop) {\r\n  this.initialize(mode,startPosition,loop,{});\r\n\r\n  // WP_02\r\n  this.instance = new lib.WingPart_01();\r\n  this.instance.setTransform(53.6,-121.9,0.854,0.854,-40.9,0,0,7.2,29.9);\r\n\r\n  this.timeline.addTween(cjs.Tween.get(this.instance).to({scaleY:0.7,rotation:9.3,x:95.6,y:-48.8},1).wait(1));\r\n\r\n}).prototype = p = new cjs.MovieClip();\r\np.nominalBounds = new cjs.Rectangle(-27.7,-161.6,153.4,156.2);\r\n\r\n})(lib = lib||{}, images = images||{}, createjs = createjs||{});\r\nvar lib, images, createjs;\r\n\"\"\"\r\n###\r\n","CocoClass = require 'core/CocoClass'\r\nGameUIState = require 'models/GameUIState'\r\n\r\n# If I were the kind of math major who remembered his math, this would all be done with matrix transforms.\r\n\r\nr2d = (radians) -> radians * 180 / Math.PI\r\nd2r = (degrees) -> degrees / 180 * Math.PI\r\n\r\nMAX_ZOOM = 8\r\nMIN_ZOOM = 0.1\r\nDEFAULT_ZOOM = 2.0\r\nDEFAULT_TARGET = {x: 0, y: 0}\r\nDEFAULT_TIME = 1000\r\nSTANDARD_ZOOM_WIDTH = 924\r\nSTANDARD_ZOOM_HEIGHT = 589\r\n\r\n# You can't mutate any of the constructor parameters after construction.\r\n# You can only call zoomTo to change the zoom target and zoom level.\r\nmodule.exports = class Camera extends CocoClass\r\n  @PPM: 10   # pixels per meter\r\n  @MPP: 0.1  # meters per pixel; should match @PPM\r\n\r\n  bounds: null  # list of two surface points defining the viewable rectangle in the world\r\n                # or null if there are no bounds\r\n\r\n  # what the camera is pointed at right now\r\n  target: DEFAULT_TARGET\r\n  zoom: DEFAULT_ZOOM\r\n  canvasScaleFactorX: 1\r\n  canvasScaleFactorY: 1\r\n\r\n  # properties for tracking going between targets\r\n  oldZoom: null\r\n  newZoom: null\r\n  oldTarget: null\r\n  newTarget: null\r\n  tweenProgress: 0.0\r\n\r\n  instant: false\r\n\r\n  # INIT\r\n\r\n  subscriptions:\r\n    'camera:zoom-in': 'onZoomIn'\r\n    'camera:zoom-out': 'onZoomOut'\r\n    'camera:zoom-to': 'onZoomTo'\r\n    'level:restarted': 'onLevelRestarted'\r\n\r\n  constructor: (@canvas, @options={}) ->\r\n    angle=Math.asin(0.75)\r\n    hFOV=d2r(30)\r\n    super()\r\n    @gameUIState = @options.gameUIState or new GameUIState()\r\n    @listenTo @gameUIState, 'surface:stage-mouse-move', @onMouseMove\r\n    @listenTo @gameUIState, 'surface:stage-mouse-down', @onMouseDown\r\n    @listenTo @gameUIState, 'surface:stage-mouse-up', @onMouseUp\r\n    @listenTo @gameUIState, 'surface:mouse-scrolled', @onMouseScrolled\r\n    @handleEvents = @options.handleEvents ? true\r\n    @canvasWidth = parseInt(@canvas.attr('width'), 10)\r\n    @canvasHeight = parseInt(@canvas.attr('height'), 10)\r\n    @offset = {x: 0, y: 0}\r\n    @calculateViewingAngle angle\r\n    @calculateFieldOfView hFOV\r\n    @calculateAxisConversionFactors()\r\n    @calculateMinMaxZoom()\r\n    @updateViewports()\r\n\r\n  onResize: (newCanvasWidth, newCanvasHeight) ->\r\n    @canvasScaleFactorX = newCanvasWidth / @canvasWidth\r\n    @canvasScaleFactorY = newCanvasHeight / @canvasHeight\r\n    Backbone.Mediator.publish 'camera:zoom-updated', camera: @, zoom: @zoom, surfaceViewport: @surfaceViewport\r\n\r\n  calculateViewingAngle: (angle) ->\r\n    # Operate on open interval between 0 - 90 degrees to make the math easier\r\n    epsilon = 0.000001  # Too small and numerical instability will get us.\r\n    @angle = Math.max(Math.min(Math.PI / 2 - epsilon, angle), epsilon)\r\n    if @angle isnt angle and angle isnt 0 and angle isnt Math.PI / 2\r\n      console.log \"Restricted given camera angle of #{r2d(angle)} to #{r2d(@angle)}.\"\r\n\r\n  calculateFieldOfView: (hFOV) ->\r\n    # http://en.wikipedia.org/wiki/Field_of_view_in_video_games\r\n    epsilon = 0.000001  # Too small and numerical instability will get us.\r\n    @hFOV = Math.max(Math.min(Math.PI - epsilon, hFOV), epsilon)\r\n    if @hFOV isnt hFOV and hFOV isnt 0 and hFOV isnt Math.PI\r\n      console.log \"Restricted given horizontal field of view to #{r2d(hFOV)} to #{r2d(@hFOV)}.\"\r\n    @vFOV = 2 * Math.atan(Math.tan(@hFOV / 2) * @canvasHeight / @canvasWidth)\r\n    if @vFOV > Math.PI\r\n      console.log 'Vertical field of view problem: expected canvas not to be taller than it is wide with high field of view.'\r\n      @vFOV = Math.PI - epsilon\r\n\r\n  calculateAxisConversionFactors: ->\r\n    @y2x = Math.sin @angle      # 1 unit along y is equivalent to y2x units along x\r\n    @z2x = Math.cos @angle      # 1 unit along z is equivalent to z2x units along x\r\n    @z2y = @z2x / @y2x          # 1 unit along z is equivalent to z2y units along y\r\n    @x2y = 1 / @y2x             # 1 unit along x is equivalent to x2y units along y\r\n    @x2z = 1 / @z2x             # 1 unit along x is equivalent to x2z units along z\r\n    @y2z = 1 / @z2y             # 1 unit along y is equivalent to y2z units along z\r\n\r\n  # CONVERSIONS AND CALCULATIONS\r\n\r\n  worldToSurface: (pos) ->\r\n    x = pos.x * Camera.PPM\r\n    y = -pos.y * @y2x * Camera.PPM\r\n    if pos.z\r\n      y -= @z2y * @y2x * pos.z * Camera.PPM\r\n    {x: x, y: y}\r\n\r\n  surfaceToCanvas: (pos) ->\r\n    {x: (pos.x - @surfaceViewport.x) * @zoom, y: (pos.y - @surfaceViewport.y) * @zoom}\r\n\r\n  canvasToScreen: (pos) ->\r\n    {x: pos.x * @canvasScaleFactorX, y: pos.y * @canvasScaleFactorY}\r\n\r\n  screenToCanvas: (pos) ->\r\n    {x: pos.x / @canvasScaleFactorX, y: pos.y / @canvasScaleFactorY}\r\n\r\n  canvasToSurface: (pos) ->\r\n    {x: pos.x / @zoom + @surfaceViewport.x, y: pos.y / @zoom + @surfaceViewport.y}\r\n\r\n  surfaceToWorld: (pos) ->\r\n    {x: pos.x * Camera.MPP, y: -pos.y * Camera.MPP * @x2y, z: 0}\r\n\r\n  canvasToWorld: (pos) -> @surfaceToWorld @canvasToSurface pos\r\n  worldToCanvas: (pos) -> @surfaceToCanvas @worldToSurface pos\r\n  worldToScreen: (pos) -> @canvasToScreen @worldToCanvas pos\r\n  surfaceToScreen: (pos) -> @canvasToScreen @surfaceToCanvas pos\r\n  screenToSurface: (pos) -> @canvasToSurface @screenToCanvas pos\r\n  screenToWorld: (pos) -> @surfaceToWorld @screenToSurface pos\r\n\r\n  cameraWorldPos: ->\r\n    # I tried to figure out the math for how much of @vFOV is below the midpoint (botFOV) and how much is above (topFOV), but I failed.\r\n    # So I'm just making something up. This would give botFOV 20deg, topFOV 10deg at @vFOV 30deg and @angle 45deg, or an even 15/15 at @angle 90deg.\r\n    botFOV = @x2y * @vFOV / (@y2x + @x2y)\r\n    topFOV = @y2x * @vFOV / (@y2x + @x2y)\r\n    botDist = @worldViewport.height / 2 * Math.sin(@angle) / Math.sin(botFOV)\r\n    z = botDist * Math.sin(@angle + botFOV)\r\n    x: @worldViewport.cx, y: @worldViewport.cy - z * @z2y, z: z\r\n\r\n  distanceTo: (pos) ->\r\n    # Get the physical distance in meters from the camera to the given world pos.\r\n    cpos = @cameraWorldPos()\r\n    dx = pos.x - cpos.x\r\n    dy = pos.y - cpos.y\r\n    dz = (pos.z or 0) - cpos.z\r\n    Math.sqrt dx * dx + dy * dy + dz * dz\r\n\r\n  distanceRatioTo: (pos) ->\r\n    # Get the ratio of the distance to the given world pos over the distance to the center of the camera view.\r\n    cpos = @cameraWorldPos()\r\n    dy = @worldViewport.cy - cpos.y\r\n    camDist = Math.sqrt(dy * dy + cpos.z * cpos.z)\r\n    return @distanceTo(pos) / camDist\r\n\r\n    # Old method for flying things below; could re-integrate this\r\n    ## Because none of our maps are designed to get smaller with distance along the y-axis, we'll only use z, as if we were looking straight down, until we get high enough. Based on worldPos.z, we gradually shift over to the more-realistic scale. This is pretty hacky.\r\n    #ratioWithoutY = dz * dz / (cPos.z * cPos.z)\r\n    #zv = Math.min(Math.max(0, worldPos.z - 5), cPos.z - 5) / (cPos.z - 5)\r\n    #zv * ratioWithY + (1 - zv) * ratioWithoutY\r\n\r\n  # SUBSCRIPTIONS\r\n\r\n  onZoomIn: (e) -> @zoomTo @target, @zoom * 1.15, 300\r\n  onZoomOut: (e) -> @zoomTo @target, @zoom / 1.15, 300\r\n\r\n  onMouseDown: (e) ->\r\n    return if @dragDisabled\r\n    @lastPos = {x: e.originalEvent.rawX, y: e.originalEvent.rawY}\r\n    @mousePressed = true\r\n\r\n  onMouseMove: (e) ->\r\n    return unless @mousePressed and @gameUIState.get('canDragCamera')\r\n    return if @dragDisabled\r\n    target = @boundTarget(@target, @zoom)\r\n    newPos =\r\n      x: target.x + (@lastPos.x - e.originalEvent.rawX) / @zoom\r\n      y: target.y + (@lastPos.y - e.originalEvent.rawY) / @zoom\r\n    @zoomTo newPos, @zoom, 0\r\n    @lastPos = {x: e.originalEvent.rawX, y: e.originalEvent.rawY}\r\n    Backbone.Mediator.publish 'camera:dragged', {}\r\n\r\n  onMouseUp: (e) ->\r\n    @mousePressed = false\r\n\r\n  onMouseScrolled: (e) ->\r\n    ratio = 1 + 0.05 * Math.sqrt(Math.abs(e.deltaY))\r\n    ratio = 1 / ratio if e.deltaY > 0\r\n    newZoom = @zoom * ratio\r\n    if e.screenPos and not @focusedOnSprite()\r\n      # zoom based on mouse position, adjusting the target so the point under the mouse stays the same\r\n      mousePoint = @screenToSurface(e.screenPos)\r\n      ratioPosX = (mousePoint.x - @surfaceViewport.x) / @surfaceViewport.width\r\n      ratioPosY = (mousePoint.y - @surfaceViewport.y) / @surfaceViewport.height\r\n      newWidth = @canvasWidth / newZoom\r\n      newHeight = @canvasHeight / newZoom\r\n      newTargetX = mousePoint.x - (newWidth * ratioPosX) + (newWidth / 2)\r\n      newTargetY = mousePoint.y - (newHeight * ratioPosY) + (newHeight / 2)\r\n      target = {x: newTargetX, y: newTargetY}\r\n    else\r\n      target = @target\r\n    @zoomTo target, newZoom, 0\r\n\r\n  onLevelRestarted: ->\r\n    @setBounds(@firstBounds, false)\r\n\r\n  # COMMANDS\r\n\r\n  setBounds: (worldBounds, updateZoom=true) ->\r\n    # receives an array of two world points. Normalize and apply them\r\n    @firstBounds = worldBounds unless @firstBounds\r\n    @bounds = @normalizeBounds(worldBounds)\r\n    @calculateMinMaxZoom()\r\n    @updateZoom true if updateZoom\r\n    @target = @currentTarget unless @focusedOnSprite()\r\n\r\n  normalizeBounds: (worldBounds) ->\r\n    return null unless worldBounds\r\n    top = Math.max(worldBounds[0].y, worldBounds[1].y)\r\n    left = Math.min(worldBounds[0].x, worldBounds[1].x)\r\n    bottom = Math.min(worldBounds[0].y, worldBounds[1].y)\r\n    right = Math.max(worldBounds[0].x, worldBounds[1].x)\r\n    bottom -= 1 if top is bottom\r\n    right += 1 if left is right\r\n    p1 = @worldToSurface({x: left, y: top})\r\n    p2 = @worldToSurface({x: right, y: bottom})\r\n    {x: p1.x, y: p1.y, width: p2.x-p1.x, height: p2.y-p1.y}\r\n\r\n  calculateMinMaxZoom: ->\r\n    # Zoom targets are always done in Surface coordinates.\r\n    @maxZoom = MAX_ZOOM\r\n    return @minZoom = MIN_ZOOM unless @bounds\r\n    @minZoom = Math.max @canvasWidth / @bounds.width, @canvasHeight / @bounds.height\r\n    if @zoom\r\n      @zoom = Math.max @minZoom, @zoom\r\n      @zoom = Math.min @maxZoom, @zoom\r\n\r\n  zoomTo: (newTarget=null, newZoom=1.0, time=1500) ->\r\n    # Target is either just a {x, y} pos or a display object with {x, y} that might change; surface coordinates.\r\n    time = 0 if @instant\r\n    newTarget ?= {x: 0, y: 0}\r\n    newTarget = (@newTarget or @target) if @locked\r\n    newZoom = Math.max newZoom, @minZoom\r\n    newZoom = Math.min newZoom, @maxZoom\r\n\r\n    thangType = @target?.sprite?.thangType\r\n    if thangType\r\n      @offset = _.clone(thangType.get('positions')?.torso or {x: 0, y: 0})\r\n      scale = thangType.get('scale') or 1\r\n      @offset.x *= scale\r\n      @offset.y *= scale\r\n    else\r\n      @offset = {x: 0, y: 0}\r\n\r\n    return if @zoom is newZoom and newTarget is newTarget.x and newTarget.y is newTarget.y\r\n\r\n    @finishTween(true)\r\n    if time\r\n      @newTarget = newTarget\r\n      @oldTarget = @boundTarget(@target, @zoom)\r\n      @oldZoom = @zoom\r\n      @newZoom = newZoom\r\n      @tweenProgress = 0.01\r\n      createjs.Tween.get(@)\r\n        .to({tweenProgress: 1.0}, time, createjs.Ease.getPowOut(4))\r\n        .call @finishTween\r\n\r\n    else\r\n      @target = newTarget\r\n      @zoom = newZoom\r\n      @updateZoom true\r\n\r\n  focusedOnSprite: ->\r\n    return @target?.name\r\n\r\n  finishTween: (abort=false) =>\r\n    createjs.Tween.removeTweens(@)\r\n    return unless @newTarget\r\n    unless abort is true\r\n      @target = @newTarget\r\n      @zoom = @newZoom\r\n    @newZoom = @oldZoom = @newTarget = @newTarget = @tweenProgress = null\r\n    @updateZoom true\r\n\r\n  updateZoom: (force=false) ->\r\n    # Update when we're focusing on a Thang, tweening, or forcing it, unless we're locked\r\n    return if (not force) and (@locked or (not @newTarget and not @focusedOnSprite()))\r\n    if @newTarget\r\n      t = @tweenProgress\r\n      @zoom = @oldZoom + t * (@newZoom - @oldZoom)\r\n      [p1, p2] = [@oldTarget, @boundTarget(@newTarget, @newZoom)]\r\n      target = @target = x: p1.x + t * (p2.x - p1.x), y: p1.y + t * (p2.y - p1.y)\r\n    else\r\n      target = @boundTarget @target, @zoom\r\n      return if not force and _.isEqual target, @currentTarget\r\n    @currentTarget = target\r\n    viewportDifference = @updateViewports target\r\n    if viewportDifference > 0.1  # Roughly 0.1 pixel difference in what we can see\r\n      Backbone.Mediator.publish 'camera:zoom-updated', camera: @, zoom: @zoom, surfaceViewport: @surfaceViewport, minZoom: @minZoom\r\n\r\n  boundTarget: (pos, zoom) ->\r\n    # Given an {x, y} in Surface coordinates, return one that will keep our viewport on the Surface.\r\n    return pos unless @bounds\r\n    y = pos.y\r\n    if thang = pos.sprite?.thang\r\n      y = @worldToSurface(x: thang.pos.x, y: thang.pos.y).y  # ignore z\r\n    marginX = (@canvasWidth / zoom / 2)\r\n    marginY = (@canvasHeight / zoom / 2)\r\n    x = Math.min(Math.max(marginX + @bounds.x, pos.x + @offset.x), @bounds.x + @bounds.width - marginX)\r\n    y = Math.min(Math.max(marginY + @bounds.y, y + @offset.y), @bounds.y + @bounds.height - marginY)\r\n    {x: x, y: y}\r\n\r\n  updateViewports: (target) ->\r\n    target ?= @target\r\n    sv = width: @canvasWidth / @zoom, height: @canvasHeight / @zoom, cx: target.x, cy: target.y\r\n    sv.x = sv.cx - sv.width / 2\r\n    sv.y = sv.cy - sv.height / 2\r\n    if @surfaceViewport\r\n      # Calculate how different this viewport is. (If it's basically not different, we can avoid visualizing the update.)\r\n      viewportDifference = Math.abs(@surfaceViewport.x - sv.x) + 1.01 * Math.abs(@surfaceViewport.y - sv.y) + 1.02 * Math.abs(@surfaceViewport.width - sv.width)\r\n    else\r\n      viewportDifference = 9001\r\n    @surfaceViewport = sv\r\n\r\n    wv = @surfaceToWorld sv  # get x and y\r\n    wv.width = sv.width * Camera.MPP\r\n    wv.height = sv.height * Camera.MPP * @x2y\r\n    wv.cx = wv.x + wv.width / 2\r\n    wv.cy = wv.y + wv.height / 2\r\n    @worldViewport = wv\r\n\r\n    viewportDifference\r\n\r\n  lock: ->\r\n    @target = @currentTarget\r\n    @locked = true\r\n\r\n  unlock: ->\r\n    @locked = false\r\n\r\n  destroy: ->\r\n    createjs.Tween.removeTweens @\r\n    super()\r\n\r\n  onZoomTo: (e) ->\r\n    @zoomTo @worldToSurface(e.pos), @zoom, e.duration\r\n","module.exports = class CameraBorder extends createjs.Container\r\n  layerPriority: 100\r\n\r\n  subscriptions: {}\r\n\r\n  constructor: (options) ->\r\n    super()\r\n    @initialize()\r\n    @mouseEnabled = @mouseChildren = false\r\n    @updateBounds options.bounds\r\n    Backbone.Mediator.subscribe(channel, @[func], @) for channel, func of @subscriptions\r\n\r\n  destroy: ->\r\n    Backbone.Mediator.unsubscribe(channel, @[func], @) for channel, func of @subscriptions\r\n\r\n  updateBounds: (bounds) ->\r\n    return if _.isEqual bounds, @bounds\r\n    @bounds = bounds\r\n    if @border\r\n      @removeChild @border\r\n      @border = null\r\n    return unless @bounds\r\n    @addChild @border = new createjs.Shape()\r\n    width = 20\r\n    i = width\r\n    while i\r\n      opacity = 3 * (1 - (i/width)) / width\r\n      @border.graphics.setStrokeStyle(i, 'round').beginStroke(\"rgba(0,0,0,#{opacity})\").drawRect(bounds.x, bounds.y, bounds.width, bounds.height)\r\n      i -= 1\r\n    @border.cache bounds.x, bounds.y, bounds.width, bounds.height\r\n","module.exports = class CoordinateDisplay extends createjs.Container\r\n  layerPriority: -10\r\n  subscriptions:\r\n    'surface:mouse-moved': 'onMouseMove'\r\n    'surface:mouse-out': 'onMouseOut'\r\n    'surface:mouse-over': 'onMouseOver'\r\n    'surface:stage-mouse-down': 'onMouseDown'\r\n    'camera:zoom-updated': 'onZoomUpdated'\r\n    'level:flag-color-selected': 'onFlagColorSelected'\r\n\r\n  constructor: (options) ->\r\n    super()\r\n    @initialize()\r\n    @camera = options.camera\r\n    @layer = options.layer\r\n    console.error @toString(), 'needs a camera.' unless @camera\r\n    console.error @toString(), 'needs a layer.' unless @layer\r\n    @build()\r\n    @performShow = @show\r\n    @show = _.debounce @show, 125\r\n    Backbone.Mediator.subscribe(channel, @[func], @) for channel, func of @subscriptions\r\n\r\n  destroy: ->\r\n    Backbone.Mediator.unsubscribe(channel, @[func], @) for channel, func of @subscriptions\r\n    @show = null\r\n    @destroyed = true\r\n\r\n  toString: -> '<CoordinateDisplay>'\r\n\r\n  build: ->\r\n    @mouseEnabled = @mouseChildren = false\r\n    @addChild @background = new createjs.Shape()\r\n    @addChild @label = new createjs.Text('', 'bold 16px Arial', '#FFFFFF')\r\n    @addChild @pointMarker = new createjs.Shape()\r\n    @label.name = 'Coordinate Display Text'\r\n    @label.shadow = new createjs.Shadow('#000000', 1, 1, 0)\r\n    @background.name = 'Coordinate Display Background'\r\n    @pointMarker.name = 'Point Marker'\r\n    @layer.addChild @\r\n\r\n  onMouseOver: (e) -> @mouseInBounds = true\r\n  onMouseOut: (e) -> @mouseInBounds = false\r\n\r\n  onMouseMove: (e) ->\r\n    wop = @camera.screenToWorld x: e.x, y: e.y\r\n    wop.x = Math.round(wop.x)\r\n    wop.y = Math.round(wop.y)\r\n    return if wop.x is @lastPos?.x and wop.y is @lastPos?.y\r\n    @lastPos = wop\r\n    @lastScreenPos = x: e.x, y: e.y\r\n    @hide()\r\n    @show()  # debounced\r\n\r\n  onMouseDown: (e) ->\r\n    return unless key.shift\r\n    wop = @camera.screenToWorld x: e.x, y: e.y\r\n    wop.x = Math.round wop.x\r\n    wop.y = Math.round wop.y\r\n    Backbone.Mediator.publish 'tome:focus-editor', {}\r\n    Backbone.Mediator.publish 'surface:coordinate-selected', wop\r\n\r\n  onZoomUpdated: (e) ->\r\n    return unless @lastPos\r\n    wop = @camera.screenToWorld @lastScreenPos\r\n    @lastPos.x = Math.round wop.x\r\n    @lastPos.y = Math.round wop.y\r\n    @performShow() if @label.parent\r\n\r\n  onFlagColorSelected: (e) ->\r\n    @placingFlag = Boolean e.color\r\n\r\n  hide: ->\r\n    return unless @label.parent\r\n    @removeChild @label\r\n    @removeChild @background\r\n    @removeChild @pointMarker\r\n    @uncache()\r\n\r\n  updateSize: ->\r\n    margin = 3\r\n    contentWidth = @label.getMeasuredWidth() + (2 * margin)\r\n    contentHeight = @label.getMeasuredHeight() + (2 * margin)\r\n\r\n    # Shift pointmarker up so it centers at pointer (affects container cache position)\r\n    @pointMarker.regY = contentHeight\r\n\r\n    pointMarkerStroke = 2\r\n    pointMarkerLength = 8\r\n    fullPointMarkerLength = pointMarkerLength + (pointMarkerStroke / 2)\r\n    contributionsToTotalSize = []\r\n    contributionsToTotalSize = contributionsToTotalSize.concat @updateCoordinates contentWidth, contentHeight, fullPointMarkerLength\r\n    contributionsToTotalSize = contributionsToTotalSize.concat @updatePointMarker 0, contentHeight, pointMarkerLength, pointMarkerStroke\r\n\r\n    totalWidth = contentWidth + contributionsToTotalSize.reduce (a, b) -> a + b\r\n    totalHeight = contentHeight + contributionsToTotalSize.reduce (a, b) -> a + b\r\n\r\n    if @isNearTopEdge()\r\n      verticalEdge =\r\n        startPos: -fullPointMarkerLength\r\n        posShift: -contentHeight + 4\r\n    else\r\n      verticalEdge =\r\n        startPos: -totalHeight + fullPointMarkerLength\r\n        posShift: contentHeight\r\n\r\n    if @isNearRightEdge()\r\n      horizontalEdge =\r\n        startPos: -totalWidth + fullPointMarkerLength\r\n        posShift: totalWidth\r\n    else\r\n      horizontalEdge =\r\n        startPos: -fullPointMarkerLength\r\n        posShift: 0\r\n\r\n    @orient verticalEdge, horizontalEdge, totalHeight, totalWidth\r\n\r\n  isNearTopEdge: ->\r\n    yRatio = 1 - (@camera.worldViewport.y - @lastPos.y) / @camera.worldViewport.height\r\n    yRatio > 0.9\r\n\r\n  isNearRightEdge: ->\r\n    xRatio = (@lastPos.x - @camera.worldViewport.x) / @camera.worldViewport.width\r\n    xRatio > 0.85\r\n\r\n  orient: (verticalEdge, horizontalEdge, totalHeight, totalWidth) ->\r\n    @label.regY = @background.regY = verticalEdge.posShift\r\n    @label.regX = @background.regX = horizontalEdge.posShift\r\n    @cache horizontalEdge.startPos, verticalEdge.startPos, totalWidth, totalHeight\r\n\r\n  updateCoordinates: (contentWidth, contentHeight, offset) ->\r\n    # Center label horizontally and vertically\r\n    @label.x = contentWidth / 2 - (@label.getMeasuredWidth() / 2) + offset\r\n    @label.y = contentHeight / 2 - (@label.getMeasuredHeight() / 2) - offset\r\n\r\n    @background.graphics\r\n      .clear()\r\n      .beginFill('rgba(0,0,0,0.4)')\r\n      .beginStroke('rgba(0,0,0,0.6)')\r\n      .setStrokeStyle(backgroundStroke = 1)\r\n      .drawRoundRect(offset, -offset, contentWidth, contentHeight, radius = 2.5)\r\n      .endFill()\r\n      .endStroke()\r\n    contributionsToTotalSize = [offset, backgroundStroke]\r\n\r\n  updatePointMarker: (centerX, centerY, length, strokeSize) ->\r\n    strokeStyle = 'square'\r\n    @pointMarker.graphics\r\n      .beginStroke('rgb(255, 255, 255)')\r\n      .setStrokeStyle(strokeSize, strokeStyle)\r\n      .moveTo(centerX, centerY - length)\r\n      .lineTo(centerX, centerY + length)\r\n      .moveTo(centerX - length, centerY)\r\n      .lineTo(centerX + length, centerY)\r\n      .endStroke()\r\n    contributionsToTotalSize = [strokeSize, length]\r\n\r\n  show: =>\r\n    return unless @mouseInBounds and @lastPos and not @destroyed\r\n    @label.text = \"{x: #{@lastPos.x}, y: #{@lastPos.y}}\"\r\n    @updateSize()\r\n    sup = @camera.worldToSurface @lastPos\r\n    @x = sup.x\r\n    @y = sup.y\r\n    @addChild @background\r\n    @addChild @label\r\n    @addChild @pointMarker unless @placingFlag\r\n    @updateCache()\r\n    Backbone.Mediator.publish 'surface:coordinates-shown', {}\r\n","CocoClass = require 'core/CocoClass'\r\n\r\nmodule.exports = class CoordinateGrid extends CocoClass\r\n  subscriptions:\r\n    'level:toggle-grid': 'onToggleGrid'\r\n\r\n  shortcuts:\r\n    'ctrl+g, ⌘+g': 'onToggleGrid'\r\n\r\n  constructor: (options, worldSize) ->\r\n    super()\r\n    options ?= {}\r\n    @camera = options.camera\r\n    @layer = options.layer\r\n    @textLayer = options.textLayer\r\n    console.error @toString(), 'needs a camera.' unless @camera\r\n    console.error @toString(), 'needs a layer.' unless @layer\r\n    console.error @toString(), 'needs a textLayer.' unless @textLayer\r\n    @build worldSize\r\n\r\n  destroy: ->\r\n    super()\r\n\r\n  toString: -> '<CoordinateGrid>'\r\n\r\n  build: (worldSize) ->\r\n    worldWidth = worldSize[0] or 80\r\n    worldHeight = worldSize[1] or 68\r\n    @gridContainer = new createjs.Container()\r\n    @gridShape = new createjs.Shape()\r\n    @gridContainer.addChild @gridShape\r\n    @gridContainer.mouseEnabled = false\r\n    @gridShape.alpha = 0.125\r\n    @gridShape.graphics.setStrokeStyle 1\r\n    @gridShape.graphics.beginStroke 'blue'\r\n    gridSize = Math.round(worldWidth / 20)\r\n    wopStart = x: 0, y: 0\r\n    wopEnd = x: worldWidth, y: worldHeight\r\n    supStart = @camera.worldToSurface wopStart\r\n    supEnd = @camera.worldToSurface wopEnd\r\n    wop = x: wopStart.x, y: wopStart.y\r\n    @labels = []\r\n    linesDrawn = 0\r\n    while wop.x <= wopEnd.x\r\n      sup = @camera.worldToSurface wop\r\n      @gridShape.graphics.mt(sup.x, supStart.y).lt(sup.x, supEnd.y)\r\n      if ++linesDrawn % 2\r\n        t = new createjs.Text(wop.x.toFixed(0), '16px Arial', 'blue')\r\n        t.textAlign = 'center'\r\n        t.textBaseline = 'bottom'\r\n        t.x = sup.x\r\n        t.y = supStart.y\r\n        t.alpha = 0.75\r\n        @labels.push t\r\n      wop.x += gridSize\r\n      if wopEnd.x < wop.x <= wopEnd.x - gridSize / 2\r\n        wop.x = wopEnd.x\r\n    linesDrawn = 0\r\n    while wop.y <= wopEnd.y\r\n      sup = @camera.worldToSurface wop\r\n      @gridShape.graphics.mt(supStart.x, sup.y).lt(supEnd.x, sup.y)\r\n      if ++linesDrawn % 2\r\n        t = new createjs.Text(wop.y.toFixed(0), '16px Arial', 'blue')\r\n        t.textAlign = 'left'\r\n        t.textBaseline = 'middle'\r\n        t.x = 0\r\n        t.y = sup.y\r\n        t.alpha = 0.75\r\n        @labels.push t\r\n      wop.y += gridSize\r\n      if wopEnd.y < wop.y <= wopEnd.y - gridSize / 2\r\n        wop.y = wopEnd.y\r\n    @gridShape.graphics.endStroke()\r\n    bounds = x: supStart.x, y: supEnd.y, width: supEnd.x - supStart.x, height: supStart.y - supEnd.y\r\n    return unless bounds?.width and bounds.height\r\n    @gridContainer.cache bounds.x, bounds.y, bounds.width, bounds.height\r\n\r\n  showGrid: ->\r\n    return if @gridShowing()\r\n    @layer.addChild @gridContainer\r\n    @textLayer.addChild label for label in @labels\r\n\r\n  hideGrid: ->\r\n    return unless @gridShowing()\r\n    @layer.removeChild @gridContainer\r\n    @textLayer.removeChild label for label in @labels\r\n\r\n  gridShowing: ->\r\n    @gridContainer?.parent?\r\n\r\n  onToggleGrid: (e) ->\r\n    e?.preventDefault?()\r\n    if @gridShowing() then @hideGrid() else @showGrid()\r\n\r\n","CocoClass = require 'core/CocoClass'\r\n\r\nmodule.exports = class CountdownScreen extends CocoClass\r\n  subscriptions:\r\n    'playback:real-time-playback-started': 'onRealTimePlaybackStarted'\r\n    'playback:real-time-playback-ended': 'onRealTimePlaybackEnded'\r\n\r\n  constructor: (options) ->\r\n    super()\r\n    options ?= {}\r\n    @camera = options.camera\r\n    @layer = options.layer\r\n    @showsCountdown = options.showsCountdown\r\n    console.error @toString(), 'needs a camera.' unless @camera\r\n    console.error @toString(), 'needs a layer.' unless @layer\r\n    @build()\r\n\r\n  destroy: ->\r\n    clearInterval @countdownInterval if @countdownInterval\r\n    super()\r\n\r\n  onCastingBegins: (e) -> @show() unless e.preload\r\n  onCastingEnds: (e) -> @hide()\r\n\r\n  toString: -> '<CountdownScreen>'\r\n\r\n  build: ->\r\n    @dimLayer = new createjs.Container()\r\n    @dimLayer.mouseEnabled = @dimLayer.mouseChildren = false\r\n    @dimLayer.addChild @dimScreen = new createjs.Shape()\r\n    @dimScreen.graphics.beginFill('rgba(0,0,0,0.5)').rect 0, 0, @camera.canvasWidth, @camera.canvasHeight\r\n    @dimLayer.alpha = 0\r\n    @dimLayer.addChild @makeCountdownText()\r\n\r\n  makeCountdownText: ->\r\n    size = Math.ceil @camera.canvasHeight / 2\r\n    text = new createjs.Text '3...', \"#{size}px Open Sans Condensed\", '#F7B42C'\r\n    text.shadow = new createjs.Shadow '#000', Math.ceil(@camera.canvasHeight / 300), Math.ceil(@camera.canvasHeight / 300), Math.ceil(@camera.canvasHeight / 120)\r\n    text.textAlign = 'center'\r\n    text.textBaseline = 'middle'\r\n    text.x = @camera.canvasWidth / 2\r\n    text.y = @camera.canvasHeight / 2\r\n    @text = text\r\n    return text\r\n\r\n  show: ->\r\n    return if @showing\r\n    createjs.Tween.removeTweens @dimLayer\r\n    if @showsCountdown\r\n      @dimLayer.alpha = 0\r\n      @showing = true\r\n      createjs.Tween.get(@dimLayer).to({alpha: 1}, 500)\r\n      @secondsRemaining = 3\r\n      @countdownInterval = setInterval @decrementCountdown, 1000\r\n      @updateText()\r\n      @layer.addChild @dimLayer\r\n    else\r\n      @endCountdown()\r\n\r\n  hide: (duration=500) ->\r\n    return unless @showing\r\n    @showing = false\r\n    createjs.Tween.removeTweens @dimLayer\r\n    createjs.Tween.get(@dimLayer).to({alpha: 0}, duration).call => @layer.removeChild @dimLayer unless @destroyed\r\n\r\n  decrementCountdown: =>\r\n    return if @destroyed\r\n    --@secondsRemaining\r\n    @updateText()\r\n    unless @secondsRemaining\r\n      @endCountdown()\r\n\r\n  updateText: ->\r\n    @text.text = if @secondsRemaining then \"#{@secondsRemaining}...\" else '0!'\r\n\r\n  endCountdown: ->\r\n    console.log 'should actually start in 1s'\r\n    clearInterval @countdownInterval if @countdownInterval\r\n    @countdownInterval = null\r\n    @hide()\r\n\r\n  onRealTimePlaybackStarted: (e) ->\r\n    @show()\r\n\r\n  onRealTimePlaybackEnded: (e) ->\r\n    clearInterval @countdownInterval if @countdownInterval\r\n    @countdownInterval = null\r\n    @hide Math.max(500, 1000 * (@secondsRemaining or 0))\r\n","module.exports = class DebugDisplay extends createjs.Container\r\n  layerPriority: 20\r\n  subscriptions:\r\n    'level:set-debug': 'onSetDebug'\r\n\r\n  constructor: (options) ->\r\n    super()\r\n    @initialize()\r\n    @canvasWidth = options.canvasWidth\r\n    @canvasHeight = options.canvasHeight\r\n    console.error 'DebugDisplay needs canvasWidth/Height.' unless @canvasWidth and @canvasHeight\r\n    @build()\r\n    @onSetDebug debug: true\r\n    Backbone.Mediator.subscribe(channel, @[func], @) for channel, func of @subscriptions\r\n\r\n  destroy: ->\r\n    Backbone.Mediator.unsubscribe(channel, @[func], @) for channel, func of @subscriptions\r\n\r\n  onSetDebug: (e) ->\r\n    return if e.debug is @on\r\n    @visible = @on = e.debug\r\n    @fps = null\r\n    @framesRenderedThisSecond = 0\r\n    @lastFrameSecondStart = Date.now()\r\n\r\n  build: ->\r\n    @mouseEnabled = @mouseChildren = false\r\n    @addChild @frameText = new createjs.Text '...', '20px Arial', '#FFF'\r\n    @frameText.name = 'frame text'\r\n    @frameText.x = @canvasWidth - 50\r\n    @frameText.y = @canvasHeight - 25\r\n    @frameText.alpha = 0.5\r\n\r\n  updateFrame: (currentFrame) ->\r\n    return unless @on\r\n    ++@framesRenderedThisSecond\r\n    time = Date.now()\r\n    diff = (time - @lastFrameSecondStart) / 1000\r\n    if diff > 1\r\n      @fps = Math.round @framesRenderedThisSecond / diff\r\n      @lastFrameSecondStart = time\r\n      @framesRenderedThisSecond = 0\r\n\r\n    @frameText.text = Math.round(currentFrame) + (if @fps? then ' - ' + @fps + ' fps' else '')\r\n    @frameText.x = @canvasWidth - @frameText.getMeasuredWidth() - 10\r\n","CocoClass = require 'core/CocoClass'\r\n\r\nmodule.exports = class Dimmer extends CocoClass\r\n  subscriptions:\r\n    'level:disable-controls': 'onDisableControls'\r\n    'level:enable-controls': 'onEnableControls'\r\n    'sprite:highlight-sprites': 'onHighlightSprites'\r\n    'sprite:speech-updated': 'onSpriteSpeechUpdated'\r\n    'surface:frame-changed': 'onFrameChanged'\r\n    'camera:zoom-updated': 'onZoomUpdated'\r\n\r\n  constructor: (options) ->\r\n    super()\r\n    options ?= {}\r\n    @camera = options.camera\r\n    @layer = options.layer\r\n    console.error @toString(), 'needs a camera.' unless @camera\r\n    console.error @toString(), 'needs a layer.' unless @layer\r\n    @build()\r\n    @updateDimMask = _.throttle @updateDimMask, 10\r\n    @highlightedThangIDs = []\r\n    @sprites = {}\r\n\r\n  toString: -> '<Dimmer>'\r\n\r\n  build: ->\r\n    @dimLayer = new createjs.Container()\r\n    @dimLayer.mouseEnabled = @dimLayer.mouseChildren = false\r\n    @dimLayer.addChild @dimScreen = new createjs.Shape()\r\n    @dimLayer.addChild @dimMask = new createjs.Shape()\r\n    @dimScreen.graphics.beginFill('rgba(0,0,0,0.5)').rect 0, 0, @camera.canvasWidth, @camera.canvasHeight\r\n    @dimMask.compositeOperation = 'destination-out'\r\n    @dimLayer.cache 0, 0, @camera.canvasWidth, @camera.canvasHeight\r\n\r\n  onDisableControls: (e) ->\r\n    return if @on or (e.controls and not ('surface' in e.controls))\r\n    @dim()\r\n\r\n  onEnableControls: (e) ->\r\n    return if not @on or (e.controls and not ('surface' in e.controls))\r\n    @undim()\r\n\r\n  onSpriteSpeechUpdated: (e) -> @updateDimMask() if @on\r\n  onFrameChanged: (e) -> @updateDimMask() if @on\r\n  onZoomUpdated: (e) -> @updateDimMask() if @on\r\n  onHighlightSprites: (e) ->\r\n    @highlightedThangIDs = e.thangIDs ? []\r\n    @updateDimMask() if @on\r\n\r\n  setSprites: (@sprites) ->\r\n\r\n  dim: ->\r\n    @on = true\r\n    @layer.addChild @dimLayer\r\n    @layer.updateLayerOrder()\r\n    sprite.setDimmed true for thangID, sprite of @sprites\r\n    @updateDimMask()\r\n\r\n  undim: ->\r\n    @on = false\r\n    @layer.removeChild @dimLayer\r\n    sprite.setDimmed false for thangID, sprite of @sprites\r\n\r\n  updateDimMask: =>\r\n    @dimMask.graphics.clear()\r\n    for thangID, sprite of @sprites\r\n      continue unless (thangID in @highlightedThangIDs) or sprite.isTalking?()\r\n      sup = x: sprite.sprite.x, y: sprite.sprite.y\r\n      cap = @camera.surfaceToCanvas sup\r\n      r = 50 * @camera.zoom  # TODO: find better way to get the radius based on the sprite's size\r\n      @dimMask.graphics.beginRadialGradientFill(['rgba(0,0,0,1)', 'rgba(0,0,0,0)'], [0.5, 1], cap.x, cap.y, 0, cap.x, cap.y, r).drawCircle(cap.x, cap.y, r)\r\n\r\n    @dimLayer.updateCache 0, 0, @camera.canvasWidth, @camera.canvasHeight\r\n","Dropper = class Dropper\r\n  lostFrames: 0.0\r\n  dropCounter: 0\r\n\r\n  constructor: ->\r\n    @listener = (e) => @tick(e)\r\n\r\n  tick: ->\r\n    unless @tickedOnce\r\n      @tickedOnce = true  # Can't get measured FPS on the 0th frame.\r\n      return\r\n\r\n    --@dropCounter if @dropCounter > 0\r\n\r\n    # Track number of frames we've lost since the last tick.\r\n    fps = createjs.Ticker.getFPS()\r\n    actual = createjs.Ticker.getMeasuredFPS(1)\r\n    @lostFrames += (fps - actual) / fps\r\n\r\n    # If lostFrames > 1, drop that number for the next tick.\r\n    @dropCounter += parseInt @lostFrames\r\n    @lostFrames = @lostFrames % 1\r\n\r\n  drop: ->\r\n    return @dropCounter > 0\r\n\r\nmodule.exports = new Dropper()\r\n","IndieLank = require 'lib/surface/IndieLank'\r\n{me} = require 'core/auth'\r\n\r\nmodule.exports = class FlagLank extends IndieLank\r\n  subscriptions:\r\n    'surface:mouse-moved': 'onMouseMoved'\r\n\r\n  #shortcuts:\r\n\r\n  defaultPos: -> x: 20, y: 20, z: 1\r\n\r\n  constructor: (thangType, options) ->\r\n    super thangType, options\r\n    @toggleCursor options.isCursor\r\n\r\n  makeIndieThang: (thangType, options) ->\r\n    thang = super thangType, options\r\n    thang.width = thang.height = thang.depth = 2\r\n    thang.pos.z = 1\r\n    thang.isSelectable = false\r\n    thang.color = options.color\r\n    thang.team = options.team\r\n    thang\r\n\r\n  onMouseMoved: (e) ->\r\n    return unless @options.isCursor\r\n    wop = @options.camera.screenToWorld x: e.x, y: e.y\r\n    @thang.pos.x = wop.x\r\n    @thang.pos.y = wop.y\r\n\r\n  toggleCursor: (to) ->\r\n    @options.isCursor = to\r\n    @thang.alpha = if to then 0.33 else 0.67  # 1.0 is for flags that have been placed\r\n    #@thang.action = if to then 'idle' else 'appear'  # TODO: why doesn't this work? Does it not render the action or something?\r\n    @thang.action = 'appear'\r\n    @updateAlpha()\r\n","Thang = require 'lib/world/thang'\r\nLank = require 'lib/surface/Lank'\r\n\r\nmodule.exports = IndieLank = class IndieLank extends Lank\r\n  notOfThisWorld: true\r\n  subscriptions:\r\n    'script:note-group-started': 'onNoteGroupStarted'\r\n    'script:note-group-ended': 'onNoteGroupEnded'\r\n\r\n  constructor: (thangType, options) ->\r\n    options.thang = @makeIndieThang thangType, options\r\n    super thangType, options\r\n    @shadow = @thang\r\n\r\n  makeIndieThang: (thangType, options) ->\r\n    @thang = thang = new Thang null, thangType.get('name'), options.thangID\r\n    # Build needed results of what used to be Exists, Physical, Acts, and Selectable Components\r\n    thang.exists = true\r\n    thang.width = thang.height = thang.depth = 4\r\n    thang.pos = options.pos ? @defaultPos()\r\n    thang.pos.z = thang.depth / 2\r\n    thang.shape = 'ellipsoid'\r\n    thang.rotation = 0\r\n    thang.action = 'idle'\r\n    thang.setAction = (action) -> thang.action = action\r\n    thang.getActionName = -> thang.action\r\n    thang.acts = true\r\n    thang.isSelectable = true\r\n    thang.team = options.team\r\n    thang.teamColors = options.teamColors\r\n    thang\r\n\r\n  onNoteGroupStarted: => @scriptRunning = true\r\n  onNoteGroupEnded: => @scriptRunning = false\r\n  onMouseEvent: (e, ourEventName) -> super e, ourEventName unless @scriptRunning\r\n  defaultPos: -> x: -20, y: 20, z: @thang.depth / 2\r\n","CocoClass = require 'core/CocoClass'\r\n\r\nmodule.exports = class Label extends CocoClass\r\n  @STYLE_DIALOGUE = 'dialogue'  # A speech bubble from a script\r\n  @STYLE_SAY = 'say'  # A piece of text generated from the world\r\n  @STYLE_NAME = 'name'  # A name like Scott set up for the Wizard\r\n  # We might want to combine 'say' and 'name'; they're very similar\r\n  # Nick designed 'say' based off of Scott's 'name' back when they were using two systems\r\n  @STYLE_VAR = 'variable' \r\n\r\n  subscriptions: {}\r\n\r\n  constructor: (options) ->\r\n    super()\r\n    options ?= {}\r\n    @sprite = options.sprite\r\n    @camera = options.camera\r\n    @layer = options.layer\r\n    @style = options.style ? (@sprite?.thang?.labelStyle || Label.STYLE_SAY)\r\n    console.error @toString(), 'needs a sprite.' unless @sprite\r\n    console.error @toString(), 'needs a camera.' unless @camera\r\n    console.error @toString(), 'needs a layer.' unless @layer\r\n    @setText options.text if options.text\r\n\r\n  destroy: ->\r\n    @setText null\r\n    super()\r\n\r\n  toString: -> \"<Label for #{@sprite?.thang?.id ? 'None'}: #{@text?.substring(0, 10) ? ''}>\"\r\n\r\n  setText: (text) ->\r\n    # Returns whether an update was actually performed\r\n    return false if text is @text\r\n    @text = text\r\n    @build()\r\n    true\r\n\r\n  build: ->\r\n    if @layer and not @layer.destroyed\r\n      @layer.removeChild @background if @background\r\n      @layer.removeChild @label if @label\r\n    @label = null\r\n    @background = null\r\n    return unless @text  # null or '' should both be skipped\r\n    o = @buildLabelOptions()\r\n    @layer.addChild @label = @buildLabel o\r\n    @layer.addChild @background = @buildBackground o\r\n    @layer.updateLayerOrder()\r\n\r\n  update: ->\r\n    return unless @text and @sprite.sprite\r\n    offset = @sprite.getOffset? (if @style in ['dialogue', 'say'] then 'mouth' else 'aboveHead')\r\n    offset ?= x: 0, y: 0  # temp (if not Lank)\r\n    offset.y += 10 if @style is 'variable'\r\n    rotation = @sprite.getRotation()\r\n    offset.x *= -1 if rotation >= 135 or rotation <= -135\r\n    @label.x = @background.x = @sprite.sprite.x + offset.x\r\n    @label.y = @background.y = @sprite.sprite.y + offset.y\r\n    null\r\n\r\n  show: ->\r\n    return unless @label\r\n    @layer.addChild @label\r\n    @layer.addChild @background\r\n    @layer.updateLayerOrder()\r\n\r\n  hide: ->\r\n    return unless @label\r\n    @layer.removeChild @background\r\n    @layer.removeChild @label\r\n\r\n  buildLabelOptions: ->\r\n    o = {}\r\n    st = {dialogue: 'D', say: 'S', name: 'N', variable: 'V'}[@style]\r\n    o.marginX = {D: 5, S: 6, N: 3, V: 0}[st]\r\n    o.marginY = {D: 6, S: 4, N: 3, V: 0}[st]\r\n    o.fontWeight = {D: 'bold', S: 'bold', N: 'bold', V: 'bold'}[st]\r\n    o.shadow = {D: false, S: true, N: true, V: true}[st]\r\n    o.shadowColor = {D: '#FFF', S: '#000', N: '#000', V: \"#000\"}[st]\r\n    o.fontSize = {D: 25, S: 12, N: 24, V:18}[st]\r\n    fontFamily = {D: 'Arial', S: 'Arial', N: 'Arial', B: 'Arial', V: 'Arial'}[st]\r\n    o.fontDescriptor = \"#{o.fontWeight} #{o.fontSize}px #{fontFamily}\"\r\n    o.fontColor = {D: '#000', S: '#FFF', N: '#6c6', V:'#6c6'}[st]\r\n    if @style is 'name' and @sprite?.thang?.team is 'humans'\r\n      o.fontColor = '#c66'\r\n    else if @style is 'name' and @sprite?.thang?.team is 'ogres'\r\n      o.fontColor = '#66c'\r\n    else if @style is 'variable'\r\n      o.fontColor = '#fff'\r\n\r\n    o.backgroundFillColor = {D: 'white', S: 'rgba(0,0,0,0.4)', N: 'rgba(0,0,0,0.7)', V: 'rgba(0,0,0,0.7)'}[st]\r\n    o.backgroundStrokeColor = {D: 'black', S: 'rgba(0,0,0,0.6)', N: 'rgba(0,0,0,0)', V: 'rgba(0,0,0,0)'}[st]\r\n    o.backgroundStrokeStyle = {D: 2, S: 1, N: 1, V: 1}[st]\r\n    o.backgroundBorderRadius = {D: 10, S: 3, N: 3, V: 3}[st]\r\n    o.layerPriority = {D: 10, S: 5, N: 5, V: 5}[st]\r\n    maxWidth = {D: 300, S: 300, N: 180, V: 100}[st]\r\n    maxWidth = Math.max @camera.canvasWidth / 2 - 100, maxWidth  # Does this do anything?\r\n    maxLength = {D: 100, S: 100, N: 30, V:30}[st]\r\n    multiline = @addNewLinesToText _.string.prune(@text, maxLength), o.fontDescriptor, maxWidth\r\n    o.text = multiline.text\r\n    o.textWidth = multiline.textWidth\r\n    o\r\n\r\n  buildLabel: (o) ->\r\n    label = new createjs.Text o.text, o.fontDescriptor, o.fontColor\r\n    label.lineHeight = o.fontSize + 2\r\n    label.x = o.marginX\r\n    label.y = o.marginY\r\n    label.shadow = new createjs.Shadow o.shadowColor, 1, 1, 0 if o.shadow\r\n    label.layerPriority = o.layerPriority\r\n    label.name = \"Sprite Label - #{@style}\"\r\n    bounds = label.getBounds()\r\n    label.cache(bounds.x, bounds.y, bounds.width, bounds.height)\r\n    o.textHeight = label.getMeasuredHeight()\r\n    o.label = label\r\n    label\r\n\r\n  buildBackground: (o) ->\r\n    w = o.textWidth + 2 * o.marginX\r\n    h = o.textHeight + 2 * o.marginY + 1  # Is this +1 needed?\r\n\r\n    background = new createjs.Shape()\r\n    background.name = \"Sprite Label Background - #{@style}\"\r\n    g = background.graphics\r\n    g.beginFill o.backgroundFillColor\r\n    g.beginStroke o.backgroundStrokeColor\r\n    g.setStrokeStyle o.backgroundStrokeStyle\r\n\r\n    if @style is 'dialogue'\r\n      radius = o.backgroundBorderRadius  # Rounded rectangle border radius\r\n      pointerHeight = 10  # Height of pointer triangle\r\n      pointerWidth = 8  # Actual width of pointer triangle\r\n      pointerWidth += radius  # Convenience value including pointer width and border radius\r\n\r\n      # Figure out the position of the pointer for the bubble\r\n      sup = x: @sprite.sprite.x, y: @sprite.sprite.y  # a little more accurate to aim for mouth--how?\r\n      cap = @camera.surfaceToCanvas sup\r\n      hPos = if cap.x / @camera.canvasWidth > 0.53 then 'right' else 'left'\r\n      vPos = if cap.y / @camera.canvasHeight > 0.53 then 'bottom' else 'top'\r\n      pointerPos = \"#{vPos}-#{hPos}\"\r\n      # TODO: we should redo this when the Thang moves enough, not just when we change its text\r\n      #return if pointerPos is @lastBubblePos and blurb is @lastBlurb\r\n\r\n      # Draw a rounded rectangle with the pointer coming out of it\r\n      g.moveTo(radius, 0)\r\n      if pointerPos is 'top-left'\r\n        g.lineTo(radius / 2, -pointerHeight)\r\n        g.lineTo(pointerWidth, 0)\r\n      else if pointerPos is 'top-right'\r\n        g.lineTo(w - pointerWidth, 0)\r\n        g.lineTo(w - radius / 2, -pointerHeight)\r\n\r\n      # Draw top and right edges\r\n      g.lineTo(w - radius, 0)\r\n      g.quadraticCurveTo(w, 0, w, radius)\r\n      g.lineTo(w, h - radius)\r\n      g.quadraticCurveTo(w, h, w - radius, h)\r\n\r\n      if pointerPos is 'bottom-right'\r\n        g.lineTo(w - radius / 2, h + pointerHeight)\r\n        g.lineTo(w - pointerWidth, h)\r\n      else if pointerPos is 'bottom-left'\r\n        g.lineTo(pointerWidth, h)\r\n        g.lineTo(radius / 2, h + pointerHeight)\r\n\r\n      # Draw bottom and left edges\r\n      g.lineTo(radius, h)\r\n      g.quadraticCurveTo(0, h, 0, h - radius)\r\n      g.lineTo(0, radius)\r\n      g.quadraticCurveTo(0, 0, radius, 0)\r\n\r\n      # Center the container where the mouth of the speaker will be\r\n      background.regX = if hPos is 'left' then 3 else o.textWidth + 3\r\n      background.regY = if vPos is 'bottom' then h + pointerHeight else -pointerHeight\r\n\r\n    else\r\n      # Just draw a rounded rectangle\r\n      background.regX = w / 2\r\n      background.regY = h + 2  # Just above health bar, say\r\n      g.drawRoundRect(o.label.x - o.marginX, o.label.y - o.marginY, w, h, o.backgroundBorderRadius)\r\n\r\n    o.label.regX = background.regX - o.marginX\r\n    o.label.regY = background.regY - o.marginY\r\n    background.cache(-10, -10, w+20, h+20) # give a wide berth for speech box pointers\r\n\r\n    g.endStroke()\r\n    g.endFill()\r\n    background.layerPriority = o.layerPriority - 1\r\n    background\r\n\r\n  addNewLinesToText: (originalText, fontDescriptor, maxWidth=400) ->\r\n    rows = []\r\n    row = []\r\n    words = _.string.words originalText\r\n    textWidth = 0\r\n    for word in words\r\n      row.push(word)\r\n      text = new createjs.Text(_.string.join(' ', row...), fontDescriptor, '#000')\r\n      width = text.getMeasuredWidth()\r\n      if width > maxWidth\r\n        if row.length is 1 # one long word, truncate it\r\n          row[0] = _.string.truncate(row[0], 40)\r\n          text.text = row[0]\r\n          textWidth = Math.max(text.getMeasuredWidth(), textWidth)\r\n          rows.push(row)\r\n          row = []\r\n        else\r\n          row.pop()\r\n          rows.push(row)\r\n          row = [word]\r\n      else\r\n        textWidth = Math.max(textWidth, width)\r\n    rows.push(row) if row.length\r\n    for row, i in rows\r\n      rows[i] = _.string.join(' ', row...)\r\n    text: _.string.join(\"\\n\", rows...), textWidth: textWidth\r\n","CocoClass = require 'core/CocoClass'\r\n{createProgressBar} = require './sprite_utils'\r\nCamera = require './Camera'\r\nMark = require './Mark'\r\nLabel = require './Label'\r\nAudioPlayer = require 'lib/AudioPlayer'\r\n{me} = require 'core/auth'\r\nThangType = require 'models/ThangType'\r\n\r\n# We'll get rid of this once level's teams actually have colors\r\nhealthColors =\r\n  ogres: [64, 128, 212]\r\n  humans: [255, 0, 0]\r\n  neutral: [64, 212, 128]\r\n\r\n# Sprite: EaselJS-based view/controller for Thang model\r\nmodule.exports = Lank = class Lank extends CocoClass\r\n  thangType: null # ThangType instance\r\n\r\n  sprite: null\r\n\r\n  healthBar: null\r\n  marks: null\r\n  labels: null\r\n  ranges: null\r\n\r\n  options:\r\n    groundLayer: null\r\n    textLayer: null\r\n    floatingLayer: null\r\n    thang: null\r\n    camera: null\r\n    showInvisible: false\r\n    preloadSounds: true\r\n\r\n  possessed: false\r\n  flipped: false\r\n  flippedCount: 0\r\n  actionQueue: null\r\n  actions: null\r\n  rotation: 0\r\n\r\n  # Scale numbers\r\n  scaleFactorX: 1 # Current scale adjustment. This can change rapidly.\r\n  scaleFactorY: 1\r\n  targetScaleFactorX: 1 # What the scaleFactor is going toward during a tween.\r\n  targetScaleFactorY: 1\r\n\r\n  # ACTION STATE\r\n  # Actions have relations. If you say 'move', 'move_side' may play because of a direction\r\n  # relationship, and if you say 'cast', 'cast_begin' may happen first, or 'cast_end' after.\r\n  currentRootAction: null  # action that, in general, is playing or will play\r\n  currentAction: null  # related action that is right now playing\r\n\r\n  subscriptions:\r\n    'level:sprite-dialogue': 'onDialogue'\r\n    'level:sprite-clear-dialogue': 'onClearDialogue'\r\n    'level:set-letterbox': 'onSetLetterbox'\r\n    'surface:ticked': 'onSurfaceTicked'\r\n    'sprite:move': 'onMove'\r\n\r\n  constructor: (@thangType, options={}) ->\r\n    super()\r\n    spriteName = @thangType.get('name')\r\n    @isMissile = /(Missile|Arrow|Spear|Bolt)/.test(spriteName) and not /(Tower|Charge)/.test(spriteName)\r\n    @options = _.extend($.extend(true, {}, @options), options)\r\n    @gameUIState = @options.gameUIState\r\n    @handleEvents = @options.handleEvents\r\n    @setThang @options.thang\r\n    @setColorConfig()\r\n\r\n    console.error @toString(), 'has no ThangType!' unless @thangType\r\n\r\n    # this is a stub, use @setSprite to swap it out for something else later\r\n    @sprite = new createjs.Container\r\n\r\n    @actionQueue = []\r\n    @marks = {}\r\n    @labels = {}\r\n    @ranges = []\r\n    @handledDisplayEvents = {}\r\n    @age = 0\r\n    @stillLoading = true\r\n    if @thangType.isFullyLoaded() then @onThangTypeLoaded() else @listenToOnce(@thangType, 'sync', @onThangTypeLoaded)\r\n\r\n  toString: -> \"<Lank: #{@thang?.id}>\"\r\n\r\n  setColorConfig: ->\r\n    return unless colorConfig = @thang?.getLankOptions?().colorConfig\r\n    if @thangType.get('original') is ThangType.heroes['code-ninja']\r\n      unlockedLevels = me.levels()\r\n      if '5522b98685fca53105544b53' in unlockedLevels  # vital-powers, start of course 5\r\n        colorConfig.belt = {hue: 0.4, saturation: 0.75, lightness: 0.25}\r\n      else if '56fc56ac7cd2381f00d758b4' in unlockedLevels  # friend-and-foe, start of course 3\r\n        colorConfig.belt = {hue: 0.067, saturation: 0.75, lightness: 0.5}\r\n      else\r\n        colorConfig.belt = {hue: 0.167, saturation: 0.75, lightness: 0.4}\r\n    @options.colorConfig = colorConfig\r\n\r\n  onThangTypeLoaded: ->\r\n    @stillLoading = false\r\n    if @options.preloadSounds\r\n      for trigger, sounds of @thangType.get('soundTriggers') or {} when trigger isnt 'say'\r\n        AudioPlayer.preloadSoundReference sound for sound in sounds when sound\r\n    if @thangType.get('raster')\r\n      @actions = {}\r\n      @isRaster = true\r\n    else\r\n      @actions = @thangType.getActions()\r\n      @createMarks()\r\n\r\n    @scaleFactorX = @thang.scaleFactorX if @thang?.scaleFactorX?\r\n    @scaleFactorX = @thang.scaleFactor if @thang?.scaleFactor?\r\n    @scaleFactorY = @thang.scaleFactorY if @thang?.scaleFactorY?\r\n    @scaleFactorY = @thang.scaleFactor if @thang?.scaleFactor?\r\n    @updateAction() unless @currentAction\r\n\r\n  setSprite: (newSprite) ->\r\n    if @sprite\r\n      @sprite.off 'animationend', @playNextAction\r\n      @sprite.destroy?()\r\n      if parent = @sprite.parent\r\n        parent.removeChild @sprite\r\n        if parent.spriteSheet is newSprite.spriteSheet\r\n          parent.addChild newSprite\r\n\r\n    # get the lank to update things\r\n    for prop in ['lastPos', 'currentRootAction']\r\n      delete @[prop]\r\n\r\n    @sprite = newSprite\r\n    if @thang and @thang.stateChanged is false\r\n      @thang.stateChanged = true\r\n    @configureMouse()\r\n    @sprite.on 'animationend', @playNextAction\r\n    @playAction(@currentAction) if @currentAction and not @stillLoading\r\n    @trigger 'new-sprite', @sprite\r\n\r\n  ##################################################\r\n  # QUEUEING AND PLAYING ACTIONS\r\n\r\n  queueAction: (action) ->\r\n    # The normal way to have an action play\r\n    action = @actions[action] if _.isString(action)\r\n    action ?= @actions.idle\r\n    @actionQueue = []\r\n    @actionQueue.push @currentRootAction.relatedActions.end if @currentRootAction?.relatedActions?.end\r\n    @actionQueue.push action.relatedActions.begin if action.relatedActions?.begin\r\n    @actionQueue.push action\r\n    if action.goesTo and nextAction = @actions[action.goesTo]\r\n      @actionQueue.push nextAction if nextAction\r\n    @currentRootAction = action\r\n    @playNextAction()\r\n\r\n  onSurfaceTicked: (e) -> @age += e.dt\r\n\r\n  playNextAction: =>\r\n    return if @destroyed\r\n    @playAction(@actionQueue.splice(0, 1)[0]) if @actionQueue.length\r\n\r\n  playAction: (action) ->\r\n    return if @isRaster\r\n    @currentAction = action\r\n    return @hide() unless action.animation or action.container or action.relatedActions or action.goesTo\r\n    @show()\r\n    return @updateActionDirection() unless action.animation or action.container or action.goesTo\r\n    return if @sprite.placeholder\r\n    m = if action.container then 'gotoAndStop' else 'gotoAndPlay'\r\n    @sprite[m]?(action.name)\r\n    @updateScale()\r\n    @updateRotation()\r\n\r\n  hide: ->\r\n    @hiding = true\r\n    @updateAlpha()\r\n\r\n  show: ->\r\n    @hiding = false\r\n    @updateAlpha()\r\n\r\n  stop: ->\r\n    @sprite?.stop?()\r\n    mark.stop() for name, mark of @marks\r\n    @stopped = true\r\n\r\n  play: ->\r\n    @sprite?.play?()\r\n    mark.play() for name, mark of @marks\r\n    @stopped = false\r\n\r\n  update: (frameChanged) ->\r\n    # Gets the sprite to reflect what the current state of the thangs and surface are\r\n    return false if @stillLoading\r\n    thangUnchanged = @thang and @thang.stateChanged is false\r\n    if (frameChanged and not thangUnchanged) or (@thang and @thang.bobHeight) or @notOfThisWorld\r\n      @updatePosition()\r\n    return false if thangUnchanged\r\n    frameChanged = frameChanged or @targetScaleFactorX isnt @scaleFactorX or @targetScaleFactorY isnt @scaleFactorY\r\n    if frameChanged\r\n      @handledDisplayEvents = {}\r\n      @updateScale()  # must happen before rotation\r\n      @updateAlpha()\r\n      @updateRotation()\r\n      @updateAction()\r\n      @updateStats()\r\n      @updateGold()\r\n      @showAreaOfEffects()\r\n      @showTextEvents()\r\n      @updateHealthBar()\r\n    @updateMarks()\r\n    @updateLabels()\r\n    @thang.stateChanged = false if @thang and @thang.stateChanged is true\r\n    return true\r\n\r\n  showAreaOfEffects: ->\r\n    return unless @thang?.currentEvents\r\n    for event in @thang.currentEvents\r\n      continue unless _.string.startsWith event, 'aoe-'\r\n      continue if @handledDisplayEvents[event]\r\n      @handledDisplayEvents[event] = true\r\n      args = JSON.parse(event[4...])\r\n      key = 'aoe-' + JSON.stringify(args[2..])\r\n      layerName = args[6] ? 'ground'  # Can also specify 'floating'.\r\n      unless layer = @options[layerName + 'Layer']\r\n        console.error \"#{@thang.id} couldn't find layer #{layerName}Layer for AOE effect #{key}; using ground layer.\"\r\n        layer = @options.groundLayer\r\n\r\n      unless key in layer.spriteSheet.getAnimations()\r\n        circle = new createjs.Shape()\r\n        radius = args[2] * Camera.PPM\r\n        if args.length is 4\r\n          circle.graphics.beginFill(args[3]).drawCircle(0, 0, radius)\r\n        else\r\n          startAngle = args[4] or 0\r\n          endAngle = args[5] or 2 * Math.PI\r\n          if startAngle is endAngle\r\n            startAngle = 0\r\n            endAngle = 2 * Math.PI\r\n          circle.graphics.beginFill(args[3])\r\n            .lineTo(0, 0)\r\n            .lineTo(radius * Math.cos(startAngle), radius * Math.sin(startAngle))\r\n            .arc(0, 0, radius, startAngle, endAngle)\r\n            .lineTo(0, 0)\r\n        layer.addCustomGraphic(key, circle, [-radius, -radius, radius*2, radius*2])\r\n\r\n      circle = new createjs.Sprite(layer.spriteSheet)\r\n      circle.gotoAndStop(key)\r\n      pos = @options.camera.worldToSurface {x: args[0], y: args[1]}\r\n      circle.x = pos.x\r\n      circle.y = pos.y\r\n      resFactor = layer.resolutionFactor\r\n      circle.scaleY = @options.camera.y2x * 0.7 / resFactor\r\n      circle.scaleX = 0.7 / resFactor\r\n      circle.alpha = 0.2\r\n      layer.addChild circle\r\n      createjs.Tween.get(circle)\r\n        .to({alpha: 0.6, scaleY: @options.camera.y2x / resFactor, scaleX: 1 / resFactor}, 100, createjs.Ease.circOut)\r\n        .to({alpha: 0, scaleY: 0, scaleX: 0}, 700, createjs.Ease.circIn)\r\n        .call =>\r\n          return if @destroyed\r\n          layer.removeChild circle\r\n          delete @handledDisplayEvents[event]\r\n\r\n  showTextEvents: ->\r\n    return unless @thang?.currentEvents\r\n    for event in @thang.currentEvents\r\n      continue unless _.string.startsWith event, 'text-'\r\n      continue if @handledDisplayEvents[event]\r\n      @handledDisplayEvents[event] = true\r\n      options = JSON.parse(event[5...])\r\n      label = new createjs.Text options.text, \"bold #{options.size or 16}px Arial\", options.color or '#FFF'\r\n      shadowColor = {humans: '#F00', ogres: '#00F', neutral: '#0F0', common: '#0F0'}[@thang.team] ? '#000'\r\n      label.shadow = new createjs.Shadow shadowColor, 1, 1, 3\r\n      offset = @getOffset 'aboveHead'\r\n      [label.x, label.y] = [@sprite.x + offset.x - label.getMeasuredWidth() / 2, @sprite.y + offset.y]\r\n      @options.textLayer.addChild label\r\n      window.labels ?= []\r\n      window.labels.push label\r\n      label.alpha = 0\r\n      createjs.Tween.get(label)\r\n        .to({y: label.y-2, alpha: 1}, 200, createjs.Ease.linear)\r\n        .to({y: label.y-12}, 1000, createjs.Ease.linear)\r\n        .to({y: label.y-22, alpha: 0}, 1000, createjs.Ease.linear)\r\n        .call =>\r\n          return if @destroyed\r\n          @options.textLayer.removeChild label\r\n\r\n  getBobOffset: ->\r\n    return 0 unless @thang.bobHeight\r\n    return @lastBobOffset if @stopped\r\n    return @lastBobOffset = @thang.bobHeight * (1 + Math.sin(@age * Math.PI / @thang.bobTime))\r\n\r\n  getWorldPosition: ->\r\n    p1 = if @possessed then @shadow.pos else @thang.pos\r\n    if bobOffset = @getBobOffset()\r\n      p1 = p1.copy?() or _.clone(p1)\r\n      p1.z += bobOffset\r\n    x: p1.x, y: p1.y, z: if @thang.isLand then 0 else p1.z - @thang.depth / 2\r\n\r\n  updatePosition: (whileLoading=false) ->\r\n    return if @stillLoading and not whileLoading\r\n    return unless @thang?.pos and @options.camera?\r\n    [p0, p1] = [@lastPos, @thang.pos]\r\n    return if p0 and p0.x is p1.x and p0.y is p1.y and p0.z is p1.z and not @thang.bobHeight\r\n    wop = @getWorldPosition()\r\n    sup = @options.camera.worldToSurface wop\r\n    [@sprite.x, @sprite.y] = [sup.x, sup.y]\r\n    @lastPos = p1.copy?() or _.clone(p1) unless whileLoading\r\n    @hasMoved = true\r\n    if @thangType.get('name') is 'Flag' and not @notOfThisWorld\r\n      # Let the pending flags know we're here (but not this call stack, they need to delete themselves, and we may be iterating sprites).\r\n      _.defer => Backbone.Mediator.publish 'surface:flag-appeared', sprite: @\r\n\r\n  updateScale: (force) ->\r\n    return unless @sprite\r\n    if @thangType.get('matchWorldDimensions') and @thang and @options.camera\r\n      if force or @thang.width isnt @lastThangWidth or @thang.height isnt @lastThangHeight or @thang.rotation isnt @lastThangRotation\r\n        bounds = @sprite.getBounds()\r\n        return unless bounds\r\n        @sprite.scaleX = @thang.width  * Camera.PPM / bounds.width  * (@options.camera.y2x + (1 - @options.camera.y2x) * Math.abs Math.cos @thang.rotation)\r\n        @sprite.scaleY = @thang.height * Camera.PPM / bounds.height * (@options.camera.y2x + (1 - @options.camera.y2x) * Math.abs Math.sin @thang.rotation)\r\n        @sprite.regX = bounds.width  * 3 / 4  # Why not / 2? I don't know.\r\n        @sprite.regY = bounds.height * 3 / 4  # Why not / 2? I don't know.\r\n\r\n        unless @thang.spriteName is 'Beam'\r\n          @sprite.scaleX *= @thangType.get('scale') ? 1\r\n          @sprite.scaleY *= @thangType.get('scale') ? 1\r\n        [@lastThangWidth, @lastThangHeight, @lastThangRotation] = [@thang.width, @thang.height, @thang.rotation]\r\n      return\r\n\r\n    scaleX = scaleY = 1\r\n\r\n    if @isMissile\r\n      # Scales the arrow so it appears longer when flying parallel to horizon.\r\n      # To do that, we convert angle to [0, 90] (mirroring half-planes twice), then make linear function out of it:\r\n      # (a - x) / a: equals 1 when x = 0, equals 0 when x = a, monotonous in between. That gives us some sort of\r\n      # degenerative multiplier.\r\n      # For our purposes, a = 90 - the direction straight upwards.\r\n      # Then we use r + (1 - r) * x function with r = 0.5, so that\r\n      # maximal scale equals 1 (when x is at it's maximum) and minimal scale is 0.5.\r\n      # Notice that the value of r is empirical.\r\n      angle = @getRotation()\r\n      angle = -angle if angle < 0\r\n      angle = 180 - angle if angle > 90\r\n      scaleX = 0.5 + 0.5 * (90 - angle) / 90\r\n\r\n#    console.error 'No thang for', @ unless @thang\r\n    @sprite.scaleX = @sprite.baseScaleX * @scaleFactorX * scaleX\r\n    @sprite.scaleY = @sprite.baseScaleY * @scaleFactorY * scaleY\r\n\r\n    newScaleFactorX = @thang?.scaleFactorX ? @thang?.scaleFactor ? 1\r\n    newScaleFactorY = @thang?.scaleFactorY ? @thang?.scaleFactor ? 1\r\n    if @layer?.name is 'Land' or @thang?.spriteName is 'Beam'\r\n      @scaleFactorX = newScaleFactorX\r\n      @scaleFactorY = newScaleFactorY\r\n    else if @thang and (newScaleFactorX isnt @targetScaleFactorX or newScaleFactorY isnt @targetScaleFactorY)\r\n      @targetScaleFactorX = newScaleFactorX\r\n      @targetScaleFactorY = newScaleFactorY\r\n      createjs.Tween.removeTweens(@)\r\n      createjs.Tween.get(@).to({scaleFactorX: @targetScaleFactorX, scaleFactorY: @targetScaleFactorY}, 2000, createjs.Ease.elasticOut)\r\n\r\n  updateAlpha: ->\r\n    @sprite.alpha = if @hiding then 0 else 1\r\n    return unless @thang?.alpha?\r\n    return if @sprite.alpha is @thang.alpha\r\n    @sprite.alpha = @thang.alpha\r\n    if @options.showInvisible\r\n      @sprite.alpha = Math.max 0.5, @sprite.alpha\r\n    mark.updateAlpha @thang.alpha for name, mark of @marks\r\n    @healthBar?.alpha = @thang.alpha\r\n\r\n  updateRotation: (sprite) ->\r\n    rotationType = @thangType.get('rotationType')\r\n    return if rotationType is 'fixed'\r\n    rotation = @getRotation()\r\n    if @isMissile and @thang.velocity\r\n      # Rotates the arrow to see it arc based on velocity.z.\r\n      # Notice that rotation here does not affect thang's state - it is just the effect.\r\n      # Thang's rotation is always pointing where it is heading.\r\n      vz = @thang.velocity.z\r\n      if vz and speed = @thang.velocity.magnitude(true)\r\n        vx = @thang.velocity.x\r\n        heading = @thang.velocity.heading()\r\n        xFactor = Math.cos heading\r\n        zFactor = vz / Math.sqrt(vz * vz + vx * vx)\r\n        rotation -= xFactor * zFactor * 45\r\n    sprite ?= @sprite\r\n    return sprite.rotation = rotation if rotationType is 'free' or not rotationType\r\n    @updateIsometricRotation(rotation, sprite)\r\n\r\n  getRotation: ->\r\n    thang = if @possessed then @shadow else @thang\r\n    return @rotation if not thang?.rotation\r\n    rotation = thang?.rotation\r\n    rotation = (360 - (rotation * 180 / Math.PI) % 360) % 360\r\n    rotation -= 360 if rotation > 180\r\n    rotation\r\n\r\n  updateIsometricRotation: (rotation, sprite) ->\r\n    return unless @currentAction\r\n    return if _.string.endsWith(@currentAction.name, 'back')\r\n    return if _.string.endsWith(@currentAction.name, 'fore')\r\n    sprite.scaleX *= -1 if Math.abs(rotation) >= 90\r\n\r\n  ##################################################\r\n  updateAction: ->\r\n    return if @isRaster or @actionLocked\r\n    action = @determineAction()\r\n    isDifferent = action isnt @currentRootAction or action is null\r\n    if not action and @thang?.actionActivated and not @stopLogging\r\n      console.error 'action is', action, 'for', @thang?.id, 'from', @currentRootAction, @thang.action, @thang.getActionName?()\r\n      @stopLogging = true\r\n    @queueAction(action) if action and (isDifferent or (@thang?.actionActivated and action.name isnt 'move'))\r\n    @updateActionDirection()\r\n\r\n  determineAction: ->\r\n    action = null\r\n    thang = if @possessed then @shadow else @thang\r\n    action = thang.action if thang?.acts\r\n    action ?= @currentRootAction.name if @currentRootAction?\r\n    action ?= 'idle'\r\n    unless @actions[action]?\r\n      @warnedFor ?= {}\r\n      console.warn 'Cannot show action', action, 'for', @thangType.get('name'), 'because it DNE' unless @warnedFor[action]\r\n      @warnedFor[action] = true\r\n      return if @action is 'idle' then null else 'idle'\r\n    #action = 'break' if @actions.break? and @thang?.erroredOut  # This makes it looks like it's dead when it's not: bad in Brawlwood.\r\n    action = 'die' if @actions.die? and thang?.health? and thang.health <= 0\r\n    @actions[action]\r\n\r\n  updateActionDirection: (@wallGrid=null) ->\r\n    # wallGrid is only needed for wall grid face updates; should refactor if this works\r\n    return unless action = @getActionDirection()\r\n    @playAction(action) if action isnt @currentAction\r\n\r\n  lockAction: -> (@actionLocked=true)\r\n\r\n  getActionDirection: (rootAction=null) ->\r\n    rootAction ?= @currentRootAction\r\n    return null unless relatedActions = rootAction?.relatedActions ? {}\r\n    rotation = @getRotation()\r\n    if relatedActions['111111111111']  # has grid-surrounding-wall-based actions\r\n      if @wallGrid\r\n        @hadWallGrid = true\r\n        action = ''\r\n        tileSize = 4\r\n        [gx, gy] = [@thang.pos.x, @thang.pos.y]\r\n        for y in [gy + tileSize, gy, gy - tileSize, gy - tileSize * 2]\r\n          for x in [gx - tileSize, gx, gx + tileSize]\r\n            if x >= 0 and y >= 0 and x < @wallGrid.width and y < @wallGrid.height\r\n              wallThangs = @wallGrid.contents x, y\r\n            else\r\n              wallThangs = ['outside of the map yo']\r\n            if wallThangs.length is 0\r\n              if y is gy and x is gx\r\n                action += '1'  # the center wall we're placing\r\n              else\r\n                action += '0'\r\n            else if wallThangs.length is 1\r\n              action += '1'\r\n            else\r\n              console.error 'Overlapping walls at', x, y, '...', wallThangs\r\n              action += '1'\r\n        matchedAction = '111111111111'\r\n        for relatedAction of relatedActions\r\n          if action.match(relatedAction.replace(/\\?/g, '.'))\r\n            matchedAction = relatedAction\r\n            break\r\n        #console.log 'returning', matchedAction, 'for', @thang.id, 'at', gx, gy\r\n        return relatedActions[matchedAction]\r\n      else if @hadWallGrid\r\n        return null\r\n      else\r\n        keys = _.keys relatedActions\r\n        index = Math.max 0, Math.floor((179 + rotation) / 360 * keys.length)\r\n        #console.log 'Showing', relatedActions[keys[index]]\r\n        return relatedActions[keys[index]]\r\n    value = Math.abs(rotation)\r\n    direction = null\r\n    direction = 'side' if value <= 45 or value >= 135\r\n    direction = 'fore' if 135 > rotation > 45\r\n    direction = 'back' if -135 < rotation < -45\r\n    relatedActions[direction]\r\n\r\n  updateStats: ->\r\n    return unless @thang and @thang.health isnt @lastHealth\r\n    @lastHealth = @thang.health\r\n    if bar = @healthBar\r\n      healthPct = Math.max(@thang.health / @thang.maxHealth, 0)\r\n      bar.scaleX = healthPct / @options.floatingLayer.resolutionFactor\r\n    if @thang.showsName\r\n      @setNameLabel(if @thang.health <= 0 then '' else @thang.id)\r\n    else if @options.playerName\r\n      @setNameLabel @options.playerName\r\n\r\n  configureMouse: ->\r\n    @sprite.cursor = 'pointer' if @thang?.isSelectable\r\n    @sprite.mouseEnabled = @sprite.mouseChildren = false unless @thang?.isSelectable or @thang?.isLand\r\n    if @sprite.mouseEnabled\r\n      @sprite.on 'mousedown', @onMouseEvent, @, false, 'sprite:mouse-down'\r\n      @sprite.on 'click',     @onMouseEvent, @, false, 'sprite:clicked'\r\n      @sprite.on 'dblclick',  @onMouseEvent, @, false, 'sprite:double-clicked'\r\n      @sprite.on 'pressmove', @onMouseEvent, @, false, 'sprite:dragged'\r\n      @sprite.on 'pressup',   @onMouseEvent, @, false, 'sprite:mouse-up'\r\n\r\n  onMouseEvent: (e, ourEventName) ->\r\n    return if @letterboxOn or not @sprite\r\n    p = @sprite\r\n    p = p.parent while p.parent\r\n    newEvent = sprite: @, thang: @thang, originalEvent: e, canvas: p.canvas\r\n    @trigger ourEventName, newEvent\r\n    Backbone.Mediator.publish ourEventName, newEvent\r\n    @gameUIState.trigger(ourEventName, newEvent)\r\n\r\n  addHealthBar: ->\r\n    return unless @thang?.health? and 'health' in (@thang?.hudProperties ? []) and @options.floatingLayer\r\n    team = @thang?.team or 'neutral'\r\n    key = \"#{team}-health-bar\"\r\n\r\n    unless key in @options.floatingLayer.spriteSheet.getAnimations()\r\n      healthColor = healthColors[team]\r\n      bar = createProgressBar(healthColor)\r\n      @options.floatingLayer.addCustomGraphic(key, bar, bar.bounds)\r\n\r\n    hadHealthBar = @healthBar\r\n    @healthBar = new createjs.Sprite(@options.floatingLayer.spriteSheet)\r\n    @healthBar.gotoAndStop(key)\r\n    offset = @getOffset 'aboveHead'\r\n    @healthBar.scaleX = @healthBar.scaleY = 1 / @options.floatingLayer.resolutionFactor\r\n    @healthBar.name = 'health bar'\r\n    @options.floatingLayer.addChild @healthBar\r\n    @updateHealthBar()\r\n    @lastHealth = null\r\n    if not hadHealthBar\r\n      @listenTo @options.floatingLayer, 'new-spritesheet', @addHealthBar\r\n\r\n  getActionProp: (prop, subProp, def=null) ->\r\n    # Get a property or sub-property from an action, falling back to ThangType\r\n    for val in [@currentAction?[prop], @thangType.get(prop)]\r\n      val = val[subProp] if val? and subProp\r\n      return val if val?\r\n    def\r\n\r\n  getOffset: (prop) ->\r\n    # Get the proper offset from either the current action or the ThangType\r\n    def = x: 0, y: {registration: 0, torso: -50, mouth: -60, aboveHead: -100}[prop]\r\n    pos = @getActionProp 'positions', prop, def\r\n    pos = x: pos.x, y: pos.y\r\n    if not @isRaster\r\n      scale = @getActionProp 'scale', null, 1\r\n      scale *= @sprite.parent.resolutionFactor if prop is 'registration'\r\n      pos.x *= scale\r\n      pos.y *= scale\r\n    if @thang and prop isnt 'registration'\r\n      pos.x *= @thang.scaleFactorX ? @thang.scaleFactor ? 1\r\n      pos.y *= @thang.scaleFactorY ? @thang.scaleFactor ? 1\r\n    # We might need to do this, but I don't have a good test case yet. TODO: figure out.\r\n    #if prop isnt @registration\r\n    #  pos.x *= if @getActionProp 'flipX' then -1 else 1\r\n    #  pos.y *= if @getActionProp 'flipY' then -1 else 1\r\n    pos\r\n\r\n  createMarks: ->\r\n    return unless @options.camera\r\n    if @thang\r\n      # TODO: Add back ranges\r\n#      allProps = []\r\n#      allProps = allProps.concat (@thang.hudProperties ? [])\r\n#      allProps = allProps.concat (@thang.programmableProperties ? [])\r\n#      allProps = allProps.concat (@thang.moreProgrammableProperties ? [])\r\n#\r\n#      for property in allProps\r\n#        if m = property.match /.*(Range|Distance|Radius)$/\r\n#          if @thang[m[0]]? and @thang[m[0]] < 9001\r\n#            @ranges.push\r\n#              name: m[0]\r\n#              radius: @thang[m[0]]\r\n#\r\n#      @ranges = _.sortBy @ranges, 'radius'\r\n#      @ranges.reverse()\r\n#\r\n#      @addMark range.name for range in @ranges\r\n\r\n      # TODO: add back bounds\r\n#      @addMark('bounds').toggle true if @thang?.drawsBounds\r\n      @addMark('shadow').toggle true unless @thangType.get('shadow') is 0\r\n\r\n  updateMarks: ->\r\n    return unless @options.camera\r\n    @addMark 'repair', null, 'repair' if @thang?.erroredOut\r\n    @marks.repair?.toggle @thang?.erroredOut\r\n\r\n    if @selected\r\n      @marks[range['name']].toggle true for range in @ranges\r\n    else\r\n      @marks[range['name']].toggle false for range in @ranges\r\n\r\n    if @isMissile and @thang.action is 'die'\r\n      @marks.shadow?.hide()\r\n    mark.update() for name, mark of @marks\r\n    #@thang.effectNames = ['warcry', 'confuse', 'control', 'curse', 'fear', 'poison', 'paralyze', 'regen', 'sleep', 'slow', 'haste']\r\n    @updateEffectMarks() if @thang?.effectNames?.length or @previousEffectNames?.length\r\n\r\n  updateEffectMarks: ->\r\n    return if _.isEqual @thang.effectNames, @previousEffectNames\r\n    return if @stopped\r\n    for effect in @thang.effectNames\r\n      mark = @addMark effect, @options.floatingLayer, effect\r\n      mark.statusEffect = true\r\n      mark.toggle 'on'\r\n      mark.show()\r\n\r\n    if @previousEffectNames\r\n      for effect in @previousEffectNames\r\n        continue if effect in @thang.effectNames\r\n        mark = @marks[effect]\r\n        mark.toggle false\r\n\r\n    if @thang.effectNames.length > 1 and not @effectInterval\r\n      @rotateEffect()\r\n      @effectInterval = setInterval @rotateEffect, 1500\r\n\r\n    else if @effectInterval and @thang.effectNames.length <= 1\r\n      clearInterval @effectInterval\r\n      @effectInterval = null\r\n\r\n    @previousEffectNames = @thang.effectNames\r\n\r\n  rotateEffect: =>\r\n    effects = (m.name for m in _.values(@marks) when m.on and m.statusEffect and m.mark)\r\n    return unless effects.length\r\n    effects.sort()\r\n    @effectIndex ?= 0\r\n    @effectIndex = (@effectIndex + 1) % effects.length\r\n    @marks[effect].hide() for effect in effects\r\n    @marks[effects[@effectIndex]].show()\r\n\r\n  setHighlight: (to, delay) ->\r\n    @addMark 'highlight', @options.floatingLayer, 'highlight' if to\r\n    @marks.highlight?.highlightDelay = delay\r\n    @marks.highlight?.toggle to and not @dimmed\r\n\r\n  setDimmed: (@dimmed) ->\r\n    @marks.highlight?.toggle @marks.highlight.on and not @dimmed\r\n\r\n  setThang: (@thang) ->\r\n    @options.thang = @thang\r\n\r\n  setDebug: (debug) ->\r\n    return unless @thang?.collides and @options.camera?\r\n    @addMark 'debug', @options.floatingLayer if debug\r\n    if d = @marks.debug\r\n      d.toggle debug\r\n      d.updatePosition()\r\n\r\n  addLabel: (name, style) ->\r\n    @labels[name] ?= new Label sprite: @, camera: @options.camera, layer: @options.textLayer, style: style\r\n    @labels[name]\r\n\r\n  addMark: (name, layer, thangType=null) ->\r\n    @marks[name] ?= new Mark name: name, lank: @, camera: @options.camera, layer: layer ? @options.groundLayer, thangType: thangType\r\n    @marks[name]\r\n\r\n  removeMark: (name) ->\r\n    @marks[name].destroy()\r\n    delete @marks[name]\r\n\r\n  notifySpeechUpdated: (e) ->\r\n    e = _.clone(e)\r\n    e.sprite = @\r\n    e.blurb ?= '...'\r\n    e.thang = @thang\r\n    Backbone.Mediator.publish 'sprite:speech-updated', e\r\n\r\n  isTalking: ->\r\n    Boolean @labels.dialogue?.text or @labels.say?.text\r\n\r\n  onDialogue: (e) ->\r\n    return unless @thang?.id is e.spriteID\r\n    unless @thang?.id is 'Hero Placeholder'  # Don't show these for heroes, because they aren't actually first-person, just LevelDialogueView narration\r\n      label = @addLabel 'dialogue', Label.STYLE_DIALOGUE\r\n      label.setText e.blurb or '...'\r\n    sound = e.sound ? AudioPlayer.soundForDialogue e.message, @thangType.get 'soundTriggers'\r\n    @dialogueSoundInstance?.stop()\r\n    if @dialogueSoundInstance = @playSound sound, false\r\n      @dialogueSoundInstance.addEventListener 'complete', -> Backbone.Mediator.publish 'sprite:dialogue-sound-completed', {}\r\n    @notifySpeechUpdated e\r\n\r\n  onClearDialogue: (e) ->\r\n    return unless @labels.dialogue?.text\r\n    @labels.dialogue?.setText null\r\n    @dialogueSoundInstance?.stop()\r\n    @notifySpeechUpdated {}\r\n\r\n  onSetLetterbox: (e) ->\r\n    @letterboxOn = e.on\r\n\r\n  setNameLabel: (name) ->\r\n    label = @addLabel 'name', Label.STYLE_NAME\r\n    label.setText name\r\n\r\n  updateLabels: ->\r\n    return unless @thang\r\n    blurb = if @thang.health <= 0 then null else @thang.sayMessage  # Dead men tell no tales\r\n    blurb = null if blurb in ['For Thoktar!', 'Bones!', 'Behead!', 'Destroy!', 'Die, humans!']  # Let's just hear, not see, these ones.\r\n    if /Hero Placeholder/.test(@thang.id)\r\n      labelStyle = Label.STYLE_DIALOGUE\r\n    else\r\n      labelStyle = @thang.labelStyle ? Label.STYLE_SAY\r\n    @addLabel 'say', labelStyle if blurb\r\n    if @labels.say?.setText blurb\r\n      @notifySpeechUpdated blurb: blurb\r\n\r\n    if @thang?.variableNames?\r\n      ls = @addLabel 'variableNames', Label.STYLE_VAR\r\n      ls.setText @thang?.variableNames\r\n    else if @labels.variableNames\r\n      @labels.variableNames.destroy()\r\n      delete @labels.variableNames\r\n\r\n    label.update() for name, label of @labels\r\n\r\n  updateGold: ->\r\n    # TODO: eventually this should be moved into some sort of team-based update\r\n    # rather than an each-thang-that-shows-gold-per-team thing.\r\n    return unless @thang\r\n    return if @thang.gold is @lastGold\r\n    gold = Math.floor @thang.gold ? 0\r\n    if @thang.world.age is 0\r\n      gold = @thang.world.initialTeamGold[@thang.team].gold\r\n    return if gold is @lastGold\r\n    @lastGold = gold\r\n    Backbone.Mediator.publish 'surface:gold-changed', {team: @thang.team, gold: gold, goldEarned: Math.floor(@thang.goldEarned ? 0)}\r\n\r\n  shouldMuteMessage: (m) ->\r\n    if me.getAnnouncesActionAudioGroup() in ['no-audio', 'just-take-damage']\r\n      return true if m in ['moveRight', 'moveUp', 'moveDown', 'moveLeft']\r\n      return true if /^attack /.test m\r\n      return true if /^Repeating loop/.test m\r\n      return true if /^findNearestEnemy/.test m\r\n\r\n    return false if m in ['moveRight', 'moveUp', 'moveDown', 'moveLeft']\r\n    @previouslySaidMessages ?= {}\r\n    t0 = @previouslySaidMessages[m] ? 0\r\n    t1 = new Date()\r\n    @previouslySaidMessages[m] = t1\r\n    return true if t1 - t0 < 5 * 1000\r\n    false\r\n\r\n  playSounds: (withDelay=true, volume=1.0) ->\r\n    for event in @thang.currentEvents ? []\r\n      if event is 'take-damage' and me.getAnnouncesActionAudioGroup() in ['no-audio', 'without-take-damage']\r\n        null  # Skip playing it\r\n      else\r\n        @playSound event, withDelay, volume\r\n      if event is 'pay-bounty-gold' and @thang.bountyGold > 25 and @thang.team isnt me.team\r\n        AudioPlayer.playInterfaceSound 'coin_1', 0.25\r\n    if @thang.actionActivated and (action = @thang.getActionName()) isnt 'say'\r\n      @playSound action, withDelay, volume\r\n    if @thang.sayMessage and withDelay and not @thang.silent and not @shouldMuteMessage @thang.sayMessage  # don't play sayMessages while scrubbing, annoying\r\n      offsetFrames = Math.abs(@thang.sayStartTime - @thang.world.age) / @thang.world.dt\r\n      if offsetFrames <= 2  # or (not withDelay and offsetFrames < 30)\r\n        sound = AudioPlayer.soundForDialogue @thang.sayMessage, @thangType.get 'soundTriggers'\r\n        @playSound sound, false, volume\r\n\r\n  playSound: (sound, withDelay=true, volume=1.0) ->\r\n    if _.isString sound\r\n      sound = @thangType.get('soundTriggers')?[sound]\r\n    if _.isArray sound\r\n      sound = sound[Math.floor Math.random() * sound.length]\r\n    return null unless sound\r\n    delay = if withDelay and sound.delay then 1000 * sound.delay / createjs.Ticker.getFPS() else 0\r\n    name = AudioPlayer.nameForSoundReference sound\r\n    AudioPlayer.preloadSoundReference sound\r\n    instance = AudioPlayer.playSound name, volume, delay, @getWorldPosition()\r\n    #console.log @thang?.id, 'played sound', name, 'with delay', delay, 'volume', volume, 'and got sound instance', instance\r\n    instance\r\n\r\n  onMove: (e) ->\r\n    return unless e.spriteID is @thang?.id\r\n    pos = e.pos\r\n    if _.isArray pos\r\n      pos = new Vector pos...\r\n    else if _.isString pos\r\n      return console.warn 'Couldn\\'t find target sprite', pos, 'from', @options.sprites unless pos of @options.sprites\r\n      target = @options.sprites[pos].thang\r\n      heading = Vector.subtract(target.pos, @thang.pos).normalize()\r\n      distance = @thang.pos.distance target.pos\r\n      offset = Math.max(target.width, target.height, 2) / 2 + 3\r\n      pos = Vector.add(@thang.pos, heading.multiply(distance - offset))\r\n    Backbone.Mediator.publish 'level:sprite-clear-dialogue', {}\r\n    @onClearDialogue()\r\n    args = [pos]\r\n    args.push(e.duration) if e.duration?\r\n    @move(args...)\r\n\r\n  move: (pos, duration=2000, endAnimation='idle') =>\r\n    @updateShadow()\r\n    if not duration\r\n      createjs.Tween.removeTweens(@shadow.pos) if @lastTween\r\n      @lastTween = null\r\n      z = @shadow.pos.z\r\n      @shadow.pos = pos\r\n      @shadow.pos.z = z\r\n      @sprite.gotoAndPlay?(endAnimation)\r\n      return\r\n\r\n    @shadow.action = 'move'\r\n    @shadow.actionActivated = true\r\n    @pointToward(pos)\r\n    @possessed = true\r\n    @update true\r\n\r\n    ease = createjs.Ease.getPowInOut(2.2)\r\n    if @lastTween\r\n      ease = createjs.Ease.getPowOut(1.2)\r\n      createjs.Tween.removeTweens(@shadow.pos)\r\n\r\n    endFunc = =>\r\n      @lastTween = null\r\n      @sprite.gotoAndPlay(endAnimation) unless @stillLoading\r\n      @shadow.action = 'idle'\r\n      @update true\r\n      @possessed = false\r\n\r\n    @lastTween = createjs.Tween\r\n      .get(@shadow.pos)\r\n      .to({x: pos.x, y: pos.y}, duration, ease)\r\n      .call(endFunc)\r\n\r\n  pointToward: (pos) ->\r\n    @shadow.rotation = Math.atan2(pos.y - @shadow.pos.y, pos.x - @shadow.pos.x)\r\n    if (@shadow.rotation * 180 / Math.PI) % 90 is 0\r\n      @shadow.rotation += 0.01\r\n\r\n  updateShadow: ->\r\n    @shadow = {} if not @shadow\r\n    @shadow.pos = @thang.pos\r\n    @shadow.rotation = @thang.rotation\r\n    @shadow.action = @thang.action\r\n    @shadow.actionActivated = @thang.actionActivated\r\n\r\n  updateHealthBar: ->\r\n    return unless @healthBar\r\n    bounds = @healthBar.getBounds()\r\n    offset = @getOffset 'aboveHead'\r\n    @healthBar.x = @sprite.x - (-offset.x + bounds.width / 2 / @options.floatingLayer.resolutionFactor)\r\n    @healthBar.y = @sprite.y - (-offset.y + bounds.height / 2 / @options.floatingLayer.resolutionFactor)\r\n\r\n  destroy: ->\r\n    mark.destroy() for name, mark of @marks\r\n    label.destroy() for name, label of @labels\r\n    p.removeChild @healthBar if p = @healthBar?.parent\r\n    @sprite?.off 'animationend', @playNextAction\r\n    clearInterval @effectInterval if @effectInterval\r\n    @dialogueSoundInstance?.removeAllEventListeners()\r\n    super()\r\n","CocoClass = require 'core/CocoClass'\r\n{me} = require 'core/auth'\r\nLayerAdapter = require './LayerAdapter'\r\nFlagLank = require 'lib/surface/FlagLank'\r\nLank = require 'lib/surface/Lank'\r\nMark = require './Mark'\r\nGrid = require 'lib/world/Grid'\r\nutils = require 'core/utils'\r\n\r\nmodule.exports = class LankBoss extends CocoClass\r\n  subscriptions:\r\n    'level:set-debug': 'onSetDebug'\r\n    'sprite:highlight-sprites': 'onHighlightSprites'\r\n    'surface:stage-mouse-down': 'onStageMouseDown'\r\n    'level:select-sprite': 'onSelectSprite'\r\n    'level:suppress-selection-sounds': 'onSuppressSelectionSounds'\r\n    'level:lock-select': 'onSetLockSelect'\r\n    'level:restarted': 'onLevelRestarted'\r\n    'god:new-world-created': 'onNewWorld'\r\n    'god:streaming-world-updated': 'onNewWorld'\r\n    'camera:dragged': 'onCameraDragged'\r\n    'sprite:loaded': -> @update(true)\r\n    'level:flag-color-selected': 'onFlagColorSelected'\r\n    'level:flag-updated': 'onFlagUpdated'\r\n    'surface:flag-appeared': 'onFlagAppeared'\r\n    'surface:remove-selected-flag': 'onRemoveSelectedFlag'\r\n\r\n  constructor: (@options={}) ->\r\n    super()\r\n    @handleEvents = @options.handleEvents\r\n    @gameUIState = @options.gameUIState\r\n    @dragged = 0\r\n    @camera = @options.camera\r\n    @webGLStage = @options.webGLStage\r\n    @surfaceTextLayer = @options.surfaceTextLayer\r\n    @world = @options.world\r\n    @options.thangTypes ?= []\r\n    @lanks = {}\r\n    @lankArray = []  # Mirror @lanks, but faster for when we just need to iterate\r\n    @createLayers()\r\n    @pendingFlags = []\r\n    if not @handleEvents\r\n      @listenTo @gameUIState, 'change:selected', @onChangeSelected\r\n\r\n  destroy: ->\r\n    @removeLank lank for thangID, lank of @lanks\r\n    @targetMark?.destroy()\r\n    @selectionMark?.destroy()\r\n    lankLayer.destroy() for lankLayer in _.values @layerAdapters\r\n    super()\r\n\r\n  toString: -> \"<LankBoss: #{@lankArray.length} lanks>\"\r\n\r\n  thangTypeFor: (type) ->\r\n    _.find @options.thangTypes, (m) -> m.get('original') is type or m.get('name') is type\r\n\r\n  createLayers: ->\r\n    @layerAdapters = {}\r\n    for [name, priority] in [\r\n      ['Land', -40]\r\n      ['Ground', -30]\r\n      ['Obstacle', -20]\r\n      ['Path', -10]\r\n      ['Default', 0]\r\n      ['Floating', 10]\r\n    ]\r\n      @layerAdapters[name] = new LayerAdapter name: name, webGL: true, layerPriority: priority, transform: LayerAdapter.TRANSFORM_SURFACE, camera: @camera\r\n    @webGLStage.addChild (lankLayer.container for lankLayer in _.values(@layerAdapters))...\r\n\r\n  layerForChild: (child, lank) ->\r\n    unless child.layerPriority?\r\n      if thang = lank?.thang\r\n        child.layerPriority = thang.layerPriority\r\n        child.layerPriority ?= 0 if thang.isSelectable\r\n        child.layerPriority ?= -40 if thang.isLand\r\n    child.layerPriority ?= 0\r\n    return @layerAdapters['Default'] unless child.layerPriority\r\n    layer = _.findLast @layerAdapters, (layer, name) ->\r\n      layer.layerPriority <= child.layerPriority\r\n    layer ?= @layerAdapters['Land'] if child.layerPriority < -40\r\n    layer ? @layerAdapters['Default']\r\n\r\n  addLank: (lank, id=null, layer=null) ->\r\n    id ?= lank.thang.id\r\n    console.error 'Lank collision! Already have:', id if @lanks[id]\r\n    @lanks[id] = lank\r\n    @lankArray.push lank\r\n    layer ?= @layerAdapters['Obstacle'] if lank.thang?.spriteName.search(/(dungeon|indoor|ice|classroom|vr).wall/i) isnt -1\r\n    layer ?= @layerForChild lank.sprite, lank\r\n    layer.addLank lank\r\n    layer.updateLayerOrder()\r\n    lank\r\n\r\n  createMarks: ->\r\n    @targetMark = new Mark name: 'target', camera: @camera, layer: @layerAdapters['Ground'], thangType: 'target'\r\n    @selectionMark = new Mark name: 'selection', camera: @camera, layer: @layerAdapters['Ground'], thangType: 'selection'\r\n\r\n  createLankOptions: (options) ->\r\n    _.extend options, {\r\n      @camera\r\n      resolutionFactor: SPRITE_RESOLUTION_FACTOR\r\n      groundLayer: @layerAdapters['Ground']\r\n      textLayer: @surfaceTextLayer\r\n      floatingLayer: @layerAdapters['Floating']\r\n      showInvisible: @options.showInvisible\r\n      @gameUIState\r\n      @handleEvents\r\n    }\r\n\r\n  onSetDebug: (e) ->\r\n    return if e.debug is @debug\r\n    @debug = e.debug\r\n    lank.setDebug @debug for lank in @lankArray\r\n\r\n  onHighlightSprites: (e) ->\r\n    highlightedIDs = e.thangIDs or []\r\n    for thangID, lank of @lanks\r\n      lank.setHighlight? thangID in highlightedIDs, e.delay\r\n\r\n  addThangToLanks: (thang, layer=null) ->\r\n    return console.warn 'Tried to add Thang to the surface it already has:', thang.id if @lanks[thang.id]\r\n    thangType = _.find @options.thangTypes, (m) ->\r\n      return false unless m.get('actions') or m.get('raster')\r\n      return m.get('name') is thang.spriteName\r\n    thangType ?= _.find @options.thangTypes, (m) -> return m.get('name') is thang.spriteName\r\n    return console.error \"Couldn't find ThangType for\", thang unless thangType\r\n\r\n    options = @createLankOptions thang: thang\r\n    options.resolutionFactor = if thangType.get('kind') is 'Floor' then 2 else SPRITE_RESOLUTION_FACTOR\r\n    if @options.playerNames and /Hero Placeholder/.test thang.id\r\n      options.playerName = @options.playerNames[thang.team]\r\n    lank = new Lank thangType, options\r\n    @listenTo lank, 'sprite:mouse-up', @onLankMouseUp\r\n    @addLank lank, null, layer\r\n    lank.setDebug @debug\r\n    lank\r\n\r\n  removeLank: (lank) ->\r\n    lank.layer.removeLank(lank)\r\n    thang = lank.thang\r\n    delete @lanks[lank.thang.id]\r\n    @lankArray.splice @lankArray.indexOf(lank), 1\r\n    @stopListening lank\r\n    lank.destroy()\r\n    lank.thang = thang  # Keep around so that we know which thang the destroyed thang was for\r\n\r\n  updateSounds: ->\r\n    lank.playSounds() for lank in @lankArray  # hmm; doesn't work for lanks which we didn't add yet in adjustLankExistence\r\n\r\n  update: (frameChanged) ->\r\n    @adjustLankExistence() if frameChanged\r\n    lank.update frameChanged for lank in @lankArray\r\n    @updateSelection()\r\n    @layerAdapters['Default'].updateLayerOrder()\r\n    @cacheObstacles()\r\n\r\n  adjustLankExistence: ->\r\n    # Add anything new, remove anything old, update everything current\r\n    updatedObstacles = []\r\n    itemsJustEquipped = []\r\n    for thang in @world.thangs when thang.exists and thang.pos\r\n      itemsJustEquipped = itemsJustEquipped.concat @equipNewItems thang if thang.equip\r\n      if lank = @lanks[thang.id]\r\n        lank.setThang thang  # make sure Lank has latest Thang\r\n      else\r\n        lank = @addThangToLanks(thang)\r\n        Backbone.Mediator.publish 'surface:new-thang-added', thang: thang, sprite: lank\r\n        updatedObstacles.push lank if lank.sprite.parent is @layerAdapters['Obstacle']\r\n        lank.playSounds()\r\n    item.modifyStats() for item in itemsJustEquipped\r\n    for thangID, lank of @lanks\r\n      missing = not (lank.notOfThisWorld or @world.thangMap[thangID]?.exists)\r\n      isObstacle = lank.sprite.parent is @layerAdapters['Obstacle']\r\n      updatedObstacles.push lank if isObstacle and (missing or lank.hasMoved)\r\n      lank.hasMoved = false\r\n      @removeLank lank if missing\r\n    @cacheObstacles updatedObstacles if updatedObstacles.length and @cachedObstacles\r\n\r\n    # mainly for handling selecting thangs from session when the thang is not always in existence\r\n    if @willSelectThang and @lanks[@willSelectThang[0]]\r\n      @selectThang @willSelectThang...\r\n\r\n    @updateScreenReader()\r\n\r\n  updateScreenReader: ->\r\n    # Testing ASCII map for screen readers\r\n    return unless me.get('name') is 'zersiax'  #in ['zersiax', 'Nick']\r\n    ascii = $('#ascii-surface')\r\n    thangs = (lank.thang for lank in @lankArray)\r\n    grid = new Grid thangs, @world.width, @world.height, 0, 0, 0, true\r\n    utils.replaceText ascii, grid.toString true\r\n    ascii.css 'transform', 'initial'\r\n    fullWidth = ascii.innerWidth()\r\n    fullHeight = ascii.innerHeight()\r\n    availableWidth = ascii.parent().innerWidth()\r\n    availableHeight = ascii.parent().innerHeight()\r\n    scale = availableWidth / fullWidth\r\n    scale = Math.min scale, availableHeight / fullHeight\r\n    ascii.css 'transform', \"scale(#{scale})\"\r\n\r\n  equipNewItems: (thang) ->\r\n    itemsJustEquipped = []\r\n    if thang.equip and not thang.equipped\r\n      thang.equip()  # Pretty hacky, but needed since initialize may not be called if we're not running Systems.\r\n      itemsJustEquipped.push thang\r\n    if thang.inventoryIDs\r\n      # Even hackier: these items were only created/equipped during simulation, so we reequip here.\r\n      for slot, itemID of thang.inventoryIDs\r\n        item = @world.getThangByID itemID\r\n        unless item.equipped\r\n          console.log thang.id, 'equipping', item, 'in', thang.slot, 'Surface-side, but it cannot equip?' unless item.equip\r\n          item.equip?()\r\n          itemsJustEquipped.push item if item.equip\r\n    return itemsJustEquipped\r\n\r\n  cacheObstacles: (updatedObstacles=null) ->\r\n    return if @cachedObstacles and not updatedObstacles\r\n    lankArray = @lankArray\r\n    wallLanks = (lank for lank in lankArray when lank.thangType?.get('name').search(/(dungeon|indoor|ice|classroom|vr).wall/i) isnt -1)\r\n    return if _.any (s.stillLoading for s in wallLanks)\r\n    walls = (lank.thang for lank in wallLanks)\r\n    @world.calculateBounds()\r\n    wallGrid = new Grid walls, @world.width, @world.height\r\n    if updatedObstacles\r\n      possiblyUpdatedWallLanks = (lank for lank in wallLanks when _.find updatedObstacles, (w2) -> lank is w2 or (Math.abs(lank.thang.pos.x - w2.thang.pos.x) + Math.abs(lank.thang.pos.y - w2.thang.pos.y)) <= 16)\r\n    else\r\n      possiblyUpdatedWallLanks = wallLanks\r\n#    console.log 'updating up to', possiblyUpdatedWallLanks.length, 'of', wallLanks.length, 'wall lanks from updatedObstacles', updatedObstacles\r\n    for wallLank in possiblyUpdatedWallLanks\r\n      wallLank.queueAction 'idle' if not wallLank.currentRootAction\r\n      wallLank.lockAction(false)\r\n      wallLank.updateActionDirection wallGrid\r\n      wallLank.lockAction(true)\r\n      wallLank.updateScale()\r\n      wallLank.updatePosition()\r\n#    console.log wallGrid.toString()\r\n    @cachedObstacles = true\r\n\r\n  lankFor: (thangID) -> @lanks[thangID]\r\n\r\n  onNewWorld: (e) ->\r\n    @world = @options.world = e.world\r\n    # Clear obstacle cache for this level, since we are spawning walls dynamically\r\n    @cachedObstacles = false if e.finished and /kithgard-mastery/.test window.location.href\r\n\r\n  play: ->\r\n    lank.play() for lank in @lankArray\r\n    @selectionMark?.play()\r\n    @targetMark?.play()\r\n\r\n  stop: ->\r\n    lank.stop() for lank in @lankArray\r\n    @selectionMark?.stop()\r\n    @targetMark?.stop()\r\n\r\n  # Selection\r\n\r\n  onSuppressSelectionSounds: (e) -> @suppressSelectionSounds = e.suppress\r\n  onSetLockSelect: (e) -> @selectLocked = e.lock\r\n  onLevelRestarted: (e) ->\r\n    @selectLocked = false\r\n    @selectLank e, null\r\n\r\n  onSelectSprite: (e) ->\r\n    @selectThang e.thangID, e.spellName\r\n\r\n  onCameraDragged: ->\r\n    @dragged += 1\r\n\r\n  onLankMouseUp: (e) ->\r\n    return unless @handleEvents\r\n    return if key.shift #and @options.choosing\r\n    return @dragged = 0 if @dragged > 3\r\n    @dragged = 0\r\n    lank = if e.sprite?.thang?.isSelectable then e.sprite else null\r\n    return if @flagCursorLank and lank?.thangType.get('name') is 'Flag'\r\n    @selectLank e, lank\r\n\r\n  onStageMouseDown: (e) ->\r\n    return unless @handleEvents\r\n    return if key.shift #and @options.choosing\r\n    @selectLank e if e.onBackground\r\n\r\n  onChangeSelected: (gameUIState, selected) ->\r\n    oldLanks = (s.sprite for s in gameUIState.previousAttributes().selected or [])\r\n    newLanks = (s.sprite for s in selected or [])\r\n    addedLanks = _.difference(newLanks, oldLanks)\r\n    removedLanks = _.difference(oldLanks, newLanks)\r\n\r\n    for lank in addedLanks\r\n      layer = if lank.sprite.parent isnt @layerAdapters.Default.container then @layerAdapters.Default else @layerAdapters.Ground\r\n      mark = new Mark name: 'selection', camera: @camera, layer: layer, thangType: 'selection'\r\n      mark.toggle true\r\n      mark.setLank(lank)\r\n      mark.update()\r\n      lank.marks.selection = mark # TODO: Figure out how to non-hackily assign lank this mark\r\n      \r\n    for lank in removedLanks\r\n      lank.removeMark?('selection')\r\n\r\n  selectThang: (thangID, spellName=null, treemaThangSelected = null) ->\r\n    return @willSelectThang = [thangID, spellName] unless @lanks[thangID]\r\n    @selectLank null, @lanks[thangID], spellName, treemaThangSelected\r\n\r\n  selectLank: (e, lank=null, spellName=null, treemaThangSelected = null) ->\r\n    return if e and (@disabled or @selectLocked)  # Ignore clicks for selection/panning/wizard movement while disabled or select is locked\r\n    worldPos = lank?.thang?.pos\r\n    worldPos ?= @camera.screenToWorld {x: e.originalEvent.rawX, y: e.originalEvent.rawY} if e?.originalEvent\r\n    if @handleEvents\r\n      if (not @reallyStopMoving) and worldPos and (@options.navigateToSelection or not lank or treemaThangSelected) and e?.originalEvent?.nativeEvent?.which isnt 3\r\n        @camera.zoomTo(lank?.sprite or @camera.worldToSurface(worldPos), @camera.zoom, 1000, true)\r\n    lank = null if @options.choosing  # Don't select lanks while choosing\r\n    if lank isnt @selectedLank\r\n      @selectedLank?.selected = false\r\n      lank?.selected = true\r\n      @selectedLank = lank\r\n    alive = lank and not (lank.thang.health < 0)\r\n\r\n    Backbone.Mediator.publish 'surface:sprite-selected',\r\n      thang: if lank then lank.thang else null\r\n      sprite: lank\r\n      spellName: spellName ? e?.spellName\r\n      originalEvent: e\r\n      worldPos: worldPos\r\n\r\n    @willSelectThang = null if lank  # Now that we've done a real selection, don't reselect some other Thang later.\r\n\r\n    if alive and not @suppressSelectionSounds\r\n      instance = lank.playSound 'selected'\r\n      if instance?.playState is 'playSucceeded'\r\n        Backbone.Mediator.publish 'sprite:thang-began-talking', thang: lank?.thang\r\n        instance.addEventListener 'complete', ->\r\n          Backbone.Mediator.publish 'sprite:thang-finished-talking', thang: lank?.thang\r\n\r\n  onFlagColorSelected: (e) ->\r\n    @removeLank @flagCursorLank if @flagCursorLank\r\n    @flagCursorLank = null\r\n    for flagLank in @lankArray when flagLank.thangType.get('name') is 'Flag'\r\n      flagLank.sprite.cursor = if e.color then 'crosshair' else 'pointer'\r\n    return unless e.color\r\n    @flagCursorLank = new FlagLank @thangTypeFor('Flag'), @createLankOptions(thangID: 'Flag Cursor', color: e.color, team: me.team, isCursor: true, pos: e.pos)\r\n    @addLank @flagCursorLank, @flagCursorLank.thang.id, @layerAdapters['Floating']\r\n\r\n  onFlagUpdated: (e) ->\r\n    return unless e.active\r\n    pendingFlag = new FlagLank @thangTypeFor('Flag'), @createLankOptions(thangID: 'Pending Flag ' + Math.random(), color: e.color, team: e.team, isCursor: false, pos: e.pos)\r\n    @addLank pendingFlag, pendingFlag.thang.id, @layerAdapters['Floating']\r\n    @pendingFlags.push pendingFlag\r\n\r\n  onFlagAppeared: (e) ->\r\n    # Remove the pending flag that matches this one's color/team/position, and any color/team matches placed earlier.\r\n    t1 = e.sprite.thang\r\n    pending = (@pendingFlags ? []).slice()\r\n    foundExactMatch = false\r\n    for i in [pending.length - 1 .. 0] by -1\r\n      pendingFlag = pending[i]\r\n      t2 = pendingFlag.thang\r\n      matchedType = t1.color is t2.color and t1.team is t2.team\r\n      matched = matchedType and (foundExactMatch or Math.abs(t1.pos.x - t2.pos.x) < 0.00001 and Math.abs(t1.pos.y - t2.pos.y) < 0.00001)\r\n      if matched\r\n        foundExactMatch = true\r\n        @pendingFlags.splice(i, 1)\r\n        @removeLank pendingFlag\r\n    e.sprite.sprite?.cursor = if @flagCursorLank then 'crosshair' else 'pointer'\r\n    null\r\n\r\n  onRemoveSelectedFlag: (e) ->\r\n    # Remove the selected lank if it's a flag, or any flag of the given color if a color is given.\r\n    flagLank = _.find [@selectedLank].concat(@lankArray), (lank) ->\r\n      lank and lank.thangType.get('name') is 'Flag' and lank.thang.team is me.team and (lank.thang.color is e.color or not e.color) and not lank.notOfThisWorld\r\n    return unless flagLank\r\n    Backbone.Mediator.publish 'surface:remove-flag', color: flagLank.thang.color\r\n\r\n  # Marks\r\n\r\n  updateSelection: ->\r\n    if @selectedLank?.thang and (not @selectedLank.thang.exists or not @world.getThangByID @selectedLank.thang.id)\r\n      thangID = @selectedLank.thang.id\r\n      @selectedLank = null  # Don't actually trigger deselection, but remove the selected lank.\r\n      @selectionMark?.toggle false\r\n      @willSelectThang = [thangID, null]\r\n    @updateTarget()\r\n    return unless @selectionMark\r\n    @selectedLank = null if @selectedLank and (@selectedLank.destroyed or not @selectedLank.thang)\r\n    # The selection mark should be on the ground layer, unless we're not a normal lank (like a wall), in which case we'll place it higher so we can see it.\r\n    if @selectedLank and @selectedLank.sprite.parent isnt @layerAdapters.Default.container\r\n      @selectionMark.setLayer @layerAdapters.Default\r\n    else if @selectedLank\r\n      @selectionMark.setLayer @layerAdapters.Ground\r\n    @selectionMark.toggle @selectedLank?\r\n    @selectionMark.setLank @selectedLank\r\n    @selectionMark.update()\r\n\r\n  updateTarget: ->\r\n    return unless @targetMark\r\n    thang = @selectedLank?.thang\r\n    target = thang?.target\r\n    targetPos = thang?.targetPos\r\n    targetPos = null if targetPos?.isZero?()  # Null targetPos get serialized as (0, 0, 0)\r\n    @targetMark.setLank if target then @lanks[target.id] else null\r\n    @targetMark.toggle @targetMark.lank or targetPos\r\n    @targetMark.update if targetPos then @camera.worldToSurface targetPos else null\r\n","###\r\n  * SpriteStage (WebGL Canvas)\r\n  ** Land texture\r\n  ** Ground-based selection/target marks, range radii\r\n  ** Walls/obstacles\r\n  ** Paths and target pieces (and ghosts?)\r\n  ** Normal Thangs, bots, wizards (z-indexing based on World-determined sprite.thang.pos.z/y, mainly, instead of sprite-map-determined sprite.z, which we rename to... something)\r\n  ** Above-thang marks (blood, highlight) and health bars\r\n\r\n  * Stage (Regular Canvas)\r\n  ** Camera border\r\n  ** surfaceTextLayer (speech, names)\r\n  ** screenLayer\r\n  *** Letterbox\r\n  **** Letterbox top and bottom\r\n  *** FPS display, maybe grid axis labels, coordinate hover\r\n\r\n  ** Grid lines--somewhere--we will figure it out, do not really need it at first\r\n###\r\n\r\nSpriteBuilder = require 'lib/sprites/SpriteBuilder'\r\nCocoClass = require 'core/CocoClass'\r\nSegmentedSprite = require './SegmentedSprite'\r\nSingularSprite = require './SingularSprite'\r\nThangType = require 'models/ThangType'\r\n\r\nNEVER_RENDER_ANYTHING = false # set to true to test placeholders\r\n\r\nmodule.exports = LayerAdapter = class LayerAdapter extends CocoClass\r\n\r\n  # Intermediary between a Surface Stage and a top-level static normal Container or hot-swapped WebGL SpriteContainer.\r\n  # It handles zooming in different ways and, if webGL, creating and assigning spriteSheets.\r\n\r\n  @TRANSFORM_SURFACE: 'surface'  # Layer moves/scales/zooms with the Surface of the World\r\n  @TRANSFORM_SURFACE_TEXT: 'surface_text'  # Layer moves with the Surface but is size-independent\r\n  @TRANSFORM_SCREEN: 'screen'  # Layer stays fixed to the screen\r\n\r\n  # WebGL properties\r\n  actionRenderState: null\r\n  needToRerender: false\r\n  toRenderBundles: null\r\n  willRender: false\r\n  buildAutomatically: true\r\n  buildAsync: true\r\n  resolutionFactor: SPRITE_RESOLUTION_FACTOR\r\n  numThingsLoading: 0\r\n  lanks: null\r\n  spriteSheet: null\r\n  container: null\r\n  customGraphics: null\r\n\r\n  subscriptions:\r\n    'camera:zoom-updated': 'onZoomUpdated'\r\n\r\n  constructor: (options) ->\r\n    super()\r\n    options ?= {}\r\n    @name = options.name ? 'Unnamed'\r\n    @defaultSpriteType = if @name is 'Default' then 'segmented' else 'singular'\r\n    @customGraphics = {}\r\n    @layerPriority = options.layerPriority ? 0\r\n    @transformStyle = options.transform ? LayerAdapter.TRANSFORM_SURFACE\r\n    @camera = options.camera\r\n    @updateLayerOrder = _.throttle @updateLayerOrder, 1000 / 30  # Don't call multiple times in one frame; 30 FPS is probably good enough\r\n\r\n    @webGL = !!options.webGL\r\n    if @webGL\r\n      @initializing = true\r\n      @spriteSheet = @_renderNewSpriteSheet(false) # builds an empty spritesheet\r\n      @container = new createjs.SpriteContainer(@spriteSheet)\r\n      @actionRenderState = {}\r\n      @toRenderBundles = []\r\n      @lanks = []\r\n      @initializing = false\r\n\r\n    else\r\n      @container = new createjs.Container()\r\n\r\n  toString: -> \"<Layer #{@layerPriority}: #{@name}>\"\r\n\r\n  #- Layer ordering\r\n\r\n  updateLayerOrder: ->\r\n    return if @destroyed\r\n    @container.sortChildren @layerOrderComparator\r\n\r\n  layerOrderComparator: (a, b) ->\r\n    # Optimize\r\n    alp = a.layerPriority or 0\r\n    blp = b.layerPriority or 0\r\n    return alp - blp if alp isnt blp\r\n    # TODO: remove this z stuff\r\n    az = a.z or 1000\r\n    bz = b.z or 1000\r\n    if aLank = a.lank\r\n      if aThang = aLank.thang\r\n        aPos = aThang.pos\r\n        if aThang.health < 0 and aThang.pos.z <= aThang.depth / 2\r\n          # Nice for not being knee deep in the dead, just not nice for ogres flying behind trees when exploded\r\n          --az\r\n    if bLank = b.lank\r\n      if bThang = bLank.thang\r\n        bPos = bThang.pos\r\n        if bThang.health < 0 and bThang.pos.z <= bThang.depth / 2\r\n          --bz\r\n    if az is bz\r\n      return 0 unless aPos and bPos\r\n      return (bPos.y - aPos.y) or (bPos.x - aPos.x)\r\n    return az - bz\r\n\r\n  #- Zoom updating\r\n\r\n  onZoomUpdated: (e) ->\r\n    return unless e.camera is @camera\r\n    if @transformStyle in [LayerAdapter.TRANSFORM_SURFACE, LayerAdapter.TRANSFORM_SURFACE_TEXT]\r\n      change = @container.scaleX / e.zoom\r\n      @container.scaleX = @container.scaleY = e.zoom\r\n      if @webGL\r\n        @container.scaleX *= @camera.canvasScaleFactorX\r\n        @container.scaleY *= @camera.canvasScaleFactorY\r\n      @container.regX = e.surfaceViewport.x\r\n      @container.regY = e.surfaceViewport.y\r\n      if @transformStyle is LayerAdapter.TRANSFORM_SURFACE_TEXT\r\n        for child in @container.children\r\n          continue if child.skipScaling\r\n          child.scaleX *= change\r\n          child.scaleY *= change\r\n\r\n  #- Container-like child functions\r\n\r\n  addChild: (children...) ->\r\n    @container.addChild children...\r\n    if @transformStyle is LayerAdapter.TRANSFORM_SURFACE_TEXT\r\n      for child in children\r\n        continue if child.skipScaling\r\n        child.scaleX /= @container.scaleX\r\n        child.scaleY /= @container.scaleY\r\n\r\n  removeChild: (children...) ->\r\n    @container.removeChild children...\r\n    # TODO: Do we actually need to scale children that were removed?\r\n    if @transformStyle is LayerAdapter.TRANSFORM_SURFACE_TEXT\r\n      for child in children\r\n        child.scaleX *= @container.scaleX\r\n        child.scaleY *= @container.scaleY\r\n\r\n  #- Adding, removing children for WebGL layers.\r\n\r\n  addLank: (lank) ->\r\n    lank.options.resolutionFactor = @resolutionFactor\r\n    lank.layer = @\r\n    @listenTo(lank, 'action-needs-render', @onActionNeedsRender)\r\n    @lanks.push lank\r\n    lank.thangType.initPrerenderedSpriteSheets() unless currentView.getQueryVariable 'jitSpritesheets'\r\n    prerenderedSpriteSheet = lank.thangType.getPrerenderedSpriteSheet(lank.options.colorConfig, @defaultSpriteType)\r\n    prerenderedSpriteSheet?.markToLoad()\r\n    @loadThangType(lank.thangType)\r\n    @addDefaultActionsToRender(lank)\r\n    @setSpriteToLank(lank)\r\n    @updateLayerOrder()\r\n    lank.addHealthBar()\r\n\r\n  removeLank: (lank) ->\r\n    @stopListening(lank)\r\n    lank.layer = null\r\n    @container.removeChild lank.sprite\r\n    @lanks = _.without @lanks, lank\r\n\r\n  #- Loading network resources dynamically\r\n\r\n  loadThangType: (thangType) ->\r\n    if not thangType.isFullyLoaded()\r\n      thangType.setProjection null\r\n      thangType.fetch() unless thangType.loading\r\n      @numThingsLoading++\r\n      @listenToOnce(thangType, 'sync', @somethingLoaded)\r\n    else if thangType.get('raster') and not thangType.loadedRaster\r\n      thangType.loadRasterImage()\r\n      @listenToOnce(thangType, 'raster-image-loaded', @somethingLoaded)\r\n      @numThingsLoading++\r\n    else if prerenderedSpriteSheet = thangType.getPrerenderedSpriteSheetToLoad()\r\n      startedLoading = prerenderedSpriteSheet.loadImage()\r\n      return if not startedLoading\r\n      @listenToOnce(prerenderedSpriteSheet, 'image-loaded', -> @somethingLoaded(thangType))\r\n      @numThingsLoading++\r\n\r\n  somethingLoaded: (thangType) ->\r\n    @numThingsLoading--\r\n    @loadThangType(thangType) # might need to load the raster image object\r\n    for lank in @lanks\r\n      if lank.thangType is thangType\r\n        @addDefaultActionsToRender(lank)\r\n    @renderNewSpriteSheet()\r\n\r\n  #- Adding to the list of things we need to render\r\n\r\n  onActionNeedsRender: (lank, action) ->\r\n    @upsertActionToRender(lank.thangType, action.name, lank.options.colorConfig)\r\n\r\n  addDefaultActionsToRender: (lank) ->\r\n    needToRender = false\r\n    if lank.thangType.get('raster')\r\n      @upsertActionToRender(lank.thangType)\r\n    else\r\n      for action in _.values(lank.thangType.getActions())\r\n        continue unless _.any ThangType.defaultActions, (prefix) -> _.string.startsWith(action.name, prefix)\r\n        @upsertActionToRender(lank.thangType, action.name, lank.options.colorConfig)\r\n\r\n  upsertActionToRender: (thangType, actionName, colorConfig) ->\r\n    groupKey = @renderGroupingKey(thangType, actionName, colorConfig)\r\n    return false if @actionRenderState[groupKey] isnt undefined\r\n    @actionRenderState[groupKey] = 'need-to-render'\r\n    @toRenderBundles.push({thangType: thangType, actionName: actionName, colorConfig: colorConfig})\r\n    return true if @willRender or not @buildAutomatically\r\n    @willRender = _.defer => @renderNewSpriteSheet()\r\n    return true\r\n\r\n  addCustomGraphic: (key, graphic, bounds) ->\r\n    return false if @customGraphics[key]\r\n    @customGraphics[key] = { graphic: graphic, bounds: new createjs.Rectangle(bounds...) }\r\n    return true if @willRender or not @buildAutomatically\r\n    @_renderNewSpriteSheet(false)\r\n\r\n  #- Rendering sprite sheets\r\n\r\n  renderNewSpriteSheet: ->\r\n    @willRender = false\r\n    return if @numThingsLoading\r\n    @_renderNewSpriteSheet()\r\n\r\n  _renderNewSpriteSheet: (async) ->\r\n    @asyncBuilder.stopAsync() if @asyncBuilder\r\n    @asyncBuilder = null\r\n\r\n    async ?= @buildAsync\r\n    builder = new createjs.SpriteSheetBuilder()\r\n    groups = _.groupBy(@toRenderBundles, ((bundle) -> @renderGroupingKey(bundle.thangType, '', bundle.colorConfig)), @)\r\n\r\n    # The first frame is always the 'loading', ie placeholder, image.\r\n    placeholder = @createPlaceholder()\r\n    dimension = @resolutionFactor * SPRITE_PLACEHOLDER_WIDTH\r\n    placeholder.setBounds(0, 0, dimension, dimension)\r\n    builder.addFrame(placeholder)\r\n\r\n    # Add custom graphics\r\n    extantGraphics = if @spriteSheet?.resolutionFactor is @resolutionFactor then @spriteSheet.getAnimations() else []\r\n    for key, graphic of @customGraphics\r\n      if key in extantGraphics\r\n        graphic = new createjs.Sprite(@spriteSheet)\r\n        graphic.gotoAndStop(key)\r\n        frame = builder.addFrame(graphic)\r\n      else\r\n        frame = builder.addFrame(graphic.graphic, graphic.bounds, @resolutionFactor)\r\n      builder.addAnimation(key, [frame], false)\r\n\r\n    # Render ThangTypes\r\n    groups = {} if NEVER_RENDER_ANYTHING\r\n    for bundleGrouping in _.values(groups)\r\n      thangType = bundleGrouping[0].thangType\r\n      colorConfig = bundleGrouping[0].colorConfig\r\n      actionNames = (bundle.actionName for bundle in bundleGrouping)\r\n      args = [thangType, colorConfig, actionNames, builder]\r\n      if thangType.get('raw') or thangType.get('prerenderedSpriteSheetData')\r\n        if (thangType.get('spriteType') or @defaultSpriteType) is 'segmented'\r\n          @renderSegmentedThangType(args...)\r\n        else\r\n          @renderSingularThangType(args...)\r\n      else\r\n        @renderRasterThangType(thangType, builder)\r\n\r\n    if async\r\n      try\r\n        builder.buildAsync()\r\n      catch e\r\n        @resolutionFactor *= 0.9\r\n        #console.log \"  Rerendering sprite sheet didn't fit, going down to resolutionFactor\", @resolutionFactor, \"async\", async\r\n        return @_renderNewSpriteSheet(async)\r\n      builder.on 'complete', @onBuildSpriteSheetComplete, @, true, builder\r\n      @asyncBuilder = builder\r\n    else\r\n      sheet = builder.build()\r\n      @onBuildSpriteSheetComplete({async:async}, builder)\r\n      return sheet\r\n\r\n  onBuildSpriteSheetComplete: (e, builder) ->\r\n    return if @initializing or @destroyed\r\n    @asyncBuilder = null\r\n\r\n    if builder.spriteSheet._images.length > 1\r\n      total = 0\r\n      # get a rough estimate of how much smaller the spritesheet needs to be\r\n      for image, index in builder.spriteSheet._images\r\n        total += image.height / builder.maxHeight\r\n      @resolutionFactor /= (Math.max(1.25, Math.sqrt(total)))\r\n      #console.log \"#{@name} rerendering new sprite sheet with resolutionFactor\", @resolutionFactor, \"async\", e.async\r\n      @_renderNewSpriteSheet(e.async)\r\n      return\r\n\r\n    @spriteSheet = builder.spriteSheet\r\n    @spriteSheet.resolutionFactor = @resolutionFactor\r\n    oldLayer = @container\r\n    @container = new createjs.SpriteContainer(@spriteSheet)\r\n    for lank in @lanks\r\n      console.log 'zombie sprite found on layer', @name if lank.destroyed\r\n      continue if lank.destroyed\r\n      @setSpriteToLank(lank)\r\n    for prop in ['scaleX', 'scaleY', 'regX', 'regY']\r\n      @container[prop] = oldLayer[prop]\r\n    if parent = oldLayer.parent\r\n      index = parent.getChildIndex(oldLayer)\r\n      parent.removeChildAt(index)\r\n      parent.addChildAt(@container, index)\r\n    @camera?.updateZoom(true)\r\n    @updateLayerOrder()\r\n    for lank in @lanks\r\n      lank.options.resolutionFactor = @resolutionFactor\r\n      lank.updateScale()\r\n      lank.updateRotation()\r\n    @trigger 'new-spritesheet'\r\n\r\n  resetSpriteSheet: ->\r\n    @removeLank(lank) for lank in @lanks.slice(0)\r\n    @toRenderBundles = []\r\n    @actionRenderState = {}\r\n    @initializing = true\r\n    @spriteSheet = @_renderNewSpriteSheet(false) # builds an empty spritesheet\r\n    @initializing = false\r\n\r\n  #- Placeholder\r\n\r\n  createPlaceholder: ->\r\n    # TODO: Experiment with this. Perhaps have rectangles if default layer is obstacle or floor,\r\n    # and different colors for different layers.\r\n    g = new createjs.Graphics()\r\n    g.setStrokeStyle(5)\r\n    color = {\r\n      'Land': [0, 50, 0]\r\n      'Ground': [230, 230, 230]\r\n      'Obstacle': [20, 70, 20]\r\n      'Path': [200, 100, 200]\r\n      'Default': [64, 64, 64]\r\n      'Floating': [100, 100, 200]\r\n    }[@name] or [0, 0, 0]\r\n    g.beginStroke(createjs.Graphics.getRGB(color...))\r\n    color.push 0.7\r\n    g.beginFill(createjs.Graphics.getRGB(color...))\r\n    width = @resolutionFactor * SPRITE_PLACEHOLDER_WIDTH\r\n    bounds = [0, 0, width, width]\r\n    if @name in ['Default', 'Ground', 'Floating', 'Path']\r\n      g.drawEllipse(bounds...)\r\n    else\r\n      g.drawRect(bounds...)\r\n    new createjs.Shape(g)\r\n\r\n  #- Rendering containers for segmented thang types\r\n\r\n  renderSegmentedThangType: (thangType, colorConfig, actionNames, spriteSheetBuilder) ->\r\n    prerenderedSpriteSheet = thangType.getPrerenderedSpriteSheet(colorConfig, 'segmented')\r\n    if prerenderedSpriteSheet and not prerenderedSpriteSheet.loadedImage\r\n      return\r\n    else if prerenderedSpriteSheet\r\n      animations = prerenderedSpriteSheet.spriteSheet._animations\r\n      renderedActions = _.zipObject(animations, _.times(animations.length, -> true))\r\n    containersToRender = thangType.getContainersForActions(actionNames)\r\n    #console.log 'render segmented', thangType.get('name'), actionNames, colorConfig, 'because we do not have prerendered sprite sheet?', prerenderedSpriteSheet\r\n    spriteBuilder = new SpriteBuilder(thangType, {colorConfig: colorConfig})\r\n    for containerGlobalName in containersToRender\r\n      containerKey = @renderGroupingKey(thangType, containerGlobalName, colorConfig)\r\n      if @spriteSheet?.resolutionFactor is @resolutionFactor and containerKey in @spriteSheet.getAnimations()\r\n        container = new createjs.Sprite(@spriteSheet)\r\n        container.gotoAndStop(containerKey)\r\n        frame = spriteSheetBuilder.addFrame(container)\r\n      else if prerenderedSpriteSheet and renderedActions[containerGlobalName]\r\n        container = new createjs.Sprite(prerenderedSpriteSheet.spriteSheet)\r\n        container.gotoAndStop(containerGlobalName)\r\n        scale = @resolutionFactor / (prerenderedSpriteSheet.get('resolutionFactor') or 1)\r\n        frame = spriteSheetBuilder.addFrame(container, null, scale)\r\n      else\r\n        container = spriteBuilder.buildContainerFromStore(containerGlobalName)\r\n        frame = spriteSheetBuilder.addFrame(container, null, @resolutionFactor * (thangType.get('scale') or 1))\r\n      spriteSheetBuilder.addAnimation(containerKey, [frame], false)\r\n\r\n  #- Rendering sprite sheets for singular thang types\r\n\r\n  renderSingularThangType: (thangType, colorConfig, actionNames, spriteSheetBuilder) ->\r\n    prerenderedSpriteSheet = thangType.getPrerenderedSpriteSheet(colorConfig, 'singular')\r\n    prerenderedFramesMap = {}\r\n    if prerenderedSpriteSheet\r\n      if not prerenderedSpriteSheet.loadedImage\r\n        return\r\n      scale = @resolutionFactor / (prerenderedSpriteSheet.get('resolutionFactor') or 1)\r\n      for frame, i in prerenderedSpriteSheet.spriteSheet._frames\r\n        sprite = new createjs.Sprite(prerenderedSpriteSheet.spriteSheet)\r\n        sprite.gotoAndStop(i)\r\n        prerenderedFramesMap[i] = spriteSheetBuilder.addFrame(sprite, null, scale)\r\n    #else\r\n    #  console.log '    Rerendering singular thang type', thangType.get('name'), thangType.get('spriteType'), colorConfig, actionNames\r\n\r\n    actionObjects = _.values(thangType.getActions())\r\n    animationActions = []\r\n    for a in actionObjects\r\n      continue unless a.animation\r\n      continue unless a.name in actionNames\r\n      animationActions.push(a)\r\n\r\n    spriteBuilder = new SpriteBuilder(thangType, {colorConfig: colorConfig})\r\n\r\n    animationGroups = _.groupBy animationActions, (action) -> action.animation\r\n    for animationName, actions of animationGroups\r\n      renderAll = _.any actions, (action) -> action.frames is undefined\r\n      scale = actions[0].scale or thangType.get('scale') or 1\r\n\r\n      actionKeys = (@renderGroupingKey(thangType, action.name, colorConfig) for action in actions)\r\n      if @spriteSheet?.resolutionFactor is @resolutionFactor and _.all(actionKeys, (key) => key in @spriteSheet.getAnimations())\r\n        framesNeeded = _.uniq(_.flatten((@spriteSheet.getAnimation(key)).frames for key in actionKeys))\r\n        framesMap = {}\r\n        for frame in framesNeeded\r\n          sprite = new createjs.Sprite(@spriteSheet)\r\n          sprite.gotoAndStop(frame)\r\n          framesMap[frame] = spriteSheetBuilder.addFrame(sprite)\r\n        for key, index in actionKeys\r\n          action = actions[index]\r\n          frames = (framesMap[f] for f in @spriteSheet.getAnimation(key).frames)\r\n          next = thangType.nextForAction(action)\r\n          spriteSheetBuilder.addAnimation(key, frames, next)\r\n        continue\r\n\r\n      if prerenderedSpriteSheet\r\n        for action in actions\r\n          name = @renderGroupingKey(thangType, action.name, colorConfig)\r\n          prerenderedFrames = prerenderedSpriteSheet.get('animations')?[action.name]?.frames\r\n          continue if not prerenderedFrames\r\n          frames = (prerenderedFramesMap[frame] for frame in prerenderedFrames)\r\n          next = thangType.nextForAction(action)\r\n          spriteSheetBuilder.addAnimation(name, frames, next)\r\n        continue\r\n\r\n      mc = spriteBuilder.buildMovieClip(animationName, null, null, null, {'temp':0})\r\n\r\n      if renderAll\r\n        res = spriteSheetBuilder.addMovieClip(mc, null, scale * @resolutionFactor)\r\n        frames = spriteSheetBuilder._animations['temp'].frames\r\n        framesMap = _.zipObject _.range(frames.length), frames\r\n      else\r\n        framesMap = {}\r\n        framesToRender = _.uniq(_.flatten((a.frames.split(',') for a in actions)))\r\n        for frame in framesToRender\r\n          frame = parseInt(frame)\r\n          f = _.bind(mc.gotoAndStop, mc, frame)\r\n          framesMap[frame] = spriteSheetBuilder.addFrame(mc, null, scale * @resolutionFactor, f)\r\n\r\n      for action in actions\r\n        name = @renderGroupingKey(thangType, action.name, colorConfig)\r\n\r\n        if action.frames\r\n          frames = (framesMap[parseInt(frame)] for frame in action.frames.split(','))\r\n        else\r\n          frames = _.sortBy(_.values(framesMap))\r\n        next = thangType.nextForAction(action)\r\n        spriteSheetBuilder.addAnimation(name, frames, next)\r\n\r\n    containerActions = []\r\n    for a in actionObjects\r\n      continue unless a.container\r\n      continue unless a.name in actionNames\r\n      containerActions.push(a)\r\n\r\n    containerGroups = _.groupBy containerActions, (action) -> action.container\r\n    for containerName, actions of containerGroups\r\n      if prerenderedSpriteSheet\r\n        for action in actions\r\n          name = @renderGroupingKey(thangType, action.name, colorConfig)\r\n          prerenderedFrames = prerenderedSpriteSheet.get('animations')?[action.name]?.frames\r\n          continue if not prerenderedFrames\r\n          frame = prerenderedFramesMap[prerenderedFrames[0]]\r\n          spriteSheetBuilder.addAnimation(name, [frame], false)\r\n        continue\r\n      container = spriteBuilder.buildContainerFromStore(containerName)\r\n      scale = actions[0].scale or thangType.get('scale') or 1\r\n      frame = spriteSheetBuilder.addFrame(container, null, scale * @resolutionFactor)\r\n      for action in actions\r\n        name = @renderGroupingKey(thangType, action.name, colorConfig)\r\n        spriteSheetBuilder.addAnimation(name, [frame], false)\r\n\r\n  #- Rendering frames for raster thang types\r\n\r\n  renderRasterThangType: (thangType, spriteSheetBuilder) ->\r\n    unless thangType.rasterImage\r\n      console.error(\"Cannot render the LayerAdapter SpriteSheet until the raster image for <#{thangType.get('name')}> is loaded.\")\r\n\r\n    # hack for IE9, otherwise width/height are not set\r\n    $img = $(thangType.rasterImage[0])\r\n    $('body').append($img)\r\n\r\n    bm = new createjs.Bitmap(thangType.rasterImage[0])\r\n    scale = thangType.get('scale') or 1\r\n    frame = spriteSheetBuilder.addFrame(bm, null, scale)\r\n    spriteSheetBuilder.addAnimation(@renderGroupingKey(thangType), [frame], false)\r\n    $img.remove()\r\n\r\n  #- Distributing new Segmented/Singular/RasterSprites to Lanks\r\n\r\n  setSpriteToLank: (lank) ->\r\n    if not lank.thangType.isFullyLoaded()\r\n      # just give a placeholder\r\n      sprite = new createjs.Sprite(@spriteSheet)\r\n      sprite.gotoAndStop(0)\r\n      sprite.placeholder = true\r\n      sprite.regX = @resolutionFactor * SPRITE_PLACEHOLDER_WIDTH / 2\r\n      sprite.regY = @resolutionFactor * SPRITE_PLACEHOLDER_WIDTH\r\n      sprite.baseScaleX = sprite.baseScaleY = sprite.scaleX = sprite.scaleY = 10 / (@resolutionFactor * SPRITE_PLACEHOLDER_WIDTH)\r\n\r\n    else if lank.thangType.get('raster')\r\n      sprite = new createjs.Sprite(@spriteSheet)\r\n      scale = lank.thangType.get('scale') or 1\r\n      reg = lank.getOffset 'registration'\r\n      sprite.regX = -reg.x * scale\r\n      sprite.regY = -reg.y * scale\r\n      sprite.gotoAndStop(@renderGroupingKey(lank.thangType))\r\n      sprite.baseScaleX = sprite.baseScaleY = 1\r\n\r\n    else\r\n      SpriteClass = if (lank.thangType.get('spriteType') or @defaultSpriteType) is 'segmented' then SegmentedSprite else SingularSprite\r\n      prefix = @renderGroupingKey(lank.thangType, null, lank.options.colorConfig) + '.'\r\n      sprite = new SpriteClass(@spriteSheet, lank.thangType, prefix, @resolutionFactor)\r\n\r\n    sprite.lank = lank\r\n    sprite.camera = @camera\r\n    sprite.layerPriority = lank.thang?.layerPriority ? lank.thangType.get 'layerPriority'\r\n    sprite.name = lank.thang?.spriteName or lank.thangType.get 'name'\r\n    lank.setSprite(sprite)\r\n    lank.update(true)\r\n    @container.addChild(sprite)\r\n    lank.updateScale true if lank.thangType.get 'matchWorldDimensions'  # Otherwise it's at the wrong scale for some reason.\r\n\r\n  renderGroupingKey: (thangType, grouping, colorConfig) ->\r\n    key = thangType.get('slug')\r\n    for colorKey, colorValue of colorConfig ? {}\r\n      key += \"(#{colorKey}:#{colorValue.hue},#{colorValue.saturation},#{colorValue.lightness})\"\r\n    key += '.'+grouping if grouping\r\n    key\r\n\r\n  destroy: ->\r\n    child.destroy?() for child in @container.children\r\n    @asyncBuilder.stopAsync() if @asyncBuilder\r\n    super()\r\n","module.exports = class Letterbox extends createjs.Container\r\n  subscriptions:\r\n    'level:set-letterbox': 'onSetLetterbox'\r\n\r\n  constructor: (options) ->\r\n    super()\r\n    @initialize()\r\n    @canvasWidth = options.canvasWidth\r\n    @canvasHeight = options.canvasHeight\r\n    console.error 'Letterbox needs canvasWidth/Height.' unless @canvasWidth and @canvasHeight\r\n    @build()\r\n    Backbone.Mediator.subscribe(channel, @[func], @) for channel, func of @subscriptions\r\n\r\n  build: ->\r\n    @mouseEnabled = @mouseChildren = false\r\n    @matteHeight = 0.10 * @canvasHeight\r\n    @upperMatte = new createjs.Shape()\r\n    @upperMatte.graphics.beginFill('black').rect(0, 0, @canvasWidth, @matteHeight)\r\n    @lowerMatte = @upperMatte.clone()\r\n    @upperMatte.x = @lowerMatte.x = 0\r\n    @upperMatte.y = -@matteHeight\r\n    @lowerMatte.y = @canvasHeight\r\n    @addChild @upperMatte, @lowerMatte\r\n\r\n  onSetLetterbox: (e) ->\r\n    T = createjs.Tween\r\n    T.removeTweens @upperMatte\r\n    T.removeTweens @lowerMatte\r\n    upperY = if e.on then 0 else -@matteHeight\r\n    lowerY = if e.on then @canvasHeight - @matteHeight else @canvasHeight\r\n    interval = 700\r\n    ease = createjs.Ease.cubicOut\r\n    T.get(@upperMatte).to({y: upperY}, interval, ease)\r\n    T.get(@lowerMatte).to({y: lowerY}, interval, ease)\r\n\r\n  destroy: ->\r\n    Backbone.Mediator.unsubscribe(channel, @[func], @) for channel, func of @subscriptions\r\n","CocoClass = require 'core/CocoClass'\r\nCamera = require './Camera'\r\nThangType = require 'models/ThangType'\r\nmarkThangTypes = {}\r\n\r\nmodule.exports = class Mark extends CocoClass\r\n  subscriptions: {}\r\n  alpha: 1\r\n\r\n  constructor: (options) ->\r\n    super()\r\n    options ?= {}\r\n    @name = options.name\r\n    @lank = options.lank\r\n    @camera = options.camera\r\n    @layer = options.layer\r\n    @thangType = options.thangType\r\n    @listenTo @layer, 'new-spritesheet', @onLayerMadeSpriteSheet\r\n    console.error @toString(), 'needs a name.' unless @name\r\n    console.error @toString(), 'needs a camera.' unless @camera\r\n    console.error @toString(), 'needs a layer.' unless @layer\r\n    @build()\r\n\r\n  destroy: ->\r\n    createjs.Tween.removeTweens @sprite if @sprite\r\n    @sprite?.parent?.removeChild @sprite\r\n    if @markLank\r\n      @layer.removeLank(@markLank)\r\n      @markLank.destroy()\r\n    @lank = null\r\n    super()\r\n\r\n  toString: -> \"<Mark #{@name}: Sprite #{@lank?.thang?.id ? 'None'}>\"\r\n\r\n  onLayerMadeSpriteSheet: ->\r\n    return unless @sprite\r\n    return @update() if @markLank\r\n    # rebuild sprite for new sprite sheet\r\n    @layer.removeChild @sprite\r\n    @sprite = null\r\n    @build()\r\n    @layer.addChild @sprite\r\n    @layer.updateLayerOrder()\r\n#    @updatePosition()\r\n    @update()\r\n\r\n  toggle: (to) ->\r\n    to = !!to\r\n    return @ if to is @on\r\n    return @toggleTo = to unless @sprite\r\n    @on = to\r\n    delete @toggleTo\r\n    if @on\r\n      if @markLank\r\n        @layer.addLank(@markLank)\r\n      else\r\n        @layer.addChild @sprite\r\n        @layer.updateLayerOrder()\r\n    else\r\n      if @markLank\r\n        @layer.removeLank(@markLank)\r\n      else\r\n        @layer.removeChild @sprite\r\n      if @highlightTween\r\n        @highlightDelay = @highlightTween = null\r\n        createjs.Tween.removeTweens @sprite\r\n        @sprite.visible = true\r\n    @\r\n\r\n  setLayer: (layer) ->\r\n    return if layer is @layer\r\n    wasOn = @on\r\n    @toggle false\r\n    @layer = layer\r\n    @toggle true if wasOn\r\n\r\n  setLank: (lank) ->\r\n    return if lank is @lank\r\n    @lank = lank\r\n    @build()\r\n    @\r\n\r\n  build: ->\r\n    unless @sprite\r\n      if @name is 'bounds' then @buildBounds()\r\n      else if @name is 'shadow' then @buildShadow()\r\n      else if @name is 'debug' then @buildDebug()\r\n      else if @name.match(/.+(Range|Distance|Radius)$/) then @buildRadius(@name)\r\n      else if @thangType then @buildSprite()\r\n      else console.error 'Don\\'t know how to build mark for', @name\r\n      @sprite?.mouseEnabled = false\r\n    @\r\n\r\n  buildBounds: ->\r\n    @sprite = new createjs.Container()\r\n    @sprite.mouseChildren = false\r\n    style = @lank.thang.drawsBoundsStyle\r\n    @drawsBoundsIndex = @lank.thang.drawsBoundsIndex\r\n    return if style is 'corner-text' and @lank.thang.world.age is 0\r\n\r\n    # Confusingly make some semi-random colors that'll be consistent based on the drawsBoundsIndex\r\n    colors = (128 + Math.floor(('0.'+Math.sin(3 * @drawsBoundsIndex + i).toString().substr(6)) * 128) for i in [1 ... 4])\r\n    color = \"rgba(#{colors[0]}, #{colors[1]}, #{colors[2]}, 0.5)\"\r\n    [w, h] = [@lank.thang.width * Camera.PPM, @lank.thang.height * Camera.PPM * @camera.y2x]\r\n\r\n    if style in ['border-text', 'corner-text']\r\n      @drawsBoundsBorderShape = shape = new createjs.Shape()\r\n      shape.graphics.setStrokeStyle 5\r\n      shape.graphics.beginStroke color\r\n      if style is 'border-text'\r\n        shape.graphics.beginFill color.replace('0.5', '0.25')\r\n      else\r\n        shape.graphics.beginFill color\r\n      if @lank.thang.shape in ['ellipsoid', 'disc']\r\n        shape.drawEllipse 0, 0, w, h\r\n      else\r\n        shape.graphics.drawRect -w / 2, -h / 2, w, h\r\n      shape.graphics.endStroke()\r\n      shape.graphics.endFill()\r\n      @sprite.addChild shape\r\n\r\n    if style is 'border-text'\r\n      text = new createjs.Text '' + @drawsBoundsIndex, '20px Arial', color.replace('0.5', '1')\r\n      text.regX = text.getMeasuredWidth() / 2\r\n      text.regY = text.getMeasuredHeight() / 2\r\n      text.shadow = new createjs.Shadow('#000000', 1, 1, 0)\r\n      @sprite.addChild text\r\n    else if style is 'corner-text'\r\n      return if @lank.thang.world.age is 0\r\n      letter = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[@drawsBoundsIndex % 26]\r\n      text = new createjs.Text letter, '14px Arial', '#333333'   # color.replace('0.5', '1')\r\n      text.x = -w / 2 + 2\r\n      text.y = -h / 2 + 2\r\n      @sprite.addChild text\r\n    else\r\n      console.warn @lank.thang.id, 'didn\\'t know how to draw bounds style:', style\r\n\r\n    if w > 0 and h > 0 and style is 'border-text'\r\n      @sprite.cache -w / 2, -h / 2, w, h, 2\r\n    @lastWidth = @lank.thang.width\r\n    @lastHeight = @lank.thang.height\r\n\r\n  buildShadow: ->\r\n    shapeName = if @lank.thang.shape in ['ellipsoid', 'disc'] then 'ellipse' else 'rect'\r\n    key = \"#{shapeName}-shadow\"\r\n    SHADOW_SIZE = 10\r\n    unless key in @layer.spriteSheet.getAnimations()\r\n      shape = new createjs.Shape()\r\n      shape.graphics.beginFill \"rgba(0,0,0)\"\r\n      bounds = [-SHADOW_SIZE/2, - SHADOW_SIZE/2, SHADOW_SIZE, SHADOW_SIZE]\r\n      if shapeName is 'ellipse'\r\n        shape.graphics.drawEllipse bounds...\r\n      else\r\n        shape.graphics.drawRect bounds...\r\n      shape.graphics.endFill()\r\n      @layer.addCustomGraphic(key, shape, bounds)\r\n    alpha = @lank.thang?.alpha ? 1\r\n    width = (@lank.thang?.width ? 0) + 0.5\r\n    height = (@lank.thang?.height ? 0) + 0.5\r\n    longest = Math.max width, height\r\n    actualLongest = @lank.thangType.get('shadow') ? longest\r\n    width = width * actualLongest / longest\r\n    height = height * actualLongest / longest\r\n    width *= Camera.PPM\r\n    height *= Camera.PPM * @camera.y2x  # TODO: doesn't work with rotation\r\n    @sprite = new createjs.Sprite(@layer.spriteSheet)\r\n    @sprite.gotoAndStop(key)\r\n    @sprite.mouseEnabled = false\r\n    @sprite.alpha = alpha\r\n    @baseScaleX = @sprite.scaleX = width / (@layer.resolutionFactor * SHADOW_SIZE)\r\n    @baseScaleY = @sprite.scaleY = height / (@layer.resolutionFactor * SHADOW_SIZE)\r\n\r\n  buildRadius: (range) ->\r\n    alpha = 0.15\r\n    colors =\r\n      voiceRange: \"rgba(0,145,0,#{alpha})\"\r\n      visualRange: \"rgba(0,0,145,#{alpha})\"\r\n      attackRange: \"rgba(145,0,0,#{alpha})\"\r\n\r\n    # Fallback colors which work on both dungeon and grass tiles\r\n    extraColors = [\r\n      \"rgba(145,0,145,#{alpha})\"\r\n      \"rgba(0,145,145,#{alpha})\"\r\n      \"rgba(145,105,0,#{alpha})\"\r\n      \"rgba(225,125,0,#{alpha})\"\r\n    ]\r\n\r\n    # Find the index of this range, to find the next-smallest radius\r\n    rangeNames = @lank.ranges.map((range, index) ->\r\n      range['name']\r\n    )\r\n    i = rangeNames.indexOf(range)\r\n\r\n    @sprite = new createjs.Shape()\r\n\r\n    fillColor = colors[range] ? extraColors[i]\r\n    @sprite.graphics.beginFill fillColor\r\n\r\n    # Draw the outer circle\r\n    @sprite.graphics.drawCircle 0, 0, @lank.thang[range] * Camera.PPM\r\n\r\n    # Cut out the hollow part if necessary\r\n    if i+1 < @lank.ranges.length\r\n      @sprite.graphics.arc 0, 0, @lank.ranges[i+1]['radius'], Math.PI*2, 0, true\r\n\r\n    @sprite.graphics.endFill()\r\n\r\n    strokeColor = fillColor.replace '' + alpha, '0.75'\r\n    @sprite.graphics.setStrokeStyle 2\r\n    @sprite.graphics.beginStroke strokeColor\r\n    @sprite.graphics.arc 0, 0, @lank.thang[range] * Camera.PPM, Math.PI*2, 0, true\r\n    @sprite.graphics.endStroke()\r\n\r\n    # Add perspective\r\n    @sprite.scaleY *= @camera.y2x\r\n\r\n  buildDebug: ->\r\n    shapeName = if @lank.thang.shape in ['ellipsoid', 'disc'] then 'ellipse' else 'rect'\r\n    key = \"#{shapeName}-debug-#{@lank.thang.collisionCategory}\"\r\n    DEBUG_SIZE = 10\r\n    unless key in @layer.spriteSheet.getAnimations()\r\n      shape = new createjs.Shape()\r\n      debugColor = {\r\n        none: 'rgba(224,255,239,0.25)'\r\n        ground: 'rgba(239,171,205,0.5)'\r\n        air: 'rgba(131,205,255,0.5)'\r\n        ground_and_air: 'rgba(2391,140,239,0.5)'\r\n        obstacles: 'rgba(88,88,88,0.5)'\r\n        dead: 'rgba(89,171,100,0.25)'\r\n      }[@lank.thang.collisionCategory] or 'rgba(171,205,239,0.5)'\r\n      shape.graphics.beginFill debugColor\r\n      bounds = [-DEBUG_SIZE / 2, -DEBUG_SIZE / 2, DEBUG_SIZE, DEBUG_SIZE]\r\n      if shapeName is 'ellipse'\r\n        shape.graphics.drawEllipse bounds...\r\n      else\r\n        shape.graphics.drawRect bounds...\r\n      shape.graphics.endFill()\r\n      @layer.addCustomGraphic(key, shape, bounds)\r\n\r\n    @sprite = new createjs.Sprite(@layer.spriteSheet)\r\n    @sprite.gotoAndStop(key)\r\n    PX = 3\r\n    w = Math.max(PX, @lank.thang.width  * Camera.PPM) * (@camera.y2x + (1 - @camera.y2x) * Math.abs Math.cos @lank.thang.rotation)\r\n    h = Math.max(PX, @lank.thang.height * Camera.PPM) * (@camera.y2x + (1 - @camera.y2x) * Math.abs Math.sin @lank.thang.rotation)\r\n    @sprite.scaleX = w / (@layer.resolutionFactor * DEBUG_SIZE)\r\n    @sprite.scaleY = h / (@layer.resolutionFactor * DEBUG_SIZE)\r\n    @sprite.rotation = -@lank.thang.rotation * 180 / Math.PI\r\n\r\n  buildSprite: ->\r\n    if _.isString @thangType\r\n      thangType = markThangTypes[@thangType]\r\n      return @loadThangType() if not thangType\r\n      @thangType = thangType\r\n\r\n    return @listenToOnce(@thangType, 'sync', @onLoadedThangType) if not @thangType.loaded\r\n    Lank = require './Lank'\r\n    # don't bother with making these render async for now, but maybe later for fun and more complexity of code\r\n    markLank = new Lank @thangType\r\n    markLank.queueAction 'idle'\r\n    @sprite = markLank.sprite\r\n    @markLank = markLank\r\n    @listenTo @markLank, 'new-sprite', (@sprite) ->\r\n\r\n  loadThangType: ->\r\n    name = @thangType\r\n    @thangType = new ThangType()\r\n    @thangType.url = -> \"/db/thang.type/#{name}\"\r\n    @listenToOnce(@thangType, 'sync', @onLoadedThangType)\r\n    @thangType.fetch()\r\n    markThangTypes[name] = @thangType\r\n\r\n  onLoadedThangType: ->\r\n    @build()\r\n    @update() if @markLank\r\n    @toggle(@toggleTo) if @toggleTo?\r\n    Backbone.Mediator.publish 'sprite:loaded', {sprite: @}\r\n\r\n  update: (pos=null) ->\r\n    return false unless @on and @sprite\r\n    return false if @lank? and not @lank.thangType.isFullyLoaded()\r\n    @sprite.visible = not @hidden\r\n    @updatePosition pos\r\n    @updateRotation()\r\n    @updateScale()\r\n    if @name is 'highlight' and @highlightDelay and not @highlightTween\r\n      @sprite.visible = false\r\n      @highlightTween = createjs.Tween.get(@sprite).to({}, @highlightDelay).call =>\r\n        return if @destroyed\r\n        @sprite.visible = true\r\n        @highlightDelay = @highlightTween = null\r\n    @updateAlpha @alpha if @name in ['shadow', 'bounds']\r\n    true\r\n\r\n  updatePosition: (pos) ->\r\n    if @lank?.thang and @name in ['shadow', 'debug', 'target', 'selection', 'repair']\r\n      pos = @camera.worldToSurface x: @lank.thang.pos.x, y: @lank.thang.pos.y\r\n    else\r\n      pos ?= @lank?.sprite\r\n    return unless pos\r\n    @sprite.x = pos.x\r\n    @sprite.y = pos.y\r\n    if @statusEffect or @name is 'highlight'\r\n      offset = @lank.getOffset 'aboveHead'\r\n      @sprite.x += offset.x\r\n      @sprite.y += offset.y\r\n      @sprite.y -= 3 if @statusEffect\r\n\r\n  updateAlpha: (@alpha) ->\r\n    return if not @sprite or @name is 'debug'\r\n    if @name is 'shadow'\r\n      worldZ = @lank.thang.pos.z - @lank.thang.depth / 2 + @lank.getBobOffset()\r\n      @sprite.alpha = @alpha * 0.451 / Math.sqrt(worldZ / 2 + 1)\r\n    else if @name is 'bounds'\r\n      @drawsBoundsBorderShape?.alpha = Math.floor @lank.thang.alpha  # Stop drawing bounds as soon as alpha is reduced at all\r\n    else\r\n      @sprite.alpha = @alpha\r\n\r\n  updateRotation: ->\r\n    if @name is 'debug' or (@name is 'shadow' and @lank.thang?.shape in ['rectangle', 'box'])\r\n      @sprite.rotation = -@lank.thang.rotation * 180 / Math.PI\r\n\r\n  updateScale: ->\r\n    if @name is 'bounds' and ((@lank.thang.width isnt @lastWidth or @lank.thang.height isnt @lastHeight) or (@lank.thang.drawsBoundsIndex isnt @drawsBoundsIndex))\r\n      oldMark = @sprite\r\n      @buildBounds()\r\n      oldMark.parent.addChild @sprite\r\n      oldMark.parent.swapChildren oldMark, @sprite\r\n      oldMark.parent.removeChild oldMark\r\n\r\n    if @markLank?\r\n      @markLank.scaleFactor = 1.2\r\n      @markLank.updateScale()\r\n\r\n    if @name is 'shadow' and thang = @lank.thang\r\n      @sprite.scaleX = @baseScaleX * (thang.scaleFactor ? thang.scaleFactorX ? 1)\r\n      @sprite.scaleY = @baseScaleY * (thang.scaleFactor ? thang.scaleFactorY ? 1)\r\n\r\n    return unless @name in ['selection', 'target', 'repair', 'highlight']\r\n\r\n    # scale these marks to 10m (100px). Adjust based on lank size.\r\n    factor = 0.3 # default size: 3m width, most commonly for target when pointing to a location\r\n\r\n    if @lank?.sprite\r\n      width = @lank.sprite.getBounds()?.width or 0\r\n      width /= @lank.options.resolutionFactor\r\n      # all targets should be set to have a width of 100px, and then be scaled accordingly\r\n      factor = width / 100 # normalize\r\n      factor *= 1.1 # add margin\r\n      factor = Math.max(factor, 0.3) # lower bound\r\n    @sprite.scaleX *= factor\r\n    @sprite.scaleY *= factor\r\n\r\n    if @name in ['selection', 'target', 'repair']\r\n      @sprite.scaleY *= @camera.y2x  # code applies perspective\r\n\r\n  stop: -> @markLank?.stop()\r\n  play: -> @markLank?.play()\r\n  hide: -> @hidden = true\r\n  show: -> @hidden = false\r\n","CocoClass = require 'core/CocoClass'\r\nAudioPlayer = require 'lib/AudioPlayer'\r\n{me} = require 'core/auth'\r\n\r\nCROSSFADE_LENGTH = 1500\r\nMUSIC_VOLUME = 0.6\r\n\r\nmodule.exports = class MusicPlayer extends CocoClass\r\n  currentMusic: null\r\n  standingBy: null\r\n\r\n  subscriptions:\r\n    'music-player:play-music': 'onPlayMusic'\r\n    'audio-player:loaded': 'onAudioLoaded'\r\n    'playback:real-time-playback-started': 'onRealTimePlaybackStarted'\r\n    'playback:real-time-playback-ended': 'onRealTimePlaybackEnded'\r\n    'music-player:enter-menu': 'onEnterMenu'\r\n    'music-player:exit-menu': 'onExitMenu'\r\n    'level:set-volume': 'onSetVolume'\r\n\r\n  constructor: ->\r\n    super arguments...\r\n    me.on 'change:music', @onMusicSettingChanged, @\r\n\r\n  onAudioLoaded: ->\r\n    @onPlayMusic(@standingBy) if @standingBy\r\n\r\n  onPlayMusic: (e) ->\r\n    return if application.isIPadApp  # Hard to measure, but just guessing this will save memory.\r\n    unless me.get 'volume'\r\n      @lastMusicEventIgnoredWhileMuted = e\r\n      return\r\n    src = e.file\r\n    src = \"/file#{src}#{AudioPlayer.ext}\"\r\n    if (not e.file) or src is @currentMusic?.src\r\n      if e.play then @restartCurrentMusic() else @fadeOutCurrentMusic()\r\n      return\r\n\r\n    media = AudioPlayer.getStatus(src)\r\n    if not media?.loaded\r\n      AudioPlayer.preloadSound(src)\r\n      @standingBy = e\r\n      return\r\n\r\n    delay = e.delay ? 0\r\n    @standingBy = null\r\n    @fadeOutCurrentMusic()\r\n    @startNewMusic(src, delay) if e.play\r\n\r\n  restartCurrentMusic: ->\r\n    return unless @currentMusic\r\n    @currentMusic.play('none', 0, 0, -1, 0.3)\r\n    @updateMusicVolume()\r\n\r\n  fadeOutCurrentMusic: ->\r\n    return unless @currentMusic\r\n    createjs.Tween.removeTweens(@currentMusic)\r\n    f = -> @stop()\r\n    createjs.Tween.get(@currentMusic).to({volume: 0.0}, CROSSFADE_LENGTH).call(f)\r\n\r\n  startNewMusic: (src, delay) ->\r\n    @currentMusic = createjs.Sound.play(src, 'none', 0, 0, -1, 0.3) if src\r\n    return unless @currentMusic\r\n    @currentMusic.volume = 0.0\r\n    if me.get('music', true)\r\n      createjs.Tween.get(@currentMusic).wait(delay).to({volume: MUSIC_VOLUME}, CROSSFADE_LENGTH)\r\n\r\n  onMusicSettingChanged: ->\r\n    @updateMusicVolume()\r\n\r\n  updateMusicVolume: ->\r\n    return unless @currentMusic\r\n    createjs.Tween.removeTweens(@currentMusic)\r\n    @currentMusic.volume = if me.get('music', true) then MUSIC_VOLUME else 0.0\r\n\r\n  onRealTimePlaybackStarted: (e) ->\r\n    @previousMusic = @currentMusic\r\n    trackNumber = _.random 0, 2\r\n    Backbone.Mediator.publish 'music-player:play-music', file: \"/music/music_real_time_#{trackNumber}\", play: true\r\n\r\n  onRealTimePlaybackEnded: (e) ->\r\n    @fadeOutCurrentMusic()\r\n    if @previousMusic\r\n      @currentMusic = @previousMusic\r\n      @restartCurrentMusic()\r\n      if @currentMusic.volume\r\n        createjs.Tween.get(@currentMusic).wait(5000).to({volume: MUSIC_VOLUME}, CROSSFADE_LENGTH)\r\n\r\n  onEnterMenu: (e) ->\r\n    return if @inMenu\r\n    @inMenu = true\r\n    @previousMusic = @currentMusic\r\n    file = \"/music/music-menu\"\r\n    Backbone.Mediator.publish 'music-player:play-music', file: file, play: true, delay: 1000\r\n\r\n  onExitMenu: (e) ->\r\n    return unless @inMenu\r\n    @inMenu = false\r\n    @fadeOutCurrentMusic()\r\n    if @previousMusic\r\n      @currentMusic = @previousMusic\r\n      @restartCurrentMusic()\r\n\r\n  onSetVolume: (e) ->\r\n    return unless e.volume and @lastMusicEventIgnoredWhileMuted\r\n    @onPlayMusic @lastMusicEventIgnoredWhileMuted\r\n    @lastMusicEventIgnoredWhileMuted = null\r\n\r\n  destroy: ->\r\n    me.off 'change:music', @onMusicSettingChanged, @\r\n    @fadeOutCurrentMusic()\r\n    super()\r\n","CocoClass = require 'core/CocoClass'\r\n\r\nmodule.exports = class PlaybackOverScreen extends CocoClass\r\n  subscriptions:\r\n    'goal-manager:new-goal-states': 'onNewGoalStates'\r\n\r\n  constructor: (options) ->\r\n    super()\r\n    options ?= {}\r\n    @camera = options.camera\r\n    @layer = options.layer\r\n    @playerNames = options.playerNames\r\n    console.error @toString(), 'needs a camera.' unless @camera\r\n    console.error @toString(), 'needs a layer.' unless @layer\r\n    @build()\r\n\r\n  toString: -> '<PlaybackOverScreen>'\r\n\r\n  build: ->\r\n    @dimLayer = new createjs.Container()\r\n    @dimLayer.mouseEnabled = @dimLayer.mouseChildren = false\r\n    @dimLayer.addChild @dimScreen = new createjs.Shape()\r\n    @dimLayer.alpha = 0\r\n    @layer.addChild @dimLayer\r\n\r\n  makeVictoryText: ->\r\n    s = ''\r\n    size = Math.ceil @camera.canvasHeight / 6\r\n    text = new createjs.Text s, \"#{size}px Open Sans Condensed\", '#F7B42C'\r\n    text.shadow = new createjs.Shadow '#000', Math.ceil(@camera.canvasHeight / 300), Math.ceil(@camera.canvasHeight / 300), Math.ceil(@camera.canvasHeight / 120)\r\n    text.textAlign = 'center'\r\n    text.textBaseline = 'middle'\r\n    text.x = 0.5 * @camera.canvasWidth\r\n    text.y = 0.8 * @camera.canvasHeight\r\n    @dimLayer.addChild text\r\n    @text = text\r\n\r\n  show: ->\r\n    return if @showing\r\n    @showing = true\r\n    @updateColor 'rgba(212, 212, 212, 0.4)' unless @color  # If we haven't caught the goal state for the first run, just do something neutral.\r\n    @dimLayer.alpha = 0\r\n    createjs.Tween.removeTweens @dimLayer\r\n    createjs.Tween.get(@dimLayer).to({alpha: 1}, 500)\r\n\r\n  hide: ->\r\n    return unless @showing\r\n    @showing = false\r\n    createjs.Tween.removeTweens @dimLayer\r\n    createjs.Tween.get(@dimLayer).to({alpha: 0}, 500)\r\n\r\n  onNewGoalStates: (e) ->\r\n    success = e.overallStatus is 'success'\r\n    failure = e.overallStatus is 'failure'\r\n    timedOut = e.timedOut\r\n    incomplete = not success and not failure and not timedOut\r\n    color = if failure then 'rgba(255, 128, 128, 0.4)' else 'rgba(255, 255, 255, 0.4)'\r\n    @updateColor color\r\n    @updateText e\r\n\r\n  updateColor: (color) ->\r\n    return if color is @color\r\n    @dimScreen.graphics.clear().beginFill(color).rect 0, 0, @camera.canvasWidth, @camera.canvasHeight\r\n    if @color\r\n      @dimLayer.updateCache()\r\n    else\r\n      @dimLayer.cache 0, 0, @camera.canvasWidth, @camera.canvasHeight\r\n    @color = color\r\n\r\n  updateText: (goalEvent) ->\r\n    return unless _.size @playerNames  # Only on multiplayer levels\r\n    teamOverallStatuses = {}\r\n\r\n    goals = if goalEvent.goalStates then _.values goalEvent.goalStates else []\r\n    goals = (g for g in goals when not g.optional)\r\n    for team in ['humans', 'ogres']\r\n      teamGoals = (g for g in goals when g.team in [undefined, team])\r\n      statuses = (goal.status for goal in teamGoals)\r\n      overallStatus = 'success' if statuses.length > 0 and _.every(statuses, (s) -> s is 'success')\r\n      overallStatus = 'failure' if statuses.length > 0 and 'failure' in statuses\r\n      teamOverallStatuses[team] = overallStatus\r\n\r\n    @makeVictoryText() unless @text\r\n    if teamOverallStatuses.humans is 'success'\r\n      @text.color = '#E62B1E'\r\n      @text.text = ((@playerNames.humans ? $.i18n.t('ladder.red_ai')) + ' ' + $.i18n.t('ladder.wins')).toLocaleUpperCase()\r\n    else if teamOverallStatuses.ogres is 'success'\r\n      @text.color = '#0597FF'\r\n      @text.text = ((@playerNames.ogres ? $.i18n.t('ladder.blue_ai')) + ' ' + $.i18n.t('ladder.wins')).toLocaleUpperCase()\r\n    else\r\n      @text.color = '#F7B42C'\r\n      if goalEvent.timedOut\r\n        @text.text = 'TIMED OUT'\r\n      else\r\n        @text.text = 'INCOMPLETE'\r\n    @dimLayer.updateCache()\r\n","CocoClass = require 'core/CocoClass'\r\n\r\nmodule.exports = class PointChooser extends CocoClass\r\n  constructor: (@options) ->\r\n    super()\r\n    @buildShape()\r\n    @options.stage.addEventListener 'stagemousedown', @onMouseDown\r\n    @options.camera.dragDisabled = true\r\n\r\n  destroy: ->\r\n    @options.stage.removeEventListener 'stagemousedown', @onMouseDown\r\n    super()\r\n\r\n  # Called also from WorldSelectModal\r\n  setPoint: (@point) ->\r\n    @updateShape()\r\n\r\n  buildShape: ->\r\n    @shape = new createjs.Shape()\r\n    @shape.alpha = 0.9\r\n    @shape.mouseEnabled = false\r\n    @shape.graphics.setStrokeStyle(1, 'round').beginStroke('#000000').beginFill('#fedcba')\r\n    @shape.graphics.drawCircle(0, 0, 4).endFill()\r\n\r\n  onMouseDown: (e) =>\r\n    return unless key.shift\r\n    @setPoint @options.camera.screenToWorld {x: e.stageX, y: e.stageY}\r\n    Backbone.Mediator.publish 'surface:choose-point', point: @point\r\n\r\n  updateShape: ->\r\n    sup = @options.camera.worldToSurface @point\r\n    @options.surfaceLayer.addChild @shape unless @shape.parent\r\n    @shape.x = sup.x\r\n    @shape.y = sup.y\r\n","CocoClass = require 'core/CocoClass'\r\nCamera = require './Camera'\r\n\r\nmodule.exports = class RegionChooser extends CocoClass\r\n  constructor: (@options) ->\r\n    super()\r\n    @options.stage.addEventListener 'stagemousedown', @onMouseDown\r\n    @options.stage.addEventListener 'stagemousemove', @onMouseMove\r\n    @options.stage.addEventListener 'stagemouseup', @onMouseUp\r\n\r\n  destroy: ->\r\n    @options.stage.removeEventListener 'stagemousedown', @onMouseDown\r\n    @options.stage.removeEventListener 'stagemousemove', @onMouseMove\r\n    @options.stage.removeEventListener 'stagemouseup', @onMouseUp\r\n    super()\r\n\r\n  onMouseDown: (e) =>\r\n    return unless key.shift\r\n    @firstPoint = @options.camera.screenToWorld {x: e.stageX, y: e.stageY}\r\n    @options.camera.dragDisabled = true\r\n\r\n  onMouseMove: (e) =>\r\n    return unless @firstPoint\r\n    @secondPoint = @options.camera.screenToWorld {x: e.stageX, y: e.stageY}\r\n    @restrictRegion() if @options.restrictRatio or key.alt\r\n    @updateShape()\r\n\r\n  onMouseUp: (e) =>\r\n    return unless @firstPoint\r\n    Backbone.Mediator.publish 'surface:choose-region', points: [@firstPoint, @secondPoint]\r\n    @firstPoint = null\r\n    @secondPoint = null\r\n    @options.camera.dragDisabled = false\r\n\r\n  restrictRegion: ->\r\n    RATIO = 1.56876  # 924 / 589\r\n    rect = @options.camera.normalizeBounds([@firstPoint, @secondPoint])\r\n    currentRatio = rect.width / rect.height\r\n    if currentRatio > RATIO\r\n      # increase the height\r\n      targetSurfaceHeight = rect.width / RATIO\r\n      targetWorldHeight = targetSurfaceHeight * Camera.MPP * @options.camera.x2y\r\n      targetWorldHeight *= -1 if @secondPoint.y < @firstPoint.y\r\n      @secondPoint.y = @firstPoint.y + targetWorldHeight\r\n    else\r\n      # increase the width\r\n      targetSurfaceWidth = rect.height * RATIO\r\n      targetWorldWidth =  targetSurfaceWidth * Camera.MPP\r\n      targetWorldWidth *= -1 if @secondPoint.x < @firstPoint.x\r\n      @secondPoint.x = @firstPoint.x + targetWorldWidth\r\n\r\n  # Called from WorldSelectModal\r\n  setRegion: (worldPoints) ->\r\n    @firstPoint = worldPoints[0]\r\n    @secondPoint = worldPoints[1]\r\n    @updateShape()\r\n    @firstPoint = null\r\n    @secondPoint = null\r\n\r\n  updateShape: ->\r\n    rect = @options.camera.normalizeBounds([@firstPoint, @secondPoint])\r\n    @options.surfaceLayer.removeChild @shape if @shape\r\n    @shape = new createjs.Shape()\r\n    @shape.alpha = 0.5\r\n    @shape.mouseEnabled = false\r\n    @shape.graphics.beginFill('#fedcba').drawRect rect.x, rect.y, rect.width, rect.height\r\n    @shape.graphics.endFill()\r\n    @shape.skipScaling = true\r\n    @options.surfaceLayer.addChild(@shape)\r\n","SpriteBuilder = require 'lib/sprites/SpriteBuilder'\r\n\r\n# Put this on MovieClips\r\nspecialGoToAndStop = (frame) ->\r\n  if frame is @currentFrame and @childrenCopy\r\n    @addChild(@childrenCopy...)\r\n  else\r\n    @gotoAndStop(frame)\r\n    @childrenCopy = @children.slice(0)\r\n\r\nmodule.exports = class SegmentedSprite extends createjs.SpriteContainer\r\n  childMovieClips: null\r\n\r\n  constructor: (@spriteSheet, @thangType, @spriteSheetPrefix, @resolutionFactor=SPRITE_RESOLUTION_FACTOR) ->\r\n    @spriteSheet.mcPool ?= {}\r\n    super(@spriteSheet)\r\n    @addEventListener 'tick', @handleTick\r\n\r\n  destroy: ->\r\n    @handleTick = undefined\r\n    @baseMovieClip.inUse = false if @baseMovieClip\r\n    @removeAllEventListeners()\r\n\r\n  # CreateJS.Sprite-like interface\r\n\r\n  play: -> @paused = false unless @baseMovieClip and @animLength > 1\r\n  stop: -> @paused = true\r\n  gotoAndPlay: (actionName) -> @goto(actionName, false)\r\n  gotoAndStop: (actionName) -> @goto(actionName, true)\r\n\r\n  goto: (actionName, @paused=true) ->\r\n    @removeAllChildren()\r\n    @currentAnimation = actionName\r\n    @baseMovieClip.inUse = false if @baseMovieClip\r\n    if @childMovieClips\r\n      mc.inUse = false for mc in @childMovieClips\r\n    @childMovieClips = @baseMovieClip = @framerate = @animLength = null\r\n    @actionNotSupported = false\r\n\r\n    action = @thangType.getActions()[actionName]\r\n    randomStart = _.string.startsWith(actionName, 'move')\r\n\r\n    # because the resulting segmented image is set to the size of the movie clip, you can use\r\n    # the raw registration data without scaling it.\r\n    reg = action.positions?.registration or @thangType.get('positions')?.registration or {x:0, y:0}\r\n\r\n    if action.animation\r\n      @regX = -reg.x\r\n      @regY = -reg.y\r\n      @framerate = (action.framerate ? 20) * (action.speed ? 1)\r\n      @childMovieClips = []\r\n      @baseMovieClip = @buildMovieClip(action.animation)\r\n      @baseMovieClip.inUse = true\r\n      @frames = action.frames\r\n      @frames = (parseInt(f) for f in @frames.split(',')) if @frames\r\n      @animLength = if @frames then @frames.length else @baseMovieClip.timeline.duration\r\n      @paused = true if @animLength is 1\r\n\r\n      if @frames\r\n        if randomStart\r\n          @currentFrame = @frames[_.random(@frames.length - 1)]\r\n        else\r\n          @currentFrame = @frames[0]\r\n      else\r\n        if randomStart\r\n          @currentFrame = then Math.floor(Math.random() * @animLength)\r\n        else\r\n          @currentFrame = 0\r\n\r\n      @baseMovieClip.specialGoToAndStop(@currentFrame)\r\n      for movieClip in @childMovieClips\r\n        if movieClip.mode is 'single'\r\n          movieClip.specialGoToAndStop(movieClip.startPosition)\r\n        else\r\n          movieClip.specialGoToAndStop(@currentFrame)\r\n\r\n      @takeChildrenFromMovieClip(@baseMovieClip, @)\r\n      @loop = action.loops isnt false\r\n      @goesTo = action.goesTo\r\n      @notifyActionNeedsRender(action) if @actionNotSupported\r\n      @scaleX = @scaleY = action.scale ? @thangType.get('scale') ? 1\r\n\r\n    else if action.container\r\n      # All transformations will be done to the child sprite\r\n      @regX = @regY = 0\r\n      @scaleX = @scaleY = 1\r\n\r\n      @childMovieClips = []\r\n      containerName = @spriteSheetPrefix + action.container\r\n      sprite = new createjs.Sprite(@spriteSheet)\r\n      sprite.gotoAndStop(containerName)\r\n      if sprite.currentFrame is 0 or @usePlaceholders\r\n        sprite.gotoAndStop(0)\r\n        @notifyActionNeedsRender(action)\r\n        bounds = @thangType.get('raw').containers[action.container].b\r\n        actionScale = (action.scale ? @thangType.get('scale') ? 1)\r\n        sprite.scaleX = actionScale * bounds[2] / (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor)\r\n        sprite.scaleY = actionScale * bounds[3] / (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor)\r\n        sprite.regX = (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor) * ((-reg.x - bounds[0]) / bounds[2])\r\n        sprite.regY = (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor) * ((-reg.y - bounds[1]) / bounds[3])\r\n      else\r\n        scale = @resolutionFactor * (action.scale ? @thangType.get('scale') ? 1)\r\n        sprite.regX = -reg.x * scale\r\n        sprite.regY = -reg.y * scale\r\n        sprite.scaleX = sprite.scaleY = 1 / @resolutionFactor\r\n      @children = []\r\n      @addChild(sprite)\r\n\r\n    else if action.goesTo\r\n      @goto(action.goesTo, @paused)\r\n      return\r\n\r\n    @scaleX *= -1 if action.flipX\r\n    @scaleY *= -1 if action.flipY\r\n    @baseScaleX = @scaleX\r\n    @baseScaleY = @scaleY\r\n    return\r\n\r\n  notifyActionNeedsRender: (action) ->\r\n    @lank?.trigger('action-needs-render', @lank, action)\r\n\r\n  buildMovieClip: (animationName, mode, startPosition, loops) ->\r\n    key = JSON.stringify([@spriteSheetPrefix].concat(arguments))\r\n    @spriteSheet.mcPool[key] ?= []\r\n    for mc in @spriteSheet.mcPool[key]\r\n      if not mc.inUse\r\n        mc.gotoAndStop(mc.currentFrame+0.01) # just to make sure it has its children back\r\n        @childMovieClips = mc.childMovieClips\r\n        return mc\r\n\r\n    raw = @thangType.get('raw')\r\n    animData = raw.animations[animationName]\r\n    @lastAnimData = animData\r\n\r\n    locals = {}\r\n    _.extend locals, @buildMovieClipContainers(animData.containers)\r\n    _.extend locals, @buildMovieClipAnimations(animData.animations)\r\n\r\n    toSkip = {}\r\n    toSkip[shape.bn] = true for shape in animData.shapes\r\n    toSkip[graphic.bn] = true for graphic in animData.graphics\r\n\r\n    anim = new createjs.MovieClip()\r\n    anim.initialize(mode ? createjs.MovieClip.INDEPENDENT, startPosition ? 0, loops ? true)\r\n    anim.specialGoToAndStop = specialGoToAndStop\r\n\r\n    for tweenData, i in animData.tweens\r\n      stopped = false\r\n      tween = createjs.Tween\r\n      for func in tweenData\r\n        args = $.extend(true, [], (func.a))\r\n        if @dereferenceArgs(args, locals, toSkip) is false\r\n#          console.debug 'Did not dereference args:', args\r\n          stopped = true\r\n          break\r\n        if tween[func.n]\r\n          tween = tween[func.n](args...)\r\n        else\r\n          # If we, say, skipped a shadow get(), then the wait() may not be present\r\n          stopped = true\r\n          break\r\n      continue if stopped\r\n      anim.timeline.addTween(tween)\r\n\r\n    anim.nominalBounds = new createjs.Rectangle(animData.bounds...)\r\n    if animData.frameBounds\r\n      anim.frameBounds = (new createjs.Rectangle(bounds...) for bounds in animData.frameBounds)\r\n\r\n    anim.childMovieClips = @childMovieClips\r\n\r\n    @spriteSheet.mcPool[key].push(anim)\r\n    return anim\r\n\r\n  buildMovieClipContainers: (localContainers) ->\r\n    map = {}\r\n    for localContainer in localContainers\r\n      outerContainer = new createjs.SpriteContainer(@spriteSheet)\r\n      innerContainer = new createjs.Sprite(@spriteSheet)\r\n      innerContainer.gotoAndStop(@spriteSheetPrefix + localContainer.gn)\r\n      if innerContainer.currentFrame is 0 or @usePlaceholders\r\n        innerContainer.gotoAndStop(0)\r\n        @actionNotSupported = true\r\n        bounds = @thangType.get('raw').containers[localContainer.gn].b\r\n        innerContainer.x = bounds[0]\r\n        innerContainer.y = bounds[1]\r\n        innerContainer.scaleX = bounds[2] / (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor)\r\n        innerContainer.scaleY = bounds[3] / (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor)\r\n      else\r\n        innerContainer.scaleX = innerContainer.scaleY = 1 / (@resolutionFactor * (@thangType.get('scale') or 1))\r\n      outerContainer.addChild(innerContainer)\r\n      outerContainer.setTransform(localContainer.t...)\r\n      outerContainer._off = localContainer.o if localContainer.o?\r\n      outerContainer.alpha = localContainer.al if localContainer.al?\r\n      map[localContainer.bn] = outerContainer\r\n    return map\r\n\r\n  buildMovieClipAnimations: (localAnimations) ->\r\n    map = {}\r\n    for localAnimation in localAnimations\r\n      animation = @buildMovieClip(localAnimation.gn, localAnimation.a...)\r\n      animation.inUse = true\r\n      animation.setTransform(localAnimation.t...)\r\n      map[localAnimation.bn] = animation\r\n      @childMovieClips.push(animation)\r\n    return map\r\n\r\n  dereferenceArgs: (args, locals, toSkip) ->\r\n    for key, val of args\r\n      if locals[val]\r\n        args[key] = locals[val]\r\n      else if val is null\r\n        args[key] = {}\r\n      else if _.isString(val) and val.indexOf('createjs.') is 0\r\n        args[key] = eval(val) # TODO: Security risk\r\n      else if _.isObject(val) or _.isArray(val)\r\n        res = @dereferenceArgs(val, locals, toSkip)\r\n        return res if res is false\r\n      else if _.isString(val) and toSkip[val]\r\n        return false\r\n    return args\r\n\r\n  handleTick: (e) =>\r\n    if @lastTimeStamp\r\n      @tick(e.timeStamp - @lastTimeStamp)\r\n    @lastTimeStamp = e.timeStamp\r\n\r\n  tick: (delta) ->\r\n    return if @paused or not @baseMovieClip\r\n    return @paused = true if @animLength is 1\r\n    newFrame = @currentFrame + @framerate * delta / 1000\r\n\r\n    if newFrame > @animLength\r\n      if @goesTo\r\n        @gotoAndPlay(@goesTo)\r\n        return\r\n      else if not @loop\r\n        @paused = true\r\n        newFrame = @animLength - 1\r\n        _.defer => @dispatchEvent('animationend')\r\n      else\r\n        newFrame = newFrame % @animLength\r\n\r\n    translatedFrame = newFrame\r\n\r\n    if @frames\r\n      prevFrame = Math.floor(newFrame)\r\n      nextFrame = Math.ceil(newFrame)\r\n      if prevFrame is nextFrame\r\n        translatedFrame = @frames[newFrame]\r\n      else if nextFrame is @frames.length\r\n        translatedFrame = @frames[prevFrame]\r\n      else\r\n        # interpolate between frames\r\n        pct = newFrame % 1\r\n        newFrameIndex = @frames[prevFrame] + (pct * (@frames[nextFrame] - @frames[prevFrame]))\r\n        translatedFrame = newFrameIndex\r\n\r\n    @currentFrame = newFrame\r\n    return if translatedFrame is @baseMovieClip.currentFrame\r\n\r\n    @baseMovieClip.specialGoToAndStop(translatedFrame)\r\n    for movieClip in @childMovieClips\r\n      movieClip.specialGoToAndStop(if movieClip.mode is 'single' then movieClip.startPosition else newFrame)\r\n\r\n    @children = []\r\n    @takeChildrenFromMovieClip(@baseMovieClip, @)\r\n\r\n  takeChildrenFromMovieClip: (movieClip, recipientContainer) ->\r\n    for child in movieClip.childrenCopy\r\n      if child instanceof createjs.MovieClip\r\n        childRecipient = new createjs.SpriteContainer(@spriteSheet)\r\n        @takeChildrenFromMovieClip(child, childRecipient)\r\n        for prop in ['regX', 'regY', 'rotation', 'scaleX', 'scaleY', 'skewX', 'skewY', 'x', 'y']\r\n          childRecipient[prop] = child[prop]\r\n        recipientContainer.addChild(childRecipient)\r\n      else\r\n        recipientContainer.addChild(child)\r\n\r\n\r\n#  _getBounds: createjs.SpriteContainer.prototype.getBounds\r\n#  getBounds: -> @baseMovieClip?.getBounds() or @children[0]?.getBounds() or @_getBounds()\r\n","SpriteBuilder = require 'lib/sprites/SpriteBuilder'\r\n\r\nfloors = ['Dungeon Floor', 'Indoor Floor', 'Grass', 'Grass01', 'Grass02', 'Grass03', 'Grass04', 'Grass05', 'Goal Trigger', 'Obstacle', 'Sand 01', 'Sand 02', 'Sand 03', 'Sand 04', 'Sand 05', 'Sand 06', 'Talus 1', 'Talus 2', 'Talus 3', 'Talus 4', 'Talus 5', 'Talus 6', 'Firn 1', 'Firn 2', 'Firn 3', 'Firn 4', 'Firn 5', 'Firn 6', 'Ice Rink 1', 'Ice Rink 2', 'Ice Rink 3', 'Firn Cliff', 'VR Floor', 'Classroom Floor']\r\n\r\ncliffs = ['Dungeon Pit', 'Grass Cliffs']\r\n\r\nmodule.exports = class SingularSprite extends createjs.Sprite\r\n  childMovieClips: null\r\n\r\n  constructor: (@spriteSheet, @thangType, @spriteSheetPrefix, @resolutionFactor=SPRITE_RESOLUTION_FACTOR) ->\r\n    super(@spriteSheet)\r\n\r\n  destroy: ->\r\n    @removeAllEventListeners()\r\n\r\n  gotoAndPlay: (actionName) -> @goto(actionName, false)\r\n  gotoAndStop: (actionName) -> @goto(actionName, true)\r\n  _gotoAndPlay: createjs.Sprite.prototype.gotoAndPlay\r\n  _gotoAndStop: createjs.Sprite.prototype.gotoAndStop\r\n\r\n  goto: (actionName, @paused=true) ->\r\n    @actionNotSupported = false\r\n\r\n    action = @thangType.getActions()[actionName]\r\n    randomStart = _.string.startsWith(actionName, 'move')\r\n    reg = action.positions?.registration or @thangType.get('positions')?.registration or {x:0, y:0}\r\n\r\n    if action.animation\r\n      @framerate = (action.framerate ? 20) * (action.speed ? 1)\r\n\r\n      func = if @paused then '_gotoAndStop' else '_gotoAndPlay'\r\n      animationName = @spriteSheetPrefix + actionName\r\n      @[func](animationName)\r\n      if @currentFrame is 0 or @usePlaceholders\r\n        @_gotoAndStop(0)\r\n        @notifyActionNeedsRender(action)\r\n        bounds = @thangType.get('raw')?.animations?[action.animation]?.bounds # checking for just-prerendered-spritesheet thangs\r\n        bounds ?= [0, 0, 1, 1]\r\n        actionScale = (action.scale ? @thangType.get('scale') ? 1)\r\n        @scaleX = actionScale * bounds[2] / (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor)\r\n        @scaleY = actionScale * bounds[3] / (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor)\r\n        @regX = (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor) * ((-reg.x - bounds[0]) / bounds[2])\r\n        @regY = (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor) * ((-reg.y - bounds[1]) / bounds[3])\r\n      else\r\n        scale = @resolutionFactor * (action.scale ? @thangType.get('scale') ? 1)\r\n        @regX = -reg.x * scale\r\n        @regY = -reg.y * scale\r\n        @scaleX = @scaleY = 1 / @resolutionFactor\r\n        @framerate = action.framerate or 20\r\n        if randomStart and frames = @spriteSheet.getAnimation(animationName)?.frames\r\n          @currentAnimationFrame = Math.floor(Math.random() * frames.length)\r\n\r\n    if action.container\r\n      animationName = @spriteSheetPrefix + actionName\r\n      @_gotoAndStop(animationName)\r\n      if @currentFrame is 0 or @usePlaceholders\r\n        @_gotoAndStop(0)\r\n        @notifyActionNeedsRender(action)\r\n        bounds = @thangType.get('raw').containers[action.container].b\r\n        actionScale = (action.scale ? @thangType.get('scale') ? 1)\r\n        @scaleX = actionScale * bounds[2] / (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor)\r\n        @scaleY = actionScale * bounds[3] / (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor)\r\n        @regX = (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor) * ((-reg.x - bounds[0]) / bounds[2])\r\n        @regY = (SPRITE_PLACEHOLDER_WIDTH * @resolutionFactor) * ((-reg.y - bounds[1]) / bounds[3])\r\n      else\r\n        scale = @resolutionFactor * (action.scale ? @thangType.get('scale') ? 1)\r\n        @regX = -reg.x * scale\r\n        @regY = -reg.y * scale\r\n        @scaleX = @scaleY = 1 / @resolutionFactor\r\n\r\n    @scaleX *= -1 if action.flipX\r\n    @scaleY *= -1 if action.flipY\r\n    @baseScaleX = @scaleX\r\n    @baseScaleY = @scaleY\r\n    if @camera and @thangType.get('name') in floors\r\n      @baseScaleY *= @camera.y2x\r\n    else if @camera and @thangType.get('name') in cliffs\r\n      if actionName is 'idle_side'\r\n        @baseScaleX *= @camera.x2y# / 0.85\r\n        @baseScaleY *= @camera.y2x * 0.85\r\n      else\r\n        @baseScaleY *= @camera.y2x / 0.85\r\n    @currentAnimation = actionName\r\n    return\r\n\r\n  notifyActionNeedsRender: (action) ->\r\n    @lank?.trigger('action-needs-render', @lank, action)\r\n","CocoClass = require 'core/CocoClass'\r\nTrailMaster = require './TrailMaster'\r\nDropper = require './Dropper'\r\nAudioPlayer = require 'lib/AudioPlayer'\r\n{me} = require 'core/auth'\r\nCamera = require './Camera'\r\nCameraBorder = require './CameraBorder'\r\nLayer = require('./LayerAdapter')\r\nLetterbox = require './Letterbox'\r\nDimmer = require './Dimmer'\r\nCountdownScreen = require './CountdownScreen'\r\nPlaybackOverScreen = require './PlaybackOverScreen'\r\nDebugDisplay = require './DebugDisplay'\r\nCoordinateDisplay = require './CoordinateDisplay'\r\nCoordinateGrid = require './CoordinateGrid'\r\nLankBoss = require './LankBoss'\r\nPointChooser = require './PointChooser'\r\nRegionChooser = require './RegionChooser'\r\nMusicPlayer = require './MusicPlayer'\r\nGameUIState = require 'models/GameUIState'\r\n\r\nresizeDelay = 500  # At least as much as $level-resize-transition-time.\r\n\r\nmodule.exports = Surface = class Surface extends CocoClass\r\n  stage: null\r\n\r\n  normalLayers: null\r\n  surfaceLayer: null\r\n  surfaceTextLayer: null\r\n  screenLayer: null\r\n  gridLayer: null\r\n\r\n  lankBoss: null\r\n\r\n  debugDisplay: null\r\n  currentFrame: 0\r\n  lastFrame: null\r\n  totalFramesDrawn: 0\r\n  playing: false  # play vs. pause -- match default button state in playback.jade\r\n  dead: false  # if we kill it for some reason\r\n  imagesLoaded: false\r\n  worldLoaded: false\r\n  scrubbing: false\r\n  debug: false\r\n\r\n  defaults:\r\n    paths: true\r\n    grid: false\r\n    navigateToSelection: true\r\n    choosing: false # 'point', 'region', 'ratio-region'\r\n    coords: null  # use world defaults, or set to false/true to override\r\n    showInvisible: false\r\n    frameRate: 30  # Best as a divisor of 60, like 15, 30, 60, with RAF_SYNCHED timing.\r\n    levelType: 'hero'\r\n\r\n  subscriptions:\r\n    'level:disable-controls': 'onDisableControls'\r\n    'level:enable-controls': 'onEnableControls'\r\n    'level:set-playing': 'onSetPlaying'\r\n    'level:set-debug': 'onSetDebug'\r\n    'level:toggle-debug': 'onToggleDebug'\r\n    'level:toggle-pathfinding': 'onTogglePathFinding'\r\n    'level:set-time': 'onSetTime'\r\n    'camera:set-camera': 'onSetCamera'\r\n    'level:restarted': 'onLevelRestarted'\r\n    'god:new-world-created': 'onNewWorld'\r\n    'god:streaming-world-updated': 'onNewWorld'\r\n    'tome:cast-spells': 'onCastSpells'\r\n    'level:set-letterbox': 'onSetLetterbox'\r\n    'application:idle-changed': 'onIdleChanged'\r\n    'camera:zoom-updated': 'onZoomUpdated'\r\n    'playback:real-time-playback-started': 'onRealTimePlaybackStarted'\r\n    'playback:real-time-playback-ended': 'onRealTimePlaybackEnded'\r\n    'level:flag-color-selected': 'onFlagColorSelected'\r\n    'tome:manual-cast': 'onManualCast'\r\n    'playback:stop-real-time-playback': 'onStopRealTimePlayback'\r\n\r\n  shortcuts:\r\n    'ctrl+\\\\, ⌘+\\\\': 'onToggleDebug'\r\n    'ctrl+o, ⌘+o': 'onTogglePathFinding'\r\n\r\n\r\n\r\n  #- Initialization\r\n\r\n  constructor: (@world, @normalCanvas, @webGLCanvas, givenOptions) ->\r\n    super()\r\n    $(window).on('keydown', @onKeyEvent)\r\n    $(window).on('keyup', @onKeyEvent)\r\n    @normalLayers = []\r\n    @options = _.clone(@defaults)\r\n    @options = _.extend(@options, givenOptions) if givenOptions\r\n    @handleEvents = @options.handleEvents ? true\r\n    @gameUIState = @options.gameUIState or new GameUIState({\r\n      canDragCamera: true\r\n    })\r\n    @realTimeInputEvents = @gameUIState.get('realTimeInputEvents')\r\n    @listenTo(@gameUIState, 'sprite:mouse-down', @onSpriteMouseDown)\r\n    @onResize = _.debounce @onResize, resizeDelay\r\n    @initEasel()\r\n    @initAudio()\r\n    $(window).on 'resize', @onResize\r\n    if @world.ended\r\n      _.defer => @setWorld @world\r\n\r\n  initEasel: ->\r\n    @normalStage = new createjs.Stage(@normalCanvas[0])\r\n    @webGLStage = new createjs.SpriteStage(@webGLCanvas[0])\r\n    @normalStage.nextStage = @webGLStage\r\n    @camera = new Camera(@webGLCanvas, { @gameUIState, @handleEvents })\r\n    AudioPlayer.camera = @camera unless @options.choosing\r\n\r\n    @normalLayers.push @surfaceTextLayer = new Layer name: 'Surface Text', layerPriority: 1, transform: Layer.TRANSFORM_SURFACE_TEXT, camera: @camera\r\n    @normalLayers.push @gridLayer = new Layer name: 'Grid', layerPriority: 2, transform: Layer.TRANSFORM_SURFACE, camera: @camera\r\n    @normalLayers.push @screenLayer = new Layer name: 'Screen', layerPriority: 3, transform: Layer.TRANSFORM_SCREEN, camera: @camera\r\n#    @normalLayers.push @cameraBorderLayer = new Layer name: 'Camera Border', layerPriority: 4, transform: Layer.TRANSFORM_SURFACE, camera: @camera\r\n#    @cameraBorderLayer.addChild @cameraBorder = new CameraBorder(bounds: @camera.bounds)\r\n    @normalStage.addChild (layer.container for layer in @normalLayers)...\r\n\r\n    canvasWidth = parseInt @normalCanvas.attr('width'), 10\r\n    canvasHeight = parseInt @normalCanvas.attr('height'), 10\r\n    @screenLayer.addChild new Letterbox canvasWidth: canvasWidth, canvasHeight: canvasHeight\r\n\r\n    @lankBoss = new LankBoss({\r\n      @camera\r\n      @webGLStage\r\n      @surfaceTextLayer\r\n      @world\r\n      thangTypes: @options.thangTypes\r\n      choosing: @options.choosing\r\n      navigateToSelection: @options.navigateToSelection\r\n      showInvisible: @options.showInvisible\r\n      playerNames: if @options.levelType is 'course-ladder' then @options.playerNames else null\r\n      @gameUIState\r\n      @handleEvents\r\n    })\r\n    @countdownScreen = new CountdownScreen camera: @camera, layer: @screenLayer, showsCountdown: @world.showsCountdown\r\n    unless @options.levelType is 'game-dev'\r\n      @playbackOverScreen = new PlaybackOverScreen camera: @camera, layer: @screenLayer, playerNames: @options.playerNames\r\n      @normalStage.addChildAt @playbackOverScreen.dimLayer, 0  # Put this below the other layers, actually, so we can more easily read text on the screen.\r\n    @initCoordinates()\r\n    @webGLStage.enableMouseOver(10)\r\n    @webGLStage.addEventListener 'stagemousemove', @onMouseMove\r\n    @webGLStage.addEventListener 'stagemousedown', @onMouseDown\r\n    @webGLStage.addEventListener 'stagemouseup', @onMouseUp\r\n    @webGLCanvas.on 'mousewheel', @onMouseWheel\r\n    @hookUpChooseControls() if @options.choosing # TODO: figure this stuff out\r\n    createjs.Ticker.timingMode = createjs.Ticker.RAF_SYNCHED\r\n    createjs.Ticker.setFPS @options.frameRate\r\n    @onResize()\r\n\r\n  initCoordinates: ->\r\n    @coordinateGrid ?= new CoordinateGrid {camera: @camera, layer: @gridLayer, textLayer: @surfaceTextLayer}, @world.size()\r\n    @coordinateGrid.showGrid() if @world.showGrid or @options.grid\r\n    showCoordinates = if @options.coords? then @options.coords else @world.showCoordinates\r\n    @coordinateDisplay ?= new CoordinateDisplay camera: @camera, layer: @surfaceTextLayer if showCoordinates\r\n\r\n  hookUpChooseControls: ->\r\n    chooserOptions = stage: @webGLStage, surfaceLayer: @surfaceTextLayer, camera: @camera, restrictRatio: @options.choosing is 'ratio-region'\r\n    klass = if @options.choosing is 'point' then PointChooser else RegionChooser\r\n    @chooser = new klass chooserOptions\r\n\r\n  initAudio: ->\r\n    @musicPlayer = new MusicPlayer()\r\n\r\n\r\n\r\n  #- Setting the world\r\n\r\n  setWorld: (@world) ->\r\n    @worldLoaded = true\r\n    @lankBoss.world = @world\r\n    @restoreWorldState() unless @options.choosing\r\n    @showLevel()\r\n    @updateState true if @loaded\r\n    @onFrameChanged()\r\n\r\n  showLevel: ->\r\n    return if @destroyed\r\n    return if @loaded\r\n    @loaded = true\r\n    @lankBoss.createMarks()\r\n    @updateState true\r\n    @drawCurrentFrame()\r\n    createjs.Ticker.addEventListener 'tick', @tick\r\n    Backbone.Mediator.publish 'level:started', {}\r\n\r\n  #- Update loop\r\n\r\n  tick: (e) =>\r\n    # seems to be a bug where only one object can register with the Ticker...\r\n    oldFrame = @currentFrame\r\n    oldWorldFrame = Math.floor oldFrame\r\n    lastFrame = @world.frames.length - 1\r\n    framesDropped = 0\r\n    while true\r\n      Dropper.tick()\r\n      # Skip some frame updates unless we're playing and not at end (or we haven't drawn much yet)\r\n      frameAdvanced = (@playing and @currentFrame < lastFrame) or @totalFramesDrawn < 2\r\n      if frameAdvanced and @playing\r\n        advanceBy = @world.frameRate / @options.frameRate\r\n        if @fastForwardingToFrame and @currentFrame < @fastForwardingToFrame - advanceBy\r\n          advanceBy = Math.min(@currentFrame + advanceBy * @fastForwardingSpeed, @fastForwardingToFrame) - @currentFrame\r\n        else if @fastForwardingToFrame\r\n          @fastForwardingToFrame = @fastForwardingSpeed = null\r\n        @currentFrame += advanceBy\r\n        @currentFrame = Math.min @currentFrame, lastFrame\r\n      newWorldFrame = Math.floor @currentFrame\r\n      if Dropper.drop()\r\n        ++framesDropped\r\n      else\r\n        worldFrameAdvanced = newWorldFrame isnt oldWorldFrame\r\n        if worldFrameAdvanced\r\n          # Only restore world state when it will correspond to an integer WorldFrame, not interpolated frame.\r\n          @restoreWorldState()\r\n          oldWorldFrame = newWorldFrame\r\n        break\r\n    if frameAdvanced and not worldFrameAdvanced\r\n      # We didn't end the above loop on an integer frame, so do the world state update.\r\n      @restoreWorldState()\r\n\r\n    # these are skipped for dropped frames\r\n    @updateState @currentFrame isnt oldFrame\r\n    @drawCurrentFrame e\r\n    @onFrameChanged()\r\n    Backbone.Mediator.publish('surface:ticked', {dt: 1 / @options.frameRate})\r\n    mib = @webGLStage.mouseInBounds\r\n    if @mouseInBounds isnt mib\r\n      Backbone.Mediator.publish('surface:mouse-' + (if mib then 'over' else 'out'), {})\r\n      @mouseInBounds = mib\r\n      @mouseIsDown = false\r\n\r\n  restoreWorldState: ->\r\n    frame = @world.getFrame(@getCurrentFrame())\r\n    return unless frame\r\n    frame.restoreState()\r\n    current = Math.max(0, Math.min(@currentFrame, @world.frames.length - 1))\r\n    if current - Math.floor(current) > 0.01 and Math.ceil(current) < @world.frames.length - 1\r\n      next = Math.ceil current\r\n      ratio = current % 1\r\n      @world.frames[next].restorePartialState ratio if next > 1\r\n    frame.clearEvents() if parseInt(@currentFrame) is parseInt(@lastFrame)\r\n    @lankBoss.updateSounds() if parseInt(@currentFrame) isnt parseInt(@lastFrame)\r\n\r\n  updateState: (frameChanged) ->\r\n    # world state must have been restored in @restoreWorldState\r\n    if @handleEvents\r\n      if @playing and @currentFrame < @world.frames.length - 1 and @heroLank and not @mouseIsDown and @camera.newTarget isnt @heroLank.sprite and @camera.target isnt @heroLank.sprite\r\n        @camera.zoomTo @heroLank.sprite, @camera.zoom, 750\r\n    @lankBoss.update frameChanged\r\n    @camera.updateZoom()  # Make sure to do this right after the LankBoss updates, not before, so it can properly target sprite positions.\r\n    @dimmer?.setSprites @lankBoss.lanks\r\n\r\n  drawCurrentFrame: (e) ->\r\n    ++@totalFramesDrawn\r\n    @normalStage.update e\r\n    @webGLStage.update e\r\n\r\n\r\n  #- Setting play/pause and progress\r\n\r\n  setProgress: (progress, scrubDuration=500) ->\r\n    progress = Math.max(Math.min(progress, 1), 0.0)\r\n\r\n    @fastForwardingToFrame = null\r\n    @scrubbing = true\r\n    onTweenEnd = =>\r\n      @scrubbingTo = null\r\n      @scrubbing = false\r\n      @scrubbingPlaybackSpeed = null\r\n\r\n    if @scrubbingTo?\r\n      # cut to the chase for existing tween\r\n      createjs.Tween.removeTweens(@)\r\n      @currentFrame = @scrubbingTo\r\n\r\n    @scrubbingTo = Math.round(progress * (@world.frames.length - 1))\r\n    @scrubbingTo = Math.max @scrubbingTo, 1\r\n    @scrubbingTo = Math.min @scrubbingTo, @world.frames.length - 1\r\n    @scrubbingPlaybackSpeed = Math.sqrt(Math.abs(@scrubbingTo - @currentFrame) * @world.dt / (scrubDuration or 0.5))\r\n    if scrubDuration\r\n      t = createjs.Tween\r\n        .get(@)\r\n        .to({currentFrame: @scrubbingTo}, scrubDuration, createjs.Ease.sineInOut)\r\n        .call(onTweenEnd)\r\n      t.addEventListener('change', @onFramesScrubbed)\r\n    else\r\n      @currentFrame = @scrubbingTo\r\n      @onFramesScrubbed()  # For performance, don't play these for instant transitions.\r\n      onTweenEnd()\r\n\r\n    return unless @loaded\r\n    @updateState true\r\n    @onFrameChanged()\r\n\r\n  onFramesScrubbed: (e) =>\r\n    return unless @loaded\r\n    if e\r\n      # Gotta play all the sounds when scrubbing (but not when doing an immediate transition).\r\n      rising = @currentFrame > @lastFrame\r\n      actualCurrentFrame = @currentFrame\r\n      tempFrame = if rising then Math.ceil(@lastFrame) else Math.floor(@lastFrame)\r\n      while true  # temporary fix to stop cacophony\r\n        break if rising and tempFrame > actualCurrentFrame\r\n        break if (not rising) and tempFrame < actualCurrentFrame\r\n        @currentFrame = tempFrame\r\n        frame = @world.getFrame(@getCurrentFrame())\r\n        frame.restoreState()\r\n        volume = Math.max(0.05, Math.min(1, 1 / @scrubbingPlaybackSpeed))\r\n        lank.playSounds false, volume for lank in @lankBoss.lankArray\r\n        tempFrame += if rising then 1 else -1\r\n      @currentFrame = actualCurrentFrame\r\n\r\n    @restoreWorldState()\r\n    @lankBoss.update true\r\n    @onFrameChanged()\r\n\r\n  getCurrentFrame: ->\r\n    return Math.max(0, Math.min(Math.floor(@currentFrame), @world.frames.length - 1))\r\n\r\n  setPaused: (paused) ->\r\n    # We want to be able to essentially stop rendering the surface if it doesn't need to animate anything.\r\n    # If pausing, though, we want to give it enough time to finish any tweens.\r\n    performToggle = =>\r\n      createjs.Ticker.setFPS if paused then 1 else @options.frameRate\r\n      @surfacePauseTimeout = null\r\n    clearTimeout @surfacePauseTimeout if @surfacePauseTimeout\r\n    clearTimeout @surfaceZoomPauseTimeout if @surfaceZoomPauseTimeout\r\n    @surfacePauseTimeout = @surfaceZoomPauseTimeout = null\r\n    if paused\r\n      @surfacePauseTimeout = _.delay performToggle, 2000\r\n      @lankBoss.stop()\r\n      @trailmaster?.stop()\r\n      @playbackOverScreen?.show()\r\n    else\r\n      performToggle()\r\n      @lankBoss.play()\r\n      @trailmaster?.play()\r\n      @playbackOverScreen?.hide()\r\n\r\n\r\n\r\n  #- Changes and events that only need to happen when the frame has changed\r\n\r\n  onFrameChanged: (force) ->\r\n    @currentFrame = Math.min(@currentFrame, @world.frames.length - 1)\r\n    @debugDisplay?.updateFrame @currentFrame\r\n    return if @currentFrame is @lastFrame and not force\r\n    progress = @getProgress()\r\n    Backbone.Mediator.publish('surface:frame-changed',\r\n      selectedThang: @lankBoss.selectedLank?.thang\r\n      progress: progress\r\n      frame: @currentFrame\r\n      world: @world\r\n    )\r\n\r\n    if (not @world.indefiniteLength) and @lastFrame < @world.frames.length and @currentFrame >= @world.totalFrames - 1\r\n      @ended = true\r\n      @setPaused true\r\n      Backbone.Mediator.publish 'surface:playback-ended', {}\r\n      @updatePaths()  # TODO: this is a hack to make sure paths are on the first time the level loads\r\n    else if @currentFrame < @world.totalFrames and @ended\r\n      @ended = false\r\n      @setPaused false\r\n      Backbone.Mediator.publish 'surface:playback-restarted', {}\r\n\r\n    @lastFrame = @currentFrame\r\n\r\n  getProgress: -> @currentFrame / Math.max(1, @world.frames.length - 1)\r\n\r\n\r\n\r\n  #- Subscription callbacks\r\n\r\n  onToggleDebug: (e) ->\r\n    e?.preventDefault?()\r\n    Backbone.Mediator.publish 'level:set-debug', {debug: not @debug}\r\n\r\n  onSetDebug: (e) ->\r\n    return if e.debug is @debug\r\n    @debug = e.debug\r\n    if @debug and not @debugDisplay\r\n      @screenLayer.addChild @debugDisplay = new DebugDisplay canvasWidth: @camera.canvasWidth, canvasHeight: @camera.canvasHeight\r\n\r\n  onLevelRestarted: (e) ->\r\n    @setProgress 0, 0\r\n\r\n  onSetCamera: (e) ->\r\n    if e.thangID\r\n      return unless target = @lankBoss.lankFor(e.thangID)?.sprite\r\n    else if e.pos\r\n      target = @camera.worldToSurface e.pos\r\n    else\r\n      target = null\r\n    @camera.setBounds e.bounds if e.bounds\r\n#    @cameraBorder.updateBounds @camera.bounds\r\n    if @handleEvents\r\n      @camera.zoomTo target, e.zoom, e.duration  # TODO: SurfaceScriptModule perhaps shouldn't assign e.zoom if not set\r\n\r\n  onZoomUpdated: (e) ->\r\n    if @ended\r\n      @setPaused false\r\n      @surfaceZoomPauseTimeout = _.delay (=> @setPaused true), 3000\r\n    @zoomedIn = e.zoom > e.minZoom * 1.1\r\n    @updateGrabbability()\r\n\r\n  updateGrabbability: ->\r\n    @webGLCanvas.toggleClass 'grabbable', @zoomedIn and not @playing and not @disabled\r\n\r\n  onDisableControls: (e) ->\r\n    return if e.controls and not ('surface' in e.controls)\r\n    @setDisabled true\r\n    @dimmer ?= new Dimmer camera: @camera, layer: @screenLayer\r\n    @dimmer.setSprites @lankBoss.lanks\r\n\r\n  onEnableControls: (e) ->\r\n    return if e.controls and not ('surface' in e.controls)\r\n    @setDisabled false\r\n\r\n  onSetLetterbox: (e) ->\r\n    @setDisabled e.on\r\n\r\n  setDisabled: (@disabled) ->\r\n    @lankBoss.disabled = @disabled\r\n    @updateGrabbability()\r\n\r\n  onSetPlaying: (e) ->\r\n    @playing = (e ? {}).playing ? true\r\n    @setPlayingCalled = true\r\n    if @playing and @currentFrame >= (@world.totalFrames - 5)\r\n      @currentFrame = 1  # Go back to the beginning (but not frame 0, that frame is weird)\r\n    if @fastForwardingToFrame and not @playing\r\n      @fastForwardingToFrame = null\r\n    @updateGrabbability()\r\n\r\n  onSetTime: (e) ->\r\n    toFrame = @currentFrame\r\n    if e.time?\r\n      @worldLifespan = @world.frames.length / @world.frameRate\r\n      e.ratio = e.time / @worldLifespan\r\n    if e.ratio?\r\n      toFrame = @world.frames.length * e.ratio\r\n    if e.frameOffset\r\n      toFrame += e.frameOffset\r\n    if e.ratioOffset\r\n      toFrame += @world.frames.length * e.ratioOffset\r\n    unless _.isNumber(toFrame) and not _.isNaN(toFrame)\r\n      return console.error('set-time event', e, 'produced invalid target frame', toFrame)\r\n    @setProgress(toFrame / @world.frames.length, e.scrubDuration)\r\n\r\n  onCastSpells: (e) ->\r\n    return if e.preload\r\n    @setPaused false if @ended\r\n    @casting = true\r\n    @setPlayingCalled = false  # Don't overwrite playing settings if they changed by, say, scripts.\r\n    @frameBeforeCast = @currentFrame\r\n    # This is where I wanted to trigger a rewind, but it turned out to be pretty complicated, since the new world gets updated everywhere, and you don't want to rewind through that.\r\n    @setProgress 0, 0\r\n\r\n  onNewWorld: (event) ->\r\n    return unless event.world.name is @world.name\r\n    @onStreamingWorldUpdated event\r\n\r\n  onStreamingWorldUpdated: (event) ->\r\n    @casting = false\r\n    @lankBoss.play()\r\n\r\n    # This has a tendency to break scripts that are waiting for playback to change when the level is loaded\r\n    # so only run it after the first world is created.\r\n    Backbone.Mediator.publish 'level:set-playing', {playing: true} unless event.firstWorld or @setPlayingCalled\r\n\r\n    @setWorld event.world\r\n    @onFrameChanged(true)\r\n    fastForwardBuffer = 2\r\n    if @playing and not @realTime and (ffToFrame = Math.min(event.firstChangedFrame, @frameBeforeCast, @world.frames.length - 1)) and ffToFrame > @currentFrame + fastForwardBuffer * @world.frameRate\r\n      @fastForwardingToFrame = ffToFrame\r\n      @fastForwardingSpeed = Math.max 3, 3 * (@world.maxTotalFrames * @world.dt) / 60\r\n    else if @realTime\r\n      buffer = if @world.indefiniteLength then 0 else @world.realTimeBufferMax\r\n      lag = (@world.frames.length - 1) * @world.dt - @world.age\r\n      intendedLag = @world.dt + buffer\r\n      if lag > intendedLag * 1.2\r\n        @fastForwardingToFrame = @world.frames.length - buffer * @world.frameRate\r\n        @fastForwardingSpeed = lag / intendedLag\r\n      else\r\n        @fastForwardingToFrame = @fastForwardingSpeed = null\r\n#    console.log \"on new world, lag\", lag, \"intended lag\", intendedLag, \"fastForwardingToFrame\", @fastForwardingToFrame, \"speed\", @fastForwardingSpeed, \"cause we are at\", @world.age, \"of\", @world.frames.length * @world.dt\r\n    if event.finished\r\n      @updatePaths()\r\n    else\r\n      @hidePaths()\r\n\r\n  onIdleChanged: (e) ->\r\n    @setPaused e.idle unless @ended\r\n\r\n\r\n\r\n  #- Mouse event callbacks\r\n\r\n  onMouseMove: (e) =>\r\n    @mouseScreenPos = {x: e.stageX, y: e.stageY}\r\n    return if @disabled\r\n    Backbone.Mediator.publish 'surface:mouse-moved', x: e.stageX, y: e.stageY\r\n    @gameUIState.trigger('surface:stage-mouse-move', { originalEvent: e })\r\n\r\n  onMouseDown: (e) =>\r\n    return if @disabled\r\n    cap = @camera.screenToCanvas({x: e.stageX, y: e.stageY})\r\n    # getObject(s)UnderPoint is broken, so we have to use the private method to get what we want\r\n    onBackground = not @webGLStage._getObjectsUnderPoint(e.stageX, e.stageY, null, true)\r\n\r\n    wop = @camera.screenToWorld x: e.stageX, y: e.stageY\r\n    event = { onBackground: onBackground, x: e.stageX, y: e.stageY, originalEvent: e, worldPos: wop }\r\n    Backbone.Mediator.publish 'surface:stage-mouse-down', event\r\n    Backbone.Mediator.publish 'tome:focus-editor', {}\r\n    @gameUIState.trigger('surface:stage-mouse-down', event)\r\n    @mouseIsDown = true\r\n\r\n  onSpriteMouseDown: (e) =>\r\n    return unless @realTime\r\n    @realTimeInputEvents.add({\r\n      type: 'mousedown'\r\n      pos: @camera.screenToWorld x: e.originalEvent.stageX, y: e.originalEvent.stageY\r\n      time: @world.dt * @world.frames.length\r\n      thangID: e.sprite.thang.id\r\n    })\r\n\r\n  onMouseUp: (e) =>\r\n    return if @disabled\r\n    onBackground = not @webGLStage.hitTest e.stageX, e.stageY\r\n    event = { onBackground: onBackground, x: e.stageX, y: e.stageY, originalEvent: e }\r\n    Backbone.Mediator.publish 'surface:stage-mouse-up', event\r\n    Backbone.Mediator.publish 'tome:focus-editor', {}\r\n    @gameUIState.trigger('surface:stage-mouse-up', event)\r\n    @mouseIsDown = false\r\n\r\n  onMouseWheel: (e) =>\r\n    # https://github.com/brandonaaron/jquery-mousewheel\r\n    e.preventDefault()\r\n    return if @disabled\r\n    event =\r\n      deltaX: e.deltaX\r\n      deltaY: e.deltaY\r\n      canvas: @webGLCanvas\r\n    event.screenPos = @mouseScreenPos if @mouseScreenPos\r\n    Backbone.Mediator.publish 'surface:mouse-scrolled', event unless @disabled\r\n    @gameUIState.trigger('surface:mouse-scrolled', event)\r\n\r\n\r\n  #- Keyboard callbacks\r\n\r\n  onKeyEvent: (e) =>\r\n    return unless @realTime\r\n    event = _.pick(e, 'type', 'keyCode', 'ctrlKey', 'metaKey', 'shiftKey')\r\n    event.time = @world.dt * @world.frames.length\r\n    @realTimeInputEvents.add(event)\r\n\r\n  #- Canvas callbacks\r\n\r\n  onResize: (e) =>\r\n    return if @destroyed or @options.choosing\r\n    oldWidth = parseInt @normalCanvas.attr('width'), 10\r\n    oldHeight = parseInt @normalCanvas.attr('height'), 10\r\n    aspectRatio = oldWidth / oldHeight\r\n    pageWidth = $('#page-container').width() - 17  # 17px nano scroll bar\r\n    if application.isIPadApp\r\n      newWidth = 1024\r\n      newHeight = newWidth / aspectRatio\r\n    else if @options.resizeStrategy is 'wrapper-size'\r\n      newWidth = $('#canvas-wrapper').width()\r\n      newHeight = newWidth / aspectRatio\r\n    else if @realTime or @options.spectateGame\r\n      pageHeight = window.innerHeight - $('#control-bar-view').outerHeight() - $('#playback-view').outerHeight()\r\n      newWidth = Math.min pageWidth, pageHeight * aspectRatio\r\n      newHeight = newWidth / aspectRatio\r\n    else if $('#thangs-tab-view')\r\n      newWidth = $('#canvas-wrapper').width()\r\n      newHeight = newWidth / aspectRatio\r\n    else\r\n      newWidth = 0.55 * pageWidth\r\n      newHeight = newWidth / aspectRatio\r\n    return unless newWidth > 0 and newHeight > 0\r\n\r\n    #scaleFactor = if application.isIPadApp then 2 else 1  # Retina\r\n    scaleFactor = 1\r\n    if @options.stayVisible\r\n      availableHeight = window.innerHeight\r\n      availableHeight -= $('.ad-container').outerHeight()\r\n      availableHeight -= $('#game-area').outerHeight() - $('#canvas-wrapper').outerHeight()\r\n      scaleFactor = availableHeight / newHeight if availableHeight < newHeight\r\n    newWidth *= scaleFactor\r\n    newHeight *= scaleFactor\r\n\r\n    return if newWidth is oldWidth and newHeight is oldHeight and not @options.spectateGame\r\n    return if newWidth < 200 or newHeight < 200\r\n    @normalCanvas.add(@webGLCanvas).attr width: newWidth, height: newHeight\r\n    @trigger 'resize', { width: newWidth, height: newHeight }\r\n\r\n    # Cannot do this to the webGLStage because it does not use scaleX/Y.\r\n    # Instead the LayerAdapter scales webGL-enabled layers.\r\n    @webGLStage.updateViewport(@webGLCanvas[0].width, @webGLCanvas[0].height)\r\n    @normalStage.scaleX *= newWidth / oldWidth\r\n    @normalStage.scaleY *= newHeight / oldHeight\r\n    @camera.onResize newWidth, newHeight\r\n    if @options.spectateGame\r\n      # Since normalCanvas is absolutely positioned, it needs help aligning with webGLCanvas.\r\n      offset = @webGLCanvas.offset().left - ($('#page-container').innerWidth() - $('#canvas-wrapper').innerWidth()) / 2\r\n      @normalCanvas.css 'left', offset\r\n\r\n  #- Camera focus on hero\r\n  focusOnHero: ->\r\n    hadHero = @heroLank\r\n    @heroLank = @lankBoss.lankFor 'Hero Placeholder'\r\n    if me.team is 'ogres'\r\n      # TODO: do this for real\r\n      @heroLank = @lankBoss.lankFor 'Hero Placeholder 1'\r\n    @updatePaths() if not hadHero\r\n\r\n  #- Real-time playback\r\n\r\n  onRealTimePlaybackStarted: (e) ->\r\n    return if @realTime\r\n    @realTimeInputEvents.reset()\r\n    @realTime = true\r\n    @onResize()\r\n    @playing = false  # Will start when countdown is done.\r\n    if @heroLank\r\n      @previousCameraZoom = @camera.zoom\r\n      #@camera.zoomTo @heroLank.sprite, 2, 3000  # This makes flag placement hard, now that we're only rarely using this as a coolcam.\r\n\r\n  onRealTimePlaybackEnded: (e) ->\r\n    return unless @realTime\r\n    @realTime = false\r\n    @onResize()\r\n    _.delay @onResize, resizeDelay + 100  # Do it again just to be double sure that we don't stay zoomed in due to timing problems.\r\n    @normalCanvas.add(@webGLCanvas).removeClass 'flag-color-selected'\r\n    if @handleEvents\r\n      if @previousCameraZoom\r\n        @camera.zoomTo @camera.newTarget or @camera.target, @previousCameraZoom, 3000\r\n\r\n  onFlagColorSelected: (e) ->\r\n    @normalCanvas.add(@webGLCanvas).toggleClass 'flag-color-selected', Boolean(e.color)\r\n    e.pos = @camera.screenToWorld @mouseScreenPos if @mouseScreenPos\r\n\r\n  # Force sizing based on width for game-dev levels, so that the instructions panel doesn't obscure the game\r\n  onManualCast: ->\r\n    if @options.levelType is 'game-dev'\r\n      console.log \"Force resize strategy\"\r\n      @options.originalResizeStrategy = @options.resizeStrategy\r\n      @options.resizeStrategy = 'wrapper-size'\r\n\r\n  # Revert back to normal sizing when done playing a game-dev level\r\n  onStopRealTimePlayback: ->\r\n    if @options.levelType is 'game-dev'\r\n      console.log \"Reset resize strategy\"\r\n      @options.resizeStrategy = @options.originalResizeStrategy\r\n\r\n  updatePaths: ->\r\n    return unless @options.paths and @heroLank\r\n    @hidePaths()\r\n    return if @world.showPaths is 'never'\r\n    layerAdapter = @lankBoss.layerAdapters['Path']\r\n    @trailmaster ?= new TrailMaster @camera, layerAdapter\r\n    @paths = @trailmaster.generatePaths @world, @heroLank.thang\r\n    @paths.name = 'paths'\r\n    layerAdapter.addChild @paths\r\n\r\n  hidePaths: ->\r\n    return if not @paths\r\n    if @paths.parent\r\n      @paths.parent.removeChild @paths\r\n    @paths = null\r\n\r\n\r\n\r\n  #- Screenshot\r\n\r\n  screenshot: (scale=0.25, format='image/jpeg', quality=0.8, zoom=2) ->\r\n    # TODO: get screenshots working again\r\n    # Quality doesn't work with image/png, just image/jpeg and image/webp\r\n    [w, h] = [@camera.canvasWidth * @camera.canvasScaleFactorX, @camera.canvasHeight * @camera.canvasScaleFactorY]\r\n    margin = (1 - 1 / zoom) / 2\r\n    @webGLStage.cache margin * w, margin * h, w / zoom, h / zoom, scale * zoom\r\n    imageData = @webGLStage.cacheCanvas.toDataURL(format, quality)\r\n    #console.log 'Screenshot with scale', scale, 'format', format, 'quality', quality, 'was', Math.floor(imageData.length / 1024), 'kB'\r\n    screenshot = document.createElement('img')\r\n    screenshot.src = imageData\r\n    @webGLStage.uncache()\r\n    imageData\r\n\r\n\r\n\r\n  #- Path finding debugging\r\n\r\n  onTogglePathFinding: (e) ->\r\n    e?.preventDefault?()\r\n    @hidePathFinding()\r\n    @showingPathFinding = not @showingPathFinding\r\n    if @showingPathFinding then @showPathFinding() else @hidePathFinding()\r\n\r\n  hidePathFinding: ->\r\n    @surfaceLayer.removeChild @navRectangles if @navRectangles\r\n    @surfaceLayer.removeChild @navPaths if @navPaths\r\n    @navRectangles = @navPaths = null\r\n\r\n  showPathFinding: ->\r\n    @hidePathFinding()\r\n\r\n    mesh = _.values(@world.navMeshes or {})[0]\r\n    return unless mesh\r\n    @navRectangles = new createjs.Container()\r\n    @navRectangles.layerPriority = -1\r\n    @addMeshRectanglesToContainer mesh, @navRectangles\r\n    @surfaceLayer.addChild @navRectangles\r\n    @surfaceLayer.updateLayerOrder()\r\n\r\n    graph = _.values(@world.graphs or {})[0]\r\n    return @surfaceLayer.updateLayerOrder() unless graph\r\n    @navPaths = new createjs.Container()\r\n    @navPaths.layerPriority = -1\r\n    @addNavPathsToContainer graph, @navPaths\r\n    @surfaceLayer.addChild @navPaths\r\n    @surfaceLayer.updateLayerOrder()\r\n\r\n  addMeshRectanglesToContainer: (mesh, container) ->\r\n    for rect in mesh\r\n      shape = new createjs.Shape()\r\n      pos = @camera.worldToSurface {x: rect.x, y: rect.y}\r\n      dim = @camera.worldToSurface {x: rect.width, y: rect.height}\r\n      shape.graphics\r\n      .setStrokeStyle(3)\r\n      .beginFill('rgba(0,0,128,0.3)')\r\n      .beginStroke('rgba(0,0,128,0.7)')\r\n      .drawRect(pos.x - dim.x/2, pos.y - dim.y/2, dim.x, dim.y)\r\n      container.addChild shape\r\n\r\n  addNavPathsToContainer: (graph, container) ->\r\n    for node in _.values graph\r\n      for edgeVertex in node.edges\r\n        @drawLine node.vertex, edgeVertex, container\r\n\r\n  drawLine: (v1, v2, container) ->\r\n    shape = new createjs.Shape()\r\n    v1 = @camera.worldToSurface v1\r\n    v2 = @camera.worldToSurface v2\r\n    shape.graphics\r\n    .setStrokeStyle(1)\r\n    .moveTo(v1.x, v1.y)\r\n    .beginStroke('rgba(128,0,0,0.4)')\r\n    .lineTo(v2.x, v2.y)\r\n    .endStroke()\r\n    container.addChild shape\r\n\r\n\r\n\r\n  #- Teardown\r\n\r\n  destroy: ->\r\n    @camera?.destroy()\r\n    createjs.Ticker.removeEventListener('tick', @tick)\r\n    createjs.Sound.stop()\r\n    layer.destroy() for layer in @normalLayers\r\n    @lankBoss.destroy()\r\n    @chooser?.destroy()\r\n    @dimmer?.destroy()\r\n    @countdownScreen?.destroy()\r\n    @playbackOverScreen?.destroy()\r\n    @coordinateDisplay?.destroy()\r\n    @coordinateGrid?.destroy()\r\n    @normalStage.clear()\r\n    @webGLStage.clear()\r\n    @musicPlayer?.destroy()\r\n    @trailmaster?.destroy()\r\n    @normalStage.removeAllChildren()\r\n    @webGLStage.removeAllChildren()\r\n    @webGLStage.removeEventListener 'stagemousemove', @onMouseMove\r\n    @webGLStage.removeEventListener 'stagemousedown', @onMouseDown\r\n    @webGLStage.removeEventListener 'stagemouseup', @onMouseUp\r\n    @webGLStage.removeAllEventListeners()\r\n    @normalStage.enableDOMEvents false\r\n    @webGLStage.enableDOMEvents false\r\n    @webGLStage.enableMouseOver 0\r\n    @webGLCanvas.off 'mousewheel', @onMouseWheel\r\n    $(window).off 'resize', @onResize\r\n    $(window).off('keydown', @onKeyEvent)\r\n    $(window).off('keyup', @onKeyEvent)\r\n    clearTimeout @surfacePauseTimeout if @surfacePauseTimeout\r\n    clearTimeout @surfaceZoomPauseTimeout if @surfaceZoomPauseTimeout\r\n    super()\r\n","PAST_PATH_ALPHA = 0.75\r\nPAST_PATH_WIDTH = 5\r\nFUTURE_PATH_ALPHA = 0.75\r\nFUTURE_PATH_WIDTH = 4\r\nTARGET_ALPHA = 1\r\nTARGET_WIDTH = 10\r\nFUTURE_PATH_INTERVAL_DIVISOR = 4\r\nPAST_PATH_INTERVAL_DIVISOR = 2\r\n\r\nCamera = require './Camera'\r\nCocoClass = require 'core/CocoClass'\r\n\r\nmodule.exports = class TrailMaster extends CocoClass\r\n  world: null\r\n\r\n  constructor: (@camera, @layerAdapter) ->\r\n    super()\r\n    @tweenedSprites = []\r\n    @tweens = []\r\n    @listenTo @layerAdapter, 'new-spritesheet', -> @generatePaths(@world, @thang)\r\n\r\n  generatePaths: (@world, @thang) ->\r\n    return if @generatingPaths\r\n    @generatingPaths = true\r\n    @cleanUp()\r\n    @createGraphics()\r\n    pathDisplayObject = new createjs.SpriteContainer(@layerAdapter.spriteSheet)\r\n    pathDisplayObject.mouseEnabled = pathDisplayObject.mouseChildren = false\r\n    pathDisplayObject.addChild @createFuturePath()\r\n#    pathDisplayObject.addChild @createPastPath() # Just made the animated path the full path... do we want to have past and future look different again?\r\n    pathDisplayObject.addChild @createTargets()\r\n    @generatingPaths = false\r\n    return pathDisplayObject\r\n\r\n  cleanUp: ->\r\n    createjs.Tween.removeTweens(sprite) for sprite in @tweenedSprites\r\n    @tweenedSprites = []\r\n    @tweens = []\r\n\r\n  createGraphics: ->\r\n    @targetDotKey = @cachePathDot(TARGET_WIDTH, @colorForThang(@thang.team, TARGET_ALPHA), [0, 0, 0, 1])\r\n    @pastDotKey = @cachePathDot(PAST_PATH_WIDTH, @colorForThang(@thang.team, PAST_PATH_ALPHA), [0, 0, 0, 1])\r\n    @futureDotKey = @cachePathDot(FUTURE_PATH_WIDTH, [255, 255, 255, FUTURE_PATH_ALPHA], @colorForThang(@thang.team, 1))\r\n\r\n  cachePathDot: (width, fillColor, strokeColor) ->\r\n    key = \"path-dot-#{width}-#{fillColor}-#{strokeColor}\"\r\n    fillColor = createjs.Graphics.getRGB(fillColor...)\r\n    strokeColor = createjs.Graphics.getRGB(strokeColor...)\r\n    unless key in @layerAdapter.spriteSheet.getAnimations()\r\n      circle = new createjs.Shape()\r\n      radius = width/2\r\n      circle.graphics.setStrokeStyle(width/5).beginFill(fillColor).beginStroke(strokeColor).drawCircle(0, 0, radius)\r\n      @layerAdapter.addCustomGraphic(key, circle, [-radius*1.5, -radius*1.5, radius*3, radius*3])\r\n    return key\r\n\r\n  colorForThang: (team, alpha=1.0) ->\r\n    rgb = [0, 255, 0]\r\n    rgb = [255, 0, 0] if team is 'humans'\r\n    rgb = [0, 0, 255] if team is 'ogres'\r\n    rgb.push(alpha)\r\n    return rgb\r\n\r\n  createPastPath: ->\r\n    return unless points = @world.pointsForThang @thang.id, @camera\r\n    interval = Math.max(1, parseInt(@world.frameRate / PAST_PATH_INTERVAL_DIVISOR))\r\n    params = { interval: interval, frameKey: @pastDotKey }\r\n    return @createPath(points, params)\r\n\r\n  createFuturePath: ->\r\n    return unless points = @world.pointsForThang @thang.id, @camera\r\n    interval = Math.max(1, parseInt(@world.frameRate / FUTURE_PATH_INTERVAL_DIVISOR))\r\n    params = { interval: interval, animate: true, frameKey: @futureDotKey }\r\n    return @createPath(points, params)\r\n\r\n  createTargets: ->\r\n    return unless @thang.allTargets\r\n    container = new createjs.SpriteContainer(@layerAdapter.spriteSheet)\r\n    for x, i in @thang.allTargets by 2\r\n      y = @thang.allTargets[i + 1]\r\n      sup = @camera.worldToSurface x: x, y: y\r\n      sprite = new createjs.Sprite(@layerAdapter.spriteSheet)\r\n      sprite.scaleX = sprite.scaleY = 1 / @layerAdapter.resolutionFactor\r\n      sprite.scaleY *= @camera.y2x\r\n      sprite.gotoAndStop(@targetDotKey)\r\n      sprite.x = sup.x\r\n      sprite.y = sup.y\r\n      container.addChild(sprite)\r\n    return container\r\n\r\n  createPath: (points, options={}) ->\r\n    options = options or {}\r\n    interval = options.interval or 8\r\n    key = options.frameKey or @pastDotKey\r\n    container = new createjs.SpriteContainer(@layerAdapter.spriteSheet)\r\n\r\n    for x, i in points by interval * 2\r\n      y = points[i + 1]\r\n      sprite = new createjs.Sprite(@layerAdapter.spriteSheet)\r\n      sprite.scaleX = sprite.scaleY = 1 / @layerAdapter.resolutionFactor\r\n      sprite.scaleY *= @camera.y2x\r\n      sprite.gotoAndStop(key)\r\n      sprite.x = x\r\n      sprite.y = y\r\n      container.addChild(sprite)\r\n      if lastSprite and options.animate\r\n        tween = createjs.Tween.get(lastSprite, {loop: true}).to({x:x, y:y}, 1000)\r\n        @tweenedSprites.push lastSprite\r\n        @tweens.push tween\r\n      lastSprite = sprite\r\n\r\n    @logged = true\r\n    container\r\n\r\n  play: ->\r\n    tween.setPaused(false) for tween in @tweens\r\n\r\n  stop: ->\r\n    tween.setPaused(true) for tween in @tweens\r\n\r\n  destroy: ->\r\n    @cleanUp()\r\n    super()\r\n","WIDTH = 20\r\nHEIGHT = 2\r\nEDGE = 0.3\r\n\r\nmodule.exports.createProgressBar = createProgressBar = (color) ->\r\n  g = new createjs.Graphics()\r\n  g.setStrokeStyle(1)\r\n  g.beginFill(createjs.Graphics.getRGB(0, 0, 0))\r\n  g.drawRect(0, -HEIGHT/2, WIDTH, HEIGHT, HEIGHT)\r\n  g.beginFill(createjs.Graphics.getRGB(color...))\r\n  g.drawRoundRect(EDGE, EDGE - HEIGHT/2, WIDTH-EDGE*2, HEIGHT-EDGE*2, HEIGHT-EDGE*2)\r\n  s = new createjs.Shape(g)\r\n  s.z = 100\r\n  s.bounds = [0, -HEIGHT/2, WIDTH, HEIGHT]\r\n  return s\r\n","CocoClass = require 'core/CocoClass'\r\nutils = require 'core/utils'\r\n\r\nmodule.exports = class GoalManager extends CocoClass\r\n  # The Goal Manager is created both on the main thread and\r\n  # each time the world is generated. The one in world generation\r\n  # records which code and world related goals\r\n  # are completed or failed, and then the results are sent back\r\n  # and saved to the main thread instance.\r\n  # The main instance handles goals based on UI notifications,\r\n  # and keeps track of what the goals are at any given point.\r\n\r\n  # Goals can only have only one goal property. Otherwise who knows what will happen.\r\n  # If you want weird goals or hybrid goals, make a custom goal.\r\n\r\n  nextGoalID: 0\r\n  nicks: ['GoalManager']\r\n\r\n  constructor: (@world, @initialGoals, @team, options) ->\r\n    super()\r\n    @options = options or {}\r\n    @init()\r\n\r\n  init: ->\r\n    @goals = []\r\n    @goalStates = {} # goalID -> object (complete, frameCompleted)\r\n    @userCodeMap = {} # @userCodeMap.thangID.methodName.aether.raw = codeString\r\n    @thangTeams = {}\r\n    @initThangTeams()\r\n    @addGoal goal for goal in @initialGoals if @initialGoals\r\n\r\n  initThangTeams: ->\r\n    return unless @world\r\n    for thang in @world.thangs when thang.team and thang.isAttackable\r\n      continue unless thang.team\r\n      @thangTeams[thang.team] = [] unless @thangTeams[thang.team]\r\n      @thangTeams[thang.team].push(thang.id)\r\n\r\n  subscriptions:\r\n    'god:new-world-created': 'onNewWorldCreated'\r\n    'god:new-html-goal-states': 'onNewHTMLGoalStates'\r\n    'level:restarted': 'onLevelRestarted'\r\n\r\n  backgroundSubscriptions:\r\n    'world:thang-died': 'onThangDied'\r\n    'world:thang-touched-goal': 'onThangTouchedGoal'\r\n    'world:thang-left-map': 'onThangLeftMap'\r\n    'world:thang-collected-item': 'onThangCollectedItem'\r\n    'world:user-code-problem': 'onUserCodeProblem'\r\n    'world:lines-of-code-counted': 'onLinesOfCodeCounted'\r\n\r\n  onLevelRestarted: ->\r\n    @goals = []\r\n    @goalStates = {}\r\n    @userCodeMap = {}\r\n    @notifyGoalChanges()\r\n    @addGoal goal for goal in @initialGoals if @initialGoals\r\n\r\n  # INTERFACE AND LIFETIME OVERVIEW\r\n\r\n  # world generator gets current goals from the main instance\r\n  getGoals: -> @goals\r\n\r\n  # background instance created by world generator,\r\n  # gets these goals and code, and is told to be all ears during world gen\r\n  setGoals: (@goals) ->\r\n  setCode: (@userCodeMap) -> @updateCodeGoalStates()\r\n  worldGenerationWillBegin: ->\r\n    @initGoalStates()\r\n    @checkForInitialUserCodeProblems()\r\n\r\n  # World generator feeds world events to the goal manager to keep track\r\n  submitWorldGenerationEvent: (channel, event, frameNumber) ->\r\n    func = @backgroundSubscriptions[channel]\r\n    func = utils.normalizeFunc(func, @)\r\n    return unless func\r\n    func.call(@, event, frameNumber)\r\n\r\n  # after world generation, generated goal states\r\n  # are grabbed to send back to main instance\r\n  worldGenerationEnded: (finalFrame) -> @wrapUpGoalStates(finalFrame)\r\n  getGoalStates: -> @goalStates\r\n\r\n  # main instance gets them and updates their existing goal states,\r\n  # passes the word along\r\n  onNewWorldCreated: (e) ->\r\n    @world = e.world\r\n    @updateGoalStates(e.goalStates) if e.goalStates?\r\n\r\n  onNewHTMLGoalStates: (e) ->\r\n    @updateGoalStates(e.goalStates) if e.goalStates?\r\n\r\n  updateGoalStates: (newGoalStates) ->\r\n    for goalID, goalState of newGoalStates\r\n      continue unless @goalStates[goalID]?\r\n      @goalStates[goalID] = goalState\r\n    @notifyGoalChanges()\r\n\r\n  # IMPLEMENTATION DETAILS\r\n\r\n  addGoal: (goal) ->\r\n    goal = $.extend(true, {}, goal)\r\n    goal.id = @nextGoalID++ if not goal.id\r\n    return if @goalStates[goal.id]?\r\n    @goals.push(goal)\r\n    goal.isPositive = @goalIsPositive goal.id\r\n    @goalStates[goal.id] = {status: 'incomplete', keyFrame: 0, team: goal.team}\r\n    @notifyGoalChanges()\r\n    return unless goal.notificationGoal\r\n    f = (channel) => (event) => @onNote(channel, event)\r\n    channel = goal.notificationGoal.channel\r\n    @addNewSubscription(channel, f(channel))\r\n\r\n  notifyGoalChanges: ->\r\n    return if @options.headless\r\n    overallStatus = @checkOverallStatus()\r\n    event =\r\n      goalStates: @goalStates\r\n      goals: @goals\r\n      overallStatus: overallStatus\r\n      timedOut: @world? and (@world.totalFrames is @world.maxTotalFrames and overallStatus not in ['success', 'failure'])\r\n    Backbone.Mediator.publish('goal-manager:new-goal-states', event)\r\n\r\n  checkOverallStatus: (ignoreIncomplete=false) ->\r\n    overallStatus = null\r\n    goals = if @goalStates then _.values @goalStates else []\r\n    goals = (g for g in goals when not g.optional)\r\n    goals = (g for g in goals when g.team in [undefined, @team]) if @team\r\n    statuses = (goal.status for goal in goals)\r\n    overallStatus = 'success' if statuses.length > 0 and _.every(statuses, (s) -> s is 'success' or (ignoreIncomplete and s is null))\r\n    overallStatus = 'failure' if statuses.length > 0 and 'failure' in statuses\r\n    #console.log 'got overallStatus', overallStatus, 'from goals', goals, 'goalStates', @goalStates, 'statuses', statuses\r\n    overallStatus\r\n\r\n  # WORLD GOAL TRACKING\r\n\r\n  initGoalStates: ->\r\n    @goalStates = {}\r\n    return unless @goals\r\n    for goal in @goals\r\n      state = {\r\n        status: null # should eventually be either 'success', 'failure', or 'incomplete'\r\n        keyFrame: 0 # when it became a 'success' or 'failure'\r\n        team: goal.team\r\n        optional: goal.optional\r\n      }\r\n      @initGoalState(state, [goal.killThangs, goal.saveThangs], 'killed')\r\n      for getTo in goal.getAllToLocations ? []\r\n        @initGoalState(state, [getTo.getToLocation?.who, []], 'arrived')\r\n      for keepFrom in goal.keepAllFromLocations ? []\r\n        @initGoalState(state, [[], keepFrom.keepFromLocation?.who], 'arrived')\r\n      @initGoalState(state, [goal.getToLocations?.who, goal.keepFromLocations?.who], 'arrived')\r\n      @initGoalState(state, [goal.leaveOffSides?.who, goal.keepFromLeavingOffSides?.who], 'left')\r\n      @initGoalState(state, [goal.collectThangs?.targets, goal.keepFromCollectingThangs?.targets], 'collected')\r\n      @initGoalState(state, [goal.codeProblems], 'problems')\r\n      @initGoalState(state, [_.keys(goal.linesOfCode ? {})], 'lines')\r\n      @goalStates[goal.id] = state\r\n\r\n  checkForInitialUserCodeProblems: ->\r\n    # There might have been some user code problems reported before the goal manager started listening.\r\n    return unless @world\r\n    for thang in @world.thangs when thang.isProgrammable\r\n      for message, problem of thang.publishedUserCodeProblems\r\n        @onUserCodeProblem {thang: thang, problem: problem}, 0\r\n\r\n  onThangDied: (e, frameNumber) ->\r\n    for goal in @goals ? []\r\n      @checkKillThangs(goal.id, goal.killThangs, e.thang, frameNumber) if goal.killThangs?\r\n      @checkKillThangs(goal.id, goal.saveThangs, e.thang, frameNumber) if goal.saveThangs?\r\n\r\n  checkKillThangs: (goalID, targets, thang, frameNumber) ->\r\n    return unless thang.id in targets or thang.team in targets\r\n    @updateGoalState(goalID, thang.id, 'killed', frameNumber)\r\n\r\n  onThangTouchedGoal: (e, frameNumber) ->\r\n    for goal in @goals ? []\r\n      @checkArrived(goal.id, goal.getToLocations.who, goal.getToLocations.targets, e.actor, e.touched.id, frameNumber) if goal.getToLocations?\r\n      if goal.getAllToLocations?\r\n        for getTo in goal.getAllToLocations\r\n          @checkArrived(goal.id, getTo.getToLocation.who, getTo.getToLocation.targets, e.actor, e.touched.id, frameNumber)\r\n      @checkArrived(goal.id, goal.keepFromLocations.who, goal.keepFromLocations.targets, e.actor, e.touched.id, frameNumber) if goal.keepFromLocations?\r\n      if goal.keepAllFromLocations?\r\n        for keepFrom in goal.keepAllFromLocations\r\n          @checkArrived(goal.id, keepFrom.keepFromLocation.who , keepFrom.keepFromLocation.targets, e.actor, e.touched.id, frameNumber )\r\n\r\n  checkArrived: (goalID, who, targets, thang, touchedID, frameNumber) ->\r\n    return unless touchedID in targets\r\n    return unless thang.id in who or thang.team in who\r\n    @updateGoalState(goalID, thang.id, 'arrived', frameNumber)\r\n\r\n  onThangLeftMap: (e, frameNumber) ->\r\n    for goal in @goals ? []\r\n      @checkLeft(goal.id, goal.leaveOffSides.who, goal.leaveOffSides.sides, e.thang, e.side, frameNumber) if goal.leaveOffSides?\r\n      @checkLeft(goal.id, goal.keepFromLeavingOffSides.who, goal.keepFromLeavingOffSides.sides, e.thang, e.side, frameNumber) if goal.keepFromLeavingOffSides?\r\n\r\n  checkLeft: (goalID, who, sides, thang, side, frameNumber) ->\r\n    return if sides and side and not (side in sides)\r\n    return unless thang.id in who or thang.team in who\r\n    @updateGoalState(goalID, thang.id, 'left', frameNumber)\r\n\r\n  onThangCollectedItem: (e, frameNumber) ->\r\n    for goal in @goals ? []\r\n      @checkCollected(goal.id, goal.collectThangs.who, goal.collectThangs.targets, e.actor, e.item.id, frameNumber) if goal.collectThangs?\r\n      @checkCollected(goal.id, goal.keepFromCollectingThangs.who, goal.keepFromCollectingThangs.targets, e.actor, e.item.id, frameNumber) if goal.keepFromCollectingThangs?\r\n\r\n  checkCollected: (goalID, who, targets, thang, itemID, frameNumber) ->\r\n    return unless itemID in targets\r\n    return unless thang.id in who or thang.team in who\r\n    @updateGoalState(goalID, itemID, 'collected', frameNumber)\r\n\r\n  onUserCodeProblem: (e, frameNumber) ->\r\n    for goal in @goals ? [] when goal.codeProblems\r\n      @checkCodeProblem goal.id, goal.codeProblems, e.thang, frameNumber\r\n\r\n  checkCodeProblem: (goalID, who, thang, frameNumber) ->\r\n    return unless thang.id in who or thang.team in who\r\n    @updateGoalState goalID, thang.id, 'problems', frameNumber\r\n\r\n  onLinesOfCodeCounted: (e, frameNumber) ->\r\n    for goal in @goals ? [] when goal.linesOfCode\r\n      @checkLinesOfCode goal.id, goal.linesOfCode, e.thang, e.linesUsed, frameNumber\r\n\r\n  checkLinesOfCode: (goalID, who, thang, linesUsed, frameNumber) ->\r\n    return unless linesAllowed = who[thang.id] ? who[thang.team]\r\n    @updateGoalState goalID, thang.id, 'lines', frameNumber if linesUsed > linesAllowed\r\n\r\n  wrapUpGoalStates: (finalFrame) ->\r\n    for goalID, state of @goalStates\r\n      if state.status is null\r\n        if @goalIsPositive(goalID)\r\n          state.status = 'incomplete'\r\n        else\r\n          state.status = 'success'\r\n          state.keyFrame = 'end' # special case for objective UI to handle\r\n\r\n  # UI EVENT GOAL TRACKING\r\n\r\n  onNote: (channel, e) ->\r\n    # TODO for UI event related goals\r\n\r\n  # HELPER FUNCTIONS\r\n\r\n  # It's a pretty similar pattern for each of the above goals.\r\n  # Once you determine a thang has done the thing, you mark it done in the progress object.\r\n  initGoalState: (state, whos, progressObjectName) ->\r\n    # 'whos' is an array of goal 'who' values.\r\n    # This inits the progress object for the goal tracking.\r\n\r\n    arrays = (prop for prop in whos when prop?.length)\r\n    return unless arrays.length\r\n    state[progressObjectName] ?= {}\r\n    for array in arrays\r\n      for thang in array\r\n        if @thangTeams[thang]?\r\n          for t in @thangTeams[thang]\r\n            state[progressObjectName][t] = false\r\n        else\r\n          state[progressObjectName][thang] = false\r\n\r\n  getGoalState: (goalID) ->\r\n    @goalStates[goalID].status\r\n\r\n  setGoalState: (goalID, status) ->\r\n    state = @goalStates[goalID]\r\n    state.status = status\r\n    if overallStatus = @checkOverallStatus true\r\n      matchedGoals = (_.find(@goals, {id: goalID}) for goalID, goalState of @goalStates when goalState.status is overallStatus)\r\n      mostEagerGoal = _.min matchedGoals, 'worldEndsAfter'\r\n      victory = overallStatus is 'success'\r\n      tentative = overallStatus is 'success'\r\n      @world?.endWorld victory, mostEagerGoal.worldEndsAfter, tentative if mostEagerGoal isnt Infinity\r\n\r\n  updateGoalState: (goalID, thangID, progressObjectName, frameNumber) ->\r\n    # A thang has done something related to the goal!\r\n    # Mark it down and update the goal state.\r\n    goal = _.find @goals, {id: goalID}\r\n    state = @goalStates[goalID]\r\n    stateThangs = state[progressObjectName]\r\n    stateThangs[thangID] = true\r\n    success = @goalIsPositive goalID\r\n    if success\r\n      numNeeded = goal.howMany ? Math.max(1, _.size stateThangs)\r\n    else\r\n      # saveThangs: by default we would want to save all the Thangs, which means that we would want none of them to be 'done'\r\n      numNeeded = _.size(stateThangs) - Math.max((goal.howMany ? 1), _.size stateThangs) + 1\r\n    numDone = _.filter(stateThangs).length\r\n    #console.log 'needed', numNeeded, 'done', numDone, 'of total', _.size(stateThangs), 'with how many', goal.howMany, 'and stateThangs', stateThangs, 'for', goalID, thangID, 'on frame', frameNumber, 'all Thangs', _.keys(stateThangs), _.values(stateThangs)\r\n    return unless numDone >= numNeeded\r\n    return if state.status and not success  # already failed it; don't wipe keyframe\r\n    state.status = if success then 'success' else 'failure'\r\n    state.keyFrame = frameNumber\r\n    #console.log goalID, 'became', success, 'on frame', frameNumber, 'with overallStatus', @checkOverallStatus true\r\n    if overallStatus = @checkOverallStatus true\r\n      matchedGoals = (_.find(@goals, {id: goalID}) for goalID, goalState of @goalStates when goalState.status is overallStatus)\r\n      mostEagerGoal = _.min matchedGoals, 'worldEndsAfter'\r\n      victory = overallStatus is 'success'\r\n      tentative = overallStatus is 'success'\r\n      @world?.endWorld victory, mostEagerGoal.worldEndsAfter, tentative if mostEagerGoal isnt Infinity\r\n\r\n  goalIsPositive: (goalID) ->\r\n    # Positive goals are completed when all conditions are true (kill all these thangs)\r\n    # Negative goals fail when any are true (keep all these thangs from being killed)\r\n    goal = _.find(@goals, {id: goalID}) ? {}\r\n    return false for prop of goal when @positiveGoalMap[prop] is 0\r\n    true\r\n\r\n  positiveGoalMap:\r\n    killThangs: 1\r\n    saveThangs: 0\r\n    getToLocations: 1\r\n    getAllToLocations: 1\r\n    keepFromLocations: 0\r\n    keepAllFromLocations: 0\r\n    leaveOffSides: 1\r\n    keepFromLeavingOffSides: 0\r\n    collectThangs: 1\r\n    keepFromCollectingThangs: 0\r\n    linesOfCode: 0\r\n    codeProblems: 0\r\n\r\n  updateCodeGoalStates: ->\r\n    # TODO\r\n\r\n  # teardown\r\n\r\n  destroy: ->\r\n    super()\r\n","# TODO: this thing needs a bit of thinking/testing for grid square alignments, exclusive vs. inclusive mins/maxes, etc.\r\n\r\nmodule.exports = class Grid\r\n  constructor: (thangs, @width, @height, @padding=0, @left=0, @bottom=0, @rogue=false) ->\r\n    @width = Math.ceil @width\r\n    @height = Math.ceil @height\r\n    @left = Math.floor @left\r\n    @bottom = Math.floor @bottom\r\n    @update thangs\r\n\r\n  update: (thangs) ->\r\n    @grid = []\r\n    for y in [0 .. @height]\r\n      @grid.push []\r\n      for x in [0 .. @width]\r\n        @grid[y].push []\r\n    if @rogue\r\n      thangs = (t for t in thangs when t.collides or t.spriteName is 'Gem' and not t.dead)\r\n    else\r\n      thangs = (t for t in thangs when t.collides)\r\n    for thang in thangs\r\n      rect = thang.rectangle()\r\n      [minX, maxX, minY, maxY] = [9001, -9001, 9001, -9001]\r\n      for v in rect.vertices()\r\n        minX = Math.min(minX, v.x - @padding)\r\n        minY = Math.min(minY, v.y - @padding)\r\n        maxX = Math.max(maxX, v.x + @padding)\r\n        maxY = Math.max(maxY, v.y + @padding)\r\n      for y in @columns minY, maxY\r\n        for x in @rows minX, maxX\r\n          @grid[y][x].push thang\r\n\r\n  contents: (gx, gy, width=1, height=1) ->\r\n    thangs = []\r\n    for y in @columns gy - height / 2, gy + height / 2\r\n      for x in @rows gx - width / 2, gx + width / 2\r\n        for thang in @grid[y][x]\r\n          thangs.push thang if thang.collides and not (thang in thangs) and thang.id isnt 'Add Thang Phantom'\r\n    thangs\r\n\r\n  clampColumn: (y) ->\r\n    y = Math.max 0, Math.floor(y) - @bottom\r\n    Math.min @grid.length, Math.ceil(y) - @bottom\r\n\r\n  clampRow: (x) ->\r\n    x = Math.max 0, Math.floor(x) - @left\r\n    Math.min @grid[0]?.length or 0, Math.ceil(x) - @left\r\n\r\n  columns: (minY, maxY) ->\r\n    [@clampColumn(minY) ... @clampColumn(maxY)]\r\n\r\n  rows: (minX, maxX) ->\r\n    [@clampRow(minX) ... @clampRow(maxX)]\r\n\r\n  toString: (rogue=false) ->\r\n    upsideDown = _.clone @grid\r\n    upsideDown.reverse()\r\n    ((@charForThangs thangs, rogue for thangs in row).join(' ') for row in upsideDown).join(\"\\n\")\r\n\r\n  charForThangs: (thangs, rogue) ->\r\n    return thangs.length or ' ' unless rogue\r\n    return '.' unless thangs.length\r\n    return '@' if _.find thangs, (t) -> /Hero Placeholder/.test t.id\r\n    return '>' if _.find thangs, spriteName: 'Spike Walls'\r\n    return 'F' if _.find thangs, spriteName: 'Fence Wall'\r\n    return 'T' if _.find thangs, spriteName: 'Fire Trap'\r\n    return ' ' if _.find thangs, spriteName: 'Dungeon Wall'\r\n    return 'G' if _.find thangs, spriteName: 'Gem'\r\n    return 'C' if _.find thangs, spriteName: 'Treasure Chest'\r\n    return '*' if _.find thangs, spriteName: 'Spear'\r\n    return 'o' if _.find thangs, type: 'munchkin'\r\n    return 'O' if _.find thangs, (t) -> t.team is 'ogres'\r\n    return 'H' if _.find thangs, (t) -> t.team is 'humans'\r\n    return 'N' if _.find thangs, (t) -> t.team is 'neutral'\r\n    return '?'\r\n","# Box2D is defined in global namespace\r\n\r\n# Used to have Box2DJS, but got rid of it.\r\nif Box2D?  # box2dweb, compiled from Flash port: https://code.google.com/p/box2dweb/\r\n  module.exports = box2d =\r\n    b2Vec2: Box2D.Common.Math.b2Vec2\r\n    b2BodyDef: Box2D.Dynamics.b2BodyDef\r\n    b2Body: Box2D.Dynamics.b2Body\r\n    b2FixtureDef: Box2D.Dynamics.b2FixtureDef\r\n    b2Fixture: Box2D.Dynamics.b2Fixture\r\n    b2FilterData: Box2D.Dynamics.b2FilterData\r\n    b2World: Box2D.Dynamics.b2World\r\n    b2ContactListener: Box2D.Dynamics.b2ContactListener\r\n    b2MassData: Box2D.Collision.Shapes.b2MassData\r\n    b2PolygonShape: Box2D.Collision.Shapes.b2PolygonShape\r\n    b2CircleShape: Box2D.Collision.Shapes.b2CircleShape\r\n  window.BOX2D_ENABLED = true\r\nelse  # no Box2D\r\n  module.exports = null\r\n","componentKeywords = ['attach', 'constructor', 'validateArguments', 'toString', 'isComponent']  # Array is faster than object\r\n\r\nmodule.exports = class Component\r\n  @className: 'Component'\r\n  isComponent: true\r\n  constructor: (config) ->\r\n    for key, value of config\r\n      @[key] = value  # Hmm, might want to _.cloneDeep here? What if the config has nested object values and the Thang modifies them, then we re-use the config for, say, missile spawning? Well, for now we'll clone in the missile.\r\n\r\n  attach: (thang) ->\r\n    # Optimize; this is much of the World constructor time\r\n    for key, value of @ when key not in componentKeywords and key[0] isnt '_'\r\n      oldValue = thang[key]\r\n      if typeof oldValue is 'function'\r\n        thang.appendMethod key, value\r\n      else\r\n        thang[key] = value\r\n\r\n  validateArguments:\r\n    additionalProperties: false\r\n\r\n  toString: ->\r\n    \"<Component: #{@constructor.className}\"\r\n","Vector = require './vector'\r\nLineSegment = require './line_segment'\r\nRectangle = require './rectangle'\r\n\r\nclass Ellipse\r\n  @className: \"Ellipse\"\r\n\r\n  # TODO: add class methods for add, multiply, subtract, divide, rotate\r\n\r\n  isEllipse: true\r\n  apiProperties: ['x', 'y', 'width', 'height', 'rotation', 'distanceToPoint', 'distanceSquaredToPoint', 'distanceToRectangle', 'distanceSquaredToRectangle', 'distanceToEllipse', 'distanceSquaredToEllipse', 'distanceToShape', 'distanceSquaredToShape', 'containsPoint', 'intersectsLineSegment', 'intersectsRectangle', 'intersectsEllipse', 'getPos', 'containsPoint', 'copy']\r\n\r\n  constructor: (@x=0, @y=0, @width=0, @height=0, @rotation=0) ->\r\n\r\n  copy: ->\r\n    new Ellipse(@x, @y, @width, @height, @rotation)\r\n\r\n  getPos: ->\r\n    new Vector(@x, @y)\r\n\r\n  rectangle: ->\r\n    new Rectangle(@x, @y, @width, @height, @rotation)\r\n\r\n  axisAlignedBoundingBox: (rounded=true) ->\r\n    @rectangle().axisAlignedBoundingBox()\r\n\r\n  distanceToPoint: (p) ->\r\n    @rectangle().distanceToPoint p  # TODO: actually implement ellipse ellipse-point distance\r\n\r\n  distanceSquaredToPoint: (p) ->\r\n    # Doesn't handle rotation; just supposed to be faster than distanceToPoint.\r\n    @rectangle().distanceSquaredToPoint p  # TODO: actually implement ellipse-point distance\r\n\r\n  distanceToRectangle: (other) ->\r\n    Math.sqrt @distanceSquaredToRectangle other\r\n\r\n  distanceSquaredToRectangle: (other) ->\r\n    @rectangle().distanceSquaredToRectangle other  # TODO: actually implement ellipse-rectangle distance\r\n\r\n  distanceToEllipse: (ellipse) ->\r\n    Math.sqrt @distanceSquaredToEllipse ellipse\r\n\r\n  distanceSquaredToEllipse: (ellipse) ->\r\n    @rectangle().distanceSquaredToEllipse ellipse  # TODO: actually implement ellipse-ellipse distance\r\n\r\n  distanceToShape: (shape) ->\r\n    Math.sqrt @distanceSquaredToShape shape\r\n\r\n  distanceSquaredToShape: (shape) ->\r\n    if shape.isEllipse then @distanceSquaredToEllipse shape else @distanceSquaredToRectangle shape\r\n\r\n  containsPoint: (p, withRotation=true) ->\r\n    # \"ellipse space\" is the cartesian space\r\n    # where the ellipse becomes the unit\r\n    # circle centered at (0, 0)\r\n    [x, y] = [p.x - @x, p.y - @y] # translate point into ellipse space\r\n    if withRotation and @rotation # optionally rotate point into ellipse space\r\n      c = Math.cos(@rotation)\r\n      s = Math.sin(@rotation)\r\n      [x, y] = [x*c + y*s, y*c - x*s]\r\n    x = x / @width * 2 # scale point into ellipse space\r\n    y = y / @height * 2\r\n    x*x + y*y <= 1 #if the resulting point falls on/in the unit circle at 0, 0\r\n\r\n\r\n  intersectsLineSegment: (p1, p2) ->\r\n    [px1, py1, px2, py2] = [p1.x, p1.y, p2.x, p2.y]\r\n    m = (py1 - py2) / (px1 - px2)\r\n    m2 = Math.pow(m, 2)\r\n    c = py1 - (m * px1)\r\n    c2 = Math.pow(c, 2)\r\n    [a, b] = [@width / 2, @height / 2]\r\n    [h, k] = [@x, @y]\r\n    a2 = Math.pow(a, 2)\r\n    a4 = Math.pow(a, 2)\r\n    b2 = Math.pow(b, 2)\r\n    b4 = Math.pow(b, 4)\r\n    h2 = Math.pow(h, 2)\r\n    k2 = Math.pow(k, 2)\r\n    sint = Math.sin(@rotation)\r\n    sin2t = Math.sin(2 * @rotation)\r\n    cost = Math.cos(@rotation)\r\n    cos2t = Math.cos(2 * @rotation)\r\n    if (not isNaN m) and m != Infinity and m != -Infinity\r\n      numeratorLeft = (-a2 * c * m * cos2t) - (a2 * c * m) + (a2 * c * sin2t) - (a2 * h * m * sin2t) - (a2 * h * cos2t) + (a2 * h) + (a2 * k * m * cos2t) + (a2 * k * m) - (a2 * k * sin2t)\r\n      numeratorMiddle = Math.SQRT2 * Math.sqrt((a4 * b2 * m2 * cos2t) + (a4 * b2 * m2) - (2 * a4 * b2 * m * sin2t) - (a4 * b2 * cos2t) + (a4 * b2) - (a2 * b4 * m2 * cos2t) + (a2 * b4 * m2) + (2 * a2 * b4 * m * sin2t) + (a2 * b4 * cos2t) + (a2 * b4) - (2 * a2 * b2 * c2) - (4 * a2 * b2 * c * h * m) + (4 * a2 * b2 * c * k) - (2 * a2 * b2 * h2 * m2) + (4 * a2 * b2 * h * k * m) - (2 * a2 * b2 * k2))\r\n      numeratorRight = (b2 * c * m * cos2t) - (b2 * c * m) - (b2 * c * sin2t) + (b2 * h * m * sin2t) + (b2 * h * cos2t) + (b2 * h) - (b2 * k * m * cos2t) + (b2 * k * m) + (b2 * k * sin2t)\r\n      denominator = (a2 * m2 * cos2t) + (a2 * m2) - (2 * a2 * m * sin2t) - (a2 * cos2t) + a2 - (b2 * m2 * cos2t) + (b2 * m2) + (2 * b2 * m * sin2t) + (b2 * cos2t) + b2\r\n      solution1 = (-numeratorLeft - numeratorMiddle + numeratorRight) / denominator\r\n      solution2 = (-numeratorLeft + numeratorMiddle + numeratorRight) / denominator\r\n      if (not isNaN solution1) and (not isNaN solution2)\r\n        [littleX, bigX] = if px1 < px2 then [px1, px2] else [px2, px1]\r\n        if (littleX <= solution1 and bigX >= solution1) or (littleX <= solution2 and bigX >= solution2)\r\n          return true\r\n      if (not isNaN solution1) or (not isNaN solution2)\r\n        solution = if not isNaN solution1 then solution1 else solution2\r\n        [littleX, bigX] = if px1 < px2 then [px1, px2] else [px2, px1]\r\n        if littleX <= solution and bigX >= solution\r\n          return true\r\n      else\r\n        return false\r\n    else\r\n      x = px1\r\n      x2 = Math.pow(x, 2)\r\n      numeratorLeft = (-a2 * h * sin2t) + (a2 * k * cos2t) + (a2 * k) + (a2 * x * sin2t)\r\n      numeratorMiddle = Math.SQRT2 * Math.sqrt((a4 * b2 * cos2t) + (a4 * b2) - (a2 * b4 * cos2t) + (a2 * b4) - (2 * a2 * b2 * h2) + (4 * a2 * b2 * h * x) - (2 * a2 * b2 * x2))\r\n      numeratorRight = (b2 * h * sin2t) - (b2 * k * cos2t) + (b2 * k) - (b2 * x * sin2t)\r\n      denominator = (a2 * cos2t) + a2 - (b2 * cos2t) + b2\r\n      solution1 = (numeratorLeft - numeratorMiddle + numeratorRight) / denominator\r\n      solution2 = (numeratorLeft + numeratorMiddle + numeratorRight) / denominator\r\n      if (not isNaN solution1) or (not isNaN solution2)\r\n        solution = if not isNaN solution1 then solution1 else solution2\r\n        [littleY, bigY] = if py1 < py2 then [py1, py2] else [py2, py1]\r\n        if littleY <= solution and bigY >= solution\r\n          return true\r\n      else\r\n        return false\r\n    false\r\n\r\n  intersectsRectangle: (rectangle) ->\r\n    rectangle.intersectsEllipse @\r\n\r\n  intersectsEllipse: (ellipse) ->\r\n    @rectangle().intersectsEllipse ellipse  # TODO: actually implement ellipse-ellipse intersection\r\n    #return true if @containsPoint ellipse.getPos()\r\n\r\n  intersectsShape: (shape) ->\r\n    if shape.isEllipse then @intersectsEllipse shape else @intersectsRectangle shape\r\n\r\n  toString: ->\r\n    return \"{x: #{@x.toFixed(0)}, y: #{@y.toFixed(0)}, w: #{@width.toFixed(0)}, h: #{@height.toFixed(0)}, rot: #{@rotation.toFixed(3)}}\"\r\n\r\n  serialize: ->\r\n    {CN: @constructor.className, x: @x, y: @y, w: @width, h: @height, r: @rotation}\r\n\r\n  @deserialize: (o, world, classMap) ->\r\n    new Ellipse o.x, o.y, o.w, o.h, o.r\r\n\r\n  serializeForAether: -> @serialize()\r\n  @deserializeFromAether: (o) -> @deserialize o\r\n\r\nmodule.exports = Ellipse\r\n","Vector = require './vector'\r\n\r\nmodule.exports.ArgumentError = class ArgumentError extends Error\r\n  @className: 'ArgumentError'\r\n  constructor: (@message, @functionName, @argumentName, @intendedType, @actualValue, @numArguments, @hint) ->\r\n    super @message\r\n    @name = 'ArgumentError'\r\n    if Error.captureStackTrace?\r\n      Error.captureStackTrace @, @constructor\r\n\r\n  toString: ->\r\n    s = \"`#{@functionName}`\"\r\n    if @argumentName is 'return'\r\n      s += \"'s return value\"\r\n    else if @argumentName is '_excess'\r\n      s += \" takes only #{@numArguments} argument#{if @numArguments > 1 then 's' else ''}.\"\r\n    else if @argumentName\r\n      s += \"'s argument `#{@argumentName}`\"\r\n    else\r\n      s += ' takes no arguments.'\r\n\r\n    actualType = typeof @actualValue\r\n    if not @actualValue?\r\n      actualType = 'null'\r\n    else if _.isArray @actualValue\r\n      actualType = 'array'\r\n    typeMismatch = @intendedType and not @intendedType.match actualType\r\n    if typeMismatch\r\n      v = ''\r\n      if actualType is 'string'\r\n        v = \"\\\"#{@actualValue}\\\"\"\r\n      else if actualType is 'number'\r\n        if Math.round(@actualValue) is @actualValue then @actualValue else @actualValue.toFixed(2)\r\n      else if actualType is 'boolean'\r\n        v = \"#{@actualValue}\"\r\n      else if (@actualValue? and @actualValue.id and @actualValue.trackedPropertiesKeys)\r\n        # (Don't import Thang, but determine whether it is Thang.)\r\n        v = @actualValue.toString()\r\n      else if @actualValue instanceof Vector\r\n        v = @actualValue.toString()\r\n      showValue = showValue or @actualValue instanceof Vector\r\n      s += \" should have type `#{@intendedType}`, but got `#{actualType}`#{if v then \": `#{v}`\" else ''}.\"\r\n    else if @argumentName and @argumentName isnt '_excess'\r\n      s += ' has a problem.'\r\n    s += '\\n' + @message if @message\r\n    s\r\n","class LineSegment\r\n  @className: \"LineSegment\"\r\n\r\n  constructor: (@a, @b) ->\r\n    @slope = (@a.y - @b.y) / (@a.x - @b.x)\r\n    @y0 = @a.y - (@slope * @a.x)\r\n    @left = if @a.x < @b.x then @a else @b\r\n    @right = if @a.x > @b.x then @a else @b\r\n    @bottom = if @a.y < @b.y then @a else @b\r\n    @top = if @a.y > @b.y then @a else @b\r\n\r\n  y: (x) ->\r\n    (@slope * x) + @y0\r\n\r\n  x: (y) ->\r\n    (y - @y0) / @slope\r\n\r\n  intersectsLineSegment: (lineSegment) ->\r\n    if lineSegment.slope is @slope\r\n      if lineSegment.y0 is @y0\r\n        if lineSegment.left.x is @left.x or lineSegment.left.x is @right.x or lineSegment.right.x is @right.x or lineSegment.right.x is @left.x\r\n          # segments are of the same line with shared start and/or end points\r\n          return true\r\n        else\r\n          [left, right] = if lineSegment.left.x < @left.x then [lineSegment, @] else [@, lineSegment]\r\n          if left.right.x > right.left.x\r\n            # segments are of the same line and one is contained within the other\r\n            return true\r\n    else if Math.abs(@slope) isnt Infinity and Math.abs(lineSegment.slope) isnt Infinity\r\n      x = (lineSegment.y0 - @y0) / (@slope - lineSegment.slope)\r\n      if x >= @left.x and x <= @right.x and x >= lineSegment.left.x and x <= lineSegment.right.x\r\n        return true\r\n    else if Math.abs(@slope) isnt Infinity or Math.abs(lineSegment.slope) isnt Infinity\r\n      [vertical, nonvertical] = if Math.abs(@slope) isnt Infinity then [lineSegment, @] else [@, lineSegment]\r\n      x = vertical.a.x\r\n      bottom = vertical.bottom.y\r\n      top = vertical.top.y\r\n      y = nonvertical.y(x)\r\n      left = nonvertical.left.x\r\n      right = nonvertical.right.x\r\n      if y >= bottom and y <= top and x >= left and x <= right\r\n        return true\r\n    false\r\n\r\n  pointOnLine: (point, segment=true) ->\r\n    if point.y is @y(point.x)\r\n      if segment\r\n        [littleY, bigY] = if @a.y < @b.y then [@a.y, @b.y] else [@b.y, @a.y]\r\n        if littleY <= point.y and bigY >= point.y\r\n          return true\r\n      else\r\n        return true\r\n    false\r\n\r\n  distanceSquaredToPoint: (point) ->\r\n    # http://stackoverflow.com/a/1501725/540620\r\n    return @a.distanceSquared point if @a.equals @b\r\n    res = Math.min point.distanceSquared(@a), point.distanceSquared(@b)\r\n    lineMagnitudeSquared = @a.distanceSquared @b\r\n    t = ((point.x - @a.x) * (@b.x - @a.x) + (point.y - @a.y) * (@b.y - @a.y)) / lineMagnitudeSquared\r\n    return @a.distanceSquared point if t < 0\r\n    return @b.distanceSquared point if t > 1\r\n    point.distanceSquared x: @a.x + t * (@b.x - @a.x), y: @a.y + t * (@b.y - @a.y)\r\n\r\n  distanceToPoint: (point) ->\r\n    Math.sqrt @distanceSquaredToPoint point\r\n\r\n  toString: ->\r\n    \"lineSegment(a=#{@a}, b=#{@b}, slope=#{@slope}, y0=#{@y0}, left=#{@left}, right=#{@right}, bottom=#{@bottom}, top=#{@top})\"\r\n\r\n  serialize: ->\r\n    {CN: @constructor.className, a: @a, b: @b}\r\n\r\n  @deserialize: (o, world, classMap) ->\r\n    new LineSegment o.a, o.b\r\n\r\n  serializeForAether: -> @serialize()\r\n  @deserializeFromAether: (o) -> @deserialize o\r\n\r\nmodule.exports = LineSegment\r\n","module.exports.thangNames = thangNames =\r\n  'Ogre Munchkin F': [\r\n    # Female\r\n    'Alali'\r\n    'Anabel'\r\n    'Delma'\r\n    'Dosha'\r\n    'Gurzunn'\r\n    'Hoot'\r\n    'Inski'\r\n    'Iyert'\r\n    'Lacos'\r\n    'Merna'\r\n    'Palt'\r\n    'Paulark'\r\n    'Pripp'\r\n    'Shmeal'\r\n    'Upfish'\r\n    'Yugark'\r\n    'Shema'\r\n  ]\r\n  'Ogre Munchkin M': [\r\n    # Male\r\n    'Blob'\r\n    'Brack'\r\n    'Cragg'\r\n    'Dobo'\r\n    'Draff'\r\n    'Eugen'\r\n    'Gert'\r\n    'Godel'\r\n    'Goreball'\r\n    'Gordok'\r\n    'Gorylo'\r\n    'Gort'\r\n    'Kog'\r\n    'Kogpole'\r\n    'Kratt'\r\n    'Leerer'\r\n    'Nerph'\r\n    'Oogre'\r\n    'Raack'\r\n    'Ragtime'\r\n    'Raort'\r\n    'Rexxar'\r\n    'Skoggen'\r\n    'Smerk'\r\n    'Snortt'\r\n    'Thabt'\r\n    'Toremon'\r\n    'Treg'\r\n    'Ursa'\r\n    'Vorobun'\r\n    'Weeb'\r\n    'Yart'\r\n    'Zozo'\r\n    'Zock'\r\n  ]\r\n  'Ogre Thrower': [\r\n    # Female\r\n    'Beebatha'\r\n    'Dross'\r\n    'Drumbaa'\r\n    'Durnath'\r\n    'Esha'\r\n    'Gragthar'\r\n    'Grel'\r\n    'Hamedi'\r\n    'Jinjin'\r\n    'Kraggan'\r\n    'Kyrgg'\r\n    'Makas'\r\n    'Moza'\r\n    'Pinakin'\r\n    'Rakash'\r\n    'Rasha'\r\n    'Savatha'\r\n    'Vujii'\r\n    'Wuda'\r\n    'Yetu'\r\n    'Zara'\r\n  ]\r\n  'Griffin Rider': [\r\n    # Female\r\n    'Aeoldan'\r\n    'Bestarius'\r\n    'Cristofide'\r\n    'Denestorath'\r\n    'Letholdus'\r\n    'Loretha'\r\n  ]\r\n  'Paladin': [\r\n    # Female\r\n    'Illumina'\r\n    'Celadia'\r\n    'Taric'\r\n    'Vaelia'\r\n    'Antary'\r\n    'Femae'\r\n  ]\r\n  'Ogre Witch': [\r\n    # Female\r\n    'Vyrryx'\r\n    'Yzzrith'\r\n    'Xith'\r\n  ]\r\n  'Ogre Chieftain': [\r\n    # Female\r\n    'Zagra Ux'\r\n    'Oniko'\r\n  ]\r\n  'Ogre Warlock': [\r\n    # Male\r\n    'Gronak'\r\n    'Sorgoth'\r\n    'Vax'\r\n    'Vyrryx'\r\n    'Vyjj'\r\n  ]\r\n  'Ogre Scout M': [\r\n    # Male\r\n    'Frandar'\r\n    'Karnaugh'\r\n    'Lanthon'\r\n    'Tarjan'\r\n    'Yorgalfen'\r\n  ]\r\n  'Ogre Scout F': [\r\n    # Female\r\n    'Freesa'\r\n    'Ganju'\r\n    'Hopper'\r\n    'Ralthora'\r\n    'Yugorota'\r\n  ]\r\n  'Burl': [\r\n    # Animal\r\n    'Borlit'\r\n    'Burlosh'\r\n    'Dorf'\r\n    'Teemer'\r\n  ]\r\n  'Sand Yak': [\r\n    # Animal\r\n    'Arngotho'\r\n    'Falthror'\r\n    'Girvan'\r\n    'Langthok'\r\n    'Ofgar'\r\n    'Randall'\r\n  ]\r\n  # Pets only have one name\r\n  'Raven Pet': ['Nevermore']\r\n  'Cougar Pet': ['Kitty']\r\n  'Frog Pet': ['Hypnotoad']\r\n  'Griffin Pet': ['']\r\n  'Pugicorn Pet': ['']\r\n  'Polar Bear Pet': ['Klondike']\r\n  'Wolf Pet': ['']\r\n  'Horse': [\r\n    # Animal\r\n    'Abby'\r\n    'Beauty'\r\n    'Cinnamon'\r\n    'Codasus'\r\n    'Ed'\r\n    'Fleetfire'\r\n    'Hurricane'\r\n    'Lovelace'\r\n    'Miracle'\r\n    'Mirial'\r\n    'Powder'\r\n    'Silver'\r\n    'Wildsilver'\r\n  ]\r\n  'Ogre M': [\r\n    # Male\r\n    'Axe Ox'\r\n    'Belch'\r\n    'Booz'\r\n    'Brusentsov'\r\n    'Demonik'\r\n    'Dronck'\r\n    'Gorlog'\r\n    'Grumus'\r\n    'Gug'\r\n    'Gurulax'\r\n    'Krogg'\r\n    'Kulgor'\r\n    'Mak Fod'\r\n    'Mokrul'\r\n    'Muthyala'\r\n    'Oni'\r\n    'Polifemo'\r\n    'Saltporker'\r\n    'Skrungt'\r\n    'Steve'\r\n    'Stinker'\r\n    'Tarlok'\r\n    'Trogdor'\r\n    'Trung'\r\n    'Vargutt'\r\n    'Vyle'\r\n  ]\r\n  'Ogre F': [\r\n    # Female\r\n    'Alkaz'\r\n    'Gar\\'ah'\r\n    'Glonc'\r\n    'Holkam'\r\n    'Kriskull'\r\n    'Mak\\'rah'\r\n    'Marghurk'\r\n    'Marnag'\r\n    'Martha'\r\n    'Morthrug'\r\n    'Nareng'\r\n    'Maleda'\r\n  ]\r\n  'Ogre Brawler': [\r\n    # Male\r\n    'Arelt'\r\n    'Borgag'\r\n    'Boz'\r\n    'Burobb'\r\n    'Dijkstro'\r\n    'Grognar'\r\n    'Grul\\'thock'\r\n    'Grumoll'\r\n    'Haggar'\r\n    'Heizenburg'\r\n    'Ironjaw'\r\n    'Mokuhr'\r\n    'Muul'\r\n    'Ork\\'han'\r\n    'Roast Beefy'\r\n    'Toharg'\r\n    'Trod'\r\n    'Tuguro'\r\n    'Turrok'\r\n    'York'\r\n    'Zabarek'\r\n    'Zagurk'\r\n    'Zeredd'\r\n  ]\r\n  'Ogre Fangrider': [\r\n    # Female\r\n    'Arizard'\r\n    'Bortrok'\r\n    'Boruvka'\r\n    'Doralt'\r\n    'Dreek'\r\n    'Flarsho'\r\n    'Geggret'\r\n    'Gurzthrot'\r\n    'Mizzy'\r\n    'Morzgret'\r\n    'Murgark'\r\n    'Muttin'\r\n    'Secka'\r\n  ]\r\n  'Ogre Shaman': [\r\n    # Female\r\n    'Ahst\\'durante'\r\n    'Aolian\\'Tak'\r\n    'Drun'\r\n    'Ghuk'\r\n    'Gogg'\r\n    'Gom'\r\n    'Grek'\r\n    'Gror'\r\n    'Grue'\r\n    'Il\\'Du\\'duka'\r\n    'Makas'\r\n    'Mogadishu'\r\n    'Nazgareth'\r\n    'Poult'\r\n    'Sham\\'uk'\r\n    'Torluk'\r\n    'Turann'\r\n    'Tuzang'\r\n    'Tuzell'\r\n    'Ugoki'\r\n    'Uld\\'Mak'\r\n    'Varreth'\r\n    'Yamizeb'\r\n    'Yerong'\r\n    'Yugargen'\r\n    'Zo\\'Goroth'\r\n    'Zulabar'\r\n  ]\r\n  'Skeleton': [\r\n    # Both\r\n    'Bloody Johnny'\r\n    'Bone Daddy'\r\n    'Bonejangles'\r\n    'Bonesworth'\r\n    'Bonette'\r\n    'Boneus'\r\n    'Doornail'\r\n    'Drybones'\r\n    'Grim'\r\n    'Haskell'\r\n    'Indiana Bones'\r\n    'James Bone'\r\n    'Kate'\r\n    'Palatine'\r\n    'Ribster'\r\n    'Rusty'\r\n    'Sacra'\r\n    'Scraps'\r\n    'Shelly'\r\n    'Shishka-Bob'\r\n    'Shishka-Joe'\r\n    'Shishka-Larry'\r\n    'Skeletor'\r\n    'Skellington'\r\n    'Skulldugger'\r\n    'Skully'\r\n    'Smitty'\r\n    'Sphenoid'\r\n    'Sternum'\r\n    'Talus'\r\n    'Tatava'\r\n    'Ulna'\r\n    'Yorick'\r\n  ]\r\n  'Ogre Headhunter': [\r\n    # Male\r\n    'Bob'\r\n    'Deadtooth'\r\n    'Ez the Cruel'\r\n    'Grroq'\r\n    'Mog'\r\n    'Mogvar'\r\n    'Ral\\'thuk'\r\n    'Soth'\r\n    'Ulxx'\r\n    'Ur'\r\n    'Veznyr'\r\n    'Warlegs'\r\n    'Xul Gor'\r\n  ]\r\n  'Trapper': [\r\n    # Male\r\n    'Senick'\r\n    'John'\r\n    'Kyle'\r\n  ]\r\n  'Forest Archer': [\r\n    # Female\r\n    'Naria'\r\n    'Sylva'\r\n    'Archia'\r\n  ]\r\n  'Raider': [\r\n    # Female\r\n    'Arryn'\r\n    'Thrat'\r\n  ]\r\n  'Goliath': [\r\n    # Male\r\n    'Okar'\r\n    'Ivan'\r\n  ]\r\n  'Guardian': [\r\n    # Female\r\n    'Illia'\r\n    'Gaia'\r\n  ]\r\n  'Pixie': [\r\n    # Female\r\n    'Zana'\r\n    'Eika'\r\n  ]\r\n  'Assassin': [\r\n    # Male\r\n    'Blackjack'\r\n    'Kha\\'Zix'\r\n    'Ritic'\r\n    'Rengar'\r\n    'Shade'\r\n    'Talon'\r\n    'Zed'\r\n    'Sherkey'\r\n  ]\r\n  'Necromancer': [\r\n    # Male\r\n    'Krekai'\r\n    'Kethum'\r\n    'Morcelu'\r\n    'Nalfar'\r\n    'Drezhul'\r\n  ]\r\n  'Master Wizard': [\r\n    # Female\r\n    'Lilith'\r\n    'Kuhafas'\r\n    'Usara'\r\n    'Veigar'\r\n    'Voldemort'\r\n    'Vallyria'\r\n  ]\r\n  'Archer F': [\r\n    # Female\r\n    'Agapi'\r\n    'Alden'\r\n    'Alleria'\r\n    'Atalanta'\r\n    'Artemis'\r\n    'Beatrice'\r\n    'Bachi'\r\n    'Beverly'\r\n    'Cairn'\r\n    'Cecily'\r\n    'Clare'\r\n    'Erica'\r\n    'Gemma'\r\n    'Ivy'\r\n    'Jensen'\r\n    'Katniss'\r\n    'Katreena'\r\n    'Keturah'\r\n    'Kim'\r\n    'Korra'\r\n    'Lina'\r\n    'Luna'\r\n    'Mercedes'\r\n    'Mira'\r\n    'Mirana'\r\n    'Natalie'\r\n    'Odette'\r\n    'Omar'\r\n    'Orly'\r\n    'Phoebe'\r\n    'Prim'\r\n    'Rosaline'\r\n    'Rowan'\r\n    'Tansy'\r\n    'Tauriel'\r\n    'Vereesa'\r\n    'Vesper'\r\n    'Yilitha'\r\n  ]\r\n  'Archer M': [\r\n    # Male\r\n    'Arty'\r\n    'Brian'\r\n    'Cole'\r\n    'Denin'\r\n    'Dev'\r\n    'Fidsdale'\r\n    'Gimsley'\r\n    'Hunter'\r\n    'Kikariy'\r\n    'Legolas'\r\n    'Loco'\r\n    'Logos'\r\n    'Lycan'\r\n    'Mars'\r\n    'Odysseos'\r\n    'Oliver'\r\n    'Quinn'\r\n    'Robin'\r\n    'Roman'\r\n    'Simon'\r\n    'Slyvos'\r\n    'Vican'\r\n    'Warshall'\r\n    'Yue Fei'\r\n    'Zhou Tong'\r\n    'Archy'\r\n  ]\r\n  'Peasant M': [\r\n    # Male\r\n    'Azgot'\r\n    'Brom'\r\n    'Blemmin'\r\n    'Carlton'\r\n    'Charles'\r\n    'Durfkor'\r\n    'Duan'\r\n    'Fendrel'\r\n    'Gawain'\r\n    'Hamming'\r\n    'Hector'\r\n    'Hershell'\r\n    'Hingle'\r\n    'Hodor'\r\n    'Jackson'\r\n    'James'\r\n    'Lyle'\r\n    'Merek'\r\n    'Paps'\r\n    'Piers'\r\n    'Shimron'\r\n    'Thad'\r\n    'Tybalt'\r\n    'Victor'\r\n    'Winkler'\r\n    'Yorik'\r\n    'Yusef'\r\n    'Yoltovic'\r\n  ]\r\n  'Peasant F': [\r\n    # Female\r\n    'Alexia'\r\n    'Alianor'\r\n    'Anastas'\r\n    'Bernadette'\r\n    'Brandy'\r\n    'Cristiana'\r\n    'Ellyn'\r\n    'Giselle'\r\n    'Gwendolin'\r\n    'Helena'\r\n    'Hilda'\r\n    'Icey'\r\n    'Katelyn'\r\n    'Mary'\r\n    'Matilda'\r\n    'Mertia'\r\n    'Millicent'\r\n    'Regan'\r\n    'Rose'\r\n    'Ruth'\r\n    'Tabitha'\r\n    'Thea'\r\n    'Lea'\r\n  ]\r\n  'Soldier M': [\r\n    # Male\r\n    'Aaron'\r\n    'Adam'\r\n    'Addison'\r\n    'Alan'\r\n    'Albert'\r\n    'Alistair'\r\n    'Andrew'\r\n    'Anthony'\r\n    'Antonio'\r\n    'Arthur'\r\n    'Augustus'\r\n    'Barron'\r\n    'Benjamin'\r\n    'Bill'\r\n    'Billy'\r\n    'Bobby'\r\n    'Bond'\r\n    'Brandon'\r\n    'Brian'\r\n    'Bruce'\r\n    'Carl'\r\n    'Carlos'\r\n    'Cecil'\r\n    'Charles'\r\n    'Chris'\r\n    'Christopher'\r\n    'Cid'\r\n    'Clarence'\r\n    'Craig'\r\n    'Daniel'\r\n    'Darius'\r\n    'David'\r\n    'Dax'\r\n    'Dennis'\r\n    'Donald'\r\n    'Douglas'\r\n    'Duke'\r\n    'Earl'\r\n    'Edward'\r\n    'Edwin'\r\n    'Eric'\r\n    'Ernest'\r\n    'Eugene'\r\n    'Ezra'\r\n    'Felix'\r\n    'Ferb'\r\n    'Frank'\r\n    'Fred'\r\n    'Gary'\r\n    'Gatsby'\r\n    'George'\r\n    'Gerald'\r\n    'Gordon'\r\n    'Gregory'\r\n    'Guan Yu'\r\n    'Halle'\r\n    'Harold'\r\n    'Harry'\r\n    'Henry'\r\n    'Hirium'\r\n    'Howard'\r\n    'Huburt'\r\n    'Hugo'\r\n    'Ieyasu'\r\n    'Jack'\r\n    'Jackson'\r\n    'James'\r\n    'Jason'\r\n    'Jax'\r\n    'Jeffrey'\r\n    'Jeremy'\r\n    'Jerry'\r\n    'Jesse'\r\n    'Jimmy'\r\n    'Joe'\r\n    'John'\r\n    'Johnny'\r\n    'Jonah'\r\n    'Jonathan'\r\n    'Jose'\r\n    'Joseph'\r\n    'Joshua'\r\n    'Juan'\r\n    'Jun Fan'\r\n    'Justin'\r\n    'Keith'\r\n    'Kenneth'\r\n    'Kevin'\r\n    'Kirin'\r\n    'Kumar'\r\n    'Larry'\r\n    'Lawrence'\r\n    'Leopold'\r\n    'Louis'\r\n    'Lucas'\r\n    'Lucian'\r\n    'Malcolm'\r\n    'Marcus'\r\n    'Mark'\r\n    'Martin'\r\n    'Matthew'\r\n    'Max'\r\n    'Maxwell'\r\n    'Michael'\r\n    'Miles'\r\n    'Mischa'\r\n    'Musashi'\r\n    'Nicholas'\r\n    'Nick'\r\n    'Noah'\r\n    'Orion'\r\n    'Parker'\r\n    'Patrick'\r\n    'Paul'\r\n    'Peter'\r\n    'Philip'\r\n    'Philippian'\r\n    'Phillip'\r\n    'Phineas'\r\n    'Pierce'\r\n    'Ralph'\r\n    'Randy'\r\n    'Raymond'\r\n    'Remy'\r\n    'Rex'\r\n    'Ricardo'\r\n    'Richard'\r\n    'Robert'\r\n    'Roderick'\r\n    'Roger'\r\n    'Ronald'\r\n    'Ronan'\r\n    'Roy'\r\n    'Russell'\r\n    'Ryan'\r\n    'Sage'\r\n    'Samson'\r\n    'Samuel'\r\n    'Scott'\r\n    'Sean'\r\n    'Shawn'\r\n    'Silas'\r\n    'Stephen'\r\n    'Sterling'\r\n    'Steve'\r\n    'Steven'\r\n    'Stormy'\r\n    'Tadakatsu'\r\n    'Terry'\r\n    'Thelonious'\r\n    'Theo'\r\n    'Thomas'\r\n    'Timothy'\r\n    'Todd'\r\n    'Tryndamere'\r\n    'Tyrone'\r\n    'Victor'\r\n    'Walter'\r\n    'Wayne'\r\n    'William'\r\n    'Willie'\r\n    'Zachary'\r\n  ]\r\n  'Soldier F': [\r\n    # Female\r\n    'Ahri'\r\n    'Alana'\r\n    'Alexandra'\r\n    'Alice'\r\n    'Allankrita'\r\n    'Amanda'\r\n    'Amy'\r\n    'Andrea'\r\n    'Angela'\r\n    'Ann'\r\n    'Anna'\r\n    'Anne'\r\n    'Annie'\r\n    'Ann-Maria'\r\n    'Aphrodite'\r\n    'Ashley'\r\n    'Barbara'\r\n    'Betty'\r\n    'Beverly'\r\n    'Bonnie'\r\n    'Brenda'\r\n    'Buffy'\r\n    'Carol'\r\n    'Carolyn'\r\n    'Catherine'\r\n    'Cheryl'\r\n    'Christina'\r\n    'Christine'\r\n    'Coco'\r\n    'Cynthia'\r\n    'Deborah'\r\n    'Debra'\r\n    'Denise'\r\n    'Diana'\r\n    'Diane'\r\n    'Donna'\r\n    'Doris'\r\n    'Dorothy'\r\n    'Elizabeth'\r\n    'Emma'\r\n    'Emily'\r\n    'Evelyn'\r\n    'Fiora'\r\n    'Frances'\r\n    'Gabrielle'\r\n    'Gloria'\r\n    'Gorgin'\r\n    'Heather'\r\n    'Helen'\r\n    'Helga'\r\n    'Holly'\r\n    'Imani'\r\n    'Irene'\r\n    'Jacqueline'\r\n    'Jane'\r\n    'Janet'\r\n    'Janice'\r\n    'Jean'\r\n    'Jennifer'\r\n    'Jessica'\r\n    'Joan'\r\n    'Jordan'\r\n    'Joyce'\r\n    'Judith'\r\n    'Judy'\r\n    'Julia'\r\n    'Julie'\r\n    'Karen'\r\n    'Katherine'\r\n    'Kathleen'\r\n    'Kathryn'\r\n    'Kathy'\r\n    'Kay'\r\n    'Kelly'\r\n    'Kimberly'\r\n    'Kira'\r\n    'Lana'\r\n    'Laura'\r\n    'Lillian'\r\n    'Linda'\r\n    'Lisa'\r\n    'Lois'\r\n    'Lori'\r\n    'Louise'\r\n    'Lukaz'\r\n    'Margaret'\r\n    'Maria'\r\n    'Mariah'\r\n    'Marie'\r\n    'Marilyn'\r\n    'Martha'\r\n    'Mary'\r\n    'Medusa'\r\n    'Melissa'\r\n    'Michelle'\r\n    'Mildred'\r\n    'Mulan'\r\n    'Nancy'\r\n    'Natasha'\r\n    'Nicole'\r\n    'Nikita'\r\n    'Norma'\r\n    'Pamela'\r\n    'Patricia'\r\n    'Paula'\r\n    'Phyllis'\r\n    'Rachel'\r\n    'Rebecca'\r\n    'Robin'\r\n    'Ronda'\r\n    'Rose'\r\n    'Ruby'\r\n    'Ruth'\r\n    'Sana'\r\n    'Sandra'\r\n    'Sara'\r\n    'Sarah'\r\n    'Scarlett'\r\n    'Shannon'\r\n    'Sharon'\r\n    'Shirley'\r\n    'Stephanie'\r\n    'Susan'\r\n    'Tammy'\r\n    'Teresa'\r\n    'Tess'\r\n    'Theresa'\r\n    'Tina'\r\n    'Trinity'\r\n    'Virginia'\r\n    'Wanda'\r\n  ]\r\n  'Ogre Peon M': [\r\n    # Male\r\n    'Ba Bo'\r\n    'Bubbage'\r\n    'Durbo'\r\n    'Jaro'\r\n    'Kurger'\r\n    'Mudwich'\r\n    'Toe Pod'\r\n    'Zugger'\r\n  ]\r\n  'Ogre Peon F': [\r\n    # Female\r\n    'Greeke'\r\n    'Iblet'\r\n    'Lorba'\r\n    'Vapa'\r\n    'Yamra'\r\n    'Zzoya'\r\n  ]\r\n  'Potion Master': [\r\n    # Male\r\n    'Amaranth'\r\n    'Alchemist'\r\n    'Arora'\r\n    'Artephius'\r\n    'Clause'\r\n    'Curie'\r\n    'Fluvius'\r\n    'Javin'\r\n    'Kanada'\r\n    'Omar'\r\n    'Paracelsus'\r\n    'Snake'\r\n    'Vanders'\r\n    'Warnsdorff'\r\n    'Zander'\r\n  ]\r\n  'Librarian': [\r\n    # Female\r\n    'Agathe'\r\n    'Agnes'\r\n    'Hushbaum'\r\n    'Mariam'\r\n    'Matilda'\r\n    'Merilda'\r\n    'Nordex'\r\n    'Satish'\r\n    'Vera'\r\n    'Charlotte'\r\n  ]\r\n  'Equestrian': [\r\n    # Male\r\n    'Neely'\r\n    'Reynaldo'\r\n    'Ryder'\r\n    'Thoron'\r\n  ]\r\n  'Knight': [\r\n    # Male\r\n    'Almeric'\r\n    'Alphonse'\r\n    'Altair'\r\n    'Arthur'\r\n    'Bertrand'\r\n    'Bronn'\r\n    'Bruce'\r\n    'Drake'\r\n    'Duran'\r\n    'Edward'\r\n    'Galahad'\r\n    'Hank'\r\n    'Hunfray'\r\n    'Jeph'\r\n    'Jorah'\r\n    'Lancelot'\r\n    'Mace'\r\n    'Neville'\r\n    'Shug'\r\n    'Tharin'\r\n    'Vint'\r\n    'Wain'\r\n  ]\r\n  'Captain': [\r\n    # Female\r\n    'Anya'\r\n    'Brigette'\r\n    'Dimia'\r\n    'Div'\r\n    'Hardcastle'\r\n    'Helena'\r\n    'Isa'\r\n    'Jan'\r\n    'Jane'\r\n    'Jarin'\r\n    'Karp'\r\n    'Katana'\r\n    'Leona'\r\n    'Lia'\r\n    'Lily'\r\n    'Nicks'\r\n    'Philips'\r\n    'Sarre'\r\n    'Sun Tzu'\r\n  ]\r\n  'Ninja': [\r\n    # Female\r\n    'Akali'\r\n    'Amara'\r\n    'Goemon'\r\n    'Itachi'\r\n    'Kennen'\r\n    'Kosaraju'\r\n    'Madara'\r\n    'Minato'\r\n    'Naruto'\r\n    'Obito'\r\n    'Sakura'\r\n    'Sasuke'\r\n    'Shen'\r\n    'Shigeru'\r\n    'Takashi'\r\n    'Zed'\r\n  ]\r\n  'Sorcerer': [\r\n    # Female\r\n    'Beazer'\r\n    'Claude'\r\n    'Gandalf'\r\n    'Izzrts'\r\n    'Kleene'\r\n    'Pender'\r\n    'Jezebel'\r\n  ]\r\n  'Samurai': [\r\n    # Male\r\n    'Hattori'\r\n    'Hirosha'\r\n    'Ieyasu'\r\n    'Izotokogawa'\r\n    'Keitaro'\r\n    'Miyoshi'\r\n    'Nobunaga'\r\n    'Yasuo'\r\n    'Yi'\r\n  ]\r\n  'Champion': [\r\n    # Female\r\n    'Ida'\r\n    'Jasmine'\r\n  ]\r\n  'Duelist': [\r\n    # Male\r\n    'Alejandro'\r\n  ]\r\n","# http://coffeescriptcookbook.com/chapters/math/generating-predictable-random-numbers\r\nclass Rand\r\n  @className: 'Rand'\r\n  # If created without a seed, uses current time as seed.\r\n  constructor: (@seed) ->\r\n    # Knuth and Lewis' improvements to Park and Miller's LCPRNG\r\n    @multiplier = 1664525\r\n    @modulo = 4294967296 # 2**32-1\r\n    @offset = 1013904223\r\n    unless @seed? and 0 <= @seed < @modulo\r\n      @seed = (new Date().valueOf() * new Date().getMilliseconds()) % @modulo\r\n\r\n  # sets new seed value, even handling negative numbers\r\n  setSeed: (seed) ->\r\n    @seed = ((seed % @modulo) + @modulo) % @modulo\r\n\r\n  # return a random integer 0 <= n < @modulo\r\n  randn: =>\r\n    # new_seed = (a * seed + c) % m\r\n    @seed = (@multiplier * @seed + @offset) % @modulo\r\n\r\n # return a random float 0 <= f < 1.0\r\n  randf: =>\r\n    @randn() / @modulo\r\n\r\n  # return a random int 0 <= f < n\r\n  rand: (n) =>\r\n    Math.floor @randf() * n\r\n\r\n  # return a random int min <= f < max\r\n  rand2: (min, max) =>\r\n    min + @rand max - min\r\n\r\n  # return a random float min <= f < max\r\n  randf2: (min, max) =>\r\n    min + @randf() * (max - min)\r\n\r\n  # return a random float within range around x\r\n  randfRange: (x, range) =>\r\n    x + (-0.5 + @randf()) * range\r\n\r\n  # shuffle array in place, and also return it\r\n  shuffle: (arr) =>\r\n    return arr unless arr.length > 2\r\n    for i in [arr.length-1 .. 1]\r\n      j = Math.floor @randf() * (i + 1)\r\n      t = arr[j]\r\n      arr[j] = arr[i]\r\n      arr[i] = t\r\n    arr\r\n  \r\n  choice: (arr) =>\r\n    return arr[@rand arr.length]\r\n\r\n\r\nmodule.exports = Rand\r\n","Vector = require './vector'\r\nLineSegment = require './line_segment'\r\n\r\nclass Rectangle\r\n  @className: 'Rectangle'\r\n  # Class methods for nondestructively operating - TODO: add rotate\r\n  for name in ['add', 'subtract', 'multiply', 'divide']\r\n    do (name) ->\r\n      Rectangle[name] = (a, b) ->\r\n        a.copy()[name](b)\r\n\r\n  isRectangle: true\r\n  apiProperties: ['x', 'y', 'width', 'height', 'rotation', 'getPos', 'vertices', 'touchesRect', 'touchesPoint', 'distanceToPoint', 'distanceSquaredToPoint', 'distanceToRectangle', 'distanceSquaredToRectangle', 'distanceToEllipse', 'distanceSquaredToEllipse', 'distanceToShape', 'distanceSquaredToShape', 'containsPoint', 'copy', 'intersectsLineSegment', 'intersectsEllipse', 'intersectsRectangle', 'intersectsShape']\r\n\r\n  constructor: (@x=0, @y=0, @width=0, @height=0, @rotation=0) ->\r\n\r\n  copy: ->\r\n    new Rectangle(@x, @y, @width, @height, @rotation)\r\n\r\n  getPos: ->\r\n    new Vector(@x, @y)\r\n\r\n  vertices: ->\r\n    # Counter-clockwise, starting from bottom left (when unrotated)\r\n    [w2, h2, cos, sin] = [@width / 2, @height / 2, Math.cos(@rotation), Math.sin(-@rotation)]\r\n    [\r\n      new Vector @x - (w2 * cos - h2 * sin), @y - (w2 * sin + h2 * cos)\r\n      new Vector @x - (w2 * cos + h2 * sin), @y - (w2 * sin - h2 * cos)\r\n      new Vector @x + (w2 * cos - h2 * sin), @y + (w2 * sin + h2 * cos)\r\n      new Vector @x + (w2 * cos + h2 * sin), @y + (w2 * sin - h2 * cos)\r\n    ]\r\n\r\n  lineSegments: ->\r\n    vertices = @vertices()\r\n    lineSegment0 = new LineSegment vertices[0], vertices[1]\r\n    lineSegment1 = new LineSegment vertices[1], vertices[2]\r\n    lineSegment2 = new LineSegment vertices[2], vertices[3]\r\n    lineSegment3 = new LineSegment vertices[3], vertices[0]\r\n    [lineSegment0, lineSegment1, lineSegment2, lineSegment3]\r\n\r\n  touchesRect: (other) ->\r\n    # Whether this rect shares part of any edge with other rect, for non-rotated, non-overlapping rectangles.\r\n    # I think it says kitty-corner rects touch, but I don't think I want that.\r\n    # Float instability might get me, too.\r\n    [bl1, tl1, tr1, br1] = @vertices()\r\n    [bl2, tl2, tr2, br2] = other.vertices()\r\n    return false if tl1.x > tr2.x or tl2.x > tr1.x\r\n    return false if bl1.y > tl2.y or bl2.y > tl1.y\r\n    return true if tl1.x is tr2.x or tl2.x is tr1.x\r\n    return true if tl1.y is bl2.y or tl2.y is bl1.y\r\n    false\r\n\r\n  touchesPoint: (p) ->\r\n    # Whether this rect has point p exactly on one of its edges, assuming no rotation.\r\n    [bl, tl, tr, br] = @vertices()\r\n    return false unless p.y >= bl.y and p.y <= tl.y\r\n    return false unless p.x >= bl.x and p.x <= br.x\r\n    return true if p.x is bl.x or p.x is br.x\r\n    return true if p.y is bl.y or p.y is tl.y\r\n    false\r\n\r\n  axisAlignedBoundingBox: (rounded=true) ->\r\n    box = @copy()\r\n    return box unless @rotation\r\n    box.rotation = 0\r\n    [left, top] = [9001, 9001]\r\n    for vertex in @vertices()\r\n      [left, top] = [Math.min(left, vertex.x), Math.min(top, vertex.y)]\r\n    if rounded\r\n      [left, top] = [Math.round(left), Math.round(top)]\r\n    [box.width, box.height] = [2 * (@x - left), 2 * (@y - top)]\r\n    box\r\n\r\n  distanceToPoint: (p) ->\r\n    # Get p in rect's coordinate space, then operate in one quadrant.\r\n    p = Vector.subtract(p, @getPos()).rotate(-@rotation)\r\n    dx = Math.max(Math.abs(p.x) - @width / 2, 0)\r\n    dy = Math.max(Math.abs(p.y) - @height / 2, 0)\r\n    Math.sqrt dx * dx + dy * dy\r\n\r\n  distanceSquaredToPoint: (p) ->\r\n    # Doesn't handle rotation; just supposed to be faster than distanceToPoint.\r\n    p = Vector.subtract(p, @getPos())\r\n    dx = Math.max(Math.abs(p.x) - @width / 2, 0)\r\n    dy = Math.max(Math.abs(p.y) - @height / 2, 0)\r\n    dx * dx + dy * dy\r\n\r\n  distanceToRectangle: (other) ->\r\n    Math.sqrt @distanceSquaredToRectangle other\r\n\r\n  distanceSquaredToRectangle: (other) ->\r\n    return 0 if @intersectsRectangle other\r\n    [firstVertices, secondVertices] = [@vertices(), other.vertices()]\r\n    [firstEdges, secondEdges] = [@lineSegments(), other.lineSegments()]\r\n    ans = Infinity\r\n    for i in [0 ... 4]\r\n      for j in [0 ... firstEdges.length]\r\n        ans = Math.min ans, firstEdges[j].distanceSquaredToPoint(secondVertices[i])\r\n      for j in [0 ... secondEdges.length]\r\n        ans = Math.min ans, secondEdges[j].distanceSquaredToPoint(firstVertices[i])\r\n    ans\r\n\r\n  distanceToEllipse: (ellipse) ->\r\n    Math.sqrt @distanceSquaredToEllipse ellipse\r\n\r\n  distanceSquaredToEllipse: (ellipse) ->\r\n    @distanceSquaredToRectangle ellipse.rectangle()  # TODO: actually implement rectangle-ellipse distance\r\n\r\n  distanceToShape: (shape) ->\r\n    Math.sqrt @distanceSquaredToShape shape\r\n\r\n  distanceSquaredToShape: (shape) ->\r\n    if shape.isEllipse then @distanceSquaredToEllipse shape else @distanceSquaredToRectangle shape\r\n\r\n  containsPoint: (p, withRotation=true) ->\r\n    if withRotation and @rotation\r\n      not @distanceToPoint(p)\r\n    else\r\n      @x - @width / 2 < p.x < @x + @width / 2 and @y - @height / 2 < p.y < @y + @height / 2\r\n\r\n  intersectsLineSegment: (p1, p2) ->\r\n    [px1, py1, px2, py2] = [p1.x, p1.y, p2.x, p2.y]\r\n    m1 = (py1 - py2) / (px1 - px2)\r\n    b1 = py1 - (m1 * px1)\r\n    vertices = @vertices()\r\n    lineSegments = [[vertices[0], vertices[1]], [vertices[1], vertices[2]], [vertices[2], vertices[3]], [vertices[3], vertices[0]]]\r\n    for lineSegment in lineSegments\r\n      [px1, py1, px2, py2] = [p1.x, p1.y, p2.x, p2.y]\r\n      m2 = (py1 - py2) / (px1 - px2)\r\n      b2 = py1 - (m * px1)\r\n      if m1 isnt m2\r\n        m = m1 - m2\r\n        b = b2 - b1\r\n        x = b / m\r\n        [littleX, bigX] = if px1 < px2 then [px1, px2] else [px2, px1]\r\n        if x >= littleX and x <= bigX\r\n          y = (m1 * x) + b1\r\n          [littleY, bigY] = if py1 < py2 then [py1, py2] else [py2, py1]\r\n          if littleY <= solution and bigY >= solution\r\n            return true\r\n    false\r\n\r\n  intersectsRectangle: (rectangle) ->\r\n    return true if @containsPoint rectangle.getPos()\r\n    for thisLineSegment in @lineSegments()\r\n      for thatLineSegment in rectangle.lineSegments()\r\n        if thisLineSegment.intersectsLineSegment(thatLineSegment)\r\n          return true\r\n    false\r\n\r\n  intersectsEllipse: (ellipse) ->\r\n    return true if @containsPoint ellipse.getPos()\r\n    return true for lineSegment in @lineSegments() when ellipse.intersectsLineSegment lineSegment.a, lineSegment.b\r\n    false\r\n\r\n  intersectsShape: (shape) ->\r\n    if shape.isEllipse then @intersectsEllipse shape else @intersectsRectangle shape\r\n\r\n  subtract: (point) ->\r\n    @x -= point.x\r\n    @y -= point.y\r\n    @pos.subtract point\r\n    @\r\n\r\n  add: (point) ->\r\n    @x += point.x\r\n    @y += point.y\r\n    @pos.add point\r\n    @\r\n\r\n  divide: (n) ->\r\n    [@width, @height] = [@width / n, @height / n]\r\n    @\r\n\r\n  multiply: (n) ->\r\n    [@width, @height] = [@width * n, @height * n]\r\n    @\r\n\r\n  isEmpty: () ->\r\n    @width is 0 and @height is 0\r\n\r\n  invalid: () ->\r\n    return (@x is Infinity) || isNaN(@x) || @y is Infinity || isNaN(@y) || @width is Infinity || isNaN(@width) || @height is Infinity || isNaN(@height) || @rotation is Infinity || isNaN(@rotation)\r\n\r\n  toString: ->\r\n    return \"{x: #{@x.toFixed(0)}, y: #{@y.toFixed(0)}, w: #{@width.toFixed(0)}, h: #{@height.toFixed(0)}, rot: #{@rotation.toFixed(3)}}\"\r\n\r\n  serialize: ->\r\n    {CN: @constructor.className, x: @x, y: @y, w: @width, h: @height, r: @rotation}\r\n\r\n  @deserialize: (o, world, classMap) ->\r\n    new Rectangle o.x, o.y, o.w, o.h, o.r\r\n\r\n  serializeForAether: -> @serialize()\r\n  @deserializeFromAether: (o) -> @deserialize o\r\n\r\nmodule.exports = Rectangle\r\n","{downTheChain} = require './world_utils'\r\n\r\nmodule.exports.scriptMatchesEventPrereqs = scriptMatchesEventPrereqs = (script, event) ->\r\n  return true unless script.eventPrereqs\r\n  for ap in script.eventPrereqs\r\n    v = downTheChain(event, ap.eventProps)\r\n    return false if ap.equalTo? and v isnt ap.equalTo\r\n    return false if ap.notEqualTo? and v is ap.notEqualTo\r\n    return false if ap.greaterThan? and not (v > ap.greaterThan)\r\n    return false if ap.greaterThanOrEqualTo? and not (v >= ap.greaterThanOrEqualTo)\r\n    return false if ap.lessThan? and not (v < ap.lessThan)\r\n    return false if ap.lessThanOrEqualTo? and not (v <= ap.lessThanOrEqualTo)\r\n    return false if ap.containingString? and (not v or v.search(ap.containingString) is -1)\r\n    return false if ap.notContainingString? and v?.search(ap.notContainingString) isnt -1\r\n    return false if ap.containingRegexp? and (not v or v.search(new RegExp(ap.containingRegexp)) is -1)\r\n    return false if ap.notContainingRegexp? and v?.search(new RegExp(ap.notContainingRegexp)) isnt -1\r\n\r\n  return true\r\n","# The System will operate on its Thangs of interest in each WorldFrame.\r\n# Systems so far: AI, UI, Collision, Movement, Targeting, Programming, Combat, Vision, Hearing, Inventory, Actions\r\n# Other Systems might be things like Attraction, EdgeBounce, EdgeWrap, and non-physics ones, too, like Rendering, Animation, ...\r\n\r\nmodule.exports = class System\r\n  @className: 'System'\r\n  constructor: (@world, config) ->\r\n    # Unlike with Component, we don't automatically copy all our properties onto the World.\r\n    # Subclasses can copy select properties here if they like.\r\n    for key, value of (config ? {})\r\n      @[key] = value\r\n    @registries = []\r\n    @hashes = {}\r\n\r\n  # Start is called once the beginning, after all Thangs have been loaded.\r\n  start: (thangs) ->\r\n\r\n  # Update is called once per frame on all thangs that currently have exist=true in the World.\r\n  # We return a simple numeric hash that will combine to a frame hash help us determine whether this frame has changed later on.\r\n  update: (thangs) ->\r\n    hash = 0\r\n\r\n  # Finish is called once at the end, after all frames have been generated.\r\n  finish: (thangs) ->\r\n\r\n  addRegistry: (condition) ->\r\n    registry = []\r\n    @registries.push [registry, condition]\r\n    registry\r\n\r\n  # Register is called whenever a Thang changes important state (exists, dead, etc), and can be called more specifically by individual Thangs.\r\n  register: (thang) ->\r\n    for [registry, condition] in @registries\r\n      if condition thang\r\n        if thang not in registry\r\n          registry.push thang\r\n      else\r\n        thangIndex = registry.indexOf thang\r\n        if thangIndex isnt -1\r\n          registry.splice thangIndex, 1\r\n    null\r\n\r\n  # Override this to determine which registries have which conditions\r\n  checkRegistration: (thang, registry) ->\r\n\r\n  hashString: (s) ->\r\n    return @hashes[s] if s of @hashes\r\n    hash = 0\r\n    for i in [0 ... Math.min(s.length, 100)]\r\n      hash = hash * 31 + s.charCodeAt(i)\r\n    hash = @hashes[s] = hash % 3.141592653589793\r\n    hash\r\n\r\n  toString: ->\r\n    \"<System: #{@constructor.className}\"\r\n","module.exports.MAX_COOLDOWN = MAX_COOLDOWN = 9001\r\n","# http://codingowl.com/readblog.php?blogid=124\r\nmodule.exports.CollisionCategory = class CollisionCategory\r\n  @className: 'CollisionCategory'\r\n  constructor: (name, @superteamIndex=null, @collisionSystem) ->\r\n    # @superteamIndex is null for 'none', 'obstacles', and 'dead'.\r\n    # It's 0 for 'ground', 'air', and 'ground_and_air' units with no superteams.\r\n    # It's 1, 2, or 3 for the superteams it gets after that. We can only have 16 collision categories.\r\n    @ground = name.search('ground') isnt -1\r\n    @air = name.search('air') isnt -1\r\n    @name = CollisionCategory.nameFor name, @superteamIndex\r\n    @superteamIndex ?= 0 if @ground or @air\r\n    @number = 1 << @collisionSystem.totalCategories++\r\n    if @collisionSystem.totalCategories > 16 then console.log 'There should only be 16 collision categories!'\r\n    @mask = 0\r\n    @collisionSystem.allCategories[@name] = @\r\n    for otherCatName, otherCat of @collisionSystem.allCategories\r\n      if @collidesWith otherCat\r\n        @mask = @mask | otherCat.number\r\n        otherCat.mask = otherCat.mask | @number\r\n\r\n  collidesWith: (cat) ->\r\n    # 'none' collides with nothing\r\n    return false if @name is 'none' or cat.name is 'none'\r\n\r\n    # 'obstacles' collides with everything; could also try letting air units (but not ground_and_air) fly over these\r\n    return true if cat.name is 'obstacles' or @name is 'obstacles'\r\n\r\n    # 'dead' collides only with obstacles\r\n    return cat.name is 'obstacles' if @name is 'dead'\r\n    return @name is 'obstacles' if cat.name is 'dead'\r\n\r\n    # 'ground_and_air_<team>' units don't hit ground or air units on their team (so missiles don't hit same team)\r\n    sameTeam = @superteamIndex and cat.superteamIndex is @superteamIndex\r\n    return false if sameTeam and @ground and @air\r\n\r\n    # actually, 'ground_and_air<team>' units don't hit any ground_and_air units (temp missile collision fix)\r\n    return false if @ground and @air and cat.ground and cat.air\r\n\r\n    # 'ground' collides with 'ground'\r\n    return true if cat.ground and @ground\r\n\r\n    # 'air' collides with 'air'\r\n    return true if cat.air and @air\r\n\r\n    # doesn't collide (probably 'ground' and 'air')\r\n    false\r\n\r\n  @nameFor: (name, superteamIndex=null) ->\r\n    return name unless name.match('ground') or name.match('air')\r\n    name + '_' + (superteamIndex or 0)\r\n","module.exports.WATER_DENSITY = WATER_DENSITY = 1000  # kg / m^3\r\nmodule.exports.AIR_DENSITY = AIR_DENSITY = 1.225  # kg / m^3\r\nmodule.exports.VACUUM_DENSITY = VACUUM_DENSITY = 0.00000000000000129  # For an excellent laboratory vacuum; kg / m^3\r\nmodule.exports.SWAMP_DENSITY = SWAMP_DENSITY = WATER_DENSITY / 4  # Swamp is dense like water, but only covers part of unit\r\nmodule.exports.STANDARD_FRICTION = STANDARD_FRICTION = 0.7  # 0.7 =~ shoe on floor.\r\nmodule.exports.ICE_FRICTION = ICE_FRICTION = 0.1  # As low as 0.015 (steel on ice), as high as 0.4 (rubber on ice)\r\n","ThangState = require './thang_state'\r\n{thangNames} = require './names'\r\n{ArgumentError} = require './errors'\r\nRand = require './rand'\r\n\r\nmodule.exports = class Thang\r\n  @className: 'Thang'\r\n  @remainingThangNames: {}\r\n\r\n  @nextID: (spriteName, world) ->\r\n    originals = thangNames[spriteName] or [spriteName]\r\n    remaining = Thang.remainingThangNames[spriteName]\r\n    remaining = Thang.remainingThangNames[spriteName] = originals.slice() unless remaining?.length\r\n\r\n    baseName = remaining.splice(world.rand.rand(remaining.length), 1)[0]\r\n    i = 0\r\n    while true\r\n      name = if i then \"#{baseName} #{i}\" else baseName\r\n      extantThang = world.thangMap[name]\r\n      break unless extantThang\r\n      i++\r\n    name\r\n\r\n  @resetThangIDs: -> Thang.remainingThangNames = {}\r\n  isThang: true\r\n  apiProperties: ['id', 'spriteName', 'health', 'pos', 'team']\r\n\r\n  constructor: (@world, @spriteName, @id) ->\r\n    @spriteName ?= @constructor.className\r\n    @id ?= @constructor.nextID @spriteName, @world\r\n    @addTrackedProperties ['exists', 'boolean']  # TODO: move into Systems/Components, too?\r\n    #console.log \"Generated #{@toString()}.\"\r\n\r\n  destroy: ->\r\n    # Just trying to destroy __aetherAPIClone, but might as well nuke everything just in case\r\n    @[key] = undefined for key of @\r\n    @destroyed = true\r\n    @destroy = ->\r\n\r\n  updateRegistration: ->\r\n    system.register @ for system in @world.systems\r\n\r\n  publishNote: (channel, event) ->\r\n    event.thang = @\r\n    @world.publishNote channel, event\r\n\r\n  getGoalState: (goalID) ->\r\n    @world.getGoalState goalID\r\n\r\n  setGoalState: (goalID, status) ->\r\n    @world.setGoalState goalID, status\r\n\r\n  getThangByID: (id) ->\r\n    @world.getThangByID id\r\n\r\n  addComponents: (components...) ->\r\n    # We don't need to keep the components around after attaching them, but we will keep their initial config for recreating Thangs\r\n    @components ?= []\r\n    for [componentClass, componentConfig] in components\r\n      @components.push [componentClass, componentConfig]\r\n      if _.isString componentClass  # We had already turned it into a string, so re-classify it momentarily\r\n        componentClass = @world.classMap[componentClass]\r\n      else\r\n        @world?.classMap[componentClass.className] ?= componentClass\r\n      c = new componentClass componentConfig ? {}\r\n      c.attach @\r\n\r\n  # [prop, type]s of properties which have values tracked across WorldFrames. Also call keepTrackedProperty some non-expensive time when you change it or it will be skipped.\r\n  addTrackedProperties: (props...) ->\r\n    @trackedPropertiesKeys ?= []\r\n    @trackedPropertiesTypes ?= []\r\n    @trackedPropertiesUsed ?= []\r\n    for [prop, type] in props\r\n      unless type in ThangState.trackedPropertyTypes\r\n        # How should errors for busted Components work? We can't recover from this and run the world.\r\n        throw new Error \"Type #{type} for property #{prop} is not a trackable property type: #{ThangState.trackedPropertyTypes}\"\r\n      oldPropIndex = @trackedPropertiesKeys.indexOf prop\r\n      if oldPropIndex is -1\r\n        @trackedPropertiesKeys.push prop\r\n        @trackedPropertiesTypes.push type\r\n        @trackedPropertiesUsed.push false\r\n      else\r\n        oldType = @trackedPropertiesTypes[oldPropIndex]\r\n        if type isnt oldType\r\n          throw new Error \"Two types were specified for trackable property #{prop}: #{oldType} and #{type}.\"\r\n\r\n  keepTrackedProperty: (prop) ->\r\n    # Wish we could do this faster, but I can't think of how.\r\n    propIndex = @trackedPropertiesKeys.indexOf prop\r\n    if propIndex isnt -1\r\n      @trackedPropertiesUsed[propIndex] = true\r\n\r\n  # @trackedFinalProperties: names of properties which need to be tracked once at the end of the World; don't worry about types\r\n  addTrackedFinalProperties: (props...) ->\r\n    @trackedFinalProperties ?= []\r\n    @trackedFinalProperties = @trackedFinalProperties.concat (k for k in props when not (k in @trackedFinalProperties))\r\n\r\n  getState: ->\r\n    @_state = new ThangState @\r\n  setState: (state) ->\r\n    @_state = state.restore()\r\n\r\n  toString: -> @id\r\n\r\n  createMethodChain: (methodName) ->\r\n    @methodChains ?= {}\r\n    chain = @methodChains[methodName]\r\n    return chain if chain\r\n    chain = @methodChains[methodName] = {original: @[methodName], user: null, components: []}\r\n    @[methodName] = _.partial @callChainedMethod, methodName  # Optimize! _.partial is fastest I've found\r\n    chain\r\n\r\n  appendMethod: (methodName, newMethod) ->\r\n    # Components add methods that come after the original method\r\n    @createMethodChain(methodName).components.push newMethod\r\n\r\n  callChainedMethod: (methodName, args...) ->\r\n    # Optimize this like crazy--but how?\r\n    chain = @methodChains[methodName]\r\n    primaryMethod = chain.user or chain.original\r\n    ret = primaryMethod?.apply @, args\r\n    for componentMethod in chain.components\r\n      ret2 = componentMethod.apply @, args\r\n      ret = ret2 ? ret  # override return value only if not null\r\n    ret\r\n\r\n  getMethodSource: (methodName) ->\r\n    source = {}\r\n    if @methodChains? and methodName of @methodChains\r\n      chain = @methodChains[methodName]\r\n      source.original = chain.original.toString()\r\n      source.user = chain.user?.toString()\r\n    else\r\n      source.original = @[methodName]?.toString() ? ''\r\n    source.original = Aether.getFunctionBody source.original\r\n    source\r\n\r\n  serialize: ->\r\n    o = {spriteName: @spriteName, id: @id, components: [], finalState: {}}\r\n    for [componentClass, componentConfig], i in (@components ? [])\r\n      if _.isString componentClass\r\n        componentClassName = componentClass\r\n      else\r\n        componentClassName = componentClass.className\r\n        @world.classMap[componentClass.className] ?= componentClass\r\n      o.components.push [componentClassName, componentConfig]\r\n    for trackedFinalProperty in @trackedFinalProperties ? []\r\n      # TODO: take some (but not all) of serialize logic from ThangState to handle other types\r\n      o.finalState[trackedFinalProperty] = @[trackedFinalProperty]\r\n    # Since we might keep tracked properties later during streaming, we need to know which we think are unused.\r\n    o.unusedTrackedPropertyKeys = (@trackedPropertiesKeys[propIndex] for used, propIndex in @trackedPropertiesUsed when not used)\r\n    o\r\n\r\n  @deserialize: (o, world, classMap, levelComponents) ->\r\n    t = new Thang world, o.spriteName, o.id\r\n    for [componentClassName, componentConfig] in o.components\r\n      unless componentClass = classMap[componentClassName]\r\n        console.debug 'Compiling new Component while deserializing:', componentClassName\r\n        componentModel = _.find levelComponents, name: componentClassName\r\n        componentClass = world.loadClassFromCode componentModel.js, componentClassName, 'component'\r\n        world.classMap[componentClassName] = componentClass\r\n      t.addComponents [componentClass, componentConfig]\r\n    t.unusedTrackedPropertyKeys = o.unusedTrackedPropertyKeys\r\n    t.unusedTrackedPropertyValues = (t[prop] for prop in o.unusedTrackedPropertyKeys)\r\n    for prop, val of o.finalState\r\n      # TODO: take some (but not all) of deserialize logic from ThangState to handle other types\r\n      t[prop] = val\r\n    t\r\n\r\n  serializeForAether: ->\r\n    {CN: @constructor.className, id: @id}\r\n\r\n  getLankOptions: ->\r\n    colorConfigs = @teamColors or @world?.getTeamColors() or {}\r\n    options = {colorConfig: {}}\r\n    if @id is 'Hero Placeholder' and not @world.getThangByID 'Hero Placeholder 1'\r\n      return options  # No team colors for heroes on single-player levels\r\n    if @team and teamColor = colorConfigs[@team]\r\n      options.colorConfig.team = teamColor\r\n    if @color and color = @grabColorConfig @color\r\n      options.colorConfig.color = color\r\n    if @colors\r\n      options.colorConfig[colorType] = colorValue for colorType, colorValue of @colors\r\n    options\r\n\r\n  grabColorConfig: (color) ->\r\n    {\r\n      green: {hue: 0.33, saturation: 0.5, lightness: 0.5}\r\n      black: {hue: 0, saturation: 0, lightness: 0.25}\r\n      violet: {hue: 0.83, saturation: 0.5, lightness: 0.5}\r\n    }[color]\r\n","{clone, typedArraySupport} = require './world_utils'\r\nVector = require './vector'\r\n\r\nif typedArraySupport\r\n  FloatArrayType = Float32Array  # Better performance than Float64Array\r\n  bytesPerFloat = FloatArrayType.BYTES_PER_ELEMENT ? FloatArrayType.prototype.BYTES_PER_ELEMENT\r\nelse\r\n  bytesPerFloat = 4\r\n\r\nmodule.exports = class ThangState\r\n  @className: 'ThangState'\r\n  @trackedPropertyTypes: [\r\n    'boolean'\r\n    'number'\r\n    'string'\r\n    'array'  # will turn everything into strings\r\n    'object'  # grrr\r\n    'Vector'\r\n    'Thang'  # serialized as ids, like strings\r\n  ]\r\n\r\n  hasRestored: false\r\n  constructor: (thang) ->\r\n    @props = []  # parallel array to @thang's trackedPropertiesKeys/Types\r\n    return unless thang\r\n    @thang = thang\r\n    for prop, propIndex in thang.trackedPropertiesKeys\r\n      type = thang.trackedPropertiesTypes[propIndex]\r\n      value = thang[prop]\r\n      if type is 'Vector'\r\n        @props.push value?.copy()  # could try storing [x, y, z] or {x, y, z} here instead if this is expensive\r\n      else if type is 'object' or type is 'array'\r\n        @props.push clone(value, true)\r\n      else\r\n        @props.push value\r\n\r\n  # Either pass storage and type, or don't pass either of them\r\n  getStoredProp: (propIndex, type, storage) ->\r\n    # Optimize it\r\n    unless type\r\n      type = @trackedPropertyTypes[propIndex]\r\n      storage = @trackedPropertyValues[propIndex]\r\n    if type is 'Vector'\r\n      value = new Vector storage[3 * @frameIndex], storage[3 * @frameIndex + 1], storage[3 * @frameIndex + 2]\r\n    else if type is 'string'\r\n      specialKey = storage[@frameIndex]\r\n      value = @specialKeysToValues[specialKey]\r\n    else if type is 'Thang'\r\n      specialKey = storage[@frameIndex]\r\n      value = @thang.world.getThangByID @specialKeysToValues[specialKey]\r\n    else if type is 'array'\r\n      specialKey = storage[@frameIndex]\r\n      valueString = @specialKeysToValues[specialKey]\r\n      if valueString and valueString.length > 1\r\n        # Trim leading Group Separator and trailing Record Separator, split by Record Separators, restore string array.\r\n        value = valueString.substring(1, valueString.length - 1).split '\\x1E'\r\n      else\r\n        value = []\r\n    else\r\n      value = storage[@frameIndex]\r\n    value\r\n\r\n  getStateForProp: (prop) ->\r\n    # Get the property, whether we have it stored in @props or in @trackedPropertyValues. Optimize it.\r\n    # Figured based on http://jsperf.com/object-vs-array-vs-native-linked-list/13 that it should be faster with small arrays to do the indexOf reads (each up to 24x faster) than to do a single object read, and then we don't have to maintain an extra @props object; just keep array\r\n    propIndex = @trackedPropertyKeys.indexOf prop\r\n    if propIndex is -1\r\n      initialPropIndex = @thang.unusedTrackedPropertyKeys.indexOf prop\r\n      return null if initialPropIndex is -1\r\n      return @thang.unusedTrackedPropertyValues[initialPropIndex]\r\n    value = @props[propIndex]\r\n    return value if value isnt undefined or @hasRestored\r\n    return @props[propIndex] = @getStoredProp propIndex\r\n\r\n  restore: ->\r\n    # Restore trackedProperties' values to @thang, retrieving them from @trackedPropertyValues if needed. Optimize it.\r\n    return @ if @thang._state is @ and not @thang.partialState\r\n    unless @hasRestored  # Restoring in a deserialized World for first time\r\n      for prop, propIndex in @thang.unusedTrackedPropertyKeys when @trackedPropertyKeys.indexOf(prop) is -1\r\n        @thang[prop] = @thang.unusedTrackedPropertyValues[propIndex]\r\n      props = []\r\n      for prop, propIndex in @trackedPropertyKeys\r\n        type = @trackedPropertyTypes[propIndex]\r\n        storage = @trackedPropertyValues[propIndex]\r\n        props.push @thang[prop] = @getStoredProp propIndex, type, storage\r\n        #console.log @frameIndex, @thang.id, prop, propIndex, type, storage, 'got', @thang[prop]\r\n      @props = props\r\n      @trackedPropertyTypes = @trackedPropertyValues = @specialKeysToValues = null  # leave @trackedPropertyKeys for indexing\r\n      @hasRestored = true\r\n    else  # Restoring later times\r\n      for prop, propIndex in @thang.unusedTrackedPropertyKeys when @trackedPropertyKeys.indexOf(prop) is -1\r\n        @thang[prop] = @thang.unusedTrackedPropertyValues[propIndex]\r\n      for prop, propIndex in @trackedPropertyKeys\r\n        @thang[prop] = @props[propIndex]\r\n    @thang.partialState = false\r\n    @thang.stateChanged = true\r\n    @\r\n\r\n  restorePartial: (ratio) ->\r\n    # Don't think we need to worry about unusedTrackedPropertyValues here.\r\n    # If it's not tracked yet, it'll very rarely partially change between frames; we can afford to miss the first one.\r\n    inverse = 1 - ratio\r\n    for prop, propIndex in @trackedPropertyKeys when prop is 'pos' or prop is 'rotation'\r\n      if @hasRestored\r\n        value = @props[propIndex]\r\n      else\r\n        type = @trackedPropertyTypes[propIndex]\r\n        storage = @trackedPropertyValues[propIndex]\r\n        value = @getStoredProp propIndex, type, storage\r\n      if prop is 'pos'\r\n        if (@thang.teleport and @thang.pos.distanceSquared(value) > 900) or (@thang.pos.x is 0 and @thang.pos.y is 0)\r\n          # Don't interpolate; it was probably a teleport. https://github.com/codecombat/codecombat/issues/738\r\n          @thang.pos = value\r\n        else\r\n          @thang.pos = @thang.pos.copy()\r\n          @thang.pos.x = inverse * @thang.pos.x + ratio * value.x\r\n          @thang.pos.y = inverse * @thang.pos.y + ratio * value.y\r\n          @thang.pos.z = inverse * @thang.pos.z + ratio * value.z\r\n      else if prop is 'rotation'\r\n        @thang.rotation = inverse * @thang.rotation + ratio * value\r\n      @thang.partialState = true\r\n    @thang.stateChanged = true\r\n    @\r\n\r\n  serialize: (frameIndex, trackedPropertyIndices, trackedPropertyTypes, trackedPropertyValues, specialValuesToKeys, specialKeysToValues) ->\r\n    # Performance hotspot--called once per tracked property per Thang per frame. Optimize the crap out of it.\r\n    for type, newPropIndex in trackedPropertyTypes\r\n      originalPropIndex = trackedPropertyIndices[newPropIndex]\r\n      storage = trackedPropertyValues[newPropIndex]\r\n      value = @props[originalPropIndex]\r\n      if value\r\n        # undefined, null, false, 0 won't trigger in this serialization code scheme anyway, so we can't differentiate between them when deserializing\r\n        if type is 'Vector'\r\n          storage[3 * frameIndex] = value.x\r\n          storage[3 * frameIndex + 1] = value.y\r\n          storage[3 * frameIndex + 2] = value.z\r\n        else if type is 'string'\r\n          specialKey = specialValuesToKeys[value]\r\n          unless specialKey\r\n            specialKey = specialKeysToValues.length\r\n            specialValuesToKeys[value] = specialKey\r\n            specialKeysToValues.push value\r\n            storage[frameIndex] = specialKey\r\n          storage[frameIndex] = specialKey\r\n        else if type is 'Thang'\r\n          value = value.id\r\n          specialKey = specialValuesToKeys[value]\r\n          unless specialKey\r\n            specialKey = specialKeysToValues.length\r\n            specialValuesToKeys[value] = specialKey\r\n            specialKeysToValues.push value\r\n            storage[frameIndex] = specialKey\r\n          storage[frameIndex] = specialKey\r\n        else if type is 'array'\r\n          # We make sure the array keys won't collide with any string keys by using some unprintable characters.\r\n          stringPieces = ['\\x1D']  # Group Separator\r\n          for element in value\r\n            if element and element.id  # Was checking element.isThang, but we can't store non-strings anyway\r\n              element = element.id\r\n            stringPieces.push element, '\\x1E'  # Record Separator(s)\r\n          value = stringPieces.join('')\r\n          specialKey = specialValuesToKeys[value]\r\n          unless specialKey\r\n            specialKey = specialKeysToValues.length\r\n            specialValuesToKeys[value] = specialKey\r\n            specialKeysToValues.push value\r\n            storage[frameIndex] = specialKey\r\n          storage[frameIndex] = specialKey\r\n        else\r\n          storage[frameIndex] = value\r\n        #console.log @thang.id, 'assigned prop', originalPropIndex, newPropIndex, value, type, 'at', frameIndex, 'to', storage[frameIndex]\r\n    null\r\n\r\n  @deserialize: (world, frameIndex, thang, trackedPropertyKeys, trackedPropertyTypes, trackedPropertyValues, specialKeysToValues) ->\r\n    # Optimize like no tomorrow--most performance-sensitive part of the whole app, called once per WorldFrame per Thang per trackedProperty, blocking the UI\r\n    ts = new ThangState\r\n    ts.thang = thang\r\n    ts.frameIndex = frameIndex\r\n    ts.trackedPropertyKeys = trackedPropertyKeys\r\n    ts.trackedPropertyTypes = trackedPropertyTypes\r\n    ts.trackedPropertyValues = trackedPropertyValues\r\n    ts.specialKeysToValues = specialKeysToValues\r\n    ts\r\n\r\n  @transferableBytesNeededForType: (type, nFrames) ->\r\n    bytes = switch type\r\n      when 'boolean' then 1\r\n      when 'number' then bytesPerFloat\r\n      when 'Vector' then bytesPerFloat * 3\r\n      when 'string' then 4\r\n      when 'Thang' then 4  # turn them into strings of their ids\r\n      when 'array'  then 4  # turn them into strings and hope it doesn't explode?\r\n      else 0\r\n    # We need to be a multiple of bytesPerFloat otherwise bigger-byte array (Float64Array, etc.) offsets won't work\r\n    # http://www.kirupa.com/forum/showthread.php?378737-Typed-Arrays-Y-U-No-offset-at-values-other-than-multiples-of-element-size\r\n    bytesPerFloat * Math.ceil(nFrames * bytes / bytesPerFloat)\r\n\r\n  @createArrayForType: (type, nFrames, buffer, offset) ->\r\n    bytes = @transferableBytesNeededForType type, nFrames\r\n    storage = switch type\r\n      when 'boolean'\r\n        new Uint8Array(buffer, offset, nFrames)\r\n      when 'number'\r\n        new FloatArrayType(buffer, offset, nFrames)\r\n      when 'Vector'\r\n        new FloatArrayType(buffer, offset, nFrames * 3)\r\n      when 'string'\r\n        new Uint32Array(buffer, offset, nFrames)\r\n      when 'Thang'\r\n        new Uint32Array(buffer, offset, nFrames)\r\n      when 'array'\r\n        new Uint32Array(buffer, offset, nFrames)\r\n      else\r\n        []\r\n    [storage, bytes]\r\n\r\nunless typedArraySupport\r\n  # Fall back to normal arrays in IE 9\r\n  ThangState.createArrayForType = (type, nFrames, buffer, offset) ->\r\n    bytes = @transferableBytesNeededForType type, nFrames\r\n    elementsPerFrame = if type is 'Vector' then 3 else 1\r\n    storage = (0 for i in [0 ... nFrames * elementsPerFrame])\r\n    [storage, bytes]\r\n","# https://github.com/hornairs/blog/blob/master/assets/coffeescripts/flocking/vector.coffee\r\nclass Vector\r\n  @className: 'Vector'\r\n  # Class methods for nondestructively operating\r\n  for name in ['add', 'subtract', 'multiply', 'divide', 'limit', 'normalize', 'rotate']\r\n    do (name) ->\r\n      Vector[name] = (a, b, useZ) ->\r\n        a.copy()[name](b, useZ)\r\n  for name in ['magnitude', 'heading', 'distance', 'dot', 'equals', 'copy', 'distanceSquared']\r\n    do (name) ->\r\n      Vector[name] = (a, b, useZ) ->\r\n        a[name](b, useZ)\r\n\r\n  isVector: true\r\n  apiProperties: ['x', 'y', 'z', 'magnitude', 'heading', 'distance', 'dot', 'equals', 'copy', 'distanceSquared', 'add', 'subtract', 'multiply', 'divide', 'limit', 'normalize', 'rotate']\r\n\r\n  constructor: (x=0, y=0, z=0) ->\r\n    return new Vector x, y, z unless @ instanceof Vector\r\n    [@x, @y, @z] = [x, y, z]\r\n\r\n  copy: ->\r\n    new Vector(@x, @y, @z)\r\n\r\n\r\n  # Mutating methods:\r\n\r\n  normalize: (useZ) ->\r\n    m = @magnitude useZ\r\n    @divide m, useZ if m > 0\r\n    @\r\n\r\n  esper_normalize: (useZ) ->\r\n    @copy().normalize(useZ)\r\n\r\n  limit: (max) ->\r\n    if @magnitude() > max\r\n      @normalize()\r\n      @multiply(max)\r\n    else\r\n      @\r\n\r\n  esper_limit: (max) ->\r\n    @copy().limit(max)\r\n\r\n  subtract: (other, useZ) ->\r\n    @x -= other.x\r\n    @y -= other.y\r\n    @z -= other.z if useZ\r\n    @\r\n\r\n  esper_subtract: (other, useZ) ->\r\n    @copy().subtract(other, useZ)\r\n\r\n  add: (other, useZ) ->\r\n    @x += other.x\r\n    @y += other.y\r\n    @z += other.z if useZ\r\n    @\r\n\r\n  esper_add: (other, useZ) ->\r\n    @copy().add(other, useZ)\r\n\r\n  divide: (n, useZ) ->\r\n    [@x, @y] = [@x / n, @y / n]\r\n    @z = @z / n if useZ\r\n    @\r\n\r\n  esper_divide: (n, useZ) ->\r\n    @copy().divide(n, useZ)\r\n\r\n  multiply: (n, useZ) ->\r\n    [@x, @y] = [@x * n, @y * n]\r\n    @z = @z * n if useZ\r\n    @\r\n\r\n  esper_multiply: (n, useZ) ->\r\n    @copy().multiply(n, useZ)\r\n\r\n  # Rotate it around the origin\r\n  # If we ever want to make this also use z: https://en.wikipedia.org/wiki/Axes_conventions\r\n  rotate: (theta) ->\r\n    return @ unless theta\r\n    [@x, @y] = [Math.cos(theta) * @x - Math.sin(theta) * @y, Math.sin(theta) * @x + Math.cos(theta) * @y]\r\n    @\r\n\r\n  esper_rotate: (theta) ->\r\n    @copy().rotate(theta)\r\n\r\n  # Non-mutating methods:\r\n\r\n  magnitude: (useZ) ->\r\n    sum = @x * @x + @y * @y\r\n    sum += @z * @z if useZ\r\n    Math.sqrt sum\r\n\r\n  magnitudeSquared: (useZ) ->\r\n    sum = @x * @x + @y * @y\r\n    sum += @z * @z if useZ\r\n    sum\r\n\r\n  heading: ->\r\n    -1 * Math.atan2(-1 * @y, @x)\r\n\r\n  distance: (other, useZ) ->\r\n    dx = @x - other.x\r\n    dy = @y - other.y\r\n    sum = dx * dx + dy * dy\r\n    if useZ\r\n      dz = @z - other.z\r\n      sum += dz * dz\r\n    Math.sqrt sum\r\n\r\n  distanceSquared: (other, useZ) ->\r\n    dx = @x - other.x\r\n    dy = @y - other.y\r\n    sum = dx * dx + dy * dy\r\n    if useZ\r\n      dz = @z - other.z\r\n      sum += dz * dz\r\n    sum\r\n\r\n  dot: (other, useZ) ->\r\n    sum = @x * other.x + @y * other.y\r\n    sum += @z * other.z if useZ\r\n    sum\r\n\r\n  # Not the strict projection, the other isn't converted to a unit vector first.\r\n  projectOnto: (other, useZ) ->\r\n    other.copy().multiply(@dot(other, useZ), useZ)\r\n\r\n  isZero: (useZ) ->\r\n    result = @x is 0 and @y is 0\r\n    result = result and @z is 0 if useZ\r\n    result\r\n\r\n  equals: (other, useZ) ->\r\n    result = other and @x is other.x and @y is other.y\r\n    result = result and @z is other.z if useZ\r\n    result\r\n\r\n  invalid: () ->\r\n    return (@x is Infinity) || isNaN(@x) || @y is Infinity || isNaN(@y) || @z is Infinity || isNaN(@z)\r\n\r\n  toString: (precision = 2) ->\r\n    return \"{x: #{@x.toFixed(precision)}, y: #{@y.toFixed(precision)}, z: #{@z.toFixed(precision)}}\"\r\n\r\n\r\n  serialize: ->\r\n    {CN: @constructor.className, x: @x, y: @y, z: @z}\r\n\r\n  @deserialize: (o, world, classMap) ->\r\n    new Vector o.x, o.y, o.z\r\n\r\n  serializeForAether: -> @serialize()\r\n  @deserializeFromAether: (o) -> @deserialize o\r\n\r\nmodule.exports = Vector\r\n","Vector = require './vector'\r\nRectangle = require './rectangle'\r\nEllipse = require './ellipse'\r\nLineSegment = require './line_segment'\r\nWorldFrame = require './world_frame'\r\nThang = require './thang'\r\nThangState = require './thang_state'\r\nRand = require './rand'\r\nWorldScriptNote = require './world_script_note'\r\n{now, consolidateThangs, typedArraySupport} = require './world_utils'\r\nComponent = require 'lib/world/component'\r\nSystem = require 'lib/world/system'\r\nPROGRESS_UPDATE_INTERVAL = 100\r\nDESERIALIZATION_INTERVAL = 10\r\nREAL_TIME_BUFFER_MIN = 2 * PROGRESS_UPDATE_INTERVAL\r\nREAL_TIME_BUFFER_MAX = 3 * PROGRESS_UPDATE_INTERVAL\r\nREAL_TIME_BUFFERED_WAIT_INTERVAL = 0.5 * PROGRESS_UPDATE_INTERVAL\r\nREAL_TIME_COUNTDOWN_DELAY = 3000  # match CountdownScreen\r\nITEM_ORIGINAL = '53e12043b82921000051cdf9'\r\nEXISTS_ORIGINAL = '524b4150ff92f1f4f8000024'\r\nCOUNTDOWN_LEVELS = ['sky-span']\r\n\r\nmodule.exports = class World\r\n  @className: 'World'\r\n  age: 0\r\n  ended: false\r\n  preloading: false  # Whether we are just preloading a world in case we soon cast it\r\n  debugging: false  # Whether we are just rerunning to debug a world we've already cast\r\n  headless: false  # Whether we are just simulating for goal states instead of all serialized results\r\n  framesSerializedSoFar: 0\r\n  framesClearedSoFar: 0\r\n  apiProperties: ['age', 'dt']\r\n  realTimeBufferMax: REAL_TIME_BUFFER_MAX / 1000\r\n  constructor: (@userCodeMap, classMap) ->\r\n    # classMap is needed for deserializing Worlds, Thangs, and other classes\r\n    @classMap = classMap ? {Vector: Vector, Rectangle: Rectangle, Thang: Thang, Ellipse: Ellipse, LineSegment: LineSegment}\r\n    Thang.resetThangIDs()\r\n\r\n    @userCodeMap ?= {}\r\n    @thangs = []\r\n    @thangMap = {}\r\n    @systems = []\r\n    @systemMap = {}\r\n    @scriptNotes = []\r\n    @rand = new Rand 0  # Existence System may change this seed\r\n    @frames = [new WorldFrame(@, 0)]\r\n\r\n  destroy: ->\r\n    @goalManager?.destroy()\r\n    thang.destroy() for thang in @thangs\r\n    @[key] = undefined for key of @\r\n    @destroyed = true\r\n    @destroy = ->\r\n\r\n  getFrame: (frameIndex) ->\r\n    # Optimize it a bit--assume we have all if @ended and are at the previous frame otherwise\r\n    frames = @frames\r\n    if @ended\r\n      frame = frames[frameIndex]\r\n    else if frameIndex\r\n      frame = frames[frameIndex - 1].getNextFrame()\r\n      frames.push frame\r\n    else\r\n      frame = frames[0]\r\n    @age = frameIndex * @dt\r\n    frame\r\n\r\n  getThangByID: (id) ->\r\n    @thangMap[id]\r\n\r\n  setThang: (thang) ->\r\n    thang.stateChanged = true\r\n    for old, i in @thangs\r\n      if old.id is thang.id\r\n        @thangs[i] = thang\r\n        break\r\n    @thangMap[thang.id] = thang\r\n\r\n  thangDialogueSounds: (startFrame=0) ->\r\n    return [] unless startFrame < @frames.length\r\n    [sounds, seen] = [[], {}]\r\n    for frameIndex in [startFrame ... @frames.length]\r\n      frame = @frames[frameIndex]\r\n      for thangID, state of frame.thangStateMap\r\n        continue unless state.thang.say and sayMessage = state.getStateForProp 'sayMessage'\r\n        soundKey = state.thang.spriteName + ':' + sayMessage\r\n        unless seen[soundKey]\r\n          sounds.push [state.thang.spriteName, sayMessage]\r\n          seen[soundKey] = true\r\n    sounds\r\n\r\n  setGoalManager: (@goalManager) ->\r\n\r\n  addError: (error) ->\r\n    (@runtimeErrors ?= []).push error\r\n    (@unhandledRuntimeErrors ?= []).push error\r\n\r\n  loadFrames: (loadedCallback, errorCallback, loadProgressCallback, preloadedCallback, skipDeferredLoading, loadUntilFrame) ->\r\n    return if @aborted\r\n    @totalFrames = 2 if @justBegin\r\n    console.log 'Warning: loadFrames called on empty World (no thangs).' unless @thangs.length\r\n    continueLaterFn = =>\r\n      @loadFrames(loadedCallback, errorCallback, loadProgressCallback, preloadedCallback, skipDeferredLoading, loadUntilFrame) unless @destroyed\r\n    if @realTime and not @countdownFinished\r\n      @realTimeSpeedFactor = 1\r\n      unless @showsCountdown\r\n        if @levelID in ['woodland-cleaver', 'village-guard', 'shield-rush']\r\n          @realTimeSpeedFactor = 2\r\n        else if @levelID in ['thornbush-farm', 'back-to-back', 'ogre-encampment', 'peasant-protection', 'munchkin-swarm', 'munchkin-harvest', 'swift-dagger', 'shrapnel', 'arcane-ally', 'touch-of-death', 'bonemender']\r\n          @realTimeSpeedFactor = 3\r\n      if @showsCountdown\r\n        return setTimeout @finishCountdown(continueLaterFn), REAL_TIME_COUNTDOWN_DELAY\r\n      else\r\n        @finishCountdown continueLaterFn\r\n    t1 = now()\r\n    @t0 ?= t1\r\n    @worldLoadStartTime ?= t1\r\n    @lastRealTimeUpdate ?= 0\r\n    frameToLoadUntil = if loadUntilFrame then loadUntilFrame + 1 else @totalFrames  # Might stop early if debugging.\r\n    i = @frames.length\r\n    while true\r\n      if @indefiniteLength\r\n        break if not @realTime # realtime has been stopped\r\n        break if @victory? # game won or lost  # TODO: give a couple seconds of buffer after victory is set instead of ending instantly\r\n      else\r\n        break if i >= frameToLoadUntil\r\n        break if i >= @totalFrames\r\n      return unless @shouldContinueLoading t1, loadProgressCallback, skipDeferredLoading, continueLaterFn\r\n      @adjustFlowSettings loadUntilFrame if @debugging\r\n      try\r\n        @getFrame(i)\r\n        ++i  # Increment this after we have succeeded in getting the frame, otherwise we'll have to do that frame again\r\n      catch error\r\n        @addError error  # Not an Aether.errors.UserCodeError; maybe we can't recover\r\n      unless @preloading or @debugging\r\n        for error in (@unhandledRuntimeErrors ? [])\r\n          return unless errorCallback error  # errorCallback tells us whether the error is recoverable\r\n        @unhandledRuntimeErrors = []\r\n    @finishLoadingFrames loadProgressCallback, loadedCallback, preloadedCallback\r\n\r\n  finishLoadingFrames: (loadProgressCallback, loadedCallback, preloadedCallback) ->\r\n    unless @debugging\r\n      @ended = true\r\n      system.finish @thangs for system in @systems\r\n    if @preloading\r\n      preloadedCallback()\r\n    else\r\n      loadProgressCallback? 1\r\n      loadedCallback()\r\n\r\n  finishCountdown: (continueLaterFn) -> =>\r\n    return if @destroyed\r\n    @countdownFinished = true\r\n    continueLaterFn()\r\n\r\n  shouldDelayRealTimeSimulation: (t) ->\r\n    return false unless @realTime\r\n    timeSinceStart = (t - @worldLoadStartTime) * @realTimeSpeedFactor\r\n    timeLoaded = @frames.length * @dt * 1000\r\n    timeBuffered = timeLoaded - timeSinceStart\r\n    if @indefiniteLength\r\n      return timeBuffered > 0\r\n    else\r\n      return timeBuffered > REAL_TIME_BUFFER_MAX * @realTimeSpeedFactor\r\n\r\n  shouldUpdateRealTimePlayback: (t) ->\r\n    return false unless @realTime\r\n    return false if @frames.length * @dt is @lastRealTimeUpdate\r\n    timeLoaded = @frames.length * @dt * 1000\r\n    timeSinceStart = (t - @worldLoadStartTime) * @realTimeSpeedFactor\r\n    remainingBuffer = @lastRealTimeUpdate * 1000 - timeSinceStart\r\n    if @indefiniteLength\r\n      return remainingBuffer <= 0\r\n    else\r\n      return remainingBuffer < REAL_TIME_BUFFER_MIN * @realTimeSpeedFactor\r\n\r\n  shouldContinueLoading: (t1, loadProgressCallback, skipDeferredLoading, continueLaterFn) ->\r\n    t2 = now()\r\n    chunkSize = @frames.length - @framesSerializedSoFar\r\n    simedTime = @frames.length / @frameRate\r\n\r\n    chunkTime = switch\r\n      when simedTime > 15 then 7\r\n      when simedTime > 10 then 5\r\n      when simedTime > 5 then 3\r\n      when simedTime > 2 then 1\r\n      else 0.5\r\n\r\n    bailoutTime = Math.max(2000*chunkTime, 10000)\r\n\r\n    dt = t2 - t1\r\n\r\n    if @realTime\r\n      shouldUpdateProgress = @shouldUpdateRealTimePlayback t2\r\n      shouldDelayRealTimeSimulation = not shouldUpdateProgress and @shouldDelayRealTimeSimulation t2\r\n    else\r\n      shouldUpdateProgress = (dt > PROGRESS_UPDATE_INTERVAL and (chunkSize / @frameRate >= chunkTime) or dt > bailoutTime)\r\n      shouldDelayRealTimeSimulation = false\r\n    return true unless shouldUpdateProgress or shouldDelayRealTimeSimulation\r\n    # Stop loading frames for now; continue in a moment.\r\n    if shouldUpdateProgress\r\n      @lastRealTimeUpdate = @frames.length * @dt if @realTime\r\n      #console.log 'we think it is now', (t2 - @worldLoadStartTime) / 1000, 'so delivering', @lastRealTimeUpdate\r\n      loadProgressCallback? @frames.length / @totalFrames unless @preloading\r\n    t1 = t2\r\n    if t2 - @t0 > 1000\r\n      console.log '  Loaded', @frames.length, 'of', @totalFrames, '(+' + (t2 - @t0).toFixed(0) + 'ms)' unless @realTime\r\n      @t0 = t2\r\n    if skipDeferredLoading\r\n      continueLaterFn()\r\n    else\r\n      delay = 0\r\n      if shouldDelayRealTimeSimulation\r\n        if @indefiniteLength\r\n          delay = 1000 / 30\r\n        else\r\n          delay = REAL_TIME_BUFFERED_WAIT_INTERVAL\r\n      setTimeout continueLaterFn, delay\r\n    false\r\n\r\n  adjustFlowSettings: (loadUntilFrame) ->\r\n    for thang in @thangs when thang.isProgrammable\r\n      userCode = @userCodeMap[thang.id] ? {}\r\n      for methodName, aether of userCode\r\n        framesToLoadFlowBefore = if methodName is 'plan' or methodName is 'makeBid' then 200 else 1  # Adjust if plan() is taking even longer\r\n        aether._shouldSkipFlow = @frames.length < loadUntilFrame - framesToLoadFlowBefore\r\n\r\n  finalizePreload: (loadedCallback) ->\r\n    @preloading = false\r\n    loadedCallback() if @ended\r\n\r\n  abort: ->\r\n    @aborted = true\r\n\r\n  addFlagEvent: (flagEvent) ->\r\n    @flagHistory.push flagEvent\r\n\r\n  addRealTimeInputEvent: (realTimeInputEvent) ->\r\n    @realTimeInputEvents.push realTimeInputEvent\r\n\r\n  loadFromLevel: (level, willSimulate=true) ->\r\n    @levelID = level.slug\r\n    @levelComponents = level.levelComponents\r\n    @thangTypes = level.thangTypes\r\n    @loadScriptsFromLevel level\r\n    @loadSystemsFromLevel level\r\n    @loadThangsFromLevel level, willSimulate\r\n    @showsCountdown = @levelID in COUNTDOWN_LEVELS or _.any(@thangs, (t) -> (t.programmableProperties and 'findFlags' in t.programmableProperties) or t.inventory?.flag)\r\n    @picoCTFProblem = level.picoCTFProblem if level.picoCTFProblem\r\n    if @picoCTFProblem?.instances and not @picoCTFProblem.flag_sha1\r\n      @picoCTFProblem = _.merge @picoCTFProblem, @picoCTFProblem.instances[0]\r\n    system.start @thangs for system in @systems\r\n\r\n  loadSystemsFromLevel: (level) ->\r\n    # Remove old Systems\r\n    @systems = []\r\n    @systemMap = {}\r\n\r\n    # Load new Systems\r\n    for levelSystem in level.systems\r\n      systemModel = levelSystem.model\r\n      config = levelSystem.config\r\n      systemClass = @loadClassFromCode systemModel.js, systemModel.name, 'system'\r\n      #console.log \"using db system class ---\\n\", systemClass, \"\\n--- from code ---n\", systemModel.js, \"\\n---\"\r\n      system = new systemClass @, config\r\n      @addSystems system\r\n    null\r\n\r\n  loadThangsFromLevel: (level, willSimulate) ->\r\n    # Remove old Thangs\r\n    @thangs = []\r\n    @thangMap = {}\r\n\r\n    # Load new Thangs\r\n    toAdd = (@loadThangFromLevel thangConfig, level.levelComponents, level.thangTypes for thangConfig in level.thangs ? [])\r\n    @extraneousThangs = consolidateThangs toAdd if willSimulate  # Combine walls, for example; serialize the leftovers later\r\n    @addThang thang for thang in toAdd\r\n    null\r\n\r\n  loadThangFromLevel: (thangConfig, levelComponents, thangTypes, equipBy=null) ->\r\n    components = []\r\n    for component, componentIndex in thangConfig.components\r\n      componentModel = _.find levelComponents, (c) ->\r\n        c.original is component.original and c.version.major is (component.majorVersion ? 0)\r\n      componentClass = @loadClassFromCode componentModel.js, componentModel.name, 'component'\r\n      components.push [componentClass, component.config]\r\n      if component.original is ITEM_ORIGINAL\r\n        isItem = true\r\n        component.config.ownerID = equipBy if equipBy\r\n      else if component.original is EXISTS_ORIGINAL\r\n        existsConfigIndex = componentIndex\r\n    if isItem and existsConfigIndex?\r\n      # For memory usage performance, make sure these don't get any tracked properties assigned.\r\n      components[existsConfigIndex][1] = {exists: false, stateless: true}\r\n    thangTypeOriginal = thangConfig.thangType\r\n    thangTypeModel = _.find thangTypes, (t) -> t.original is thangTypeOriginal\r\n    return console.error thangConfig.id ? equipBy, 'could not find ThangType for', thangTypeOriginal unless thangTypeModel\r\n    thangTypeName = thangTypeModel.name\r\n    thang = new Thang @, thangTypeName, thangConfig.id\r\n    try\r\n      thang.addComponents components...\r\n    catch e\r\n      console.error 'couldn\\'t load components for', thangTypeOriginal, thangConfig.id, 'because', e.toString(), e.stack\r\n    thang\r\n\r\n  addThang: (thang) ->\r\n    @thangs.unshift thang  # Interactions happen in reverse order of specification/drawing\r\n    @setThang thang\r\n    @updateThangState thang\r\n    thang.updateRegistration()\r\n    thang\r\n\r\n  loadScriptsFromLevel: (level) ->\r\n    @scriptNotes = []\r\n    @scripts = []\r\n    @addScripts level.scripts...\r\n\r\n  loadClassFromCode: (js, name, kind='component') ->\r\n    # Cache them based on source code so we don't have to worry about extra compilations\r\n    @componentCodeClassMap ?= {}\r\n    @systemCodeClassMap ?= {}\r\n    map = if kind is 'component' then @componentCodeClassMap else @systemCodeClassMap\r\n    c = map[js]\r\n    return c if c\r\n    try\r\n      c = map[js] = eval js\r\n    catch err\r\n      console.error \"Couldn't compile #{kind} code:\", err, \"\\n\", js\r\n      c = map[js] = {}\r\n    c.className = name\r\n    c\r\n\r\n  updateThangState: (thang) ->\r\n    @frames[@frames.length-1].thangStateMap[thang.id] = thang.getState()\r\n\r\n  size: ->\r\n    @calculateBounds() unless @width? and @height?\r\n    return [@width, @height] if @width? and @height?\r\n\r\n  getBounds: ->\r\n    @calculateBounds() unless @bounds?\r\n    return @bounds\r\n\r\n  calculateBounds: ->\r\n    bounds = {left: 0, top: 0, right: 0, bottom: 0}\r\n    hasLand = _.some @thangs, 'isLand'\r\n    for thang in @thangs when thang.isLand or (not hasLand and thang.rectangle)  # Look at Lands only\r\n      rect = thang.rectangle().axisAlignedBoundingBox()\r\n      bounds.left = Math.min(bounds.left, rect.x - rect.width / 2)\r\n      bounds.right = Math.max(bounds.right, rect.x + rect.width / 2)\r\n      bounds.bottom = Math.min(bounds.bottom, rect.y - rect.height / 2)\r\n      bounds.top = Math.max(bounds.top, rect.y + rect.height / 2)\r\n    @width = bounds.right - bounds.left\r\n    @height = bounds.top - bounds.bottom\r\n    @bounds = bounds\r\n    [@width, @height]\r\n\r\n  publishNote: (channel, event) ->\r\n    event ?= {}\r\n    channel = 'world:' + channel\r\n    for script in @scripts ? []\r\n      continue if script.channel isnt channel\r\n      scriptNote = new WorldScriptNote script, event\r\n      continue if scriptNote.invalid\r\n      @scriptNotes.push scriptNote\r\n    return unless @goalManager\r\n    @goalManager.submitWorldGenerationEvent(channel, event, @frames.length)\r\n\r\n  getGoalState: (goalID) ->\r\n    @goalManager.getGoalState(goalID)\r\n\r\n  setGoalState: (goalID, status) ->\r\n    @goalManager.setGoalState(goalID, status)\r\n\r\n  endWorld: (victory=false, delay=3, tentative=false) ->\r\n    @totalFrames = Math.min(@totalFrames, @frames.length + Math.floor(delay / @dt))  # end a few seconds later\r\n    @victory = victory  # TODO: should just make this signify the winning superteam\r\n    @victoryIsTentative = tentative\r\n    status = if @victory then 'won' else 'lost'\r\n    @publishNote status\r\n    console.log \"The world ended in #{status} on frame #{@totalFrames}\"\r\n\r\n  addSystems: (systems...) ->\r\n    @systems = @systems.concat systems\r\n    for system in systems\r\n      @systemMap[system.constructor.className] = system\r\n  getSystem: (systemClassName) ->\r\n    @systemMap?[systemClassName]\r\n\r\n  addScripts: (scripts...) ->\r\n    @scripts = (@scripts ? []).concat scripts\r\n\r\n  addTrackedProperties: (props...) ->\r\n    @trackedProperties = (@trackedProperties ? []).concat props\r\n\r\n  serialize: ->\r\n    # Code hotspot; optimize it\r\n    @freeMemoryBeforeFinalSerialization() if @ended\r\n    startFrame = @framesSerializedSoFar\r\n    endFrame = @frames.length\r\n    if @indefiniteLength\r\n      toClear = Math.max(@framesSerializedSoFar-10, 0)\r\n      for i in _.range(@framesClearedSoFar, toClear)\r\n        @frames[i] = null\r\n      @framesClearedSoFar = @framesSerializedSoFar\r\n    #console.log \"... world serializing frames from\", startFrame, \"to\", endFrame, \"of\", @totalFrames\r\n    [transferableObjects, nontransferableObjects] = [0, 0]\r\n    serializedFlagHistory = (_.omit(_.clone(flag), 'processed') for flag in @flagHistory)\r\n    o = {totalFrames: @totalFrames, maxTotalFrames: @maxTotalFrames, frameRate: @frameRate, dt: @dt, victory: @victory, userCodeMap: {}, trackedProperties: {}, flagHistory: serializedFlagHistory, difficulty: @difficulty, scores: @getScores(), randomSeed: @randomSeed, picoCTFFlag: @picoCTFFlag}\r\n    o.trackedProperties[prop] = @[prop] for prop in @trackedProperties or []\r\n\r\n    for thangID, methods of @userCodeMap\r\n      serializedMethods = o.userCodeMap[thangID] = {}\r\n      for methodName, method of methods\r\n        serializedMethods[methodName] = method.serialize?() ? method # serialize the method again if it has been deserialized\r\n\r\n    t0 = now()\r\n    o.trackedPropertiesThangIDs = []\r\n    o.trackedPropertiesPerThangIndices = []\r\n    o.trackedPropertiesPerThangKeys = []\r\n    o.trackedPropertiesPerThangTypes = []\r\n    trackedPropertiesPerThangValues = []  # We won't send these, just the offsets and the storage buffer\r\n    o.trackedPropertiesPerThangValuesOffsets = []  # Needed to reconstruct ArrayBufferViews on other end, since Firefox has bugs transfering those: https://bugzilla.mozilla.org/show_bug.cgi?id=841904 and https://bugzilla.mozilla.org/show_bug.cgi?id=861925  # Actually, as of January 2014, it should be fixed. So we could try to undo the workaround.\r\n    transferableStorageBytesNeeded = 0\r\n    nFrames = endFrame - startFrame\r\n    for thang in @thangs\r\n      # Don't serialize empty trackedProperties for stateless Thangs which haven't changed (like obstacles).\r\n      # Check both, since sometimes people mark stateless Thangs but then change them, and those should still be tracked, and the inverse doesn't work on the other end (we'll just think it doesn't exist then).\r\n      # If streaming the world, a thang marked stateless that actually change will get messed up. I think.\r\n      continue if thang.stateless and not _.some(thang.trackedPropertiesUsed, Boolean)\r\n      o.trackedPropertiesThangIDs.push thang.id\r\n      trackedPropertiesIndices = []\r\n      trackedPropertiesKeys = []\r\n      trackedPropertiesTypes = []\r\n      for used, propIndex in thang.trackedPropertiesUsed\r\n        continue unless used\r\n        trackedPropertiesIndices.push propIndex\r\n        trackedPropertiesKeys.push thang.trackedPropertiesKeys[propIndex]\r\n        trackedPropertiesTypes.push thang.trackedPropertiesTypes[propIndex]\r\n      o.trackedPropertiesPerThangIndices.push trackedPropertiesIndices\r\n      o.trackedPropertiesPerThangKeys.push trackedPropertiesKeys\r\n      o.trackedPropertiesPerThangTypes.push trackedPropertiesTypes\r\n      trackedPropertiesPerThangValues.push []\r\n      o.trackedPropertiesPerThangValuesOffsets.push []\r\n      for type in trackedPropertiesTypes\r\n        transferableStorageBytesNeeded += ThangState.transferableBytesNeededForType(type, nFrames)\r\n    if typedArraySupport\r\n      o.storageBuffer = new ArrayBuffer(transferableStorageBytesNeeded)\r\n    else\r\n      o.storageBuffer = []\r\n    storageBufferOffset = 0\r\n    for trackedPropertiesValues, thangIndex in trackedPropertiesPerThangValues\r\n      trackedPropertiesValuesOffsets = o.trackedPropertiesPerThangValuesOffsets[thangIndex]\r\n      for type, propIndex in o.trackedPropertiesPerThangTypes[thangIndex]\r\n        [storage, bytesStored] = ThangState.createArrayForType type, nFrames, o.storageBuffer, storageBufferOffset\r\n        trackedPropertiesValues.push storage\r\n        trackedPropertiesValuesOffsets.push storageBufferOffset\r\n        ++transferableObjects if bytesStored\r\n        ++nontransferableObjects unless bytesStored\r\n        if typedArraySupport\r\n          storageBufferOffset += bytesStored\r\n        else\r\n          # Instead of one big array with each storage as a view into it, they're all separate, so let's keep 'em around for flattening.\r\n          storageBufferOffset += storage.length\r\n          o.storageBuffer.push storage\r\n\r\n    o.specialKeysToValues = [null, Infinity, NaN]\r\n    # Whatever is in specialKeysToValues index 0 will be default for anything missing, so let's make sure it's null.\r\n    # Don't think we can include undefined or it'll be treated as a sparse array; haven't tested performance.\r\n    o.specialValuesToKeys = {}\r\n    for specialValue, i in o.specialKeysToValues\r\n      o.specialValuesToKeys[specialValue] = i\r\n\r\n    t1 = now()\r\n    o.frameHashes = []\r\n    for frameIndex in [startFrame ... endFrame]\r\n      o.frameHashes.push @frames[frameIndex].serialize(frameIndex - startFrame, o.trackedPropertiesThangIDs, o.trackedPropertiesPerThangIndices, o.trackedPropertiesPerThangTypes, trackedPropertiesPerThangValues, o.specialValuesToKeys, o.specialKeysToValues)\r\n    t2 = now()\r\n\r\n    unless typedArraySupport\r\n      flattened = []\r\n      for storage in o.storageBuffer\r\n        for value in storage\r\n          flattened.push value\r\n      o.storageBuffer = flattened\r\n\r\n    #console.log 'Allocating memory:', (t1 - t0).toFixed(0), 'ms; assigning values:', (t2 - t1).toFixed(0), 'ms, so', ((t2 - t1) / nFrames).toFixed(3), 'ms per frame for', nFrames, 'frames'\r\n    #console.log 'Got', transferableObjects, 'transferable objects and', nontransferableObjects, 'nontransferable; stored', transferableStorageBytesNeeded, 'bytes transferably'\r\n\r\n    o.thangs = (t.serialize() for t in @thangs.concat(@extraneousThangs ? []))\r\n    o.scriptNotes = (sn.serialize() for sn in @scriptNotes)\r\n    if o.scriptNotes.length > 200\r\n      console.log 'Whoa, serializing a lot of WorldScriptNotes here:', o.scriptNotes.length\r\n    @freeMemoryAfterEachSerialization() unless @ended\r\n    {serializedWorld: o, transferableObjects: [o.storageBuffer], startFrame: startFrame, endFrame: endFrame}\r\n\r\n  @deserialize: (o, classMap, oldSerializedWorldFrames, finishedWorldCallback, startFrame, endFrame, level, streamingWorld) ->\r\n    # Code hotspot; optimize it\r\n    #console.log 'Deserializing', o, 'length', JSON.stringify(o).length\r\n    #console.log JSON.stringify(o)\r\n    #console.log 'Got special keys and values:', o.specialValuesToKeys, o.specialKeysToValues\r\n    perf = {}\r\n    perf.t0 = now()\r\n    nFrames = endFrame - startFrame\r\n    if streamingWorld\r\n      w = streamingWorld\r\n      # Make sure we get any Aether updates from the new frames into the already-deserialized streaming world Aethers.\r\n      for thangID, methods of o.userCodeMap\r\n        for methodName, serializedAether of methods\r\n          for aetherStateKey in ['flow', 'metrics', 'style', 'problems']\r\n            w.userCodeMap[thangID] ?= {}\r\n            w.userCodeMap[thangID][methodName] ?= {}\r\n            w.userCodeMap[thangID][methodName][aetherStateKey] = serializedAether[aetherStateKey]\r\n    else\r\n      w = new World o.userCodeMap, classMap\r\n    [w.totalFrames, w.maxTotalFrames, w.frameRate, w.dt, w.scriptNotes, w.victory, w.flagHistory, w.difficulty, w.scores, w.randomSeed, w.picoCTFFlag] = [o.totalFrames, o.maxTotalFrames, o.frameRate, o.dt, o.scriptNotes ? [], o.victory, o.flagHistory, o.difficulty, o.scores, o.randomSeed, o.picoCTFFlag]\r\n    w[prop] = val for prop, val of o.trackedProperties\r\n\r\n    perf.t1 = now()\r\n    if w.thangs.length\r\n      for thangConfig in o.thangs\r\n        if thang = w.thangMap[thangConfig.id]\r\n          for prop, val of thangConfig.finalState\r\n            thang[prop] = val\r\n        else\r\n          w.thangs.push thang = Thang.deserialize(thangConfig, w, classMap, level.levelComponents)\r\n          w.setThang thang\r\n    else\r\n      w.thangs = (Thang.deserialize(thang, w, classMap, level.levelComponents) for thang in o.thangs)\r\n      w.setThang thang for thang in w.thangs\r\n    w.scriptNotes = (WorldScriptNote.deserialize(sn, w, classMap) for sn in o.scriptNotes)\r\n    perf.t2 = now()\r\n\r\n    o.trackedPropertiesThangs = (w.getThangByID thangID for thangID in o.trackedPropertiesThangIDs)\r\n    o.trackedPropertiesPerThangValues = []\r\n    for trackedPropertyTypes, thangIndex in o.trackedPropertiesPerThangTypes\r\n      o.trackedPropertiesPerThangValues.push (trackedPropertiesValues = [])\r\n      trackedPropertiesValuesOffsets = o.trackedPropertiesPerThangValuesOffsets[thangIndex]\r\n      for type, propIndex in trackedPropertyTypes\r\n        storage = ThangState.createArrayForType(type, nFrames, o.storageBuffer, trackedPropertiesValuesOffsets[propIndex])[0]\r\n        unless typedArraySupport\r\n          # This could be more efficient\r\n          i = trackedPropertiesValuesOffsets[propIndex]\r\n          storage = o.storageBuffer.slice i, i + storage.length\r\n        trackedPropertiesValues.push storage\r\n    perf.t3 = now()\r\n\r\n    perf.batches = 0\r\n    perf.framesCPUTime = 0\r\n    w.frames = [] unless streamingWorld\r\n    clearTimeout @deserializationTimeout if @deserializationTimeout\r\n\r\n    if w.indefiniteLength\r\n      clearTo = Math.max(w.frames.length - 100, 0)\r\n      if clearTo > w.framesClearedSoFar\r\n        for i in _.range(w.framesClearedSoFar, clearTo)\r\n          w.frames[i] = null\r\n      w.framesClearedSoFar = clearTo\r\n\r\n    @deserializationTimeout = _.delay @deserializeSomeFrames, 1, o, w, finishedWorldCallback, perf, startFrame, endFrame\r\n    w  # Return in-progress deserializing world\r\n\r\n  # Spread deserialization out across multiple calls so the interface stays responsive\r\n  @deserializeSomeFrames: (o, w, finishedWorldCallback, perf, startFrame, endFrame) =>\r\n    ++perf.batches\r\n    startTime = now()\r\n    for frameIndex in [w.frames.length ... endFrame]\r\n      w.frames.push WorldFrame.deserialize(w, frameIndex - startFrame, o.trackedPropertiesThangIDs, o.trackedPropertiesThangs, o.trackedPropertiesPerThangKeys, o.trackedPropertiesPerThangTypes, o.trackedPropertiesPerThangValues, o.specialKeysToValues, o.frameHashes[frameIndex - startFrame], w.dt * frameIndex)\r\n      elapsed = now() - startTime\r\n      if elapsed > DESERIALIZATION_INTERVAL and frameIndex < endFrame - 1\r\n        #console.log \"  Deserialization not finished, let's do it again soon. Have:\", w.frames.length, \", wanted from\", startFrame, \"to\", endFrame\r\n        perf.framesCPUTime += elapsed\r\n        @deserializationTimeout = _.delay @deserializeSomeFrames, 1, o, w, finishedWorldCallback, perf, startFrame, endFrame\r\n        return\r\n    @deserializationTimeout = null\r\n    perf.framesCPUTime += elapsed\r\n    @finishDeserializing w, finishedWorldCallback, perf, startFrame, endFrame\r\n\r\n  @finishDeserializing: (w, finishedWorldCallback, perf, startFrame, endFrame) ->\r\n    perf.t4 = now()\r\n    w.ended = true\r\n    nFrames = endFrame - startFrame\r\n    totalCPUTime = perf.t3 - perf.t0 + perf.framesCPUTime\r\n    #console.log 'Deserialization:', totalCPUTime.toFixed(0) + 'ms (' + (totalCPUTime / nFrames).toFixed(3) + 'ms per frame).', perf.batches, 'batches. Did', startFrame, 'to', endFrame, 'in', (perf.t4 - perf.t0).toFixed(0) + 'ms wall clock time.'\r\n    if false\r\n      console.log '  Deserializing--constructing new World:', (perf.t1 - perf.t0).toFixed(2) + 'ms'\r\n      console.log '  Deserializing--Thangs and ScriptNotes:', (perf.t2 - perf.t1).toFixed(2) + 'ms'\r\n      console.log '  Deserializing--reallocating memory:', (perf.t3 - perf.t2).toFixed(2) + 'ms'\r\n      console.log '  Deserializing--WorldFrames:', (perf.t4 - perf.t3).toFixed(2) + 'ms wall clock time,', (perf.framesCPUTime).toFixed(2) + 'ms CPU time'\r\n    finishedWorldCallback w\r\n\r\n  findFirstChangedFrame: (oldWorld) ->\r\n    return 0 unless oldWorld\r\n    for newFrame, i in @frames\r\n      oldFrame = oldWorld.frames[i]\r\n      break unless oldFrame and ((newFrame.hash is oldFrame.hash) or not newFrame.hash? or not oldFrame.hash?)  # undefined gets in there when streaming at the last frame of each batch for some reason\r\n    firstChangedFrame = i\r\n    if @frames.length is @totalFrames\r\n      if @frames[i]\r\n        console.log 'First changed frame is', firstChangedFrame, 'with hash', @frames[i].hash, 'compared to', oldWorld.frames[i]?.hash\r\n      else\r\n        console.log 'No frames were changed out of all', @frames.length\r\n    firstChangedFrame\r\n\r\n  freeMemoryBeforeFinalSerialization: ->\r\n    @levelComponents = null\r\n    @thangTypes = null\r\n\r\n  freeMemoryAfterEachSerialization: ->\r\n    @frames[i] = null for frame, i in @frames when i < @frames.length - 1\r\n\r\n  pointsForThang: (thangID, camera=null) ->\r\n    # Optimized\r\n    @pointsForThangCache ?= {}\r\n    cacheKey = thangID\r\n    allPoints = @pointsForThangCache[cacheKey]\r\n    unless allPoints\r\n      allPoints = []\r\n      lastFrameIndex = @frames.length - 1\r\n      lastPos = x: null, y: null\r\n      for frameIndex in [lastFrameIndex .. 0] by -1\r\n        frame = @frames[frameIndex]\r\n        continue unless frame # may have been evicted for game dev levels\r\n        if pos = frame.thangStateMap[thangID]?.getStateForProp 'pos'\r\n          pos = camera.worldToSurface {x: pos.x, y: pos.y} if camera  # without z\r\n          if not lastPos.x? or (Math.abs(lastPos.x - pos.x) + Math.abs(lastPos.y - pos.y)) > 1\r\n            lastPos = pos\r\n        allPoints.push lastPos.y, lastPos.x unless lastPos.y is 0 and lastPos.x is 0\r\n      allPoints.reverse()\r\n      @pointsForThangCache[cacheKey] = allPoints\r\n\r\n    return allPoints\r\n\r\n  actionsForThang: (thangID, keepIdle=false) ->\r\n    # Optimized\r\n    @actionsForThangCache ?= {}\r\n    cacheKey = thangID + '_' + Boolean(keepIdle)\r\n    cached = @actionsForThangCache[cacheKey]\r\n    return cached if cached\r\n    states = (frame.thangStateMap[thangID] for frame in @frames)\r\n    actions = []\r\n    lastAction = ''\r\n    for state, i in states\r\n      action = state?.getStateForProp 'action'\r\n      continue unless action and (action isnt lastAction or state.actionActivated)\r\n      continue unless state.action isnt 'idle' or keepIdle\r\n      actions.push {frame: i, pos: state.pos, name: action}\r\n      lastAction = action\r\n    @actionsForThangCache[cacheKey] = actions\r\n    return actions\r\n\r\n  getTeamColors: ->\r\n    teamConfigs = @teamConfigs or {}\r\n    colorConfigs = {}\r\n    colorConfigs[teamName] = config.color for teamName, config of teamConfigs\r\n    colorConfigs\r\n\r\n  teamForPlayer: (n) ->\r\n    playableTeams = @playableTeams ? ['humans']\r\n    playableTeams[n % playableTeams.length]\r\n\r\n  getScores: ->\r\n    time: @age\r\n    'damage-taken': @getSystem('Combat')?.damageTakenForTeam 'humans'\r\n    'damage-dealt': @getSystem('Combat')?.damageDealtForTeam 'humans'\r\n    'gold-collected': @getSystem('Inventory')?.teamGold.humans?.collected\r\n    'difficulty': @difficulty\r\n","ThangState = require './thang_state'\r\n\r\nmodule.exports = class WorldFrame\r\n  @className: 'WorldFrame'\r\n\r\n  constructor: (@world, @time=0) ->\r\n    @thangStateMap = {}\r\n    @setState() if @world\r\n\r\n  getNextFrame: ->\r\n    # Optimized. Must be called while thangs are current at this frame.\r\n    nextTime = @time + @world.dt\r\n    return null if nextTime > @world.lifespan and not @world.indefiniteLength\r\n    @hash = @world.rand.seed\r\n    @hash += system.update() for system in @world.systems\r\n    nextFrame = new WorldFrame(@world, nextTime)\r\n    return nextFrame\r\n\r\n  setState: ->\r\n    for thang in @world.thangs when not thang.stateless\r\n      @thangStateMap[thang.id] = thang.getState()\r\n\r\n  restoreState: ->\r\n    thangState.restore() for thangID, thangState of @thangStateMap\r\n    for thang in @world.thangs\r\n      if not @thangStateMap[thang.id] and not thang.stateless\r\n        #console.log 'Frame', @time, 'restoring state for', thang.id, 'and saying it don\\'t exist'\r\n        thang.exists = false\r\n\r\n  restorePartialState: (ratio) ->\r\n    thangState.restorePartial ratio for thangID, thangState of @thangStateMap\r\n\r\n  restoreStateForThang: (thang) ->\r\n    thangState = @thangStateMap[thang.id]\r\n    if not thangState\r\n      if not thang.stateless\r\n        thang.exists = false\r\n        #console.log 'Frame', @time, 'restoring state for', thang.id, 'in particular and saying it don\\'t exist'\r\n      return\r\n    thangState.restore()\r\n\r\n  clearEvents: -> thang.currentEvents = [] for thang in @world.thangs\r\n\r\n  toString: ->\r\n    map = ((' ' for x in [0 .. @world.width])  \\\r\n           for y in [0 .. @world.height])\r\n    symbols = '.ox@dfga[]/D'\r\n    for thang, i in @world.thangs when thang.rectangle\r\n      rect = thang.rectangle().axisAlignedBoundingBox()\r\n      for y in [Math.floor(rect.y - rect.height / 2) ... Math.ceil(rect.y + rect.height / 2)]\r\n        for x in [Math.floor(rect.x - rect.width / 2) ... Math.ceil(rect.x + rect.width / 2)]\r\n          map[y][x] = symbols[i % symbols.length] if 0 <= y < @world.height and 0 <= x < @world.width\r\n    @time + '\\n' + (xs.join(' ') for xs in map).join('\\n') + '\\n'\r\n\r\n  serialize: (frameIndex, trackedPropertiesThangIDs, trackedPropertiesPerThangIndices, trackedPropertiesPerThangTypes, trackedPropertiesPerThangValues, specialValuesToKeys, specialKeysToValues) ->\r\n    # Optimize\r\n    for thangID, thangIndex in trackedPropertiesThangIDs\r\n      thangState = @thangStateMap[thangID]\r\n      if thangState\r\n        thangState.serialize(frameIndex, trackedPropertiesPerThangIndices[thangIndex], trackedPropertiesPerThangTypes[thangIndex], trackedPropertiesPerThangValues[thangIndex], specialValuesToKeys, specialKeysToValues)\r\n    @hash\r\n\r\n  @deserialize: (world, frameIndex, trackedPropertiesThangIDs, trackedPropertiesThangs, trackedPropertiesPerThangKeys, trackedPropertiesPerThangTypes, trackedPropertiesPerThangValues, specialKeysToValues, hash, age) ->\r\n    # Optimize\r\n    wf = new WorldFrame null, age\r\n    wf.world = world\r\n    wf.hash = hash\r\n    for thangID, thangIndex in trackedPropertiesThangIDs\r\n      wf.thangStateMap[thangID] = ThangState.deserialize world, frameIndex, trackedPropertiesThangs[thangIndex], trackedPropertiesPerThangKeys[thangIndex], trackedPropertiesPerThangTypes[thangIndex], trackedPropertiesPerThangValues[thangIndex], specialKeysToValues\r\n    wf\r\n","{clone} = require './world_utils'\r\n{scriptMatchesEventPrereqs} = require './script_event_prereqs'\r\n\r\nmodule.exports = class WorldScriptNote\r\n  @className: 'WorldScriptNote'\r\n  constructor: (script, @event, world) ->\r\n    return unless script?\r\n    @invalid = true\r\n    return unless scriptMatchesEventPrereqs(script, @event)\r\n    # Could add the scriptPrereqsSatisfied or seen/repeats stuff if needed\r\n    @invalid = false\r\n    @channel = script.channel\r\n    @event ?= {}\r\n    @event.replacedNoteChain = script.noteChain\r\n\r\n  serialize: ->\r\n    o = {channel: @channel, event: {}}\r\n    for key, value of @event\r\n      if value?.isThang\r\n        value = {isThang: true, id: value.id}\r\n      else if _.isArray value\r\n        for subval, i in value\r\n          if subval?.isThang\r\n            value[i] = {isThang: true, id: subval.id}\r\n      o.event[key] = value\r\n    o\r\n\r\n  @deserialize: (o, world, classMap) ->\r\n    scriptNote = new WorldScriptNote\r\n    scriptNote.channel = o.channel\r\n    scriptNote.event = {}\r\n    for key, value of o.event\r\n      if value? and typeof value is 'object' and value.isThang\r\n        value = world.getThangByID value.id\r\n      else if _.isArray value\r\n        for subval, i in value\r\n          if subval? and typeof subval is 'object' and subval.isThang\r\n            value[i] = world.getThangByID subval.id\r\n      else if value? and typeof value is 'object' and value.CN\r\n        value = classMap[value.CN].deserialize value, world, classMap\r\n      scriptNote.event[key] = value\r\n    scriptNote\r\n","Vector = require './vector'\r\nRectangle = require './rectangle'\r\nEllipse = require './ellipse'\r\nLineSegment = require './line_segment'\r\nGrid = require './Grid'\r\n\r\nmodule.exports.typedArraySupport = typedArraySupport = Float32Array?  # Not in IE until IE 10; we'll fall back to normal arrays\r\n#module.exports.typedArraySupport = typedArraySupport = false  # imitate IE9 (and in God.coffee)\r\n\r\nunless ArrayBufferView?\r\n  # https://code.google.com/p/chromium/issues/detail?id=60449\r\n  if typedArraySupport\r\n    # We have it, it's just not exposed\r\n    someArray = new Uint8Array(0)\r\n    if someArray.__proto__\r\n      # Most browsers\r\n      ArrayBufferView = someArray.__proto__.__proto__.constructor\r\n    else\r\n      # IE before 11\r\n      ArrayBufferView = Object.getPrototypeOf(Object.getPrototypeOf(someArray)).constructor\r\n  else\r\n    # If we don't have typed arrays, we don't need an ArrayBufferView\r\n    ArrayBufferView = null\r\n\r\nmodule.exports.clone = clone = (obj, skipThangs=false) ->\r\n  # http://coffeescriptcookbook.com/chapters/classes_and_objects/cloning\r\n  if not obj? or typeof obj isnt 'object'\r\n    return obj\r\n\r\n  if obj instanceof Date\r\n    return new Date(obj.getTime())\r\n\r\n  if obj instanceof RegExp\r\n    flags = ''\r\n    flags += 'g' if obj.global?\r\n    flags += 'i' if obj.ignoreCase?\r\n    flags += 'm' if obj.multiline?\r\n    flags += 'y' if obj.sticky?\r\n    return new RegExp(obj.source, flags)\r\n\r\n  if (obj instanceof Vector) or (obj instanceof Rectangle) or (obj instanceof Ellipse) or (obj instanceof LineSegment)\r\n    return obj.copy()\r\n\r\n  if skipThangs and obj.isThang\r\n    return obj\r\n\r\n  if _.isArray obj\r\n    return obj.slice()\r\n\r\n  if ArrayBufferView and obj instanceof ArrayBufferView\r\n    return new obj.constructor obj\r\n\r\n  newInstance = new obj.constructor()\r\n  for key of obj\r\n    newInstance[key] = clone obj[key], skipThangs\r\n\r\n  newInstance\r\n\r\n# Walk a key chain down to the value. Can optionally set newValue instead.\r\nmodule.exports.downTheChain = downTheChain = (obj, keyChain, newValue=undefined) ->\r\n  return null unless obj\r\n  return obj[keyChain] unless _.isArray keyChain\r\n  value = obj\r\n  while keyChain.length and value\r\n    if newValue isnt undefined and keyChain.length is 1\r\n      value[keyChain[0]] = newValue\r\n      return newValue\r\n    value = value[keyChain[0]]\r\n    keyChain = keyChain[1..]\r\n  return value\r\n\r\nmodule.exports.now = (if window?.performance?.now? then (-> window.performance.now()) else (-> new Date()))\r\n\r\nmodule.exports.consolidateThangs = consolidateThangs = (thangs) ->\r\n  # We can gain a performance increase by consolidating all regular walls into a minimal covering, non-intersecting set a la Gridmancer.\r\n  debug = false\r\n  isStructural = (t) ->\r\n    t.stateless and t.collides and t.collisionCategory is 'obstacles' and t.shape in ['box', 'sheet'] and  # Can only do wall-like obstacle Thangs.\r\n    t.spriteName isnt 'Ice Wall' and t.restitution is 1.0 and  # Fixed restitution value on 2016-03-15, but it causes discrepancies, so disabled for Kelvintaph levels.\r\n    /Wall/.test(t.spriteName) and  # Not useful to do Thangs that aren't actually walls because they're usually not on a grid\r\n    (t.pos.x - t.width / 2 >= 0) and (t.pos.y - t.height / 2 >= 0)  # Grid doesn't handle negative numbers, so don't coalesce walls below/left of 0, 0.\r\n  structural = _.remove thangs, isStructural\r\n  return unless structural.length\r\n  rightmost = _.max structural, (t) -> t.pos.x + t.width / 2\r\n  topmost = _.max structural, (t) -> t.pos.y + t.height / 2\r\n  leftmost = _.min structural, (t) -> t.pos.x - t.width / 2\r\n  bottommost = _.min structural, (t) -> t.pos.y - t.height / 2\r\n  console.log 'got rightmost', rightmost.id, 'topmost', topmost.id, 'lefmostmost', leftmost.id, 'bottommost', bottommost.id, 'out of', structural.length, 'structural thangs' if debug\r\n  left = Math.min 0, leftmost.pos.x - leftmost.width / 2\r\n  bottom = Math.min 0, bottommost.pos.y - bottommost.height / 2\r\n  if (left < 0) or (bottom < 0)\r\n    console.error 'Negative structural Thangs aren\\'t supported, sorry!'  # TODO: largestRectangle, AI System, and anything else that accesses grid directly need updating to finish this\r\n  left = 0\r\n  bottom = 0\r\n  width = rightmost.pos.x + rightmost.width / 2 - left\r\n  height = topmost.pos.y + topmost.height / 2 - bottom\r\n  padding = 0\r\n  console.log 'got max width', width, 'height', height, 'left', left, 'bottom', bottom, 'of thangs', thangs.length, 'structural', structural.length if debug\r\n  grid = new Grid structural, width, height, padding, left, bottom\r\n\r\n  dissection = []\r\n  addStructuralThang = (rect) ->\r\n    thang = structural[dissection.length]  # Grab one we already know is configured properly.\r\n    console.error 'Hmm, our dissection has more Thangs than the original structural Thangs?', dissection.length unless thang\r\n    thang.pos.x = rect.x\r\n    thang.pos.y = rect.y\r\n    thang.width = rect.width\r\n    thang.height = rect.height\r\n    thang.destroyBody()\r\n    thang.createBodyDef()\r\n    thang.createBody()\r\n    dissection.push thang\r\n\r\n  dissectRectangles grid, addStructuralThang, false, debug\r\n\r\n  # Now add the new structural thangs back to thangs and return the ones not in the dissection.\r\n  console.log 'Turned', structural.length, 'structural Thangs into', dissection.length, 'dissecting Thangs.'\r\n  thangs.push dissection...\r\n  structural[dissection.length ... structural.length]\r\n\r\n\r\nmodule.exports.dissectRectangles = dissectRectangles = (grid, rectangleCallback, wantEmpty, debug) ->\r\n  # Mark Maxham's fast sweeper approach: https://github.com/codecombat/codecombat/issues/1090\r\n  console.log grid.toString() if debug\r\n  for x in grid.rows grid.left, grid.left + grid.width\r\n    y = grid.clampColumn grid.bottom\r\n    while y < grid.clampColumn grid.bottom + grid.height\r\n      y2 = y  # Note our current y.\r\n      ++y2 until occ x, y2, grid, wantEmpty  # Sweep through y to expand 1xN rect.\r\n      if y2 > y  # If we get a hit, sweep X with that swath.\r\n        x2 = x + 1\r\n        ++x2 until occCol x2, y, y2, grid, wantEmpty\r\n        w = x2 - x\r\n        h = y2 - y\r\n        rect = addRect grid, x, y, w, h, wantEmpty\r\n        rectangleCallback rect\r\n        console.log grid.toString() if debug\r\n        y = y2\r\n      ++y\r\n\r\nocc = (x, y, grid, wantEmpty) ->\r\n  return true if y > grid.bottom + grid.height or x > grid.left + grid.width\r\n  console.error 'trying to check invalid coordinates', x, y, 'from grid', grid.bottom, grid.left, grid.width, grid.height unless grid.grid[y]?[x]\r\n  Boolean(grid.grid[y][x].length) is wantEmpty\r\n\r\noccCol = (x, y1, y2, grid, wantEmpty) ->\r\n  for j in [y1 ... y2]\r\n    if occ(x, j, grid, wantEmpty)\r\n      return true\r\n  false\r\n\r\naddRect = (grid, leftX, bottomY, width, height, wantEmpty) ->\r\n  for x in [leftX ... leftX + width]\r\n    for y in [bottomY ... bottomY + height]\r\n      grid.grid[y][x] = if wantEmpty then [true] else []\r\n  new Rectangle leftX + width / 2, bottomY + height / 2, width, height\r\n"]}