{"version":3,"sources":["app/collections/Prepaids.coffee"],"names":[],"mappings":";AAAA;EAAA;;;AAAA,iBAAiB,QAAQ,4BAAR;;AACjB,UAAU,QAAQ,gBAAR;;AAEV,MAAM,SAAC,OAAD;SAAa,CAAC,CAAC,MAAF,CAAS,OAAT,EAAkB,SAAC,CAAD,EAAI,CAAJ;WAAU,IAAI;EAAd,CAAlB;AAAb;;AAEN,MAAM,CAAC,OAAP,GAAuB;;;;;;;qBACrB,QAAO;;qBAEP,MAAK;;qBAEL,aAAY;WACV,0CAAM,SAAN;EADU;;qBAGZ,aAAY,SAAC,OAAD;WACV,CACK,OAAO,CAAC,GAAR,CAAY,MAAZ,MAAuB,QAA1B,GAAwC,GAAxC,GAAiD,GADnD,EAEE,OAAO,CAAC,GAAR,CAAY,SAAZ,CAFF,CAGC,CAAC,QAHF;EADU;;qBAMZ,oBAAmB;AACjB;WAAA;;AAAK;AAAA;WAAA;;qBAAA,OAAO,CAAC,GAAR,CAAY,cAAZ;AAAA;;iBAAL,KAA6D;EAD5C;;qBAGnB,iBAAgB;AACd;WAAA;;AAAK;AAAA;WAAA;;qBAAA,CAAC,CAAC,IAAF,CAAO,OAAO,CAAC,GAAR,CAAY,WAAZ,CAAP;AAAA;;iBAAL,KAAkE;EADpD;;qBAGhB,iBAAgB;WAAG,IAAI,CAAC,GAAL,CAAS,IAAC,kBAAD,KAAuB,IAAC,eAAD,EAAhC,EAAmD,CAAnD;EAAH;;qBAEhB,iBAAgB,SAAC,SAAD,EAAY,IAAZ;;MACd,OAAQ;;;MACR,IAAI,CAAC,OAAQ;;IACb,IAAI,CAAC,IAAI,CAAC,OAAV,GAAoB;WACpB,IAAC,MAAD,CAAO,IAAP;EAJc;;;;GAtBsB","file":"public/javascripts/app/collections/Prepaids.js","sourcesContent":["CocoCollection = require 'collections/CocoCollection'\r\nPrepaid = require 'models/Prepaid'\r\n\r\nsum = (numbers) -> _.reduce(numbers, (a, b) -> a + b)\r\n\r\nmodule.exports = class Prepaids extends CocoCollection\r\n  model: Prepaid\r\n\r\n  url: \"/db/prepaid\"\r\n  \r\n  initialize: ->\r\n    super(arguments...)\r\n\r\n  comparator: (prepaid) ->\r\n    [\r\n      if prepaid.get('type') is 'course' then 'C' else 'S'\r\n      prepaid.get('endDate')\r\n    ].toString()\r\n\r\n  totalMaxRedeemers: ->\r\n    sum((prepaid.get('maxRedeemers') for prepaid in @models)) or 0\r\n    \r\n  totalRedeemers: ->\r\n    sum((_.size(prepaid.get('redeemers')) for prepaid in @models)) or 0\r\n    \r\n  totalAvailable: -> Math.max(@totalMaxRedeemers() - @totalRedeemers(), 0)\r\n\r\n  fetchByCreator: (creatorID, opts) ->\r\n    opts ?= {}\r\n    opts.data ?= {}\r\n    opts.data.creator = creatorID\r\n    @fetch opts\r\n"]}