{"version":3,"sources":["app/schemas/models/level_session.coffee"],"names":[],"mappings":";AAAA;;AAAA,IAAI,QAAQ,cAAR;;AAEJ,2BAA2B,CAAC,CAAC,MAAF,CACzB;EAAA,IAAI,CAAC,CAAC,QAAF,CACF;IAAA,OAAO;MACL;QACE,KAAK,OADP;QAEE,MAAM,gBAFR;OADK;KAAP;GADE,CAAJ;EAOA,MACE;IAAA,MAAM,QAAN;GARF;EASA,SACE;IAAA,MAAM,QAAN;GAVF;CADyB;;AAa3B,0BAA0B,CAAC,CAAC,MAAF,CAAS;EAAC,UAAU,CAAC,UAAD,EAAa,cAAb,CAAX;EAAyC,OAAO;IAAC;MAAC,KAAK,IAAN;MAAY,MAAM,iDAAlB;KAAD;GAAhD;CAAT,EACxB;EAAA,UAAU,CAAC,CAAC,QAAF,CAAW,EAAX,CAAV;EACA,cACE;IAAA,MAAM,SAAN;IACA,SAAS,CADT;GAFF;CADwB;;AAM1B,qBAAqB,CAAC,CAAC,MAAF,CACnB;EAAA,OAAO,SAAP;EACA,aAAa,qCADb;EAEA,WACE;IAAA,cAAc,QAAd;IACA,uBAAuB,QADvB;IAEA,UAAU,CAFV;GAHF;CADmB;;AAQrB,CAAC,CAAC,MAAF,CAAS,kBAAkB,CAAC,UAA5B,EAEE;EAAA,SACE;IAAA,MAAM,QAAN;GADF;EAEA,aACE;IAAA,MAAM,QAAN;GAHF;EAIA,WACE;IAAA,MAAM,QAAN;GALF;EAMA,SACE;IAAA,MAAM,QAAN;GAPF;EAQA,SAAS,CAAC,CAAC,QAAF,CACP;IAAA,OACE;MACE;QACE,KAAK,OADP;QAEE,MAAM,gBAFR;OADF;KADF;GADO,CART;EAgBA,SAAS,CAAC,CAAC,IAAF,CACP;IAAA,OAAO,SAAP;IACA,UAAU,IADV;GADO,CAhBT;EAoBA,SAAS,CAAC,CAAC,IAAF,CACP;IAAA,OAAO,SAAP;IACA,UAAU,IADV;GADO,CApBT;EAwBA,oBAAoB,EAxBpB;EA4BA,MAAM,CAAC,CAAC,WAAF,EA5BN;EA6BA,OAAO,uBA7BP;EA+BA,YAAY,CAAC,CAAC,gBA/Bd;EAiCA,OAAO,CAAC,CAAC,MAAF,CAAS,EAAT,EACL;IAAA,UACE;MAAA,MAAM,SAAN;KADF;IAEA,SAAS,CAAC,CAAC,MAAF,CAAS,EAAT,EACP;MAAA,OACE;QAAA,MAAM,QAAN;QACA,sBACE;UAAA,MAAM,QAAN;SAFF;OADF;MAIA,eACE;QAAA,MAAM,CACJ,MADI,EAEJ,QAFI,CAAN;OALF;MASA,qBACE;QAAA,MAAM,QAAN;OAVF;KADO,CAFT;IAeA,UACE;MAAA,MAAM,CACJ,MADI,EAEJ,QAFI,CAAN;KAhBF;IAoBA,SACE;MAAA,MAAM,SAAN;KArBF;IAsBA,OACE;MAAA,MAAM,QAAN;KAvBF;IAwBA,QACE;MAAA,MAAM,QAAN;MACA,sBACE;QAAA,OAAO,OAAP;QACA,MAAM,QADN;QAEA,YACE;UAAA,SACE;YAAA,MAAM,QAAN;YACA,sBACE;cAAA,OAAO,cAAP;cACA,MAAM,QADN;cAEA,YACE;gBAAA,SACE;kBAAA,MAAM,QAAN;iBADF;gBAEA,QACE;kBAAA,MAAM,QAAN;iBAHF;eAHF;aAFF;WADF;SAHF;OAFF;KAzBF;IAwCA,YACE;MAAA,MAAM,QAAN;MACA,aAAa,qCADb;MAEA,sBACE;QAAA,OAAO,YAAP;QACA,MAAM,QADN;QAEA,YACE;UAAA,QAAQ;YAAA,QAAM,CAAC,SAAD,EAAY,YAAZ,EAA0B,SAA1B,CAAN;WAAR;SAHF;OAHF;KAzCF;IAgDA,iBACE;MAAA,aAAa,oGAAb;MACA,MAAM,SADN;MAEA,SAAS,CAFT;KAjDF;IAoDA,YACE;MAAA,aAAa,0FAAb;MACA,MAAM,SADN;MAEA,SAAS,CAFT;KArDF;IAwDA,gCAAgC,CAAC,CAAC,IAAF,CAC9B;MAAA,aAAa,iFAAb;KAD8B,CAxDhC;IA0DA,aACE;MAAA,aAAa,2EAAb;MACA,MAAM,OADN;MAEA,OAAO,CAAC,CAAC,MAAF,CAAS;QAAC,UAAU,CAAC,QAAD,EAAW,OAAX,EAAoB,MAApB,EAA4B,QAA5B,CAAX;OAAT,EACL;QAAA,QAAQ;UAAC,MAAM,QAAP;SAAR;QACA,MAAM;UAAC,MAAM,QAAP;SADN;QAEA,OAAO;UAAC,MAAM,QAAP;UAAiB,QAAM,CAAC,OAAD,EAAU,OAAV,EAAmB,QAAnB,CAAvB;SAFP;QAGA,MAAM;UAAC,MAAM,QAAP;UAAiB,SAAS,CAA1B;SAHN;QAIA,QAAQ;UAAC,MAAM,SAAP;SAJR;QAKA,KAAK,CAAC,CAAC,MAAF,CAAS;UAAC,UAAU,CAAC,GAAD,EAAM,GAAN,CAAX;SAAT,EACH;UAAA,GAAG;YAAC,MAAM,QAAP;WAAH;UACA,GAAG;YAAC,MAAM,QAAP;WADH;SADG,CALL;QAQA,QAAQ;UAAC,MAAM,QAAP;UAAiB,QAAM,CAAC,OAAD,CAAvB;SARR;OADK,CAFP;KA3DF;IAuEA,WAAW,CAAC,CAAC,KAAF,CAAQ,EAAR,EACT,CAAC,CAAC,MAAF,CAAS,EAAT,EACE;MAAA,MAAM,CAAC,CAAC,WAAF,CAAc;QAAA,QAAQ,CAAC,MAAD,EAAS,cAAT,EAAyB,cAAzB,EAAyC,gBAAzC,EAA2D,YAA3D,CAAR;OAAd,CAAN;MACA,MAAM,CAAC,CAAC,IAAF,CACJ;QAAA,aAAa,oDAAb;OADI,CADN;MAGA,OAAO;QAAC,MAAM,QAAP;OAHP;KADF,CADS,CAvEX;GADK,CAjCP;EAgHA,MACE;IAAA,MAAM,QAAN;IACA,sBACE;MAAA,MAAM,QAAN;MACA,sBACE;QAAA,MAAM,QAAN;QACA,QAAQ,MADR;OAFF;KAFF;GAjHF;EAwHA,UACE;IAAA,MAAM,OAAN;GAzHF;EA2HA,cACE;IAAA,MAAM,QAAN;GA5HF;EA8HA,UACE;IAAA,MAAM,QAAN;IACA,OAAO,UADP;IAEA,aAAa,+CAFb;GA/HF;EAmIA,YACE;IAAA,MAAM,QAAN;IACA,sBACE;MAAA,MAAM,OAAN;KAFF;GApIF;EAwIA,SACE;IAAA,MAAM,QAAN;GAzIF;EA2IA,MACE;IAAA,MAAM,OAAN;GA5IF;EA8IA,6BACE;IAAA,MAAM,SAAN;IACA,SAAS,CADT;IAEA,aAAa,qFAFb;GA/IF;EAmJA,cACE;IAAA,MAAM,QAAN;GApJF;EAsJA,mBACE;IAAA,MAAM,QAAN;IACA,SAAS,CADT;GAvJF;EA0JA,YACE;IAAA,MAAM,QAAN;GA3JF;EA6JA,WACE;IAAA,MAAM,SAAN;GA9JF;EAgKA,YAAY,CAAC,CAAC,IAAF,CACV;IAAA,OAAO,WAAP;GADU,CAhKZ;EAmKA,eACE;IAAA,MAAM,QAAN;IACA,sBACE;MAAA,MAAM,QAAN;MACA,sBACE;QAAA,MAAM,QAAN;QACA,QAAQ,MADR;OAFF;KAFF;GApKF;EA2KA,uBACE;IAAA,MAAM,QAAN;GA5KF;EA8KA,WACE;IAAA,MAAM,SAAN;IACA,aAAa,iFADb;GA/KF;EAkLA,uBACE;IAAA,MAAM,QAAN;IACA,aAAa,0HADb;IAEA,SAAS,CAFT;IAGA,SAAS,CAHT;GAnLF;EAwLA,cACE;IAAA,MAAM,SAAN;IACA,aAAa,qGADb;GAzLF;EA4LA,qBACE;IAAA,MAAM,QAAN;GA7LF;EA+LA,gBACE;IAAA,MAAM,QAAN;GAhMF;EAkMA,cACE;IAAA,MAAM,OAAN;IACA,OAAO,eADP;IAEA,aAAa,+DAFb;IAGA,OACE;MAAA,OAAO,qBAAP;MACA,aAAa,uDADb;MAEA,MAAM,OAFN;MAGA,OACE;QAAA,MAAM,QAAN;OAJF;KAJF;GAnMF;EA6MA,SACE;IAAA,MAAM,OAAN;IACA,OAAO,SADP;IAEA,aAAa,yEAFb;IAGA,OACE;MAAA,MAAM,QAAN;MACA,YACE;QAAA,MAAM,CAAC,CAAC,IAAF,CACJ;UAAA,OAAO,eAAP;UACA,aAAa,gCADb;SADI,CAAN;QAGA,UACE;UAAA,OAAO,iBAAP;UACA,aAAa,mGADb;UAEA,MAAM,QAFN;SAJF;QAOA,SACE;UAAA,MAAM,QAAN;UACA,OAAO,SADP;UAEA,aAAa,mDAFb;UAGA,YACE;YAAA,MACE;cAAA,OAAO,MAAP;cACA,aAAa,mFADb;cAEA,MAAM,QAFN;aADF;WAJF;SARF;QAgBA,WACE;UAAA,MAAM,OAAN;UACA,OAAO,WADP;UAEA,aAAa,kFAFb;UAGA,OACE;YAAA,MAAM,QAAN;YACA,YACE;cAAA,WACE;gBAAA,OAAO,qBAAP;gBACA,aAAa,gCADb;gBAEA,MAAM,CAAC,QAAD,EAAW,QAAX,EAAqB,MAArB,CAFN;eADF;cAIA,QACE;gBAAA,OAAO,kBAAP;gBACA,aAAa,4BADb;gBAEA,MAAM,CAAC,QAAD,EAAW,QAAX,EAAqB,MAArB,CAFN;eALF;cAQA,MACE;gBAAA,OAAO,eAAP;gBACA,aAAa,0BADb;gBAEA,MAAM,CAAC,QAAD,EAAW,MAAX,CAFN;eATF;cAYA,YACE;gBAAA,OAAO,sBAAP;gBACA,aAAa,sDADb;gBAEA,MAAM,CAAC,QAAD,EAAW,QAAX,EAAqB,MAArB,CAFN;eAbF;cAgBA,SACE;gBAAA,MAAM,QAAN;gBACA,YACE;kBAAA,MACE;oBAAA,OAAO,eAAP;oBACA,aAAa,0CADb;oBAEA,MAAM,QAFN;mBADF;iBAFF;eAjBF;cAuBA,cACE;gBAAA,MAAM,CAAC,QAAD,EAAW,MAAX,CAAN;gBACA,aAAa,+DADb;eAxBF;aAFF;WAJF;SAjBF;QAiDA,WAAW;UAAC,MAAM,QAAP;UAAiB,aAAa,6DAA9B;SAjDX;QAkDA,YAAY;UAAC,aAAa,yDAAd;SAlDZ;OAFF;KAJF;GA9MF;EAwQA,SACE,CAAC,CAAC,KAAF,CAAQ;IAAC,aAAa,qGAAd;GAAR,EACE,CAAC,CAAC,MAAF,CAAS,EAAT,EACE;IAAA,UAAU;MAAC,MAAM,QAAP;MAAiB,aAAa,0DAA9B;KAAV;IACA,OAAO,CAAC,CAAC,MAAF,CAAS;MAAC,aAAa,yEAAd;KAAT,CADP;IAEA,wBAAwB,CAAC,CAAC,IAAF,CAAO;MAAC,aAAa,wHAAd;KAAP,CAFxB;GADF,CADF,CAzQF;EA+QA,gBACE;IAAA,MAAM,SAAN;IACA,OAAO,kBADP;IAEA,aAAa,0DAFb;GAhRF;CAFF;;AAsRA,kBAAkB,CAAC,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC,UAA7D,GAA0E,CAAC,CAAC,IAAF,CAAO,kBAAkB,CAAC,UAA1B,EAAsC,cAAtC,EAAsD,mBAAtD,EAA2E,YAA3E,EAAyF,qBAAzF,EAAgH,gBAAhH,EAAkI,cAAlI,EAAkJ,SAAlJ;;AAE1E,CAAC,CAAC,qBAAF,CAAwB,kBAAxB,EAA4C,eAA5C;;AACA,CAAC,CAAC,2BAAF,CAA8B,kBAA9B,EAAkD,eAAlD;;AAEA,MAAM,CAAC,OAAP,GAAiB","file":"public/javascripts/app/schemas/models/level_session.js","sourcesContent":["c = require './../schemas'\r\n\r\nLevelSessionPlayerSchema = c.object\r\n  id: c.objectId\r\n    links: [\r\n      {\r\n        rel: 'extra'\r\n        href: '/db/user/{($)}'\r\n      }\r\n    ]\r\n  time:\r\n    type: 'Number'\r\n  changes:\r\n    type: 'Number'\r\n\r\nLevelSessionLevelSchema = c.object {required: ['original', 'majorVersion'], links: [{rel: 'db', href: '/db/level/{(original)}/version/{(majorVersion)}'}]},\r\n  original: c.objectId({})\r\n  majorVersion:\r\n    type: 'integer'\r\n    minimum: 0\r\n\r\nLevelSessionSchema = c.object\r\n  title: 'Session'\r\n  description: 'A single session for a given level.'\r\n  default:\r\n    codeLanguage: 'python'\r\n    submittedCodeLanguage: 'python'\r\n    playtime: 0\r\n\r\n_.extend LevelSessionSchema.properties,\r\n  # denormalization\r\n  browser:\r\n    type: 'object'\r\n  creatorName:\r\n    type: 'string'\r\n  levelName:\r\n    type: 'string'\r\n  levelID:\r\n    type: 'string'\r\n  creator: c.objectId\r\n    links:\r\n      [\r\n        {\r\n          rel: 'extra'\r\n          href: '/db/user/{($)}'\r\n        }\r\n      ]\r\n  created: c.date\r\n    title: 'Created'\r\n    readOnly: true\r\n\r\n  changed: c.date\r\n    title: 'Changed'\r\n    readOnly: true\r\n\r\n  dateFirstCompleted: {} # c.stringDate\r\n#    title: 'Completed'\r\n#    readOnly: true\r\n\r\n  team: c.shortString()\r\n  level: LevelSessionLevelSchema\r\n\r\n  heroConfig: c.HeroConfigSchema\r\n\r\n  state: c.object {},\r\n    complete:\r\n      type: 'boolean'\r\n    scripts: c.object {},\r\n      ended:\r\n        type: 'object'\r\n        additionalProperties:\r\n          type: 'number'\r\n      currentScript:\r\n        type: [\r\n          'null'\r\n          'string'\r\n        ]\r\n      currentScriptOffset:\r\n        type: 'number'\r\n\r\n    selected:  # Not tracked any more, delete with old level types\r\n      type: [\r\n        'null'\r\n        'string'\r\n      ]\r\n    playing:\r\n      type: 'boolean'  # Not tracked any more, delete with old level types\r\n    frame:\r\n      type: 'number'  # Not tracked any more, delete with old level types\r\n    thangs:   # ... what is this? Is this used?\r\n      type: 'object'\r\n      additionalProperties:\r\n        title: 'Thang'\r\n        type: 'object'\r\n        properties:\r\n          methods:\r\n            type: 'object'\r\n            additionalProperties:\r\n              title: 'Thang Method'\r\n              type: 'object'\r\n              properties:\r\n                metrics:\r\n                  type: 'object'\r\n                source:\r\n                  type: 'string'\r\n    goalStates:\r\n      type: 'object'\r\n      description: 'Maps Goal ID on a goal state object'\r\n      additionalProperties:\r\n        title: 'Goal State'\r\n        type: 'object'\r\n        properties:\r\n          status: enum: ['failure', 'incomplete', 'success']\r\n    submissionCount:\r\n      description: 'How many times the session has been submitted for real-time playback (can affect the random seed).'\r\n      type: 'integer'\r\n      minimum: 0\r\n    difficulty:\r\n      description: 'The highest difficulty level beaten, for use in increasing-difficulty replayable levels.'\r\n      type: 'integer'\r\n      minimum: 0\r\n    lastUnsuccessfulSubmissionTime: c.date\r\n      description: 'The last time that real-time submission was started without resulting in a win.'\r\n    flagHistory:\r\n      description: 'The history of flag events during the last real-time playback submission.'\r\n      type: 'array'\r\n      items: c.object {required: ['player', 'color', 'time', 'active']},\r\n        player: {type: 'string'}\r\n        team: {type: 'string'}\r\n        color: {type: 'string', enum: ['green', 'black', 'violet']}\r\n        time: {type: 'number', minimum: 0}\r\n        active: {type: 'boolean'}\r\n        pos: c.object {required: ['x', 'y']},\r\n          x: {type: 'number'}\r\n          y: {type: 'number'}\r\n        source: {type: 'string', enum: ['click']}  # Do not store 'code' flag events in the session.\r\n    topScores: c.array {},\r\n      c.object {},\r\n        type: c.shortString('enum': ['time', 'damage-taken', 'damage-dealt', 'gold-collected', 'difficulty'])\r\n        date: c.date\r\n          description: 'When the submission achieving this score happened.'\r\n        score: {type: 'number'}  # Store 'time' and 'damage-taken' as negative numbers so the index works.\r\n\r\n  code:\r\n    type: 'object'\r\n    additionalProperties:\r\n      type: 'object'\r\n      additionalProperties:\r\n        type: 'string'\r\n        format: 'code'\r\n\r\n  codeLogs:\r\n    type: 'array'\r\n\r\n  codeLanguage:\r\n    type: 'string'\r\n\r\n  playtime:\r\n    type: 'number'\r\n    title: 'Playtime'\r\n    description: 'The total playtime on this session in seconds'\r\n\r\n  teamSpells:\r\n    type: 'object'\r\n    additionalProperties:\r\n      type: 'array'\r\n\r\n  players:\r\n    type: 'object'\r\n\r\n  chat:\r\n    type: 'array'\r\n\r\n  ladderAchievementDifficulty:\r\n    type: 'integer'\r\n    minimum: 0\r\n    description: 'What ogre AI difficulty, 0-4, this human session has beaten in a multiplayer arena.'\r\n\r\n  meanStrength:\r\n    type: 'number'\r\n\r\n  standardDeviation:\r\n    type: 'number'\r\n    minimum: 0\r\n\r\n  totalScore:\r\n    type: 'number'\r\n\r\n  submitted:\r\n    type: 'boolean'\r\n\r\n  submitDate: c.date\r\n    title: 'Submitted'\r\n\r\n  submittedCode:\r\n    type: 'object'\r\n    additionalProperties:\r\n      type: 'object'\r\n      additionalProperties:\r\n        type: 'string'\r\n        format: 'code'\r\n\r\n  submittedCodeLanguage:\r\n    type: 'string'\r\n\r\n  isRanking:\r\n    type: 'boolean'\r\n    description: 'Whether this session is still in the first ranking chain after being submitted.'\r\n\r\n  randomSimulationIndex:\r\n    type: 'number'\r\n    description: 'A random updated every time the game is randomly simulated for a uniform random distribution of simulations (see #2448).'\r\n    minimum: 0\r\n    maximum: 1\r\n\r\n  unsubscribed:\r\n    type: 'boolean'\r\n    description: 'Whether the player has opted out of receiving email updates about ladder rankings for this session.'\r\n\r\n  numberOfWinsAndTies:\r\n    type: 'number'\r\n\r\n  numberOfLosses:\r\n    type: 'number'\r\n\r\n  scoreHistory:\r\n    type: 'array'\r\n    title: 'Score History'\r\n    description: 'A list of objects representing the score history of a session'\r\n    items:\r\n      title: 'Score History Point'\r\n      description: 'An array with the format [unix timestamp, totalScore]'\r\n      type: 'array'\r\n      items:\r\n        type: 'number'\r\n\r\n  matches:\r\n    type: 'array'\r\n    title: 'Matches'\r\n    description: 'All of the matches a submitted session has played in its current state.'\r\n    items:\r\n      type: 'object'\r\n      properties:\r\n        date: c.date\r\n          title: 'Date computed'\r\n          description: 'The date a match was computed.'\r\n        playtime:\r\n          title: 'Playtime so far'\r\n          description: 'The total seconds of playtime on this session when the match was computed. Not currently tracked.'\r\n          type: 'number'\r\n        metrics:\r\n          type: 'object'\r\n          title: 'Metrics'\r\n          description: 'Various information about the outcome of a match.'\r\n          properties:\r\n            rank:\r\n              title: 'Rank'\r\n              description: 'A 0-indexed ranking representing the player\\'s standing in the outcome of a match'\r\n              type: 'number'\r\n        opponents:\r\n          type: 'array'\r\n          title: 'Opponents'\r\n          description: 'An array containing information about the opponents\\' sessions in a given match.'\r\n          items:\r\n            type: 'object'\r\n            properties:\r\n              sessionID:\r\n                title: 'Opponent Session ID'\r\n                description: 'The session ID of an opponent.'\r\n                type: ['object', 'string', 'null']\r\n              userID:\r\n                title: 'Opponent User ID'\r\n                description: 'The user ID of an opponent'\r\n                type: ['object', 'string', 'null']\r\n              name:\r\n                title: 'Opponent name'\r\n                description: 'The name of the opponent'\r\n                type: ['string', 'null']\r\n              totalScore:\r\n                title: 'Opponent total score'\r\n                description: 'The totalScore of a user when the match was computed'\r\n                type: ['number', 'string', 'null']\r\n              metrics:\r\n                type: 'object'\r\n                properties:\r\n                  rank:\r\n                    title: 'Opponent Rank'\r\n                    description: 'The opponent\\'s ranking in a given match'\r\n                    type: 'number'\r\n              codeLanguage:\r\n                type: ['string', 'null']  # 'null' in case an opponent session got corrupted, don't care much here\r\n                description: 'What submittedCodeLanguage the opponent used during the match'\r\n        simulator: {type: 'object', description: 'Holds info on who simulated the match, and with what tools.'}\r\n        randomSeed: {description: 'Stores the random seed that was used during this match.'}\r\n\r\n  leagues:\r\n    c.array {description: 'Multiplayer data for the league corresponding to Clans and CourseInstances the player is a part of.'},\r\n      c.object {},\r\n        leagueID: {type: 'string', description: 'The _id of a Clan or CourseInstance the user belongs to.'}\r\n        stats: c.object {description: 'Multiplayer match statistics corresponding to this entry in the league.'}\r\n        lastOpponentSubmitDate: c.date {description: 'The submitDate of the last league session we selected to play against (for playing through league opponents in order).'}\r\n\r\n  isForClassroom:\r\n    type: 'boolean'\r\n    title: 'Is For Classroom'\r\n    description: 'The level session was created for a user inside a course'\r\n\r\nLevelSessionSchema.properties.leagues.items.properties.stats.properties = _.pick LevelSessionSchema.properties, 'meanStrength', 'standardDeviation', 'totalScore', 'numberOfWinsAndTies', 'numberOfLosses', 'scoreHistory', 'matches'\r\n\r\nc.extendBasicProperties LevelSessionSchema, 'level.session'\r\nc.extendPermissionsProperties LevelSessionSchema, 'level.session'\r\n\r\nmodule.exports = LevelSessionSchema\r\n"]}